# BlinnPhong材质详解

###### *version :2.1.0beta   Update:2019-5-14*

Because the standard and other materials in Unity are different from those in LayaAir, when developers use the exported 3D resources, we will find that the effect of art will be different from that in Unity. It is inconvenient for developers to modify the properties of various materials or adjust the lighting in the code to achieve the desired effect.

In order to make the operation of the LayaAir engine consistent with the fine art in Unity, LayaAir official adds BlinnPhongMaterial material to the Unity export plug-in and the engine, allowing developers to see what they get, reducing the time of code modification and improving the efficiency of the work. Therefore, it is suggested that the material should be used as far as possible in future development.

####Main attributes and methods are described in detail:

> attribute

`albedoColor:Vector4`Albedo color.

`albedoIntensity:Number`Albedo intensity.

`albedoTexture:BaseTexture`Albedo mapping.

`enableLighting:Boolean`Whether illumination is enabled.

`normalTexture:BaseTexture`Normal mapping.

`renderMode:int`[write-only] Sets the rendering mode.

`shininess:Number`  高光强度,范围为0到1。

`specularColor:Vector4`High light color.

`specularTexture:BaseTexture`High-light mapping.

`tilingOffset:Vector4`Texture tiling and migration.



####Scene One-click Conversion to BlinnPhong Material

After installing the new plug-in, a key is added to the Untiy LayaAir3D menu to convert the scene material into BlinnPhong material (Figure 6). After clicking the menu LayaAir Tool - --> Switch Shader to LayaBlinnPhong option, you can find that the model in the resource interface will become purple, and the effect in the scene will also change, indicating that the material type has been modified successfully.

![] (img/1.png)<br> (Figure 1)

Selecting any model in the scene with the mouse, we can see that a new Shader type of material appears in the Inspector panel on the right (Figure 7). Material attributes are different from the Standard standard material in Unity, which simplifies a lot and removes some attributes that LayaAir does not support. We can change the display of the model by modifying these properties.

![] (img/2.png)<br> (Figure 2)

####Manual Modification to BlinnPhong Material

In general, we recommend using a key in the menu to convert to BlinnPhong material, so that all materials in the scene will be modified, and no material can be found or ignored, resulting in the unmodified situation.

Of course, when creating new materials, standard materials are generated by default, which requires developers to manually modify the Shader type of materials to BlinnPhong. When we install the plug-in, the LayaAir3D option appears in the Shader type of the Material Panel for our modification. (Fig. 3)

![图片3](img/3.gif)<br> (Figure 3)

BlinnPhong Material Material Luminous Mapping Attributes are basically the same as the standard material. In Unity Material Panel, the following attributes can be adjusted:

#####diffuse map

**Diffuse Map**In the game, it shows the reflection and color of the object's surface. In other words, it can show the color and intensity of an object when it is illuminated by light. As shown in Figure 9, you can see the original demo::（[demo地址](http://localhost/LayaAir2_Auto/%3Chttps://layaair.ldc.layabox.com/demo2/?language=ch&category=3d&group=Material&name=BlinnPhong_DiffuseMap%3E))


```typescript

var material = new Laya.BlinnPhongMaterial();
//漫反射贴图
Laya.Texture2D.load("res/threeDimen/texture/earth.png", Laya.Handler.create(this, function(texture) {
    //设置材质纹理
	material.albedoTexture = texture;
}));

earth2.meshRenderer.material = material;
```


![] (img/4.png)<br> (Figure 4)

#####normal map

**Normal maps**It is a grayscale image that can be used as a height map of an object to display a concave and convex surface, as shown in Figure 10. You can see the official example in more detail.（[demo地址](http://localhost/LayaAir2_Auto/%3Chttps://layaair.ldc.layabox.com/demo2/?language=ch&category=3d&group=Material&name=BlinnPhong_NormalMap%3E))


```typescript

var material = meshSprite3D.meshRenderer.material as Laya.BlinnPhongMaterial;
//法线贴图
Laya.Texture2D.load(normalMapUrl[i], Laya.Handler.create(this, function(texture) {
    //设置发现贴图
    material.normalTexture = texture;
}));
```


![] (img/5.png)<br> (Fig. 5)

#####Specular Map

**Specular Map**It is used to represent the surface properties of a model when light shines on it. (e.g. metal and skin, cloth and plastics reflect different amounts of light) so as to distinguish different materials. Highlight mapping reproduces specular reflections and highlight colors on the surface of objects in the engine. The more reflective the material is. As shown in Figure 7, you can see the official example in more detail（[demo地址](http://localhost/LayaAir2_Auto/%3Chttps://layaair.ldc.layabox.com/demo2/?language=ch&category=3d&group=Material&name=BlinnPhong_SpecularMap%3E))


```typescript

//获取Sprite3D上的蒙皮网格精灵节点
var skinnedMeshSprite3d = dude2.getChildAt(0).getChildAt(0) as Laya.SkinnedMeshSprite3D;
//历遍蒙皮网格节点的材质列表
for (var i:int = 0; i < skinnedMeshSprite3d.skinnedMeshRenderer.materials.length; i++) {
    //获取对应材质
    var material = skinnedMeshSprite3d.skinnedMeshRenderer.materials[i] as Laya.BlinnPhongMaterial;
    //加载对应的贴图
	Laya.Texture2D.load(specularMapUrl[i], Laya.Handler.create(this,function(mat, tex) {
        mat.specularTexture = tex;//设置高光贴图
    }, [material]));
}
```


![] (img/6.png)<br> (fig. 6)
