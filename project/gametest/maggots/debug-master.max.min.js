var Laya=window.Laya=function(t){var e={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,i){return 1==arguments.length?e.__presubstr.call(this,t):e.__presubstr.call(this,t,i>0?i:this.length+i)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var n=0;t>n;n++)i[n]=e;return i},__extend:function(t,i){function n(){e.un(this,"constructor",t)}for(var r in i)if(i.hasOwnProperty(r)){var a=Object.getOwnPropertyDescriptor(i,r),s=a.get,o=a.set;s||o?s&&o?Object.defineProperty(t,r,a):(s&&Object.defineProperty(t,r,s),o&&Object.defineProperty(t,r,o)):t[r]=i[r]}n.prototype=i.prototype,t.prototype=new n,e.un(t.prototype,"__imps",e.__copy({},i.prototype.__imps))},__copy:function(t,e){if(!e)return null;t=t||{};for(var i in e)t[i]=e[i];return t},__package:function(i,n){if(!e.__packages[i]){e.__packages[i]=!0;var r=t,a=i.split(".");if(a.length>1)for(var s=0,o=a.length-1;o>s;s++){var l=r[a[s]];r=l?l:r[a[s]]={}}r[a[a.length-1]]||(r[a[a.length-1]]=n||{})}},__hasOwnProperty:function(t,e){function i(t,e){if(Object.hasOwnProperty.call(e.prototype,t))return!0;var n=e.prototype.__super;return null==n?null:i(t,n)}return e=e||this,Object.hasOwnProperty.call(e,t)||i(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e===String)return"string"==typeof t;if(e===Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},__int:function(t){return t?parseInt(t):0},"interface":function(i,n){e.__package(i,{});var r=e.__internals,a=r[i]=r[i]||{self:i};if(n){var s=n.split(",");a.extend=[];for(var o=0;o<s.length;o++){var l=s[o];r[l]=r[l]||{self:l},a.extend.push(r[l])}}for(var _=t,h=i.split("."),o=0;o<h.length-1;o++)_=_[h[o]];_[h[h.length-1]]={__interface__:i}},"class":function(i,n,r,a){if(r&&e.__extend(i,r),n)if(e.__package(n,i),e.__classmap[n]=i,n.indexOf(".")>0){if(0==n.indexOf("laya.")){var s=n.split(".");a=a||s[s.length-1],e[a]&&console.log("Warning!,this class["+a+"] already exist:",e[a]),e[a]=i}}else"Main"==n?t.Main=i:(e[n]&&console.log("Error!,this class["+n+"] already exist:",e[n]),e[n]=i);var o=e.un,l=i.prototype;o(l,"hasOwnProperty",e.__hasOwnProperty),o(l,"__class",i),o(l,"__super",r),o(l,"__className",n),o(i,"__super",r),o(i,"__className",n),o(i,"__isclass",!0),o(i,"super",function(t){this.__super.call(t)})},imps:function(t,i){function n(t){var i,a;if((i=e.__internals[t])&&(r[t]=!0,a=i.extend))for(var s=0;s<a.length;s++)n(a[s].self)}if(!i)return null;var r=t.__imps||e.un(t,"__imps",{});for(var a in i)n(a)},superSet:function(t,e,i,n){var r=t.prototype["_$set_"+i];r&&r.call(e,n)},superGet:function(t,e,i){var n=t.prototype["_$get_"+i];return n?n.call(e):null},getset:function(t,i,n,r,a){t?(r&&(i["_$GET_"+n]=r),a&&(i["_$SET_"+n]=a)):(r&&e.un(i,"_$get_"+n,r),a&&e.un(i,"_$set_"+n,a)),r&&a?Object.defineProperty(i,n,{get:r,set:a,enumerable:!1,configurable:!0}):(r&&Object.defineProperty(i,n,{get:r,enumerable:!1,configurable:!0}),a&&Object.defineProperty(i,n,{set:a,enumerable:!1,configurable:!0}))},"static":function(t,e){function i(){var i=e[n],r=e[n+1];Object.defineProperty(t,i,{get:function(){return delete this[i],this[i]=r.call(this)},set:function(t){delete this[i],this[i]=t},enumerable:!0,configurable:!0})}for(var n=0,r=e.length;r>n;n+=2)"length"==e[n]?t.length=e[n+1].call(t):i()},un:function(t,i,n){return n||(n=t[i]),e.__propun.value=n,Object.defineProperty(t,i,e.__propun),n},uns:function(t,i){i.forEach(function(i){e.un(t,i)})}};return t.console=t.console||{log:function(){}},t.trace=t.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),e}(window,document);!function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;Laya.interface("laya.d3.core.IClone"),Laya.interface("laya.runtime.IMarket"),Laya.interface("laya.filters.IFilter"),Laya.interface("laya.resource.IDispose"),Laya.interface("laya.resource.IDestroy"),Laya.interface("laya.resource.IListPool"),Laya.interface("laya.webgl.shapes.IShape"),Laya.interface("laya.d3.graphics.IVertex"),Laya.interface("laya.webgl.submit.ISubmit"),Laya.interface("laya.filters.IFilterAction"),Laya.interface("laya.d3.core.scene.ITreeNode"),Laya.interface("laya.runtime.ICPlatformClass"),Laya.interface("laya.resource.ICreateResource"),Laya.interface("laya.webgl.canvas.save.ISaveData"),Laya.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var ___Laya=function(){return __getset(1,Laya,"alertGlobalError",null,function(t){var e=0;Browser.window.onerror=t?function(t,i,n,r,a){e++<5&&a&&alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+a.stack)}:null}),Laya.init=function(t,e){for(var i=[],n=2,r=arguments.length;r>n;n++)i.push(arguments[n]);if(!Laya._isinit){Laya._isinit=!0,window.conch&&RunDriver.enableNative(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=Laya._arrayBufferSlice),Browser.__init__(),Render.isConchApp||Context.__init__(),Laya.timer=new Timer,Laya.startTimer=new Timer,Laya.physicsTimer=new Timer,Laya.updateTimer=new Timer,Laya.lateTimer=new Timer,Laya.renderTimer=new Timer,Laya.loader=new LoaderManager,WeakObject.__init__();for(var n=0,a=i.length;a>n;n++)i[n].enable&&i[n].enable();return ResourceManager.__init__(),CacheManger.beginCheck(),Laya._currentStage=Laya.stage=new Stage,Laya.getUrlPath(),Laya.render=new Render(0,0),Laya.stage.size(t,e),window.stage=Laya.stage,RenderSprite.__init__(),KeyBoardManager.__init__(),MouseManager.instance.__init__(Laya.stage,Render.canvas),Input.__init__(),SoundManager.autoStopMusic=!0,LayaNative2D.__init__(),Render.canvas}},Laya.getUrlPath=function(){var t=Browser.window.location,e=t.pathname;e=":"==e.charAt(2)?e.substring(1):e,URL.rootPath=URL.basePath=URL.getPath("file:"==t.protocol?e:t.protocol+"//"+t.host+t.pathname)},Laya._arrayBufferSlice=function(t,e){var i=this,n=new Uint8Array(i,t,e-t),r=new Uint8Array(n.length);return r.set(n),r.buffer},Laya._runScript=function(t){return Browser.window["e"+String.fromCharCode(118)+"al"](t)},Laya.enableDebugPanel=function(t){void 0===t&&(t="libs/laya.debugtool.js");var e=Browser.createElement("script");e.onload=function(){Laya.DebugPanel.init()},e.src=t,Browser.document.body.appendChild(e)},Laya.stage=null,Laya.timer=null,Laya.startTimer=null,Laya.physicsTimer=null,Laya.updateTimer=null,Laya.lateTimer=null,Laya.renderTimer=null,Laya.loader=null,Laya.version="1.7.7beta",Laya.render=null,Laya._currentStage=null,Laya._isinit=!1,__static(Laya,["conchMarket",function(){return this.conchMarket=window.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=window.PlatformClass}]),Laya}(),SaveBase=function(){function t(){}__class(t,"laya.webgl.canvas.save.SaveBase");var e=t.prototype;return Laya.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._dataObj[this._valueName]=this._value,t.POOL[t.POOL._length++]=this,this._newSubmit&&(e._curSubmit=Submit.RENDERBASE)},t._createArray=function(){var t=[];return t._length=0,t},t._init=function(){var e=t._namemap={};return e[1]="ALPHA",e[2]="fillStyle",e[8]="font",e[256]="lineWidth",e[512]="strokeStyle",e[8192]="_mergeID",e[1024]=e[2048]=e[4096]=[],e[16384]="textBaseline",e[32768]="textAlign",e[65536]="_nBlendType",e[1048576]="shader",e[2097152]="filters",e},t.save=function(e,i,n,r){if((e._saveMark._saveuse&i)!==i){e._saveMark._saveuse|=i;var a=t.POOL,s=a._length>0?a[--a._length]:new t;s._value=n[s._valueName=t._namemap[i]],s._dataObj=n,s._newSubmit=r;var o=e._save;o[o._length++]=s}},t.POOL=laya.webgl.canvas.save.SaveBase._createArray(),t._namemap=t._init(),t}(),Main=function(){function t(){this.texturePath="monkey.png",this.texture=null,this.sp=null,Laya.init(800,600,WebGL),Stat.show(),Laya.loader.load(this.texturePath,Handler.create(this,this.onTextureLoaded))}__class(t,"Main");var e=t.prototype;return e.onTextureLoaded=function(){this.texture=Laya.loader.getRes(this.texturePath),this.init(),Laya.timer.frameLoop(1,this,this.animate)},e.init=function(){this.sp=Laya.stage.addChild(new Sprite),this.sp.x=100,this.sp.y=100,this.sp.pivotX=55,this.sp.pivotY=72.5,this.sp.graphics.drawTexture(this.texture,0,0);var t=new Sprite;t.x=100,t.y=100,t.graphics.drawTexture(this.texture,0,0),this.sp.addChild(t);var e=new Sprite;e.scale(2,2),e.rotation=45,e.x=100,e.y=100,e.graphics.drawTexture(this.texture,0,0),e.graphics.drawPoly(10,10,[10,10,100,10,100,100,10,100,50,50,10,10],"red","blue"),t.addChild(e)},e.animate=function(){this.sp.rotation++},t}(),PerformanceTest_Maggots=function(){function t(){this.texturePath="res/tinyMaggot.png",this.texturePath1="res/tinyMaggot1.png",this.padding=100,this.maggotAmount=5e3,this.tick=0,this.maggots=[],this.wrapBounds=null,this.maggotTexture=null,this.maggotTexture1=null,MiniAdpter.init(),Render.isConchApp?Laya.init(window.innerWidth,window.innerHeight,WebGL):Laya.init(Browser.width,Browser.height,WebGL),Stat.show(),Laya.stage.scaleMode="fixedwidth",this.wrapBounds=new Rectangle(-this.padding,-this.padding,Laya.stage.width+2*this.padding,Laya.stage.height+2*this.padding),Laya.loader.load(this.texturePath,Handler.create(this,this.onTextureLoaded)),Laya.loader.load(this.texturePath1,Handler.create(this,this.onTextureLoaded1))}__class(t,"PerformanceTest_Maggots");var e=t.prototype;return e.onTextureLoaded=function(){this.maggotTexture=Laya.loader.getRes(this.texturePath),this.maggotTexture1&&(this.initMaggots(),Laya.timer.frameLoop(1,this,this.animate))},e.onTextureLoaded1=function(){this.maggotTexture1=Laya.loader.getRes(this.texturePath1),this.maggotTexture&&(this.initMaggots(),Laya.timer.frameLoop(1,this,this.animate))},e.initMaggots=function(){for(var t,e=0;e<this.maggotAmount;e++){e%16e3==0&&(t=this.createNewContainer());var i=this.newMaggot(e);t.addChild(i),this.maggots.push(i)}},e.createNewContainer=function(){var t=new Sprite;return t.size(Browser.clientWidth,Browser.clientHeight),Laya.stage.addChild(t),t},e.newMaggot=function(t){var e=new Maggot;e.texture=t%50==0?this.maggotTexture1:this.maggotTexture,e.pivot(16.5,35);var i=.8+.3*Math.random();return e.scale(i,i),e.rotation=1,e.x=Math.random()*Laya.stage.width,e.y=Math.random()*Laya.stage.height,e.direction=Math.random()*Math.PI,e.turningSpeed=.01*(Math.random()-.8),e.speed=.2*(2+2*Math.random()),e.offset=100*Math.random(),e},e.animate=function(){for(var t,e,i=this.wrapBounds,n=180/Math.PI,r=0,a=0,s=0;s<this.maggotAmount;s++){t=this.maggots[s];var o=.9+.1*Math.sin(this.tick+t.offset);t.direction+=t.turningSpeed,e=t.direction,r=t._x,a=t._y,r+=Math.sin(e)*t.speed*o,a+=Math.cos(e)*t.speed*o,r<i.x?r+=i.width:r>i.x+i.width&&(r-=i.width),a<i.y?a+=i.height:a>i.y+i.height&&(a-=i.height),t._setX(r),t._setY(a),t._setScaleY(o),t._setRotation((-e+Math.PI)*n),t._setTranformChange()}this.tick+=.1},e.animateOld=function(){for(var t,e,i=this.wrapBounds,n=180/Math.PI,r=0,a=0,s=0;s<this.maggotAmount;s++){t=this.maggots[s];var o=.9+.1*Math.sin(this.tick+t.offset);t.scaleY=o,t.direction+=t.turningSpeed,e=t.direction,r=t._x,a=t._y,r+=Math.sin(e)*t.speed*o,a+=Math.cos(e)*t.speed*o,t.rotation=(-e+Math.PI)*n,r<i.x?r+=i.width:r>i.x+i.width&&(r-=i.width),a<i.y?a+=i.height:a>i.y+i.height&&(a-=i.height),t.pos(r,a,!0)}this.tick+=.1},t}(),EventDispatcher=function(){function t(){this._$0__events=null}var e;__class(t,"laya.events.EventDispatcher");var i=t.prototype;return i.hasListener=function(t){var e=this._$0__events&&this._$0__events[t];return!!e},i.event=function(t,e){if(!this._$0__events||!this._$0__events[t])return!1;var i=this._$0__events[t];if(i.run)i.once&&delete this._$0__events[t],null!=e?i.runWith(e):i.run();else{for(var n=0,r=i.length;r>n;n++){var a=i[n];a&&(null!=e?a.runWith(e):a.run()),(!a||a.once)&&(i.splice(n,1),n--,r--)}0===i.length&&this._$0__events&&delete this._$0__events[t]}return!0},i.on=function(t,e,i,n){return this._createListener(t,e,i,n,!1)},i.once=function(t,e,i,n){return this._createListener(t,e,i,n,!0)},i._createListener=function(t,i,n,r,a,s){void 0===s&&(s=!0),s&&this.off(t,i,n,a);var o=e.create(i||this,n,r,a);this._$0__events||(this._$0__events={});var l=this._$0__events;return l[t]?l[t].run?l[t]=[l[t],o]:l[t].push(o):l[t]=o,this},i.off=function(t,e,i,n){if(void 0===n&&(n=!1),!this._$0__events||!this._$0__events[t])return this;var r=this._$0__events[t];if(null!=i)if(r.run)e&&r.caller!==e||i&&r.method!==i||n&&!r.once||(delete this._$0__events[t],r.recover());else{for(var a=0,s=0,o=r.length;o>s;s++){var l=r[s];l?!l||e&&l.caller!==e||i&&l.method!==i||n&&!l.once||(a++,r[s]=null,l.recover()):a++}a===o&&delete this._$0__events[t]}return this},i.offAll=function(t){var e=this._$0__events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._$0__events=null}return this},i.offAllCaller=function(t){if(t&&this._$0__events)for(var e in this._$0__events)this.off(e,t,null);return this},i._recoverHandlers=function(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;e>-1;e--)t[e]&&(t[e].recover(),t[e]=null)},i.isMouseEvent=function(e){return t.MOUSE_EVENTS[e]||!1},t.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},t.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0}),e=function(t){function e(t,i,n,r){e.__super.call(this,t,i,n,r)}__class(e,"",t);var i=e.prototype;return i.recover=function(){this._id>0&&(this._id=0,e._pool.push(this.clear()))},e.create=function(t,i,n,r){return void 0===r&&(r=!0),e._pool.length?e._pool.pop().setTo(t,i,n,r):new e(t,i,n,r)},e._pool=[],e}(Handler)},t}(),Handler=function(){function t(t,e,i,n){this.once=!1,this._id=0,void 0===n&&(n=!1),this.setTo(t,e,i,n)}__class(t,"laya.utils.Handler");var e=t.prototype;return e.setTo=function(e,i,n,r){return this._id=t._gid++,this.caller=e,this.method=i,this.args=n,this.once=r,this},e.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},e.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},e.clear=function(){return this.caller=null,this.method=null,this.args=null,this},e.recover=function(){this._id>0&&(this._id=0,t._pool.push(this.clear()))},t.create=function(e,i,n,r){return void 0===r&&(r=!0),t._pool.length?t._pool.pop().setTo(e,i,n,r):new t(e,i,n,r)},t._pool=[],t._gid=1,t}(),Config=function(){function t(){}return __class(t,"Config"),t.WebGLTextCacheCount=500,t.atlasEnable=!1,t.animationInterval=50,t.isAntialias=!1,t.isAlpha=!1,t.premultipliedAlpha=!0,t.isStencil=!0,t.preserveDrawingBuffer=!1,t.smartCache=!1,t.webGL2D_MeshAllocMaxMem=!0,t.useWebGL2=!1,t}(),Component=function(){function t(){this._indexInList=-1,this._id=Utils.getGID(),this._enabled=!0,this._awaked=!1,this._customAdded=!0,this._active=!1}__class(t,"laya.components.Component");var e=t.prototype;return Laya.imps(e,{"laya.resource.IListPool":!0}),e._getIndexInList=function(){return this._indexInList},e._setIndexInList=function(t){this._indexInList=t},e._added=function(){},e._awake=function(){},e._onEnable=function(){},e._onDisable=function(){},e._onEnableInScene=function(){},e._onDisableInScene=function(){},e._onDestroy=function(){},e._parse=function(){},e._cloneTo=function(){},e._setActive=function(t){t?this._customAdded&&(this._awaked||(this._awaked=!0,this._awake()),this._enabled&&this._onEnable()):this._enabled&&this._onDisable()},e._setActiveInScene=function(t){t?this._onEnableInScene():this._onDisableInScene()},e._doAwake=function(){this._customAdded=!0,this.owner.activeInHierarchy&&(this._awaked||(this._awaked=!0,this._awake()),this._active||(this._active=!0,this._enabled&&this._onEnable()))},e._destroy=function(){this._owner.activeInHierarchy&&this._setActive(!1),this._owner._scene&&this._setActiveInScene(!1),this._onDestroy(),this._enabled=!0,this._awaked=!1,this._customAdded=!0,this._owner=null},e.destroy=function(){this._owner&&this._owner._destroyComponent(this)},__getset(0,e,"id",function(){return this._id}),__getset(0,e,"enabled",function(){return this._enabled},function(t){this._enabled=t,t?this._owner.activeInHierarchy&&this._onEnable():this._owner.activeInHierarchy&&this._onDisable()}),__getset(0,e,"owner",function(){return this._owner}),__getset(0,e,"isSingleton",function(){return!0}),t}(),Prefab=function(){function t(){this.json=null}__class(t,"laya.components.Prefab");var e=t.prototype;return e.create=function(){return this.json?SceneUtils.createComp(this.json):null},t}(),Const=function(){function t(){}return __class(t,"laya.Const"),t.DISPLAY=1,t.HAS_ZORDER=2,t.HAS_MOUSE=4,t.DISPLAYED_INSTAGE=8,t}(),BitmapFont=function(){function t(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}__class(t,"laya.display.BitmapFont");var e=t.prototype;return e.loadFont=function(t,e){return this._path=t,this._complete=e,t&&-1!==t.indexOf(".fnt")?(Laya.loader.load([{url:t,type:"xml"},{url:t.replace(".fnt",".png"),type:"image"}],Handler.create(this,this._onLoaded)),void 0):(console.error('Bitmap font configuration information must be a ".fnt" file'),void 0)},e._onLoaded=function(){this.parseFont(Loader.getRes(this._path),Loader.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.run()},e.parseFont=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=1,n=t.getElementsByTagName("info");this.fontSize=parseInt(n[0].attributes.size.nodeValue);var r=n[0].attributes.padding.nodeValue,a=r.split(",");this._padding=[parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),parseInt(a[3])];var s=t.getElementsByTagName("char"),o=0;for(o=0;o<s.length;o++){var l=s[o].attributes,_=parseInt(l.id.nodeValue),h=parseInt(l.xoffset.nodeValue)/i,u=parseInt(l.yoffset.nodeValue)/i,c=parseInt(l.xadvance.nodeValue)/i,d=new Rectangle;d.x=parseInt(l.x.nodeValue),d.y=parseInt(l.y.nodeValue),d.width=parseInt(l.width.nodeValue),d.height=parseInt(l.height.nodeValue);var f=Texture.create(e,d.x,d.y,d.width,d.height,h,u);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing),this._fontCharDic[_]=f,this._fontWidthMap[_]=c}}},e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]},e.destroy=function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null,this._complete=null,this._padding=null}},e.setSpaceWidth=function(t){this._spaceWidth=t},e.getCharWidth=function(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "===t?this._spaceWidth+this.letterSpacing:0},e.getTextWidth=function(t){for(var e=0,i=0,n=t.length;n>i;i++)e+=this.getCharWidth(t.charAt(i));return e},e.getMaxWidth=function(){return this._maxWidth},e.getMaxHeight=function(){return this.fontSize},e._drawText=function(t,e,i,n,r,a){var s,o=this.getTextWidth(t),l=0;"center"===r&&(l=(a-o)/2),"right"===r&&(l=a-o);for(var _=0,h=0,u=t.length;u>h;h++)s=this.getCharTexture(t.charAt(h)),s&&(e.graphics.drawImage(s,i+_+l,n),_+=this.getCharWidth(t.charAt(h)))},t}(),AlphaCmd=function(){function t(){}__class(t,"laya.display.cmd.AlphaCmd");var e=t.prototype;return e.recover=function(){Pool.recover("AlphaCmd",this)},e.run=function(t){t.alpha(this._alpha)},__getset(0,e,"cmdID",function(){return"Alpha"}),__getset(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),t.create=function(e){var i=Pool.getItemByClass("AlphaCmd",t);return i._alpha=e,i},t.ID="Alpha",t}(),ClipRectCmd=function(){function t(){}__class(t,"laya.display.cmd.ClipRectCmd");var e=t.prototype;return e.recover=function(){Pool.recover("ClipRectCmd",this)},e.run=function(t,e,i){t.clipRect(this._x+e,this._y+i,this._width,this._height)},__getset(0,e,"cmdID",function(){return"ClipRect"}),__getset(0,e,"width",function(){return this._width},function(t){this._width=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"height",function(){return this._height},function(t){this._height=t}),t.create=function(e,i,n,r){var a=Pool.getItemByClass("ClipRectCmd",t);return a._x=e,a._y=i,a._width=n,a._height=r,a},t.ID="ClipRect",t}(),DrawCircleCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawCircleCmd");var e=t.prototype;return e.recover=function(){this._fillColor=null,this._lineColor=null,Pool.recover("DrawCircleCmd",this)},e.run=function(t,e,i){t._drawCircle(this._x+e,this._y+i,this._radius,this._fillColor,this._lineColor,this._lineWidth,this._vid)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t}),__getset(0,e,"cmdID",function(){return"DrawCircle"}),__getset(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"radius",function(){return this._radius},function(t){this._radius=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a,s,o){var l=Pool.getItemByClass("DrawCircleCmd",t);return l._x=e,l._y=i,l._radius=n,l._fillColor=r,l._lineColor=a,l._lineWidth=s,l._vid=o,l},t.ID="DrawCircle",t}(),DrawCurvesCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawCurvesCmd");var e=t.prototype;return e.recover=function(){this._points=null,this._lineColor=null,Pool.recover("DrawCurvesCmd",this)},e.run=function(t,e,i){t.drawCurves(this._x+e,this._y+i,this._points,this._lineColor,this._lineWidth)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t}),__getset(0,e,"points",function(){return this._points},function(t){this._points=t}),__getset(0,e,"cmdID",function(){return"DrawCurves"}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a){var s=Pool.getItemByClass("DrawCurvesCmd",t);return s._x=e,s._y=i,s._points=n,s._lineColor=r,s._lineWidth=a,s},t.ID="DrawCurves",t}(),DrawImageCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawImageCmd");var e=t.prototype;return e.recover=function(){this._texture=null,Pool.recover("DrawImageCmd",this)},e.run=function(t,e,i){t.drawTexture(this._texture,this._x+e,this._y+i,this._width,this._height)},__getset(0,e,"cmdID",function(){return"DrawImage"}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"texture",function(){return this._texture},function(t){this._texture=t}),__getset(0,e,"width",function(){return this._width},function(t){this._width=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"height",function(){return this._height},function(t){this._height=t}),t.create=function(e,i,n,r,a){var s=Pool.getItemByClass("DrawImageCmd",t);return s._texture=e,s._x=i,s._y=n,s._width=r,s._height=a,s},t.ID="DrawImage",t}(),DrawLineCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawLineCmd");var e=t.prototype;return e.recover=function(){Pool.recover("DrawLineCmd",this)},e.run=function(t,e,i){t._drawLine(e,i,this._fromX,this._fromY,this._toX,this._toY,this._lineColor,this._lineWidth,this._vid)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t}),__getset(0,e,"cmdID",function(){return"DrawLine"}),__getset(0,e,"toY",function(){return this._toY},function(t){this._toY=t}),__getset(0,e,"fromX",function(){return this._fromX},function(t){this._fromX=t}),__getset(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),__getset(0,e,"toX",function(){return this._toX},function(t){this._toX=t}),__getset(0,e,"fromY",function(){return this._fromY},function(t){this._fromY=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a,s,o){var l=Pool.getItemByClass("DrawLineCmd",t);return l._fromX=e,l._fromY=i,l._toX=n,l._toY=r,l._lineColor=a,l._lineWidth=s,l._vid=o,l},t.ID="DrawLine",t}(),DrawLinesCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawLinesCmd");var e=t.prototype;return e.recover=function(){this._points=null,this._lineColor=null,Pool.recover("DrawLinesCmd",this)},e.run=function(t,e,i){t._drawLines(this._x+e,this._y+i,this._points,this._lineColor,this._lineWidth,this._vid)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t}),__getset(0,e,"points",function(){return this._points},function(t){this._points=t}),__getset(0,e,"cmdID",function(){return"DrawLines"}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a,s){var o=Pool.getItemByClass("DrawLinesCmd",t);return o._x=e,o._y=i,o._points=n,o._lineColor=r,o._lineWidth=a,o._vid=s,o},t.ID="DrawLines",t}(),DrawPathCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawPathCmd");var e=t.prototype;return e.recover=function(){this._paths=null,this._brush=null,this._pen=null,Pool.recover("DrawPathCmd",this)},e.run=function(t,e,i){t._drawPath(this._x+e,this._y+i,this._paths,this._brush,this._pen)},__getset(0,e,"cmdID",function(){return"DrawPath"}),__getset(0,e,"paths",function(){return this._paths},function(t){this._paths=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"brush",function(){return this._brush},function(t){this._brush=t}),__getset(0,e,"pen",function(){return this._pen},function(t){this._pen=t}),t.create=function(e,i,n,r,a){var s=Pool.getItemByClass("DrawPathCmd",t);return s._x=e,s._y=i,s._paths=n,s._brush=r,s._pen=a,s},t.ID="DrawPath",t}(),DrawPieCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawPieCmd");var e=t.prototype;return e.recover=function(){this._fillColor=null,this._lineColor=null,Pool.recover("DrawPieCmd",this)},e.run=function(t,e,i){t._drawPie(this._x+e,this._y+i,this._radius,this._startAngle,this._endAngle,this._fillColor,this._lineColor,this._lineWidth,this._vid)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t}),__getset(0,e,"startAngle",function(){return this._startAngle},function(t){this._startAngle=t}),__getset(0,e,"cmdID",function(){return"DrawPie"}),__getset(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"radius",function(){return this._radius},function(t){this._radius=t}),__getset(0,e,"endAngle",function(){return this._endAngle},function(t){this._endAngle=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),__getset(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),t.create=function(e,i,n,r,a,s,o,l,_){var h=Pool.getItemByClass("DrawPieCmd",t);return h._x=e,h._y=i,h._radius=n,h._startAngle=r,h._endAngle=a,h._fillColor=s,h._lineColor=o,h._lineWidth=l,h._vid=_,h},t.ID="DrawPie",t}(),DrawPolyCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawPolyCmd");var e=t.prototype;return e.recover=function(){this._points=null,this._fillColor=null,this._lineColor=null,Pool.recover("DrawPolyCmd",this)},e.run=function(t,e,i){t._drawPoly(this._x+e,this._y+i,this._points,this._fillColor,this._lineColor,this._lineWidth,this._isConvexPolygon,this._vid)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t}),__getset(0,e,"points",function(){return this._points},function(t){this._points=t}),__getset(0,e,"cmdID",function(){return"DrawPoly"}),__getset(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"isConvexPolygon",function(){return this._isConvexPolygon},function(t){this._isConvexPolygon=t}),__getset(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a,s,o,l){var _=Pool.getItemByClass("DrawPolyCmd",t);return _._x=e,_._y=i,_._points=n,_._fillColor=r,_._lineColor=a,_._lineWidth=s,_._isConvexPolygon=o,_._vid=l,_},t.ID="DrawPoly",t}(),DrawRectCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawRectCmd");var e=t.prototype;return e.recover=function(){this._fillColor=null,this._lineColor=null,Pool.recover("DrawRectCmd",this)},e.run=function(t,e,i){t.drawRect(this._x+e,this._y+i,this._width,this._height,this._fillColor,this._lineColor,this._lineWidth)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t}),__getset(0,e,"cmdID",function(){return"DrawRect"}),__getset(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t}),__getset(0,e,"width",function(){return this._width},function(t){this._width=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"height",function(){return this._height},function(t){this._height=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a,s,o){var l=Pool.getItemByClass("DrawRectCmd",t);return l._x=e,l._y=i,l._width=n,l._height=r,l._fillColor=a,l._lineColor=s,l._lineWidth=o,l},t.ID="DrawRect",t}(),DrawTextureCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawTextureCmd");var e=t.prototype;return e.recover=function(){this._texture=null,this._matrix=null,Pool.recover("DrawTextureCmd",this)},e.run=function(t,e,i){t.drawTextureWithTransform(this._texture,this._x,this._y,this._width,this._height,this._matrix,e,i,this._alpha,this._blendMode)},__getset(0,e,"cmdID",function(){return"DrawTexture"}),__getset(0,e,"matrix",function(){return this._matrix},function(t){this._matrix=t}),__getset(0,e,"texture",function(){return this._texture},function(t){this._texture=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"width",function(){return this._width},function(t){this._width=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"height",function(){return this._height},function(t){this._height=t}),__getset(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),__getset(0,e,"color",function(){return this._color},function(t){this._color=t}),__getset(0,e,"blendMode",function(){return this._blendMode
},function(t){this._blendMode=t}),t.create=function(e,i,n,r,a,s,o,l,_){var h=Pool.getItemByClass("DrawTextureCmd",t);return h._texture=e,h._x=i,h._y=n,h._width=r,h._height=a,h._matrix=s,h._alpha=o,h._color=l,h._blendMode=_,h},t.ID="DrawTexture",t}(),DrawTexturesCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawTexturesCmd");var e=t.prototype;return e.recover=function(){this._texture=null,this._pos=null,Pool.recover("DrawTexturesCmd",this)},e.run=function(t,e,i){t.drawTextures(this._texture,this._pos,e,i)},__getset(0,e,"cmdID",function(){return"DrawTextures"}),__getset(0,e,"texture",function(){return this._texture},function(t){this._texture=t}),__getset(0,e,"pos",function(){return this._pos},function(t){this._pos=t}),t.create=function(e,i){var n=Pool.getItemByClass("DrawTexturesCmd",t);return n._texture=e,n._pos=i,n},t.ID="DrawTextures",t}(),DrawTrianglesCmd=function(){function t(){}__class(t,"laya.display.cmd.DrawTrianglesCmd");var e=t.prototype;return e.recover=function(){this._texture=null,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,Pool.recover("DrawTrianglesCmd",this)},e.run=function(t,e,i){t.drawTriangles(this._texture,this._x+e,this._y+i,this._vertices,this._uvs,this._indices,this._matrix,this._alpha,this._color,this._blendMode)},__getset(0,e,"vertices",function(){return this._vertices},function(t){this._vertices=t}),__getset(0,e,"cmdID",function(){return"DrawTriangles"}),__getset(0,e,"matrix",function(){return this._matrix},function(t){this._matrix=t}),__getset(0,e,"texture",function(){return this._texture},function(t){this._texture=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),__getset(0,e,"uvs",function(){return this._uvs},function(t){this._uvs=t}),__getset(0,e,"indices",function(){return this._indices},function(t){this._indices=t}),__getset(0,e,"color",function(){return this._color},function(t){this._color=t}),__getset(0,e,"blendMode",function(){return this._blendMode},function(t){this._blendMode=t}),t.create=function(e,i,n,r,a,s,o,l,_,h){var u=Pool.getItemByClass("DrawTrianglesCmd",t);return u._texture=e,u._x=i,u._y=n,u._vertices=r,u._uvs=a,u._indices=s,u._matrix=o,u._alpha=l,u._color=_,u._blendMode=h,u},t.ID="DrawTriangles",t}(),FillBorderTextCmd=function(){function t(){}__class(t,"laya.display.cmd.FillBorderTextCmd");var e=t.prototype;return e.recover=function(){Pool.recover("FillBorderTextCmd",this)},e.run=function(t,e,i){t.fillBorderText(this._text,this._x+e,this._y+i,this._font,this._fillColor,this._borderColor,this._lineWidth,this._textAlign)},__getset(0,e,"cmdID",function(){return"FillBorderText"}),__getset(0,e,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t}),__getset(0,e,"text",function(){return this._text},function(t){this._text=t}),__getset(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t}),__getset(0,e,"textAlign",function(){return this._textAlign},function(t){this._textAlign=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"font",function(){return this._font},function(t){this._font=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a,s,o,l){var _=Pool.getItemByClass("FillBorderTextCmd",t);return _._text=e,_._x=i,_._y=n,_._font=r,_._fillColor=a,_._borderColor=s,_._lineWidth=o,_._textAlign=l,_},t.ID="FillBorderText",t}(),FillBorderWordsCmd=function(){function t(){}__class(t,"laya.display.cmd.FillBorderWordsCmd");var e=t.prototype;return e.recover=function(){this._words=null,Pool.recover("FillBorderWordsCmd",this)},e.run=function(t,e,i){t.fillBorderWords(this._words,this._x+e,this._y+i,this._font,this._fillColor,this._borderColor,this._lineWidth)},__getset(0,e,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t}),__getset(0,e,"cmdID",function(){return"FillBorderWords"}),__getset(0,e,"words",function(){return this._words},function(t){this._words=t}),__getset(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"font",function(){return this._font},function(t){this._font=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a,s,o){var l=Pool.getItemByClass("FillBorderWordsCmd",t);return l._words=e,l._x=i,l._y=n,l._font=r,l._fillColor=a,l._borderColor=s,l._lineWidth=o,l},t.ID="FillBorderWords",t}(),FillTextCmd=function(){function t(){this._textIsWorldText=!1}__class(t,"laya.display.cmd.FillTextCmd");var e=t.prototype;return e.recover=function(){Pool.recover("FillTextCmd",this)},e.run=function(t,e,i){t.drawText(this._text,this._x+e,this._y+i,this._font,this._color,this._textAlign)},__getset(0,e,"text",function(){return this._text},function(t){this._text=t,this._textIsWorldText=t instanceof laya.utils.WordText,this._textIsWorldText&&this._text.cleanCache()}),__getset(0,e,"cmdID",function(){return"FillText"}),__getset(0,e,"textAlign",function(){return this._textAlign},function(t){this._textAlign=t,this._textIsWorldText&&this._text.cleanCache()}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"color",function(){return this._color},function(t){this._color=t,this._textIsWorldText&&this._text.cleanCache()}),__getset(0,e,"font",function(){return this._font},function(t){this._font=t,this._textIsWorldText&&this._text.cleanCache()}),t.create=function(e,i,n,r,a,s){var o=Pool.getItemByClass("FillTextCmd",t);return o._text=e,o._textIsWorldText=e instanceof laya.utils.WordText,o._x=i,o._y=n,o._font=r,o._color=a,o._textAlign=s,o},t.ID="FillText",t}(),FillTextureCmd=function(){function t(){}__class(t,"laya.display.cmd.FillTextureCmd");var e=t.prototype;return e.recover=function(){this._texture=null,this._offset=null,this._other=null,Pool.recover("FillTextureCmd",this)},e.run=function(t,e,i){t.fillTexture(this._texture,this._x+e,this._y+i,this._width,this._height,this._type,this._offset,this._other)},__getset(0,e,"cmdID",function(){return"FillTexture"}),__getset(0,e,"texture",function(){return this._texture},function(t){this._texture=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"width",function(){return this._width},function(t){this._width=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"offset",function(){return this._offset},function(t){this._offset=t}),__getset(0,e,"height",function(){return this._height},function(t){this._height=t}),__getset(0,e,"other",function(){return this._other},function(t){this._other=t}),__getset(0,e,"type",function(){return this._type},function(t){this._type=t}),t.create=function(e,i,n,r,a,s,o,l){var _=Pool.getItemByClass("FillTextureCmd",t);return _._texture=e,_._x=i,_._y=n,_._width=r,_._height=a,_._type=s,_._offset=o,_._other=l,_},t.ID="FillTexture",t}(),FillWordsCmd=function(){function t(){}__class(t,"laya.display.cmd.FillWordsCmd");var e=t.prototype;return e.recover=function(){this._words=null,Pool.recover("FillWordsCmd",this)},e.run=function(t,e,i){t.fillWords(this._words,this._x+e,this._y+i,this._font,this._color)},__getset(0,e,"cmdID",function(){return"FillWords"}),__getset(0,e,"words",function(){return this._words},function(t){this._words=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"color",function(){return this._color},function(t){this._color=t}),__getset(0,e,"font",function(){return this._font},function(t){this._font=t}),t.create=function(e,i,n,r,a){var s=Pool.getItemByClass("FillWordsCmd",t);return s._words=e,s._x=i,s._y=n,s._font=r,s._color=a,s},t.ID="FillWords",t}(),RestoreCmd=function(){function t(){}__class(t,"laya.display.cmd.RestoreCmd");var e=t.prototype;return e.recover=function(){Pool.recover("RestoreCmd",this)},e.run=function(t){t.restore()},__getset(0,e,"cmdID",function(){return"Restore"}),t.create=function(){var e=Pool.getItemByClass("RestoreCmd",t);return e},t.ID="Restore",t}(),RotateCmd=function(){function t(){}__class(t,"laya.display.cmd.RotateCmd");var e=t.prototype;return e.recover=function(){Pool.recover("RotateCmd",this)},e.run=function(t,e,i){t._rotate(this._angle,this._pivotX+e,this._pivotY+i)},__getset(0,e,"cmdID",function(){return"Rotate"}),__getset(0,e,"angle",function(){return this._angle},function(t){this._angle=t}),__getset(0,e,"pivotX",function(){return this._pivotX},function(t){this._pivotX=t}),__getset(0,e,"pivotY",function(){return this._pivotY},function(t){this._pivotY=t}),t.create=function(e,i,n){var r=Pool.getItemByClass("RotateCmd",t);return r._angle=e,r._pivotX=i,r._pivotY=n,r},t.ID="Rotate",t}(),SaveCmd=function(){function t(){}__class(t,"laya.display.cmd.SaveCmd");var e=t.prototype;return e.recover=function(){Pool.recover("SaveCmd",this)},e.run=function(t){t.save()},__getset(0,e,"cmdID",function(){return"Save"}),t.create=function(){var e=Pool.getItemByClass("SaveCmd",t);return e},t.ID="Save",t}(),ScaleCmd=function(){function t(){}__class(t,"laya.display.cmd.ScaleCmd");var e=t.prototype;return e.recover=function(){Pool.recover("ScaleCmd",this)},e.run=function(t,e,i){t._scale(this._scaleX,this._scaleY,this._pivotX+e,this._pivotY+i)},__getset(0,e,"cmdID",function(){return"Scale"}),__getset(0,e,"scaleX",function(){return this._scaleX},function(t){this._scaleX=t}),__getset(0,e,"scaleY",function(){return this._scaleY},function(t){this._scaleY=t}),__getset(0,e,"pivotX",function(){return this._pivotX},function(t){this._pivotX=t}),__getset(0,e,"pivotY",function(){return this._pivotY},function(t){this._pivotY=t}),t.create=function(e,i,n,r){var a=Pool.getItemByClass("ScaleCmd",t);return a._scaleX=e,a._scaleY=i,a._pivotX=n,a._pivotY=r,a},t.ID="Scale",t}(),StrokeTextCmd=function(){function t(){}__class(t,"laya.display.cmd.StrokeTextCmd");var e=t.prototype;return e.recover=function(){Pool.recover("StrokeTextCmd",this)},e.run=function(t,e,i){t.strokeWord(this._text,this._x+e,this._y+i,this._font,this._color,this._lineWidth,this._textAlign)},__getset(0,e,"text",function(){return this._text},function(t){this._text=t}),__getset(0,e,"cmdID",function(){return"StrokeText"}),__getset(0,e,"textAlign",function(){return this._textAlign},function(t){this._textAlign=t}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t}),__getset(0,e,"color",function(){return this._color},function(t){this._color=t}),__getset(0,e,"font",function(){return this._font},function(t){this._font=t}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t}),t.create=function(e,i,n,r,a,s,o){var l=Pool.getItemByClass("StrokeTextCmd",t);return l._text=e,l._x=i,l._y=n,l._font=r,l._color=a,l._lineWidth=s,l._textAlign=o,l},t.ID="StrokeText",t}(),TransformCmd=function(){function t(){}__class(t,"laya.display.cmd.TransformCmd");var e=t.prototype;return e.recover=function(){this._matrix=null,Pool.recover("TransformCmd",this)},e.run=function(t,e,i){t._transform(this._matrix,this._pivotX+e,this._pivotY+i)},__getset(0,e,"cmdID",function(){return"Transform"}),__getset(0,e,"matrix",function(){return this._matrix},function(t){this._matrix=t}),__getset(0,e,"pivotX",function(){return this._pivotX},function(t){this._pivotX=t}),__getset(0,e,"pivotY",function(){return this._pivotY},function(t){this._pivotY=t}),t.create=function(e,i,n){var r=Pool.getItemByClass("TransformCmd",t);return r._matrix=e,r._pivotX=i,r._pivotY=n,r},t.ID="Transform",t}(),TranslateCmd=function(){function t(){}__class(t,"laya.display.cmd.TranslateCmd");var e=t.prototype;return e.recover=function(){Pool.recover("TranslateCmd",this)},e.run=function(t){t.translate(this._tx,this._ty)},__getset(0,e,"ty",function(){return this._ty},function(t){this._ty=t}),__getset(0,e,"cmdID",function(){return"Translate"}),__getset(0,e,"tx",function(){return this._tx},function(t){this._tx=t}),t.create=function(e,i){var n=Pool.getItemByClass("TranslateCmd",t);return n._tx=e,n._ty=i,n},t.ID="Translate",t}(),AlphaCmdNative=function(){function t(){this._paramData=new ParamData(4,!0)}__class(t,"laya.display.cmdNative.AlphaCmdNative");var e=t.prototype;return e.recover=function(){Pool.recover("AlphaCmd",this)},e.run=function(t){t.alpha(this._alpha)},__getset(0,e,"cmdID",function(){return"Alpha"}),__getset(0,e,"alpha",function(){return this._alpha},function(t){t=t>1?1:t,t=0>t?0:t,this._alpha=t;var e=16777215;e=255*t<<24|e,this._paramData._int32Data[0]=e,LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e){var i=Pool.getItemByClass("AlphaCmd",t),n=i._graphicsCmdEncoder=this._commandEncoder;return i.alpha=e,n.setGlobalValueEx(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,15,i._paramData.getPtrID(),0),LayaGL.syncBufferToRenderThread(n),i},t.ID="Alpha",t}(),ClipRectCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}__class(t,"laya.display.cmdNative.ClipRectCmdNative");var e=t.prototype;return e.recover=function(){Pool.recover("ClipRectCmd",this)},__getset(0,e,"cmdID",function(){return"ClipRect"}),__getset(0,e,"width",function(){},function(){}),__getset(0,e,"x",function(){},function(){}),__getset(0,e,"y",function(){},function(){}),__getset(0,e,"height",function(){},function(){}),t.create=function(e,i,n,r){var a=Pool.getItemByClass("ClipRectCmd",t),s=a._graphicsCmdEncoder=this._commandEncoder,o=a._paramData._float32Data;o[0]=e,o[1]=i,o[2]=n,o[3]=r;var l=a._paramData.getPtrID();return LayaGL.syncBufferToRenderThread(a._paramData),s.setClipValueEx(LayaNative2D.GLOBALVALUE_CLIPDIR,LayaNative2D.GLOBALVALUE_CLIPSIZE,LayaNative2D.GLOBALVALUE_MATRIX32,l),LayaGL.syncBufferToRenderThread(s),a},t.ID="ClipRect",t}(),DrawImageCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=0/0,this._y=0/0,this._width=0/0,this._height=0/0}__class(t,"laya.display.cmdNative.DrawImageCmdNative");var e=t.prototype;return e.recover=function(){this._graphicsCmdEncoder=null,Pool.recover("DrawImageCmd",this)},__getset(0,e,"cmdID",function(){return"DrawImage"}),__getset(0,e,"y",function(){return this._y},function(e){this._y=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"texture",function(){return this._texture},function(e){this._texture=e,this._paramData._int32Data[t._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture;var i=this._paramData._float32Data,n=this._texture.uv;i[t._PARAM_VB_POS_+2]=n[0],i[t._PARAM_VB_POS_+3]=n[1],i[t._PARAM_VB_POS_+8]=n[2],i[t._PARAM_VB_POS_+9]=n[3],i[t._PARAM_VB_POS_+14]=n[4],i[t._PARAM_VB_POS_+15]=n[5],i[t._PARAM_VB_POS_+20]=n[6],i[t._PARAM_VB_POS_+21]=n[7],LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"width",function(){return this._width},function(e){this._width=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"x",function(){return this._x},function(e){this._x=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"height",function(){return this._height},function(e){this._height=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,n,r,a){var s=Pool.getItemByClass("DrawImageCmd",t);s._graphicsCmdEncoder=this._commandEncoder,t._DRAW_IMAGE_CMD_ENCODER_||(t._DRAW_IMAGE_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(124,32,!0),t._DRAW_IMAGE_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._DRAW_IMAGE_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHQUADTEXTURE),t._DRAW_IMAGE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_IMAGE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_CLIPDIR,1),t._DRAW_IMAGE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_CLIPSIZE,2),t._DRAW_IMAGE_CMD_ENCODER_.uniformTextureByParamData(0,4,4*t._PARAM_TEXTURE_POS_),t._DRAW_IMAGE_CMD_ENCODER_.setRectMeshByParamData(12,4*t._PARAM_VB_POS_,16),t._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_IMAGE_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(116,!0)),s._texture=e,s._x=i,s._y=n,s._width=r,s._height=a;var o=s._paramData._float32Data,l=s._paramData._int32Data;l[0]=3,l[1]=33984,l[t._PARAM_TEXTURE_POS_]=e.bitmap._glTexture,l[3]=1,l[4]=96;var _=0!=r?r:e.bitmap.width,h=0!=a?a:e.bitmap.height,u=e.uv,c=t._PARAM_VB_POS_;return o[c++]=i,o[c++]=n,o[c++]=u[0],o[c++]=u[1],l[c++]=4294967295,l[c++]=4294967295,o[c++]=i+_,o[c++]=n,o[c++]=u[2],o[c++]=u[3],l[c++]=4294967295,l[c++]=4294967295,o[c++]=i+_,o[c++]=n+h,o[c++]=u[4],o[c++]=u[5],l[c++]=4294967295,l[c++]=4294967295,o[c++]=i,o[c++]=n+h,o[c++]=u[6],o[c++]=u[7],l[c++]=4294967295,l[c++]=4294967295,LayaGL.syncBufferToRenderThread(s._paramData),s._graphicsCmdEncoder.useCommandEncoder(t._DRAW_IMAGE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),LayaGL.syncBufferToRenderThread(s._graphicsCmdEncoder),s},t.ID="DrawImage",t._DRAW_IMAGE_CMD_ENCODER_=null,t._PARAM_TEXTURE_POS_=2,t._PARAM_VB_POS_=5,t}(),DrawLineCmdNative=function(){function t(){this._paramData=null,this._fromX=0/0,this._fromY=0/0,this._toX=0/0,this._toY=0/0,this._lineColor=null,this._lineWidth=0/0,this._vid=0}__class(t,"laya.display.cmdNative.DrawLineCmdNative");var e=t.prototype;return e.recover=function(){Pool.recover("DrawLineCmd",this)},__getset(0,e,"lineColor",function(){return this._lineColor},function(e){this._lineColor=e;var i=Color.create(this.lineColor),n=i.numColor,r=this._paramData._int32Data,a=t._PARAM_VB_POS_;a++,a++,r[a++]=n,a++,a++,r[a++]=n,a++,a++,r[a++]=n,a++,a++,r[a++]=n,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"cmdID",function(){return"DrawLine"}),__getset(0,e,"toY",function(){return this._toY},function(e){this._toY=e;var i=[this._fromX,this._fromY,this._toX,this._toY],n=[],r=[];BasePoly.createLine2(i,r,this._lineWidth,0,n,!1);var a=this._paramData._float32Data,s=(this._paramData._int32Data,this._paramData._int16Data),o=t._PARAM_VB_POS_;a[o++]=n[0],a[o++]=n[1],o++,a[o++]=n[2],a[o++]=n[3],o++,a[o++]=n[4],a[o++]=n[5],o++,a[o++]=n[6],a[o++]=n[7],o++;var l=2*t._PARAM_IB_POS_;s[l++]=r[0],s[l++]=r[1],s[l++]=r[2],s[l++]=r[3],s[l++]=r[4],s[l++]=r[5],LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"fromX",function(){return this._fromX},function(e){this._fromX=e;var i=[this._fromX,this._fromY,this._toX,this._toY],n=[],r=[];BasePoly.createLine2(i,r,this._lineWidth,0,n,!1);var a=this._paramData._float32Data,s=(this._paramData._int32Data,this._paramData._int16Data),o=t._PARAM_VB_POS_;a[o++]=n[0],a[o++]=n[1],o++,a[o++]=n[2],a[o++]=n[3],o++,a[o++]=n[4],a[o++]=n[5],o++,a[o++]=n[6],a[o++]=n[7],o++;var l=2*t._PARAM_IB_POS_;s[l++]=r[0],s[l++]=r[1],s[l++]=r[2],s[l++]=r[3],s[l++]=r[4],s[l++]=r[5],LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),__getset(0,e,"toX",function(){return this._toX},function(e){this._toX=e;var i=[this._fromX,this._fromY,this._toX,this._toY],n=[],r=[];BasePoly.createLine2(i,r,this._lineWidth,0,n,!1);var a=this._paramData._float32Data,s=(this._paramData._int32Data,this._paramData._int16Data),o=t._PARAM_VB_POS_;a[o++]=n[0],a[o++]=n[1],o++,a[o++]=n[2],a[o++]=n[3],o++,a[o++]=n[4],a[o++]=n[5],o++,a[o++]=n[6],a[o++]=n[7],o++;var l=2*t._PARAM_IB_POS_;s[l++]=r[0],s[l++]=r[1],s[l++]=r[2],s[l++]=r[3],s[l++]=r[4],s[l++]=r[5],LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"fromY",function(){return this._fromY},function(e){this._fromY=e;var i=[this._fromX,this._fromY,this._toX,this._toY],n=[],r=[];BasePoly.createLine2(i,r,this._lineWidth,0,n,!1);var a=this._paramData._float32Data,s=(this._paramData._int32Data,this._paramData._int16Data),o=t._PARAM_VB_POS_;a[o++]=n[0],a[o++]=n[1],o++,a[o++]=n[2],a[o++]=n[3],o++,a[o++]=n[4],a[o++]=n[5],o++,a[o++]=n[6],a[o++]=n[7],o++;var l=2*t._PARAM_IB_POS_;s[l++]=r[0],s[l++]=r[1],s[l++]=r[2],s[l++]=r[3],s[l++]=r[4],s[l++]=r[5],LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(e){this._lineWidth=e;var i=[this._fromX,this._fromY,this._toX,this._toY],n=[],r=[];BasePoly.createLine2(i,r,this.lineWidth,0,n,!1);var a=this._paramData._float32Data,s=(this._paramData._int32Data,this._paramData._int16Data),o=t._PARAM_VB_POS_;a[o++]=n[0],a[o++]=n[1],o++,a[o++]=n[2],a[o++]=n[3],o++,a[o++]=n[4],a[o++]=n[5],o++,a[o++]=n[6],a[o++]=n[7],o++;var l=2*t._PARAM_IB_POS_;s[l++]=r[0],s[l++]=r[1],s[l++]=r[2],s[l++]=r[3],s[l++]=r[4],s[l++]=r[5],LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,n,r,a,s,o){var l=Pool.getItemByClass("DrawLineCmd",t);l._graphicsCmdEncoder=this._commandEncoder,t._DRAW_LINE_CMD_ENCODER_||(t._DRAW_LINE_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(84,32,!0),t._DRAW_LINE_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWVG),t._DRAW_LINE_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHVG),t._DRAW_LINE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_LINE_CMD_ENCODER_.setMeshByParamData(4*t._PARAM_VB_POS_,4,4*t._PARAM_IB_POS_,8),t._DRAW_LINE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_LINE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_LINE_CMD_ENCODER_)),l._paramData||(l._paramData=new ParamData(84,!0)),l._fromX=e,l._fromY=i,l._toX=n,l._toY=r,l._lineColor=a,l._lineWidth=s,l._vid=o;var _=Color.create(a),h=_.numColor,u=[e,i,n,r],c=[],d=[];BasePoly.createLine2(u,d,s,0,c,!1);var f=l._paramData._float32Data,m=l._paramData._int32Data,p=l._paramData._int16Data;m[0]=1,m[1]=48,m[2]=12;var g=t._PARAM_VB_POS_;f[g++]=c[0],f[g++]=c[1],m[g++]=h,f[g++]=c[2],f[g++]=c[3],m[g++]=h,f[g++]=c[4],f[g++]=c[5],m[g++]=h,f[g++]=c[6],f[g++]=c[7],m[g++]=h;var v=2*t._PARAM_IB_POS_;return p[v++]=d[0],p[v++]=d[1],p[v++]=d[2],p[v++]=d[3],p[v++]=d[4],p[v++]=d[5],f[t._PARAM_LINECOLOR_POS_]=a?a:4278190335,f[t._PARAM_LINEWIDTH_POS_]=s,f[t._PARAM_VID_POS_]=o,LayaGL.syncBufferToRenderThread(l._paramData),l._graphicsCmdEncoder.useCommandEncoder(t._DRAW_LINE_CMD_ENCODER_.getPtrID(),l._paramData.getPtrID(),-1),LayaGL.syncBufferToRenderThread(l._graphicsCmdEncoder),l},t.ID="DrawLine",t._DRAW_LINE_CMD_ENCODER_=null,t._PARAM_VB_POS_=3,t._PARAM_IB_POS_=15,t._PARAM_LINECOLOR_POS_=18,t._PARAM_LINEWIDTH_POS_=19,t._PARAM_VID_POS_=20,t}(),DrawLinesCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=0/0,this._y=0/0,this._points=null,this._lineColor=null,this._lineWidth=0/0,this._vid=0,this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}__class(t,"laya.display.cmdNative.DrawLinesCmdNative");var e=t.prototype;return e.recover=function(){this._points=null,this._lineColor=null,Pool.recover("DrawLinesCmd",this)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=Color.create(this._lineColor),i=e.numColor,n=this.vbBuffer._int32Data,r=0,a=0;a<this._vertNum;a++)r++,r++,n[r++]=i;LayaGL.syncBufferToRenderThread(this.vbBuffer)}),__getset(0,e,"points",function(){return this._points},function(e){this._points=e,this._ibArray.length=0,this._vbArray.length=0,BasePoly.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);var i=Color.create(this._lineColor),n=i.numColor;this._vertNum=this._points.length;var r=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*r*4,!0)),this._vbSize=3*this._vertNum*4;for(var a=this.vbBuffer._float32Data,s=this.vbBuffer._int32Data,o=0,l=0;l<this._vertNum;l++)a[o++]=this._vbArray[2*l]+this.x,a[o++]=this._vbArray[2*l+1]+this.y,s[o++]=n;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(r-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var _=this.ibBuffer._int16Data,h=0;h<3*(this._vertNum-2);h++)_[h]=this._ibArray[h];var s=this._paramData._int32Data;s[t._PARAM_VB_SIZE_POS_]=this._vbSize,s[t._PARAM_IB_SIZE_POS_]=this._ibSize,LayaGL.syncBufferToRenderThread(this.ibBuffer),LayaGL.syncBufferToRenderThread(this.vbBuffer),LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"cmdID",function(){return"DrawLines"}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,n=0;n<this._vertNum;n++)e[i++]=this._vbArray[2*n]+this._x,i++,i++;LayaGL.syncBufferToRenderThread(this.vbBuffer)}),__getset(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,n=0;n<this._vertNum;n++)i++,e[i++]=this._vbArray[2*n+1]+this._y,i++;LayaGL.syncBufferToRenderThread(this.vbBuffer)}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,BasePoly.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,i=0,n=0;n<this._vertNum;n++)e[i++]=this._vbArray[2*n]+this.x,e[i++]=this._vbArray[2*n+1]+this.y,i++;LayaGL.syncBufferToRenderThread(this.vbBuffer)}),t.create=function(e,i,n,r,a,s){var o=Pool.getItemByClass("DrawLinesCmd",t);o._graphicsCmdEncoder=this._commandEncoder,t._DRAW_LINES_CMD_ENCODER_||(t._DRAW_LINES_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(88,32,!0),t._DRAW_LINES_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWVG),t._DRAW_LINES_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHVG),t._DRAW_LINES_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_SIZE_POS_),t._DRAW_LINES_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_LINES_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_LINES_CMD_ENCODER_)),o._paramData||(o._paramData=new ParamData(32,!0)),o._x=e,o._y=i,o._points=n,o._lineColor=r,o._lineWidth=a,o._vid=s,BasePoly.createLine2(n,o._ibArray,a,0,o._vbArray,!1);var l=Color.create(r),_=l.numColor;o._vertNum=n.length;var h=o._vertNum;(!o.vbBuffer||o.vbBuffer.getByteLength()<3*o._vertNum*4)&&(o.vbBuffer=new ParamData(3*h*4,!0)),o._vbSize=3*o._vertNum*4;for(var u=o.vbBuffer._float32Data,c=o.vbBuffer._int32Data,d=0,f=0;f<o._vertNum;f++)u[d++]=o._vbArray[2*f]+e,u[d++]=o._vbArray[2*f+1]+i,c[d++]=_;(!o.ibBuffer||o.ibBuffer.getByteLength()<3*(o._vertNum-2)*2)&&(o.ibBuffer=new ParamData(3*(h-2)*2,!0,!0)),o._ibSize=3*(o._vertNum-2)*2;for(var m=o.ibBuffer._int16Data,p=0;p<3*(o._vertNum-2);p++)m[p]=o._ibArray[p];var g=o._paramData._float32Data,c=o._paramData._int32Data;return c[0]=1,c[t._PARAM_VB_POS_]=o.vbBuffer.getPtrID(),c[t._PARAM_IB_POS_]=o.ibBuffer.getPtrID(),g[t._PARAM_LINECOLOR_POS_]=r?r:4278190335,g[t._PARAM_LINEWIDTH_POS_]=a,g[t._PARAM_VID_POS_]=s,c[t._PARAM_VB_SIZE_POS_]=o._vbSize,c[t._PARAM_IB_SIZE_POS_]=o._ibSize,LayaGL.syncBufferToRenderThread(o.vbBuffer),LayaGL.syncBufferToRenderThread(o.ibBuffer),LayaGL.syncBufferToRenderThread(o._paramData),o._graphicsCmdEncoder.useCommandEncoder(t._DRAW_LINES_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1),LayaGL.syncBufferToRenderThread(o._graphicsCmdEncoder),o},t.ID="DrawLines",t._DRAW_LINES_CMD_ENCODER_=null,t._PARAM_VB_POS_=1,t._PARAM_IB_POS_=2,t._PARAM_LINECOLOR_POS_=3,t._PARAM_LINEWIDTH_POS_=4,t._PARAM_VID_POS_=5,t._PARAM_VB_SIZE_POS_=6,t._PARAM_IB_SIZE_POS_=7,t}(),DrawPolyCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=0/0,this._y=0/0,this._points=null,this._fillColor=null,this._lineColor=null,this._lineWidth=0/0,this._isConvexPolygon=!1,this._vid=0,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}__class(t,"laya.display.cmdNative.DrawPolyCmdNative");var e=t.prototype;return e.recover=function(){this._points=null,this._fillColor=null,this._lineColor=null,Pool.recover("DrawPolyCmd",this)},__getset(0,e,"lineColor",function(){return this._lineColor},function(t){if(this._lineColor=t,this._lineColor&&this.line_vbBuffer){for(var e=Color.create(this._lineColor),i=e.numColor,n=this.line_vbBuffer._int32Data,r=0,a=0;a<this._line_vertNum;a++)r++,r++,n[r++]=i;LayaGL.syncBufferToRenderThread(this.line_vbBuffer)}}),__getset(0,e,"points",function(){return this._points},function(e){this._points=e,this._vertNum=this._points.length/2;var i=this._vertNum,n=0;if(this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,this._lineColor){for(var r=0;r<this._points.length;r++)this._linePoints.push(this._points[r]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),BasePoly.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,n=this._line_vertNum}var a=0;if(this._isConvexPolygon){var s=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*s*2)&&(this.ibBuffer=new ParamData(3*s*2,!0,!0)),this._ibSize=3*s*2;for(var o=this.ibBuffer._int16Data,l=0,_=0;s>_;_++)o[l++]=a,o[l++]=_+1+a,o[l++]=_+2+a;if(this._lineColor){(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(n-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var h=this.line_ibBuffer._int16Data,l=0,u=0;u<3*(this._line_vertNum-2);u++)h[l++]=this._line_ibArray[u]}}else{var c=Earcut.earcut(this._points,null,2);if(c.length>0){(!this.ibBuffer||this.ibBuffer.getByteLength()<2*c.length)&&(this.ibBuffer=new ParamData(2*c.length,!0,!0)),this._ibSize=2*c.length;for(var o=this.ibBuffer._int16Data,l=0,u=0;u<c.length;u++)o[l++]=c[u];if(this._lineColor){(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(n-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var h=this.line_ibBuffer._int16Data,l=0,u=0;u<3*(this._line_vertNum-2);u++)h[l++]=this._line_ibArray[u]}}}(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*i*4,!0)),this._vbSize=3*this._vertNum*4;for(var d=Color.create(this._fillColor),f=d.numColor,m=this.vbBuffer._float32Data,p=this.vbBuffer._int32Data,g=0,r=0;r<this._vertNum;r++)m[g++]=this._points[2*r]+this._x,m[g++]=this._points[2*r+1]+this._y,p[g++]=f;if(this._lineColor){(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*n*4,!0)),this._line_vbSize=3*this._line_vertNum*4;for(var v=Color.create(this._lineColor),x=v.numColor,y=this.line_vbBuffer._float32Data,T=this.line_vbBuffer._int32Data,g=0,r=0;r<this._line_vertNum;r++)y[g++]=this._line_vbArray[2*r]+this._x,y[g++]=this._line_vbArray[2*r+1]+this._y,T[g++]=x
}var D=this._paramData._int32Data;D[t._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),D[t._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),D[t._PARAM_VB_SIZE_POS_]=this._vbSize,D[t._PARAM_IB_SIZE_POS_]=this._ibSize,this._lineColor&&(D[t._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),D[t._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),D[t._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,D[t._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,LayaGL.syncBufferToRenderThread(this.line_vbBuffer),LayaGL.syncBufferToRenderThread(this.line_ibBuffer)),LayaGL.syncBufferToRenderThread(this.vbBuffer),LayaGL.syncBufferToRenderThread(this.ibBuffer),LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"cmdID",function(){return"DrawPoly"}),__getset(0,e,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=Color.create(this._fillColor),i=e.numColor,n=this.vbBuffer._int32Data,r=0,a=0;a<this._vertNum;a++)r++,r++,n[r++]=i;LayaGL.syncBufferToRenderThread(this.vbBuffer)}),__getset(0,e,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,n=0;n<this._vertNum;n++)e[i++]=this._points[2*n]+this._x,i++,i++;if(this._lineColor){for(var r=this.line_vbBuffer._float32Data,i=0,n=0;n<this._line_vertNum;n++)r[i++]=this._line_vbArray[2*n]+this._x,i++,i++;LayaGL.syncBufferToRenderThread(this.line_vbBuffer)}LayaGL.syncBufferToRenderThread(this.vbBuffer)}),__getset(0,e,"isConvexPolygon",function(){return this._isConvexPolygon},function(t){this._isConvexPolygon=t}),__getset(0,e,"vid",function(){return this._vid},function(t){this._vid=t}),__getset(0,e,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,n=0;n<this._vertNum;n++)i++,e[i++]=this._points[2*n+1]+this._y,i++;if(this._lineColor){for(var r=this.line_vbBuffer._float32Data,i=0,n=0;n<this._line_vertNum;n++)i++,r[i++]=this._line_vbArray[2*n+1]+this._y,i++;LayaGL.syncBufferToRenderThread(this.line_vbBuffer)}LayaGL.syncBufferToRenderThread(this.vbBuffer)}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(t){if(this._lineWidth=t,this._lineColor&&this.line_vbBuffer){this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var e=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),BasePoly.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var i=this.line_vbBuffer._float32Data,n=0,e=0;e<this._line_vertNum;e++)i[n++]=this._line_vbArray[2*e]+this._x,i[n++]=this._line_vbArray[2*e+1]+this._y,n++;LayaGL.syncBufferToRenderThread(this.line_vbBuffer)}}),t.create=function(e,i,n,r,a,s,o,l){var _=Pool.getItemByClass("DrawPolyCmd",t);_._graphicsCmdEncoder=this._commandEncoder,a?t._DRAW_POLY_LINES_CMD_ENCODER_||(t._DRAW_POLY_LINES_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(140,32,!0),t._DRAW_POLY_LINES_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWVG),t._DRAW_POLY_LINES_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHVG),t._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_SIZE_POS_),t._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_LINE_VB_POS_,4*t._PARAM_LINE_VB_SIZE_POS_,4*t._PARAM_LINE_IB_POS_,4*t._PARAM_LINE_IB_SIZE_POS_),t._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_POLY_LINES_CMD_ENCODER_)):t._DRAW_POLY_CMD_ENCODER_||(t._DRAW_POLY_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(88,32,!0),t._DRAW_POLY_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWVG),t._DRAW_POLY_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHVG),t._DRAW_POLY_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_POLY_CMD_ENCODER_.setMeshExByParamData(4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_,4*t._PARAM_IB_POS_,4*t._PARAM_IB_SIZE_POS_),t._DRAW_POLY_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_POLY_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_POLY_CMD_ENCODER_)),_._paramData||(_._paramData=new ParamData(56,!0)),_._x=e,_._y=i,_._points=n,_._fillColor=r,_._lineColor=a,_._lineWidth=s,_._isConvexPolygon=o,_._vid=l,_._vertNum=n.length/2;var h=_._vertNum,u=0;if(a){for(var c=0;c<n.length;c++)_._linePoints.push(n[c]);_._linePoints.push(n[0]),_._linePoints.push(n[1]),BasePoly.createLine2(_._linePoints,_._line_ibArray,s,0,_._line_vbArray,!1),_._line_vertNum=_._linePoints.length,u=_._line_vertNum}var d=0;if(o){var f=_._vertNum-2;(!_.ibBuffer||_.ibBuffer.getByteLength()<3*f*2)&&(_.ibBuffer=new ParamData(3*f*2,!0,!0)),_._ibSize=3*f*2;for(var m=_.ibBuffer._int16Data,p=0,g=0;f>g;g++)m[p++]=d,m[p++]=g+1+d,m[p++]=g+2+d;if(a){(!_.line_ibBuffer||_.line_ibBuffer.getByteLength()<3*(_._line_vertNum-2)*2)&&(_.line_ibBuffer=new ParamData(3*(u-2)*2,!0,!0)),_._line_ibSize=3*(_._line_vertNum-2)*2;for(var v=_.line_ibBuffer._int16Data,p=0,x=0;x<3*(_._line_vertNum-2);x++)v[p++]=_._line_ibArray[x]}}else{var y=Earcut.earcut(n,null,2);if(y.length>0){(!_.ibBuffer||_.ibBuffer.getByteLength()<2*y.length)&&(_.ibBuffer=new ParamData(2*y.length,!0,!0)),_._ibSize=2*y.length;for(var m=_.ibBuffer._int16Data,p=0,x=0;x<y.length;x++)m[p++]=y[x];if(a){(!_.line_ibBuffer||_.line_ibBuffer.getByteLength()<3*(_._line_vertNum-2)*2)&&(_.line_ibBuffer=new ParamData(3*(u-2)*2,!0,!0)),_._line_ibSize=3*(_._line_vertNum-2)*2;for(var v=_.line_ibBuffer._int16Data,p=0,x=0;x<3*(_._line_vertNum-2);x++)v[p++]=_._line_ibArray[x]}}}var T=Color.create(r),D=T.numColor;(!_.vbBuffer||_.vbBuffer.getByteLength()<3*_._vertNum*4)&&(_.vbBuffer=new ParamData(3*h*4,!0)),_._vbSize=3*_._vertNum*4;for(var E=_.vbBuffer._float32Data,S=_.vbBuffer._int32Data,M=0,c=0;c<_._vertNum;c++)E[M++]=n[2*c]+e,E[M++]=n[2*c+1]+i,S[M++]=D;if(a){(!_.line_vbBuffer||_.line_vbBuffer.getByteLength()<3*_._line_vertNum*4)&&(_.line_vbBuffer=new ParamData(3*u*4,!0)),_._line_vbSize=3*_._line_vertNum*4;for(var R=Color.create(a),A=R.numColor,C=_.line_vbBuffer._float32Data,L=_.line_vbBuffer._int32Data,M=0,c=0;c<_._line_vertNum;c++)C[M++]=_._line_vbArray[2*c]+e,C[M++]=_._line_vbArray[2*c+1]+i,L[M++]=A}var I=_._paramData._float32Data,w=_._paramData._int32Data;return w[0]=1,w[1]=32,w[t._PARAM_VB_POS_]=_.vbBuffer.getPtrID(),w[t._PARAM_IB_POS_]=_.ibBuffer.getPtrID(),w[t._PARAM_VB_SIZE_POS_]=_._vbSize,w[t._PARAM_IB_SIZE_POS_]=_._ibSize,I[t._PARAM_ISCONVEXT_POS_]=o,I[t._PARAM_VID_POS_]=l,a&&(w[t._PARAM_LINE_VB_POS_]=_.line_vbBuffer.getPtrID(),w[t._PARAM_LINE_IB_POS_]=_.line_ibBuffer.getPtrID(),I[t._PARAM_LINECOLOR_POS_]=a,I[t._PARAM_LINEWIDTH_POS_]=s,w[t._PARAM_LINE_VB_SIZE_POS_]=_._line_vbSize,w[t._PARAM_LINE_IB_SIZE_POS_]=_._line_ibSize,LayaGL.syncBufferToRenderThread(_.line_vbBuffer),LayaGL.syncBufferToRenderThread(_.line_ibBuffer)),LayaGL.syncBufferToRenderThread(_.vbBuffer),LayaGL.syncBufferToRenderThread(_.ibBuffer),LayaGL.syncBufferToRenderThread(_._paramData),a?_._graphicsCmdEncoder.useCommandEncoder(t._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),_._paramData.getPtrID(),-1):_._graphicsCmdEncoder.useCommandEncoder(t._DRAW_POLY_CMD_ENCODER_.getPtrID(),_._paramData.getPtrID(),-1),LayaGL.syncBufferToRenderThread(_._graphicsCmdEncoder),_},t.ID="DrawPoly",t._DRAW_POLY_CMD_ENCODER_=null,t._DRAW_POLY_LINES_CMD_ENCODER_=null,t._PARAM_VB_POS_=2,t._PARAM_IB_POS_=3,t._PARAM_LINE_VB_POS_=4,t._PARAM_LINE_IB_POS_=5,t._PARAM_LINECOLOR_POS_=6,t._PARAM_LINEWIDTH_POS_=7,t._PARAM_ISCONVEXT_POS_=8,t._PARAM_VID_POS_=9,t._PARAM_VB_SIZE_POS_=10,t._PARAM_IB_SIZE_POS_=11,t._PARAM_LINE_VB_SIZE_POS_=12,t._PARAM_LINE_IB_SIZE_POS_=13,t}(),DrawRectCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._x=0/0,this._y=0/0,this._width=0/0,this._height=0/0,this._fillColor=null,this._lineColor=null,this._lineWidth=0/0,this._line_vertNum=0,this._linePoints=[],this._line_ibArray=[],this._line_vbArray=[]}__class(t,"laya.display.cmdNative.DrawRectCmdNative");var e=t.prototype;return e.recover=function(){this._graphicsCmdEncoder=null,Pool.recover("DrawRectCmd",this)},__getset(0,e,"lineColor",function(){return this._lineColor},function(e){if(this.lineColor&&this._linePoints){this._lineColor=e;for(var i=this._paramData._int32Data,n=Color.create(this._lineColor),r=n.numColor,a=t._PARAM_LINE_VB_POS_,s=0;s<this._line_vertNum;s++)a++,a++,i[a++]=r;LayaGL.syncBufferToRenderThread(this._paramData)}}),__getset(0,e,"cmdID",function(){return"DrawRect"}),__getset(0,e,"fillColor",function(){return this._fillColor},function(e){if(this._fillColor=e,"string"==typeof e){var i=Color.create(this._fillColor),n=i.numColor,r=this._paramData._int32Data;r[t._PARAM_VB_POS_+4]=n,r[t._PARAM_VB_POS_+10]=n,r[t._PARAM_VB_POS_+16]=n,r[t._PARAM_VB_POS_+22]=n}else{var r=this._paramData._int32Data;r[t._PARAM_VB_POS_+4]=e,r[t._PARAM_VB_POS_+10]=e,r[t._PARAM_VB_POS_+16]=e,r[t._PARAM_VB_POS_+22]=e}LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"width",function(){return this._width},function(e){this._width=e;var i=this._paramData._float32Data;if(i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,BasePoly.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var n=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[n++]=this._line_vbArray[2*r],i[n++]=this._line_vbArray[2*r+1],n++}LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"x",function(){return this._x},function(e){this._x=e;var i=this._paramData._float32Data;if(i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[0]=this._x,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,this._linePoints[6]=this._x,this._linePoints[8]=this._x,BasePoly.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var n=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[n++]=this._line_vbArray[2*r],i[n++]=this._line_vbArray[2*r+1],n++}LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"y",function(){return this._y},function(e){this._y=e;var i=this._paramData._float32Data;if(i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[1]=this._y,this._linePoints[3]=this._y,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,this._linePoints[9]=this._y-this._lineWidth/2,BasePoly.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var n=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[n++]=this._line_vbArray[2*r],i[n++]=this._line_vbArray[2*r+1],n++}LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"height",function(){return this._height},function(e){this._height=e;var i=this._paramData._float32Data;if(i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,BasePoly.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var n=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[n++]=this._line_vbArray[2*r],i[n++]=this._line_vbArray[2*r+1],n++}LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"lineWidth",function(){return this._lineWidth},function(e){if(this.lineColor&&this._linePoints){this._lineWidth=e,this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[9]=this._y-this._lineWidth/2,BasePoly.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var i=this._paramData._float32Data,n=t._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i[n++]=this._line_vbArray[2*r],i[n++]=this._line_vbArray[2*r+1],n++;LayaGL.syncBufferToRenderThread(this._paramData)}}),t.create=function(e,i,n,r,a,s,o){var l=Pool.getItemByClass("DrawRectCmd",t);l._graphicsCmdEncoder=this._commandEncoder,s?t._DRAW_RECT_LINE_CMD_ENCODER_||(t._DRAW_RECT_LINE_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(164,32,!0),t._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHQUADTEXTURE),t._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_RECT_LINE_CMD_ENCODER_.setRectMeshByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),t._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWVG),t._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHVG),t._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_RECT_LINE_CMD_ENCODER_.setMeshByParamData(4*t._PARAM_LINE_VB_POS_,4*t._PARAM_LINE_VB_SIZE_POS_,4*t._PARAM_LINE_IB_POS_,4*t._PARAM_LINE_IB_SIZE_POS_),t._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_RECT_LINE_CMD_ENCODER_)):t._DRAW_RECT_CMD_ENCODER_||(t._DRAW_RECT_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(84,32,!0),t._DRAW_RECT_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._DRAW_RECT_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHQUADTEXTURE),t._DRAW_RECT_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_RECT_CMD_ENCODER_.setRectMeshByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_RECT_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_RECT_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_RECT_CMD_ENCODER_)),l._paramData||(l._paramData=new ParamData(280,!0)),l._x=e,l._y=i,l._width=n,l._height=r,l._fillColor=a,l._lineColor=s,l._lineWidth=o;var _=Color.create(a),h=_.numColor,u=l._paramData._float32Data,c=l._paramData._int32Data;c[t._PARAM_RECT_NUM_POS_]=1,c[t._PARAM_VB_SIZE_POS_]=96;var d=t._PARAM_VB_POS_;if(u[d++]=e,u[d++]=i,u[d++]=0,u[d++]=0,c[d++]=h,u[d++]=4294967295,u[d++]=e+n,u[d++]=i,u[d++]=0,u[d++]=0,c[d++]=h,u[d++]=4294967295,u[d++]=e+n,u[d++]=i+r,u[d++]=0,u[d++]=0,c[d++]=h,u[d++]=4294967295,u[d++]=e,u[d++]=i+r,u[d++]=0,u[d++]=0,c[d++]=h,u[d++]=4294967295,s){l._linePoints.push(e),l._linePoints.push(i),l._linePoints.push(e+n),l._linePoints.push(i),l._linePoints.push(e+n),l._linePoints.push(i+r),l._linePoints.push(e),l._linePoints.push(i+r),l._linePoints.push(e),l._linePoints.push(i-o/2),BasePoly.createLine2(l._linePoints,l._line_ibArray,o,0,l._line_vbArray,!1),l._line_vertNum=l._linePoints.length,c[t._PARAM_LINE_VB_SIZE_POS_]=120;var f=Color.create(s),m=f.numColor;d=t._PARAM_LINE_VB_POS_;for(var p=0;p<l._line_vertNum;p++)u[d++]=l._line_vbArray[2*p],u[d++]=l._line_vbArray[2*p+1],c[d++]=m;c[t._PARAM_LINE_IB_SIZE_POS_]=2*l._line_ibArray.length;var g=l._paramData._int16Data;d=2*t._PARAM_LINE_IB_POS_;for(var v=0;v<l._line_ibArray.length;v++)g[d++]=l._line_ibArray[v]}return LayaGL.syncBufferToRenderThread(l._paramData),s?l._graphicsCmdEncoder.useCommandEncoder(t._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),l._paramData.getPtrID(),-1):l._graphicsCmdEncoder.useCommandEncoder(t._DRAW_RECT_CMD_ENCODER_.getPtrID(),l._paramData.getPtrID(),-1),LayaGL.syncBufferToRenderThread(l._graphicsCmdEncoder),l},t.ID="DrawRect",t._DRAW_RECT_CMD_ENCODER_=null,t._DRAW_RECT_LINE_CMD_ENCODER_=null,t._PARAM_RECT_NUM_POS_=0,t._PARAM_VB_SIZE_POS_=1,t._PARAM_VB_POS_=2,t._PARAM_LINE_VB_SIZE_POS_=26,t._PARAM_LINE_VB_POS_=27,t._PARAM_LINE_IB_SIZE_POS_=57,t._PARAM_LINE_IB_POS_=58,t}(),DrawTextureCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=0/0,this._y=0/0,this._width=0/0,this._height=0/0,this._matrix=null,this._alpha=0/0,this._color=null,this._blendMode=null}__class(t,"laya.display.cmdNative.DrawTextureCmdNative");var e=t.prototype;return e.recover=function(){this._texture=null,Pool.recover("DrawTextureCmd",this)},__getset(0,e,"cmdID",function(){return"DrawTexture"}),__getset(0,e,"matrix",function(){return this._matrix},function(e){var i=this._paramData._float32Data;i[t._PARAM_MATRIX_POS_]=e.a,i[t._PARAM_MATRIX_POS_+1]=e.b,i[t._PARAM_MATRIX_POS_+2]=e.c,i[t._PARAM_MATRIX_POS_+3]=e.d,i[t._PARAM_MATRIX_POS_+4]=e.tx,i[t._PARAM_MATRIX_POS_+5]=e.ty,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"y",function(){return this._y},function(e){this._y=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"texture",function(){return this._texture},function(e){if(e&&e.url){this._texture=e,this._paramData._int32Data[t._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture;var i=this._paramData._float32Data,n=this.texture.uv;i[t._PARAM_VB_POS_+2]=n[0],i[t._PARAM_VB_POS_+3]=n[1],i[t._PARAM_VB_POS_+8]=n[2],i[t._PARAM_VB_POS_+9]=n[3],i[t._PARAM_VB_POS_+14]=n[4],i[t._PARAM_VB_POS_+15]=n[5],i[t._PARAM_VB_POS_+20]=n[6],i[t._PARAM_VB_POS_+21]=n[7],LayaGL.syncBufferToRenderThread(this._paramData)}}),__getset(0,e,"width",function(){return this._width},function(e){this._width=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"x",function(){return this._x},function(e){this._x=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_]=this._x,i[t._PARAM_VB_POS_+6]=this._x+this._width,i[t._PARAM_VB_POS_+12]=this._x+this._width,i[t._PARAM_VB_POS_+18]=this._x,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"height",function(){return this._height},function(e){this._height=e;var i=this._paramData._float32Data;i[t._PARAM_VB_POS_+1]=this._y,i[t._PARAM_VB_POS_+7]=this._y,i[t._PARAM_VB_POS_+13]=this._y+this._height,i[t._PARAM_VB_POS_+19]=this._y+this._height,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t;this._paramData._float32Data;LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,n,r,a,s,o,l,_){var h=Pool.getItemByClass("DrawTextureCmd",t);h._graphicsCmdEncoder=this._commandEncoder,s?t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_||(t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=LayaGL.instance.createCommandEncoder(132,32,!0),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useVDO(LayaNative2D.VDO_MESHQUADTEXTURE),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.save(),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setGlobalValueByParamData(LayaNative2D.GLOBALVALUE_MATRIX32,7,4*t._PARAM_MATRIX_POS_),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(LayaNative2D.GLOBALVALUE_CLIPDIR,1),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(LayaNative2D.GLOBALVALUE_CLIPSIZE,2),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformTextureByParamData(4*t._PARAM_UNIFORM_LOCATION_POS_,4*t._PARAM_TEX_LOCATION_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setRectMeshByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.restore(),LayaGL.syncBufferToRenderThread(t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_)):t._DRAW_TEXTURE_CMD_ENCODER_||(t._DRAW_TEXTURE_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(124,32,!0),t._DRAW_TEXTURE_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._DRAW_TEXTURE_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHQUADTEXTURE),t._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_CLIPDIR,1),t._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_CLIPSIZE,2),t._DRAW_TEXTURE_CMD_ENCODER_.uniformTextureByParamData(4*t._PARAM_UNIFORM_LOCATION_POS_,4*t._PARAM_TEX_LOCATION_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_TEXTURE_CMD_ENCODER_.setRectMeshByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_TEXTURE_CMD_ENCODER_)),h._paramData||(h._paramData=new ParamData(148,!0)),h._texture=e,h._x=i,h._y=n,h._width=r,h._height=a,h._matrix=s,h._alpha=o,h._color=l,h._blendMode=_;var u=0!=r?r:e.bitmap.width,c=0!=a?a:e.bitmap.height,d=e.uv,f=h._paramData._float32Data,m=h._paramData._int32Data;m[t._PARAM_UNIFORM_LOCATION_POS_]=3,m[t._PARAM_TEX_LOCATION_POS_]=33984,m[t._PARAM_TEXTURE_POS_]=e.bitmap._glTexture,m[t._PARAM_RECT_NUM_POS_]=1,m[t._PARAM_VB_SIZE_POS_]=96;var p=t._PARAM_VB_POS_;return f[p++]=i,f[p++]=n,f[p++]=d[0],f[p++]=d[1],m[p++]=4294967295,m[p++]=4294967295,f[p++]=i+u,f[p++]=n,f[p++]=d[2],f[p++]=d[3],m[p++]=4294967295,m[p++]=4294967295,f[p++]=i+u,f[p++]=n+c,f[p++]=d[4],f[p++]=d[5],m[p++]=4294967295,m[p++]=4294967295,f[p++]=i,f[p++]=n+c,f[p++]=d[6],f[p++]=d[7],m[p++]=4294967295,m[p++]=4294967295,s?(f[t._PARAM_MATRIX_POS_]=s.a,f[t._PARAM_MATRIX_POS_+1]=s.b,f[t._PARAM_MATRIX_POS_+2]=s.c,f[t._PARAM_MATRIX_POS_+3]=s.d,f[t._PARAM_MATRIX_POS_+4]=s.tx,f[t._PARAM_MATRIX_POS_+5]=s.ty):(f[t._PARAM_MATRIX_POS_]=1,f[t._PARAM_MATRIX_POS_+1]=0,f[t._PARAM_MATRIX_POS_+2]=0,f[t._PARAM_MATRIX_POS_+3]=1,f[t._PARAM_MATRIX_POS_+4]=0,f[t._PARAM_MATRIX_POS_+5]=0),LayaGL.syncBufferToRenderThread(h._paramData),s?h._graphicsCmdEncoder.useCommandEncoder(t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),h._paramData.getPtrID(),-1):h._graphicsCmdEncoder.useCommandEncoder(t._DRAW_TEXTURE_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1),LayaGL.syncBufferToRenderThread(h._graphicsCmdEncoder),h},t.ID="DrawTexture",t._DRAW_TEXTURE_CMD_ENCODER_=null,t._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=null,t._PARAM_UNIFORM_LOCATION_POS_=0,t._PARAM_TEX_LOCATION_POS_=1,t._PARAM_TEXTURE_POS_=2,t._PARAM_RECT_NUM_POS_=3,t._PARAM_VB_SIZE_POS_=4,t._PARAM_VB_POS_=5,t._PARAM_MATRIX_POS_=29,t._PARAM_BLEND_SRC_POS_=35,t._PARAM_BLEND_DEST_POS_=36,t}(),DrawTexturesCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._pos=null,this._rectNum=0,this._vbSize=0,this.vbBuffer=null}__class(t,"laya.display.cmdNative.DrawTexturesCmdNative");var e=t.prototype;return e.recover=function(){this._texture=null,this._pos=null,Pool.recover("DrawTexturesCmd",this)},__getset(0,e,"cmdID",function(){return"DrawTextures"}),__getset(0,e,"texture",function(){return this._texture},function(e){this._texture=e;for(var i=this._texture.bitmap.width,n=this._texture.bitmap.height,r=this._texture.uv,a=this.vbBuffer._float32Data,s=this.vbBuffer._int32Data,o=0,l=0;l<this._rectNum;l++){var _=this.pos[2*l],h=this.pos[2*l+1];a[o++]=_,a[o++]=h,a[o++]=r[0],a[o++]=r[1],s[o++]=4294967295,s[o++]=4294967295,a[o++]=_+i,a[o++]=h,a[o++]=r[2],a[o++]=r[3],s[o++]=4294967295,s[o++]=4294967295,a[o++]=_+i,a[o++]=h+n,a[o++]=r[4],a[o++]=r[5],s[o++]=4294967295,s[o++]=4294967295,a[o++]=_,a[o++]=h+n,a[o++]=r[6],a[o++]=r[7],s[o++]=4294967295,s[o++]=4294967295}var u=this._paramData._int32Data;u[t._PARAM_TEXLOCATION_POS_]=33984,u[t._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture,LayaGL.syncBufferToRenderThread(this.vbBuffer),LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"pos",function(){return this._pos},function(e){this._pos=e;var i=this._pos.length/2,n=this._texture.bitmap.width,r=this._texture.bitmap.height,a=this._texture.uv;(!this.vbBuffer||this.vbBuffer.getByteLength()<24*i*4)&&(this.vbBuffer=new ParamData(24*i*4,!0)),this._vbSize=24*i*4,this._rectNum=i;for(var s=this.vbBuffer._float32Data,o=this.vbBuffer._int32Data,l=0,_=0;i>_;_++){var h=this.pos[2*_],u=this.pos[2*_+1];s[l++]=h,s[l++]=u,s[l++]=a[0],s[l++]=a[1],o[l++]=4294967295,o[l++]=4294967295,s[l++]=h+n,s[l++]=u,s[l++]=a[2],s[l++]=a[3],o[l++]=4294967295,o[l++]=4294967295,s[l++]=h+n,s[l++]=u+r,s[l++]=a[4],s[l++]=a[5],o[l++]=4294967295,o[l++]=4294967295,s[l++]=h,s[l++]=u+r,s[l++]=a[6],s[l++]=a[7],o[l++]=4294967295,o[l++]=4294967295}var c=(this._paramData._float32Data,this._paramData._int32Data);c[t._PARAM_RECT_NUM_POS_]=this._rectNum,c[t._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),c[t._PARAM_VB_SIZE_POS_]=this._vbSize,LayaGL.syncBufferToRenderThread(this.vbBuffer),LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i){var n=Pool.getItemByClass("DrawTexturesCmd",t);n._graphicsCmdEncoder=this._commandEncoder,t._DRAW_TEXTURES_CMD_ENCODER_||(t._DRAW_TEXTURES_CMD_ENCODER_=LayaGL.instance.createCommandEncoder(124,32,!0),t._DRAW_TEXTURES_CMD_ENCODER_.useProgramEx(LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._DRAW_TEXTURES_CMD_ENCODER_.useVDO(LayaNative2D.VDO_MESHQUADTEXTURE),t._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_CLIPDIR,1),t._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(LayaNative2D.GLOBALVALUE_CLIPSIZE,2),t._DRAW_TEXTURES_CMD_ENCODER_.uniformTextureByParamData(t._PARAM_UNIFORMLOCATION_POS_,4*t._PARAM_TEXLOCATION_POS_,4*t._PARAM_TEXTURE_POS_),t._DRAW_TEXTURES_CMD_ENCODER_.setRectMeshExByParamData(4*t._PARAM_RECT_NUM_POS_,4*t._PARAM_VB_POS_,4*t._PARAM_VB_SIZE_POS_),t._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._DRAW_TEXTURES_CMD_ENCODER_)),n._paramData||(n._paramData=new ParamData(24,!0)),n._texture=e,n._pos=i;var r=e.bitmap.width,a=e.bitmap.height,s=e.uv,o=i.length/2;(!n.vbBuffer||n.vbBuffer.getByteLength()<24*o*4)&&(n.vbBuffer=new ParamData(24*o*4,!0)),n._vbSize=24*o*4,n._rectNum=o;for(var l=n.vbBuffer._float32Data,_=n.vbBuffer._int32Data,h=0,u=0;o>u;u++){var c=i[2*u],d=i[2*u+1];l[h++]=c,l[h++]=d,l[h++]=s[0],l[h++]=s[1],_[h++]=4294967295,_[h++]=4294967295,l[h++]=c+r,l[h++]=d,l[h++]=s[2],l[h++]=s[3],_[h++]=4294967295,_[h++]=4294967295,l[h++]=c+r,l[h++]=d+a,l[h++]=s[4],l[h++]=s[5],_[h++]=4294967295,_[h++]=4294967295,l[h++]=c,l[h++]=d+a,l[h++]=s[6],l[h++]=s[7],_[h++]=4294967295,_[h++]=4294967295}var f=(n._paramData._float32Data,n._paramData._int32Data);return f[t._PARAM_UNIFORMLOCATION_POS_]=3,f[t._PARAM_TEXLOCATION_POS_]=33984,f[t._PARAM_TEXTURE_POS_]=e.bitmap._glTexture,f[t._PARAM_RECT_NUM_POS_]=n._rectNum,f[t._PARAM_VB_POS_]=n.vbBuffer.getPtrID(),f[t._PARAM_VB_SIZE_POS_]=n._vbSize,LayaGL.syncBufferToRenderThread(n.vbBuffer),LayaGL.syncBufferToRenderThread(n._paramData),n._graphicsCmdEncoder.useCommandEncoder(t._DRAW_TEXTURES_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1),LayaGL.syncBufferToRenderThread(n._graphicsCmdEncoder),n},t.ID="DrawTextures",t._DRAW_TEXTURES_CMD_ENCODER_=null,t._PARAM_UNIFORMLOCATION_POS_=0,t._PARAM_TEXLOCATION_POS_=1,t._PARAM_TEXTURE_POS_=2,t._PARAM_RECT_NUM_POS_=3,t._PARAM_VB_POS_=4,t._PARAM_VB_SIZE_POS_=5,t}(),FillTextCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=0/0,this._y=0/0,this._font=null,this._color=null,this._textAlign=null,this._draw_texture_cmd_encoder_=LayaGL.instance.createCommandEncoder(64,32,!0),this.cbook=CharBook.charbookInst}__class(t,"laya.display.cmdNative.FillTextCmdNative");var e=t.prototype;return e.createFillText=function(t,e,i,n,r,a,s){var o=Color.create(a),l=o.numColor,_={};_._curMat=new Matrix,_._italicDeg=0,_._drawTextureUseColor=4294967295,_.fillStyle=a,_._drawTextureM=function(e,i,n,r,a,s,o,_){t.useProgramEx(LayaNative2D.PROGRAMEX_DRAWTEXTURE),t.useVDO(LayaNative2D.VDO_MESHQUADTEXTURE),t.uniformEx(LayaNative2D.GLOBALVALUE_VIEWS,0),t.uniformTexture(3,33984,e.bitmap._glTexture);var h=new Float32Array([i,n,_[0],_[1],0,0,i+r,n,_[2],_[3],0,0,i+r,n+a,_[4],_[5],0,0,i,n+a,_[6],_[7],0,0]),u=new Int32Array(h.buffer);u[4]=u[10]=u[16]=u[22]=l,u[5]=u[11]=u[17]=u[23]=4294967295,t.setRectMesh(1,h,h.length),t.modifyMesh(LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t)},this.cbook.filltext(_,e,i,n,r,a,null,0,s)},e.recover=function(){this._graphicsCmdEncoder=null,Pool.recover("FillTextCmd",this)},__getset(0,e,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),LayaGL.syncBufferToRenderThread(e)}),__getset(0,e,"cmdID",function(){return"FillText"}),__getset(0,e,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),LayaGL.syncBufferToRenderThread(e)}),__getset(0,e,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),LayaGL.syncBufferToRenderThread(e)}),__getset(0,e,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),LayaGL.syncBufferToRenderThread(e)}),__getset(0,e,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),LayaGL.syncBufferToRenderThread(e)}),__getset(0,e,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),LayaGL.syncBufferToRenderThread(e)}),t.create=function(e,i,n,r,a,s){this.cbook||new Error("Error:charbook not create!");var o=Pool.getItemByClass("FillTextCmd",t),l=o._graphicsCmdEncoder=this._commandEncoder;return o._text=e,o._x=i,o._y=n,o._font=r,o._color=a,o._textAlign=s,o._draw_texture_cmd_encoder_.clearEncoding(),o.createFillText(o._draw_texture_cmd_encoder_,e,i,n,r,a,s),LayaGL.syncBufferToRenderThread(o._draw_texture_cmd_encoder_),l.useCommandEncoder(o._draw_texture_cmd_encoder_.getPtrID(),-1,-1),LayaGL.syncBufferToRenderThread(l),o},t.ID="FillText",t}(),RestoreCmdNative=function(){function t(){this._graphicsCmdEncoder=null}__class(t,"laya.display.cmdNative.RestoreCmdNative");var e=t.prototype;return e.recover=function(){Pool.recover("RestoreCmd",this)},__getset(0,e,"cmdID",function(){return"Restore"}),t.create=function(){var e=Pool.getItemByClass("RestoreCmd",t),i=e._graphicsCmdEncoder=this._commandEncoder;
return i.restore(),LayaGL.syncBufferToRenderThread(i),e},t.ID="Restore",t}(),RotateCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(12,!0)}__class(t,"laya.display.cmdNative.RotateCmdNative");var e=t.prototype;return e.recover=function(){Pool.recover("RotateCmd",this)},__getset(0,e,"cmdID",function(){return"Rotate"}),__getset(0,e,"angle",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"pivotX",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"pivotY",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,n){var r=Pool.getItemByClass("RotateCmd",t),a=r._graphicsCmdEncoder=this._commandEncoder,s=r._paramData._float32Data;s[0]=e,s[1]=i,s[2]=n;var o=r._paramData.getPtrID();return LayaGL.syncBufferToRenderThread(r._paramData),a.setGlobalValueEx(LayaNative2D.GLOBALVALUE_MATRIX32,13,o,0),LayaGL.syncBufferToRenderThread(a),r},t.ID="Rotate",t}(),SaveCmdNative=function(){function t(){this._graphicsCmdEncoder=null}__class(t,"laya.display.cmdNative.SaveCmdNative");var e=t.prototype;return e.recover=function(){Pool.recover("SaveCmd",this)},__getset(0,e,"cmdID",function(){return"Save"}),t.create=function(){var e=Pool.getItemByClass("SaveCmd",t),i=e._graphicsCmdEncoder=this._commandEncoder;return i.save(),LayaGL.syncBufferToRenderThread(i),e},t.ID="Save",t}(),ScaleCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}__class(t,"laya.display.cmdNative.ScaleCmdNative");var e=t.prototype;return e.recover=function(){Pool.recover("ScaleCmd",this)},__getset(0,e,"cmdID",function(){return"Scale"}),__getset(0,e,"scaleX",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"scaleY",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"pivotX",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"pivotY",function(){return this._paramData._float32Data[3]},function(t){this._paramData._float32Data[3]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,n,r){var a=Pool.getItemByClass("ScaleCmd",t),s=a._graphicsCmdEncoder=this._commandEncoder,o=a._paramData._float32Data;o[0]=e,o[1]=i,o[2]=n,o[3]=r;var l=a._paramData.getPtrID();return LayaGL.syncBufferToRenderThread(a._paramData),s.setGlobalValueEx(LayaNative2D.GLOBALVALUE_MATRIX32,12,l,0),LayaGL.syncBufferToRenderThread(s),a},t.ID="Scale",t}(),TransformCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._matrix=null,this._paramData=new ParamData(32,!0)}__class(t,"laya.display.cmdNative.TransformCmdNative");var e=t.prototype;return e.recover=function(){this._matrix=null,Pool.recover("TransformCmd",this)},__getset(0,e,"cmdID",function(){return"Transform"}),__getset(0,e,"matrix",function(){return this._matrix},function(t){this._matrix=t;var e=this._paramData._float32Data;e[0]=this._matrix.a,e[1]=this._matrix.b,e[2]=this._matrix.c,e[3]=this._matrix.d,e[4]=this._matrix.tx,e[5]=this._matrix.ty,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"pivotX",function(){return this._paramData._float32Data[6]},function(t){this._paramData._float32Data[6]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"pivotY",function(){return this._paramData._float32Data[7]},function(t){this._paramData._float32Data[7]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i,n){var r=Pool.getItemByClass("TransformCmd",t),a=r._graphicsCmdEncoder=this._commandEncoder,s=r._paramData._float32Data;s[0]=e.a,s[1]=e.b,s[2]=e.c,s[3]=e.d,s[4]=e.tx,s[5]=e.ty,s[6]=i,s[7]=n,r._matrix=e;var o=r._paramData.getPtrID();return LayaGL.syncBufferToRenderThread(r._paramData),a.setGlobalValueEx(LayaNative2D.GLOBALVALUE_MATRIX32,14,o,0),LayaGL.syncBufferToRenderThread(a),r},t.ID="Transform",t}(),TranslateCmdNative=function(){function t(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(8,!0)}__class(t,"laya.display.cmdNative.TranslateCmdNative");var e=t.prototype;return e.recover=function(){Pool.recover("TranslateCmd",this)},__getset(0,e,"ty",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),__getset(0,e,"cmdID",function(){return"Translate"}),__getset(0,e,"tx",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,LayaGL.syncBufferToRenderThread(this._paramData)}),t.create=function(e,i){var n=Pool.getItemByClass("TranslateCmd",t),r=n._graphicsCmdEncoder=this._commandEncoder,a=n._paramData._float32Data;a[0]=e,a[1]=i;var s=n._paramData.getPtrID();return LayaGL.syncBufferToRenderThread(n._paramData),r.setGlobalValueEx(LayaNative2D.GLOBALVALUE_MATRIX32,9,s,0),LayaGL.syncBufferToRenderThread(r),n},t.ID="Translate",t}(),BoundsStyle=function(){function t(){}__class(t,"laya.display.css.BoundsStyle");var e=t.prototype;return e.reset=function(){return this.bounds&&this.bounds.recover(),this.userBounds&&this.userBounds.recover(),this.bounds=null,this.userBounds=null,this.temBM=null,this},e.recover=function(){Pool.recover("BoundsStyle",this.reset())},t.create=function(){return Pool.getItemByClass("BoundsStyle",t)},t}(),CacheStyle=function(){function t(){this.reset()}__class(t,"laya.display.css.CacheStyle");var e=t.prototype;return e.needBitmapCache=function(){return this.cacheForFilters||this.mask},e.needEnableCanvasRender=function(){return"none"!=this.userSetCache||this.cacheForFilters||this.mask},e.releaseContext=function(){this.canvas&&(Pool.recover("CacheCanvas",this.canvas),this.canvas.size(0,0),this.canvas=null)},e.createContext=function(){if(!this.canvas){this.canvas=Pool.getItem("CacheCanvas")||HTMLCanvas.create("AUTO");var t=this.canvas.context;t||(t=this.canvas.getContext("2d"),t.__tx=0,t.__ty=0)}},e.releaseFilterCache=function(){var t=this.filterCache;t&&(t.destroy(),t.recycle(),this.filterCache=null)},e.recover=function(){this!==t.EMPTY&&Pool.recover("SpriteCache",this.reset())},e.reset=function(){return this.releaseContext(),this.releaseFilterCache(),this.cacheAs="none",this.enableCanvasRender=!1,this.userSetCache="none",this.cacheForFilters=!1,this.staticCache=!1,this.reCache=!0,this.mask=null,this.maskParent=null,this.filterCache=null,this.filters=null,this.hasGlowFilter=!1,this.cacheRect&&this.cacheRect.recover(),this.cacheRect=null,this},e._calculateCacheRect=function(e,i,n,r){var a=e._cacheStyle;a.cacheRect||(a.cacheRect=Rectangle.create());var s;Render.isWebGL&&"bitmap"!==i?a.cacheRect.setTo(-e._style.pivotX,-e._style.pivotY,1,1):(s=e.getSelfBounds(),s.x=s.x-e.pivotX,s.y=s.y-e.pivotY,s.x=s.x-16,s.y=s.y-16,s.width=s.width+32,s.height=s.height+32,s.x=Math.floor(s.x+n)-n,s.y=Math.floor(s.y+r)-r,s.width=Math.floor(s.width),s.height=Math.floor(s.height),a.cacheRect.copyFrom(s)),s=a.cacheRect;var o=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleX,l=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleY;if(!Render.isWebGL){var _,h=1,u=1;for(_=e;_&&_!=Laya.stage;)h*=_.scaleX,u*=_.scaleY,_=_.parent;h>1&&(o*=h),u>1&&(l*=u)}if(e._style.scrollRect){var c=e._style.scrollRect;s.x-=c.x,s.y-=c.y}return t._scaleInfo.setTo(o,l),t._scaleInfo},t.create=function(){return Pool.getItemByClass("SpriteCache",t)},t.EMPTY=new t,__static(t,["_scaleInfo",function(){return this._scaleInfo=new Point}]),t}(),SpriteStyle=function(){function t(){this.reset()}__class(t,"laya.display.css.SpriteStyle");var e=t.prototype;return e.reset=function(){return this.scaleX=this.scaleY=1,this.skewX=this.skewY=0,this.pivotX=this.pivotY=this.rotation=0,this.alpha=1,this.scrollRect&&this.scrollRect.recover(),this.scrollRect=null,this.viewport&&this.viewport.recover(),this.viewport=null,this.hitArea=null,this.dragging=null,this.blendMode=null,this},e.recover=function(){this!==t.EMPTY&&Pool.recover("SpriteStyle",this.reset())},t.create=function(){return Pool.getItemByClass("SpriteStyle",t)},t.EMPTY=new t,t}(),Graphics=function(){function t(){this._one=null,this._cmds=null,this._render=this._renderEmpty,this._createData()}__class(t,"laya.display.Graphics");var e=t.prototype;return e._createData=function(){},e._clearData=function(){},e._destroyData=function(){},e.destroy=function(){this.clear(!0),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0,this._sp._setRenderType(0),this._sp=null),this._destroyData()},e.clear=function(t){if(void 0===t&&(t=!0),t){var e=this._one;if(this._cmds){var i=0,n=this._cmds.length;for(i=0;n>i;i++)e=this._cmds[i],e.recover();this._cmds.length=0}else e&&e.recover()}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._clearData(),this._sp&&(this._sp._renderType&=-513,this._sp._setRenderType(this._sp._renderType)),this._repaint(),this._vectorgraphArray){for(i=0,n=this._vectorgraphArray.length;n>i;i++)VectorGraphManager.getInstance().deleteShape(this._vectorgraphArray[i]);this._vectorgraphArray.length=0}},e._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},e._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=GraphicsBounds.create(),this._graphicBounds._graphics=this)},e._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},e._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},e.getBounds=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(t)},e.getBoundPoints=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(t)},e.drawImage=function(t,e,i,n,r){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),!t)return null;if(n||(n=t.sourceWidth),r||(r=t.sourceHeight),t.loaded){var a=n/t.sourceWidth,s=r/t.sourceHeight;if(n=t.width*a,r=t.height*s,0>=n||0>=r)return null;e+=t.offsetX*a,i+=t.offsetY*s}this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType));var o=DrawImageCmd.create.call(this,t,e,i,n,r);return null==this._one?(this._one=o,this._render=this._renderOneImg):this._saveToCmd(null,o),this._repaint(),o},e._isOneImage=function(){return this._render===this._renderOneImg},e.drawTexture=function(t,e,i,n,r,a,s,o,l){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),!t||.01>s)return null;if(!t.loaded)return null;if(n||(n=t.sourceWidth),r||(r=t.sourceHeight),t.loaded){var _=n/t.sourceWidth,h=r/t.sourceHeight;if(n=t.width*_,r=t.height*h,0>=n||0>=r)return null;e+=t.offsetX*_,i+=t.offsetY*h}if(this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType)),!Render.isWebGL&&(l||o)){var u=HTMLCanvas.create("2D");u.size(n,r);var c=u.getContext("2d");if(c.drawTexture(t,0,0,n,r),t=new Texture(u),o){var d=new ColorFilterAction,f=Color.create(o).arrColor;d.data=(new ColorFilter).color(255*f[0],255*f[1],255*f[2]),d.apply({ctx:{ctx:c}})}}var m=DrawTextureCmd.create.call(this,t,e,i,n,r,a,s,o,l);return this._repaint(),this._saveToCmd(null,m)},e.cleanByTexture=function(t,e,i,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),!t)return this.clear(!0);if(this._one&&this._render===this._renderOneImg){n||(n=t.sourceWidth),r||(r=t.sourceHeight);var a=n/t.sourceWidth,s=r/t.sourceHeight;n=t.width*a,r=t.height*s,e+=t.offsetX*a,i+=t.offsetY*s;var o=this._one;o.texture=t,o.x=e,o.y=i,o.width=n,o.height=r,this._repaint()}else this.clear(!0),t&&this.drawImage(t,e,i,n,r)},e.drawTextures=function(t,e){return t?this._saveToCmd(Render._context._drawTextures,DrawTexturesCmd.create.call(this,t,e)):null},e.drawTriangles=function(t,e,i,n,r,a,s,o,l,_){return void 0===o&&(o=1),this._saveToCmd(Render._context.drawTriangles,DrawTrianglesCmd.create.call(this,t,e,i,n,r,a,s,o,l,_))},e.fillTexture=function(t,e,i,n,r,a,s){return void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a="repeat"),t&&t.loaded?this._saveToCmd(Render._context._fillTexture,FillTextureCmd.create.call(this,t,e,i,n,r,a,s||Point.EMPTY,{})):null},e._saveToCmd=function(t,e){return this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType)),null==this._one?(this._one=e,this._render=this._renderOne):(this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),this._repaint(),e},e.clipRect=function(t,e,i,n){return this._saveToCmd(Render._context._clipRect,ClipRectCmd.create.call(this,t,e,i,n))},e.fillText=function(t,e,i,n,r,a){return this._saveToCmd(Render._context._fillText,FillTextCmd.create.call(this,t,e,i,n||Text.defaultFontStr(),r,a))},e.fillBorderText=function(t,e,i,n,r,a,s,o){return this._saveToCmd(Render._context._fillBorderText,FillBorderTextCmd.create.call(this,t,e,i,n||Text.defaultFontStr(),r,a,s,o))},e.fillWords=function(t,e,i,n,r){return this._saveToCmd(Render._context._fillWords,FillWordsCmd.create.call(this,t,e,i,n||Text.defaultFontStr(),r))},e.fillBorderWords=function(t,e,i,n,r,a,s){return this._saveToCmd(Render._context._fillBorderWords,FillBorderWordsCmd.create.call(this,t,e,i,n||Text.defaultFontStr(),r,a,s))},e.strokeText=function(t,e,i,n,r,a,s){return this._saveToCmd(Render._context._strokeText,StrokeTextCmd.create.call(this,t,e,i,n||Text.defaultFontStr(),r,a,s))},e.alpha=function(t){return this._saveToCmd(Render._context._alpha,AlphaCmd.create.call(this,t))},e.transform=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(Render._context._transform,TransformCmd.create.call(this,t,e,i))},e.rotate=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(Render._context._rotate,RotateCmd.create.call(this,t,e,i))},e.scale=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),this._saveToCmd(Render._context._scale,ScaleCmd.create.call(this,t,e,i,n))},e.translate=function(t,e){return this._saveToCmd(Render._context._translate,TranslateCmd.create.call(this,t,e))},e.save=function(){return this._saveToCmd(Render._context._save,SaveCmd.create.call(this))},e.restore=function(){return this._saveToCmd(Render._context._restore,RestoreCmd.create.call(this))},e.replaceText=function(t){this._repaint();var e=this._cmds;if(e){for(var i=e.length-1;i>-1;i--)if(this._isTextCmd(e[i]))return e[i].text=t,!0}else if(this._one&&this._isTextCmd(this._one))return this._one.text=t,!0;return!1},e._isTextCmd=function(t){var e=t.cmdID;return"FillText"==e||"StrokeText"==e||"FillBorderText"==e},e.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(e)for(var i=e.length-1;i>-1;i--)this._isTextCmd(e[i])&&this._setTextCmdColor(e[i],t);else this._one&&this._isTextCmd(this._one)&&this._setTextCmdColor(this._one,t)},e._setTextCmdColor=function(t,e){var i=t.cmdID;switch(i){case"FillText":case"StrokeText":t.color=e;break;case"FillBorderText":case"FillBorderWords":case"FillBorderText":t.fillColor=e}},e.loadImage=function(t,e,i,n,r,a){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var s=Loader.getRes(t);s?s.loaded?this.drawImage(s,e,i,n,r):s.once("loaded",this,this.drawImage,[s,e,i,n,r]):(s=new Texture,s.load(t),Loader.cacheRes(t,s),s.once("loaded",this,this.drawImage,[s,e,i,n,r])),null!=a&&(s._loaded?a.call(this._sp):s.on("loaded",this._sp,a))},e._renderEmpty=function(){},e._renderAll=function(t,e,i,n){for(var r,a=this._cmds,s=0,o=a.length;o>s;s++)(r=a[s]).run(e,i,n)},e._renderOne=function(t,e,i,n){this._one.run(e,i,n)},e._renderOneImg=function(t,e,i,n){this._one.run(e,i,n)},e.drawLine=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=0;Render.isWebGL&&(s=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s));var o=a%2===0?0:.5;return this._saveToCmd(Render._context._drawLine,DrawLineCmd.create.call(this,t+o,e+o,i+o,n+o,r,a,s))},e.drawLines=function(t,e,i,n,r){void 0===r&&(r=1);var a=0;if(!i||i.length<4)return null;Render.isWebGL&&(a=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(a));var s=r%2===0?0:.5;return this._saveToCmd(Render._context._drawLines,DrawLinesCmd.create.call(this,t+s,e+s,i,n,r,a))},e.drawCurves=function(t,e,i,n,r){return void 0===r&&(r=1),this._saveToCmd(Render._context._drawCurves,DrawCurvesCmd.create.call(this,t,e,i,n,r))},e.drawRect=function(t,e,i,n,r,a,s){void 0===s&&(s=1);var o=a?s/2:0,l=a?s:0;return this._saveToCmd(Render._context.drawRect,DrawRectCmd.create.call(this,t+o,e+o,i-l,n-l,r,a,s))},e.drawCircle=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=r?a/2:0,o=0;return Render.isWebGL&&(o=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(o)),this._saveToCmd(Render._context._drawCircle,DrawCircleCmd.create.call(this,t,e,i-s,n,r,a,o))},e.drawPie=function(t,e,i,n,r,a,s,o){void 0===o&&(o=1);var l=s?o/2:0,_=s?o:0,h=0;return Render.isWebGL&&(h=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(h)),this._saveToCmd(Render._context._drawPie,DrawPieCmd.create.call(this,t+l,e+l,i-_,Utils.toRadian(n),Utils.toRadian(r),a,s,o,h))},e.drawPoly=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=0;if(Render.isWebGL){s=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s);var o=!1;o=i.length>6?!1:!0}var l=r?a%2===0?0:.5:0;return this._saveToCmd(Render._context._drawPoly,DrawPolyCmd.create.call(this,t+l,e+l,i,n,r,a,o,s))},e.drawPath=function(t,e,i,n,r){return this._saveToCmd(Render._context._drawPath,DrawPathCmd.create.call(this,t,e,i,n,r))},__getset(0,e,"cmds",function(){return this._cmds},function(t){this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType)),this._cmds=t,this._render=this._renderAll,this._repaint()}),t}(),GraphicsBounds=function(){function t(){this._cacheBoundsType=!1}__class(t,"laya.display.GraphicsBounds");var e=t.prototype;return e.destroy=function(){this._graphics=null,this._cacheBoundsType=!1,this._temp&&(this._temp.length=0),this._rstBoundPoints&&(this._rstBoundPoints.length=0),this._bounds&&this._bounds.recover(),this._bounds=null,Pool.recover("GraphicsBounds",this)},e.reset=function(){this._temp&&(this._temp.length=0)},e.getBounds=function(t){return void 0===t&&(t=!1),(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=Rectangle._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds},e.getBoundPoints=function(t){return void 0===t&&(t=!1),(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=Utils.copyArray(this._rstBoundPoints,this._temp)},e._getCmdPoints=function(e){void 0===e&&(e=!1);var i,n=(Render._context,this._graphics.cmds);if(i=this._temp||(this._temp=[]),i.length=0,n||null==this._graphics._one||(t._tempCmds.length=0,t._tempCmds.push(this._graphics._one),n=t._tempCmds),!n)return i;var r=t._tempMatrixArrays;r.length=0;var a=t._initMatrix;a.identity();for(var s,o,l=t._tempMatrix,_=0,h=n.length;h>_;_++)switch(s=n[_],s.cmdID){case"Alpha":r.push(a),a=a.clone();break;case"Restore":a=r.pop();break;case"Scale":l.identity(),l.translate(-s.pivotX,-s.pivotY),l.scale(s.scaleX,s.scaleY),l.translate(s.pivotX,s.pivotY),this._switchMatrix(a,l);break;case"Rotate":l.identity(),l.translate(-s.pivotX,-s.pivotY),l.rotate(s.angle),l.translate(s.pivotX,s.pivotY),this._switchMatrix(a,l);break;case"Translate":l.identity(),l.translate(s.tx,s.ty),this._switchMatrix(a,l);break;case"Transform":l.identity(),l.translate(-s.pivotX,-s.pivotY),l.concat(s.matrix),l.translate(s.pivotX,s.pivotY),this._switchMatrix(a,l);break;case"DrawImage":case"FillTexture":t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,s.width,s.height),a);break;case"DrawTexture":a.copyTo(l),s.matrix&&l.concat(s.matrix),t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,s.width,s.height),l);break;case"DrawImage":if(o=s.texture,e)s.width&&s.height?t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,s.width,s.height),a):t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,o.width,o.height),a);else{var u=(s.width||o.sourceWidth)/o.width,c=(s.height||o.sourceHeight)/o.height,d=u*o.sourceWidth,f=c*o.sourceHeight,m=o.offsetX>0?o.offsetX:0,p=o.offsetY>0?o.offsetY:0;m*=u,p*=c,t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x-m,s.y-p,d,f),a)}break;case"FillTexture":s.width&&s.height?t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,s.width,s.height),a):(o=s.texture,t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,o.width,o.height),a));break;case"DrawTexture":var g;s.matrix?(a.copyTo(l),l.concat(s.matrix),g=l):g=a,e?s.width&&s.height?t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,s.width,s.height),g):(o=s.texture,t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,o.width,o.height),g)):(o=s.texture,u=(s.width||o.sourceWidth)/o.width,c=(s.height||o.sourceHeight)/o.height,d=u*o.sourceWidth,f=c*o.sourceHeight,m=o.offsetX>0?o.offsetX:0,p=o.offsetY>0?o.offsetY:0,m*=u,p*=c,t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x-m,s.y-p,d,f),g));break;case"DrawRect":t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x,s.y,s.width,s.height),a);break;case"DrawCircle":t._addPointArrToRst(i,Rectangle._getBoundPointS(s.x-s.radius,s.y-s.radius,s.x+s.radius,s.y+s.radius),a);break;case"DrawLine":t._tempPoints.length=0;var v=0/0;v=.5*s.lineWidth,s.fromX==s.toX?t._tempPoints.push(s.fromX+v,s.fromY,s.toX+v,s.toY,s.fromX-v,s.fromY,s.toX-v,s.toY):s.fromY==s.toY?t._tempPoints.push(s.fromX,s.fromY+v,s.toX,s.toY+v,s.fromX,s.fromY-v,s.toX,s.toY-v):t._tempPoints.push(s.fromX,s.fromY,s.toX,s.toY),t._addPointArrToRst(i,t._tempPoints,a);break;case"DrawCurves":t._addPointArrToRst(i,Bezier.I.getBezierPoints(s.points),a,s.x,s.y);break;case"DrawLines":case"DrawPoly":t._addPointArrToRst(i,s.points,a,s.x,s.y);break;case"DrawPath":t._addPointArrToRst(i,this._getPathPoints(s.paths),a,s.x,s.y);break;case"DrawPie":t._addPointArrToRst(i,this._getPiePoints(s.x,s.y,s.radius,s.startAngle,s.endAngle),a)}return i.length>200?i=Utils.copyArray(i,Rectangle._getWrapRec(i)._getBoundPoints()):i.length>8&&(i=GrahamScan.scanPList(i)),i},e._switchMatrix=function(t,e){e.concat(t),e.copyTo(t)},e._getPiePoints=function(e,i,n,r,a){var s=t._tempPoints;t._tempPoints.length=0,s.push(e,i);var o=Math.PI/10,l=0/0;for(l=r;a>l;l+=o)s.push(e+n*Math.cos(l),i+n*Math.sin(l));return a!=l&&s.push(e+n*Math.cos(a),i+n*Math.sin(a)),s},e._getPathPoints=function(e){var i=0,n=0,r=t._tempPoints;r.length=0,n=e.length;var a;for(i=0;n>i;i++)a=e[i],a.length>1&&(r.push(a[1],a[2]),a.length>3&&r.push(a[3],a[4]));return r},t.create=function(){return Pool.getItemByClass("GraphicsBounds",t)},t._addPointArrToRst=function(e,i,n,r,a){void 0===r&&(r=0),void 0===a&&(a=0);var s=0,o=0;for(o=i.length,s=0;o>s;s+=2)t._addPointToRst(e,i[s]+r,i[s+1]+a,n)},t._addPointToRst=function(t,e,i,n){var r=Point.TEMP;r.setTo(e?e:0,i?i:0),n.transformPoint(r),t.push(r.x,r.y)},t._tempPoints=[],t._tempMatrixArrays=[],t._tempCmds=[],__static(t,["_tempMatrix",function(){return this._tempMatrix=new Matrix},"_initMatrix",function(){return this._initMatrix=new Matrix}]),t}(),SpriteConst=function(){function t(){}return __class(t,"laya.display.SpriteConst"),t.POSRENDERTYPE=0,t.POSBUFFERBEGIN=1,t.POSBUFFEREND=2,t.POSREPAINT=3,t.POSFRAMECOUNT=4,t.POSX=5,t.POSY=6,t.POSPIVOTX=7,t.POSPIVOTY=8,t.POSSCALEX=9,t.POSSCALEY=10,t.POSSKEWX=11,t.POSSKEWY=12,t.POSROTATION=13,t.POSTRANSFORM_FLAG=14,t.POSMATRIX=15,t.POSCOLOR=21,t.POSGRAPICS=22,t.POSSIM_TEXTURE_ID=23,t.POSSIM_TEXTURE_DATA=24,t.POSLAYAGL3D=25,t.POSCUSTOM=26,t.POSCLIP=27,t.POSCLIP_NEG_POS=31,t.POSCOLORFILTER_COLOR=33,t.POSCOLORFILTER_ALPHA=49,t.POSSIZE=53,t.ALPHA=1,t.TRANSFORM=2,t.BLEND=4,t.CANVAS=8,t.FILTERS=16,t.MASK=32,t.CLIP=64,t.STYLE=128,t.TEXTURE=256,t.GRAPHICS=512,t.LAYAGL3D=1024,t.CUSTOM=2048,t.ONECHILD=4096,t.CHILDS=8192,t.REPAINT_NONE=0,t.REPAINT_NODE=1,t.REPAINT_CACHE=2,t.REPAINT_ALL=3,t}(),Event=function(){function t(){}__class(t,"laya.events.Event");var e=t.prototype;return e.setTo=function(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this},e.stopPropagation=function(){this._stoped=!0},__getset(0,e,"stageY",function(){return Laya.stage.mouseY}),__getset(0,e,"charCode",function(){return this.nativeEvent.charCode}),__getset(0,e,"touches",function(){var t=this.nativeEvent.touches;if(t)for(var e=Laya.stage,i=0,n=t.length;n>i;i++){var r=t[i],a=Point.TEMP;a.setTo(r.clientX,r.clientY),e._canvasTransform.invertTransformPoint(a),e.transform.invertTransformPoint(a),r.stageX=a.x,r.stageY=a.y}return t}),__getset(0,e,"keyLocation",function(){return this.nativeEvent.location||this.nativeEvent.keyLocation}),__getset(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),__getset(0,e,"altKey",function(){return this.nativeEvent.altKey}),__getset(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey}),__getset(0,e,"stageX",function(){return Laya.stage.mouseX}),t.EMPTY=new t,t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.CLICK="click",t.RIGHT_MOUSE_DOWN="rightmousedown",t.RIGHT_MOUSE_UP="rightmouseup",t.RIGHT_CLICK="rightclick",t.MOUSE_MOVE="mousemove",t.MOUSE_OVER="mouseover",t.MOUSE_OUT="mouseout",t.MOUSE_WHEEL="mousewheel",t.ROLL_OVER="mouseover",t.ROLL_OUT="mouseout",t.DOUBLE_CLICK="doubleclick",t.CHANGE="change",t.CHANGED="changed",t.RESIZE="resize",t.ADDED="added",t.REMOVED="removed",t.DISPLAY="display",t.UNDISPLAY="undisplay",t.ERROR="error",t.COMPLETE="complete",t.LOADED="loaded",t.PROGRESS="progress",t.INPUT="input",t.RENDER="render",t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.KEY_DOWN="keydown",t.KEY_PRESS="keypress",t.KEY_UP="keyup",t.FRAME="enterframe",t.DRAG_START="dragstart",t.DRAG_MOVE="dragmove",t.DRAG_END="dragend",t.ENTER="enter",t.SELECT="select",t.BLUR="blur",t.FOCUS="focus",t.VISIBILITY_CHANGE="visibilitychange",t.FOCUS_CHANGE="focuschange",t.PLAYED="played",t.PAUSED="paused",t.STOPPED="stopped",t.START="start",t.END="end",t.COMPONENT_ADDED="componentadded",t.COMPONENT_REMOVED="componentremoved",t.HIERARCHY_LOADED="hierarchyloaded",t.RELEASED="released",t.LINK="link",t.LABEL="label",t.FULL_SCREEN_CHANGE="fullscreenchange",t.DEVICE_LOST="devicelost",t.MESH_CHANGED="meshchanged",t.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",t.ANIMATION_CHANGED="animationchanged",t.TRAIL_FILTER_CHANGE="trailfilterchange",t}(),KeyBoardManager=function(){function t(){}return __class(t,"laya.events.KeyBoardManager"),t.__init__=function(){t._addEvent("keydown"),t._addEvent("keypress"),t._addEvent("keyup")},t._addEvent=function(t){Browser.document.addEventListener(t,function(e){laya.events.KeyBoardManager._dispatch(e,t)},!0)},t._dispatch=function(e,i){if(t.enabled){t._event._stoped=!1,t._event.nativeEvent=e,t._event.keyCode=e.keyCode||e.which||e.charCode,"keydown"===i?t._pressKeys[t._event.keyCode]=!0:"keyup"===i&&(t._pressKeys[t._event.keyCode]=null);for(var n=Laya.stage.focus&&null!=Laya.stage.focus.event&&Laya.stage.focus.displayedInStage?Laya.stage.focus:Laya.stage,r=n;r;)r.event(i,t._event.setTo(i,r,n)),r=r.parent}},t.hasKeyDown=function(e){return t._pressKeys[e]},t._pressKeys={},t.enabled=!0,__static(t,["_event",function(){return this._event=new Event}]),t}(),MouseManager=function(){function t(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new Event,this._matrix=new Matrix,this._point=new Point,this._rect=new Rectangle,this._prePoint=new Point,this._curTouchID=0/0}__class(t,"laya.events.MouseManager");var e=t.prototype;return e.__init__=function(e,i){this._stage=e;var n=this,r=this._eventList;i.oncontextmenu=function(){return t.enabled?!1:void 0},i.addEventListener("mousedown",function(e){t.enabled&&(Browser.onIE||e.preventDefault(),r.push(e),n.mouseDownTime=Browser.now())}),i.addEventListener("mouseup",function(e){t.enabled&&(e.preventDefault(),r.push(e),n.mouseDownTime=-Browser.now())},!0),i.addEventListener("mousemove",function(e){if(t.enabled){e.preventDefault();var i=Browser.now();if(i-n._lastMoveTimer<10)return;n._lastMoveTimer=i,r.push(e)}},!0),i.addEventListener("mouseout",function(e){t.enabled&&r.push(e)}),i.addEventListener("mouseover",function(e){t.enabled&&r.push(e)}),i.addEventListener("touchstart",function(e){t.enabled&&(r.push(e),Input.isInputting||e.preventDefault(),n.mouseDownTime=Browser.now())}),i.addEventListener("touchend",function(e){t.enabled&&(Input.isInputting||e.preventDefault(),r.push(e),n.mouseDownTime=-Browser.now())},!0),i.addEventListener("touchmove",function(e){t.enabled&&(e.preventDefault(),r.push(e))},!0),i.addEventListener("touchcancel",function(e){t.enabled&&(e.preventDefault(),r.push(e))},!0),i.addEventListener("mousewheel",function(e){t.enabled&&r.push(e)}),i.addEventListener("DOMMouseScroll",function(e){t.enabled&&r.push(e)})},e.initEvent=function(t,e){var i=this;i._event._stoped=!1,i._event.nativeEvent=e||t,i._target=null,this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),i.mouseX=this._point.x,i.mouseY=this._point.y,i._event.touchId=t.identifier||0,this._tTouchID=i._event.touchId;var n;n=TouchManager.I._event,n._stoped=!1,n.nativeEvent=i._event.nativeEvent,n.touchId=i._event.touchId},e.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=TouchManager.I.getLastOvers(),i=0,n=e.length;n>i;i++){var r=e[i];r.event("mousewheel",this._event.setTo("mousewheel",r,this._target))}},e.onMouseMove=function(t){TouchManager.I.onMouseMove(t,this._tTouchID)},e.onMouseDown=function(t){if(Input.isInputting&&Laya.stage.focus&&Laya.stage.focus.focus&&!Laya.stage.focus.contains(this._target)){var e=Laya.stage.focus._tf||Laya.stage.focus,i=t._tf||t;i instanceof laya.display.Input&&i.multiline==e.multiline?e._focusOut():e.focus=!1}TouchManager.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)},e.onMouseUp=function(t){TouchManager.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)},e.check=function(t,e,i,n){this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y;var r=t._style.scrollRect;if(r&&(this._rect.setTo(r.x,r.y,r.width,r.height),!this._rect.contains(e,i)))return!1;if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i))return!1;for(var a=t._children.length-1;a>-1;a--){var s=t._children[a];if(!s.destroyed&&s._mouseState>1&&s._visible&&this.check(s,e,i,n))return!0}}var o=!t.hitTestPrior||t.mouseThrough||this.disableMouseEvent?this.hitTest(t,e,i):!0;return o?(this._target=t,n.call(this,t)):n===this.onMouseUp&&t===this._stage&&(this._target=this._stage,n.call(this,this._target)),o},e.hitTest=function(t,e,i){var n=!1;t.scrollRect&&(e-=t._style.scrollRect.x,i-=t._style.scrollRect.y);var r=t._style.hitArea;return r&&r.isHitGraphic?r.isHit(e,i):((t.width>0&&t.height>0||t.mouseThrough||r)&&(n=t.mouseThrough?t.getGraphicBounds().contains(e,i):(r?r:this._rect.setTo(0,0,t.width,t.height)).contains(e,i)),n)},e.runEvent=function(){var e=this._eventList.length;if(e){for(var i=this,n=0;e>n;){var r=this._eventList[n];switch("mousemove"!==r.type&&(this._prePoint.x=this._prePoint.y=-1e6),r.type){case"mousedown":this._touchIDs[0]=this._id++,t._isTouchRespond?t._isTouchRespond=!1:(i._isLeftMouse=0===r.button,i.initEvent(r),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));
break;case"mouseup":i._isLeftMouse=0===r.button,i.initEvent(r),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-r.clientX)+Math.abs(this._prePoint.y-r.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=r.clientX,this._prePoint.y=r.clientY,i.initEvent(r),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"touchstart":t._isTouchRespond=!0,i._isLeftMouse=!0;for(var a=r.changedTouches,s=0,o=a.length;o>s;s++){var l=a[s];(t.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=l.identifier,this._id%200===0&&(this._touchIDs={}),this._touchIDs[l.identifier]=this._id++,i.initEvent(l,r),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown))}break;case"touchend":case"touchcancel":t._isTouchRespond=!0,i._isLeftMouse=!0;var _=r.changedTouches;for(s=0,o=_.length;o>s;s++)if(l=_[s],t.multiTouchEnabled||l.identifier==this._curTouchID){this._curTouchID=0/0,i.initEvent(l,r);var h=!1;h=i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp),h||i.onMouseUp(null)}break;case"touchmove":var u=r.changedTouches;for(s=0,o=u.length;o>s;s++)l=u[s],(t.multiTouchEnabled||l.identifier==this._curTouchID)&&(i.initEvent(l,r),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":i.checkMouseWheel(r);break;case"mouseout":i._stage.event("mouseout",i._event.setTo("mouseout",i._stage,i._stage));break;case"mouseover":i._stage.event("mouseover",i._event.setTo("mouseover",i._stage,i._stage))}n++}this._eventList.length=0}},t.enabled=!0,t.multiTouchEnabled=!0,t._isTouchRespond=!1,__static(t,["instance",function(){return this.instance=new t}]),t}(),TouchManager=function(){function t(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new Event}__class(t,"laya.events.TouchManager");var e=t.prototype;return e.getTouchFromArr=function(t,e){var i=0,n=0;n=e.length;var r;for(i=0;n>i;i++)if(r=e[i],r.id==t)return r;return null},e.removeTouchFromArr=function(t,e){var i=0;for(i=e.length-1;i>=0;i--)e[i].id==t&&e.splice(i,1)},e.createTouchO=function(t,e){var i;return i=Pool.getItem("TouchData")||{},i.id=e,i.tar=t,i},e.onMouseDown=function(e,i,n){if(void 0===n&&(n=!1),this.enable){var r,a,s;r=this.getTouchFromArr(i,this.preOvers),s=this.getEles(e,null,t._tEleArr),r?r.tar=e:(a=this.createTouchO(e,i),this.preOvers.push(a)),Browser.onMobile&&this.sendEvents(s,"mouseover",i);var o;o=n?this.preDowns:this.preRightDowns,r=this.getTouchFromArr(i,o),r?r.tar=e:(a=this.createTouchO(e,i),o.push(a)),this.sendEvents(s,n?"mousedown":"rightmousedown",i)}},e.sendEvents=function(t,e,i){void 0===i&&(i=0);var n=0,r=0;r=t.length,this._event._stoped=!1;var a;a=t[0];var s;for(n=0;r>n;n++){if(s=t[n],s.destroyed)return;if(s.event(e,this._event.setTo(e,s,a)),this._event._stoped)break}},e.getEles=function(t,e,i){for(i?i.length=0:i=[];t&&t!=e;)i.push(t),t=t._parent;return i},e.checkMouseOutAndOverOfMove=function(e,i,n){if(void 0===n&&(n=0),i!=e){var r,a,s=0,o=0;if(i.contains(e))a=this.getEles(e,i,t._tEleArr),this.sendEvents(a,"mouseover",n);else if(e.contains(i))a=this.getEles(i,e,t._tEleArr),this.sendEvents(a,"mouseout",n);else{a=t._tEleArr,a.length=0;var l;l=this.getEles(i,null,t._oldArr);var _;_=this.getEles(e,null,t._newArr),o=l.length;var h=0;for(s=0;o>s;s++){if(r=l[s],h=_.indexOf(r),h>=0){_.splice(h,_.length-h);break}a.push(r)}a.length>0&&this.sendEvents(a,"mouseout",n),_.length>0&&this.sendEvents(_,"mouseover",n)}}},e.onMouseMove=function(e,i){if(this.enable){var n;n=this.getTouchFromArr(i,this.preOvers);var r;n?(this.checkMouseOutAndOverOfMove(e,n.tar),n.tar=e,r=this.getEles(e,null,t._tEleArr)):(r=this.getEles(e,null,t._tEleArr),this.sendEvents(r,"mouseover",i),this.preOvers.push(this.createTouchO(e,i))),this.sendEvents(r,"mousemove",i)}},e.getLastOvers=function(){return t._tEleArr.length=0,this.preOvers.length>0&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,t._tEleArr):(t._tEleArr.push(Laya.stage),t._tEleArr)},e.onMouseUp=function(e,i,n){if(void 0===n&&(n=!1),this.enable){var r,a,s,o,l,_=0,h=0,u=Browser.onMobile;a=this.getEles(e,null,t._tEleArr),this.sendEvents(a,n?"mouseup":"rightmouseup",i);var c;if(c=n?this.preDowns:this.preRightDowns,r=this.getTouchFromArr(i,c)){var d=!1,f=Browser.now();if(d=f-this._lastClickTime<300,this._lastClickTime=f,e==r.tar)l=a;else for(s=this.getEles(r.tar,null,t._oldArr),l=t._newArr,l.length=0,h=s.length,_=0;h>_;_++)o=s[_],a.indexOf(o)>=0&&l.push(o);l.length>0&&this.sendEvents(l,n?"click":"rightclick",i),n&&d&&this.sendEvents(l,"doubleclick",i),this.removeTouchFromArr(i,c),r.tar=null,Pool.recover("TouchData",r)}else;r=this.getTouchFromArr(i,this.preOvers),r&&u&&(l=this.getEles(r.tar,null,l),l&&l.length>0&&this.sendEvents(l,"mouseout",i),this.removeTouchFromArr(i,this.preOvers),r.tar=null,Pool.recover("TouchData",r))}},t._oldArr=[],t._newArr=[],t._tEleArr=[],__static(t,["I",function(){return this.I=new t}]),t}(),Filter=function(){function t(){this._action=null}__class(t,"laya.filters.Filter");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilter":!0}),__getset(0,e,"type",function(){return-1}),__getset(0,e,"action",function(){return this._action}),t.BLUR=16,t.COLOR=32,t.GLOW=8,t}(),ColorFilterAction=function(){function t(){this.data=null}__class(t,"laya.filters.ColorFilterAction");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){var e=t.canvas,i=e.context;if(0==e.width||0==e.height)return e;for(var n,r=i.getImageData(0,0,e.width,e.height),a=r.data,s=0,o=a.length;o>s;s+=4)n=this.getColor(a[s],a[s+1],a[s+2],a[s+3]),0!=a[s+3]&&(a[s]=n[0],a[s+1]=n[1],a[s+2]=n[2],a[s+3]=n[3]);return i.putImageData(r,0,0),t},e.getColor=function(t,e,i,n){var r=[];if(this.data._mat&&this.data._alpha){var a=this.data._mat,s=this.data._alpha;r[0]=a[0]*t+a[1]*e+a[2]*i+a[3]*n+s[0],r[1]=a[4]*t+a[5]*e+a[6]*i+a[7]*n+s[1],r[2]=a[8]*t+a[9]*e+a[10]*i+a[11]*n+s[2],r[3]=a[12]*t+a[13]*e+a[14]*i+a[15]*n+s[3]}return r},t}(),Bezier=function(){function t(){this._controlPoints=[new Point,new Point,new Point],this._calFun=this.getPoint2}__class(t,"laya.maths.Bezier");var e=t.prototype;return e._switchPoint=function(t,e){var i=this._controlPoints.shift();i.setTo(t,e),this._controlPoints.push(i)},e.getPoint2=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],a=Math.pow(1-t,2)*i.x+2*t*(1-t)*n.x+Math.pow(t,2)*r.x,s=Math.pow(1-t,2)*i.y+2*t*(1-t)*n.y+Math.pow(t,2)*r.y;e.push(a,s)},e.getPoint3=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],a=this._controlPoints[3],s=Math.pow(1-t,3)*i.x+3*n.x*t*(1-t)*(1-t)+3*r.x*t*t*(1-t)+a.x*Math.pow(t,3),o=Math.pow(1-t,3)*i.y+3*n.y*t*(1-t)*(1-t)+3*r.y*t*t*(1-t)+a.y*Math.pow(t,3);e.push(s,o)},e.insertPoints=function(t,e){var i=0/0;t=t>0?t:5;var n=0/0;for(n=1/t,i=0;1>=i;i+=n)this._calFun(i,e)},e.getBezierPoints=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=2);var n=0,r=0;if(r=t.length,2*(i+1)>r)return[];var a=[];switch(i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(Point.create());for(n=0;2*i>n;n+=2)this._switchPoint(t[n],t[n+1]);for(n=2*i;r>n;n+=2)this._switchPoint(t[n],t[n+1]),n/2%i==0&&this.insertPoints(e,a);return a},__static(t,["I",function(){return this.I=new t}]),t}(),GrahamScan=function(){function t(){}return __class(t,"laya.maths.GrahamScan"),t.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)},t.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},t._getPoints=function(e,i,n){for(void 0===i&&(i=!1),t._mPointList||(t._mPointList=[]);t._mPointList.length<e;)t._mPointList.push(new Point);return n||(n=[]),n.length=0,i?t.getFrom(n,t._mPointList,e):t.getFromR(n,t._mPointList,e),n},t.getFrom=function(t,e,i){var n=0;for(n=0;i>n;n++)t.push(e[n]);return t},t.getFromR=function(t,e,i){var n=0;for(n=0;i>n;n++)t.push(e.pop());return t},t.pListToPointList=function(e,i){void 0===i&&(i=!1);var n=0,r=e.length/2,a=t._getPoints(r,i,t._tempPointList);for(n=0;r>n;n++)a[n].setTo(e[n+n],e[n+n+1]);return a},t.pointListToPlist=function(e){var i,n=0,r=e.length,a=t._temPList;for(a.length=0,n=0;r>n;n++)i=e[n],a.push(i.x,i.y);return a},t.scanPList=function(e){return Utils.copyArray(e,t.pointListToPlist(t.scan(t.pListToPointList(e,!0))))},t.scan=function(e){var i,n,r,a=0,s=0,o=0,l=e.length,_={};for(n=t._temArr,n.length=0,l=e.length,a=l-1;a>=0;a--)i=e[a],r=i.x+"_"+i.y,_.hasOwnProperty(r)||(_[r]=!0,n.push(i));for(l=n.length,Utils.copyArray(e,n),a=1;l>a;a++)(e[a].y<e[o].y||e[a].y==e[o].y&&e[a].x<e[o].x)&&(o=a);for(i=e[0],e[0]=e[o],e[o]=i,a=1;l-1>a;a++){for(o=a,s=a+1;l>s;s++)(t.multiply(e[s],e[o],e[0])>0||0==t.multiply(e[s],e[o],e[0])&&t.dis(e[0],e[s])<t.dis(e[0],e[o]))&&(o=s);i=e[a],e[a]=e[o],e[o]=i}if(n=t._temArr,n.length=0,e.length<3)return Utils.copyArray(n,e);for(n.push(e[0],e[1],e[2]),a=3;l>a;a++){for(;n.length>=2&&t.multiply(e[a],n[n.length-1],n[n.length-2])>=0;)n.pop();e[a]&&n.push(e[a])}return n},t._mPointList=null,t._tempPointList=[],t._temPList=[],t._temArr=[],t}(),MathUtil=function(){function t(){}return __class(t,"laya.maths.MathUtil"),t.subtractVector3=function(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]},t.lerp=function(t,e,i){return t*(1-i)+e*i},t.scaleVector3=function(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e},t.lerpVector3=function(t,e,i,n){var r=t[0],a=t[1],s=t[2];n[0]=r+i*(e[0]-r),n[1]=a+i*(e[1]-a),n[2]=s+i*(e[2]-s)},t.lerpVector4=function(t,e,i,n){var r=t[0],a=t[1],s=t[2],o=t[3];n[0]=r+i*(e[0]-r),n[1]=a+i*(e[1]-a),n[2]=s+i*(e[2]-s),n[3]=o+i*(e[3]-o)},t.slerpQuaternionArray=function(t,e,i,n,r,a,s){var o,l,_,h,u,c=t[e+0],d=t[e+1],f=t[e+2],m=t[e+3],p=i[n+0],g=i[n+1],v=i[n+2],x=i[n+3];return l=c*p+d*g+f*v+m*x,0>l&&(l=-l,p=-p,g=-g,v=-v,x=-x),1-l>1e-6?(o=Math.acos(l),_=Math.sin(o),h=Math.sin((1-r)*o)/_,u=Math.sin(r*o)/_):(h=1-r,u=r),a[s+0]=h*c+u*p,a[s+1]=h*d+u*g,a[s+2]=h*f+u*v,a[s+3]=h*m+u*x,a},t.getRotation=function(t,e,i,n){return Math.atan2(n-e,i-t)/Math.PI*180},t.sortBigFirst=function(t,e){return t==e?0:e>t?1:-1},t.sortSmallFirst=function(t,e){return t==e?0:e>t?-1:1},t.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},t.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},t.sortByKey=function(e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0);var r;return r=i?n?t.sortNumBigFirst:t.sortBigFirst:n?t.sortNumSmallFirst:t.sortSmallFirst,function(t,i){return r(t[e],i[e])}},t}(),Matrix=function(){function t(e,i,n,r,a,s,o){return this._bTransform=!1,void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===o&&(o=0),null!=t._createFun?t._createFun(e,i,n,r,a,s,o):(this.a=e,this.b=i,this.c=n,this.d=r,this.tx=a,this.ty=s,this._checkTransform(),void 0)}__class(t,"laya.maths.Matrix");var e=t.prototype;return e.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this._bTransform=!1,this},e._checkTransform=function(){return this._bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},e.setTranslate=function(t,e){return this.tx=t,this.ty=e,this},e.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this._bTransform=!0,this},e.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,a=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this._bTransform=!0,this},e.skew=function(t,e){var i=Math.tan(t),n=Math.tan(e),r=this.a,a=this.b;return this.a+=n*this.c,this.b+=n*this.d,this.c+=i*r,this.d+=i*a,this},e.invertTransformPoint=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,a=this.tx,s=e*r-i*n,o=r/s,l=-i/s,_=-n/s,h=e/s,u=(n*this.ty-r*a)/s,c=-(e*this.ty-i*a)/s;return t.setTo(o*t.x+_*t.y+u,l*t.x+h*t.y+c)},e.transformPoint=function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)},e.transformPointN=function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)},e.transformPointArray=function(t,e){for(var i=t.length,n=0;i>n;n+=2){var r=t[n],a=t[n+1];e[n]=this.a*r+this.c*a+this.tx,e[n+1]=this.b*r+this.d*a+this.ty}return e},e.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},e.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},e.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,a=t*n-e*i;return this.a=n/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-n*r)/a,this.ty=-(t*this.ty-e*r)/a,this},e.setTo=function(t,e,i,n,r,a){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a,this},e.concat=function(t){var e=this.a,i=this.c,n=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=n*t.a+this.ty*t.c+t.tx,this.ty=n*t.b+this.ty*t.d+t.ty,this},e.scaleEx=function(t,e){var i=this.a,n=this.b,r=this.c,a=this.d;0!==n||0!==r?(this.a=t*i,this.b=t*n,this.c=e*r,this.d=e*a):(this.a=t*i,this.b=0*a,this.c=0*i,this.d=e*a),this._bTransform=!0},e.rotateEx=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.b,a=this.c,s=this.d;0!==r||0!==a?(this.a=e*n+i*a,this.b=e*r+i*s,this.c=-i*n+e*a,this.d=-i*r+e*s):(this.a=e*n,this.b=i*s,this.c=-i*n,this.d=e*s),this._bTransform=!0},e.clone=function(){var e=t.create();return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e._bTransform=this._bTransform,e},e.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t._bTransform=this._bTransform,t},e.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},e.destroy=function(){this.recover()},e.recover=function(){Pool.recover("Matrix",this.identity())},t.mul=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=t.tx,l=t.ty,_=e.a,h=e.b,u=e.c,c=e.d,d=e.tx,f=e.ty;return 0!==h||0!==u?(i.a=n*_+r*u,i.b=n*h+r*c,i.c=a*_+s*u,i.d=a*h+s*c,i.tx=_*o+u*l+d,i.ty=h*o+c*l+f):(i.a=n*_,i.b=r*c,i.c=a*_,i.d=s*c,i.tx=_*o+d,i.ty=c*l+f),i},t.mul16=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=t.tx,l=t.ty,_=e.a,h=e.b,u=e.c,c=e.d,d=e.tx,f=e.ty;return 0!==h||0!==u?(i[0]=n*_+r*u,i[1]=n*h+r*c,i[4]=a*_+s*u,i[5]=a*h+s*c,i[12]=_*o+u*l+d,i[13]=h*o+c*l+f):(i[0]=n*_,i[1]=r*c,i[4]=a*_,i[5]=s*c,i[12]=_*o+d,i[13]=c*l+f),i},t.mulPre=function(t,e,i,n,r,a,s,o){var l=t.a,_=t.b,h=t.c,u=t.d,c=t.tx,d=t.ty;return 0!==i||0!==n?(o.a=l*e+_*n,o.b=l*i+_*r,o.c=h*e+u*n,o.d=h*i+u*r,o.tx=e*c+n*d+a,o.ty=i*c+r*d+s):(o.a=l*e,o.b=_*r,o.c=h*e,o.d=u*r,o.tx=e*c+a,o.ty=r*d+s),o},t.mulPos=function(t,e,i,n,r,a,s,o){var l=t.a,_=t.b,h=t.c,u=t.d,c=t.tx,d=t.ty;return 0!==_||0!==h?(o.a=e*l+i*h,o.b=e*_+i*u,o.c=n*l+r*h,o.d=n*_+r*u,o.tx=l*a+h*s+c,o.ty=_*a+u*s+d):(o.a=e*l,o.b=i*u,o.c=n*l,o.d=r*u,o.tx=l*a+c,o.ty=u*s+d),o},t.preMul=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=e.a,l=e.b,_=e.c,h=e.d,u=e.tx,c=e.ty;return i.a=o*n,i.b=i.c=0,i.d=h*s,i.tx=u*n+t.tx,i.ty=c*s+t.ty,(0!==l||0!==_||0!==r||0!==a)&&(i.a+=l*a,i.d+=_*r,i.b+=o*r+l*s,i.c+=_*n+h*a,i.tx+=c*a,i.ty+=u*r),i},t.preMulXY=function(t,e,i,n){var r=t.a,a=t.b,s=t.c,o=t.d;return n.a=r,n.b=a,n.c=s,n.d=o,n.tx=e*r+t.tx+i*s,n.ty=i*o+t.ty+e*a,n},t.create=function(){return Pool.getItemByClass("Matrix",t)},t.EMPTY=new t,t.TEMP=new t,t._createFun=null,t}(),Point=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}__class(t,"laya.maths.Point");var e=t.prototype;return e.setTo=function(t,e){return this.x=t,this.y=e,this},e.reset=function(){return this.x=this.y=0,this},e.recover=function(){Pool.recover("Point",this.reset())},e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))},e.toString=function(){return this.x+","+this.y},e.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t>0){var e=1/t;this.x*=e,this.y*=e}},e.copy=function(t){return this.setTo(t.x,t.y)},t.create=function(){return Pool.getItemByClass("Point",t)},t.TEMP=new t,t.EMPTY=new t,t}(),Rectangle=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}__class(t,"laya.maths.Rectangle");var e=t.prototype;return e.setTo=function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},e.reset=function(){return this.x=this.y=this.width=this.height=0,this},e.recover=function(){Pool.recover("Rectangle",this.reset())},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom?!0:!1},e.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)},e.intersection=function(e,i){return this.intersects(e)?(i||(i=new t),i.x=Math.max(this.x,e.x),i.y=Math.max(this.y,e.y),i.width=Math.min(this.right,e.right)-i.x,i.height=Math.min(this.bottom,e.bottom)-i.y,i):null},e.union=function(e,i){return i||(i=new t),this.clone(i),e.width<=0||e.height<=0?i:(i.addPoint(e.x,e.y),i.addPoint(e.right,e.bottom),this)},e.clone=function(e){return e||(e=new t),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},e.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},e.equals=function(t){return t&&t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height?!0:!1},e.addPoint=function(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this},e._getBoundPoints=function(){var e=t._temB;return e.length=0,0==this.width||0==this.height?e:(e.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),e)},e.isEmpty=function(){return this.width<=0||this.height<=0?!0:!1},__getset(0,e,"right",function(){return this.x+this.width}),__getset(0,e,"bottom",function(){return this.y+this.height}),t.create=function(){return Pool.getItemByClass("Rectangle",t)},t._getBoundPointS=function(e,i,n,r){var a=t._temA;return a.length=0,0==n||0==r?a:(a.push(e,i,e+n,i,e,i+r,e+n,i+r),a)},t._getWrapRec=function(e,i){if(!e||e.length<1)return i?i.setTo(0,0,0,0):t.TEMP.setTo(0,0,0,0);i=i?i:laya.maths.Rectangle.create();var n,r,a,s,o,l=e.length,_=Point.TEMP;for(r=s=99999,a=o=-r,n=0;l>n;n+=2)_.x=e[n],_.y=e[n+1],r=r<_.x?r:_.x,s=s<_.y?s:_.y,a=a>_.x?a:_.x,o=o>_.y?o:_.y;return i.setTo(r,s,a-r,o-s)},t.EMPTY=new t,t.TEMP=new t,t._temB=[],t._temA=[],t}(),SoundManager=function(){function t(){}return __class(t,"laya.media.SoundManager"),__getset(1,t,"autoStopMusic",function(){return t._autoStopMusic},function(e){Laya.stage.off("blur",null,t._stageOnBlur),Laya.stage.off("focus",null,t._stageOnFocus),Laya.stage.off("visibilitychange",null,t._visibilityChange),t._autoStopMusic=e,e&&(Laya.stage.on("blur",null,t._stageOnBlur),Laya.stage.on("focus",null,t._stageOnFocus),Laya.stage.on("visibilitychange",null,t._visibilityChange))}),__getset(1,t,"muted",function(){return t._muted},function(e){e&&t.stopAllSound(),t.musicMuted=e,t._muted=e}),__getset(1,t,"musicMuted",function(){return t._musicMuted},function(e){e?(t._bgMusic&&t.stopSound(t._bgMusic),t._musicMuted=e):(t._musicMuted=e,t._bgMusic&&t.playMusic(t._bgMusic))}),__getset(1,t,"soundMuted",function(){return t._soundMuted},function(e){t._soundMuted=e}),t.__init__=function(){var e=Browser.window,i=e.AudioContext||e.webkitAudioContext||e.mozAudioContext?!0:!1;return i&&WebAudioSound.initWebAudio(),t._soundClass=i?WebAudioSound:AudioSound,i},t.addChannel=function(e){t._channels.indexOf(e)>=0||t._channels.push(e)},t.removeChannel=function(e){for(var i=t._channels.length-1;i>=0;i--)if(t._channels[i]===e)return t._channels.splice(i,1),void 0},t._visibilityChange=function(){Laya.stage.isVisibility?t._stageOnFocus():t._stageOnBlur()},t._stageOnBlur=function(){t._isActive=!1,t._musicChannel&&(t._musicChannel.isStopped||(t._blurPaused=!0,t._musicLoops=t._musicChannel.loops,t._musicCompleteHandler=t._musicChannel.completeHandler,t._musicPosition=t._musicChannel.position,t._musicChannel.stop(),Laya.stage.once("mousedown",null,t._stageOnFocus))),t.stopAllSound()},t._stageOnFocus=function(){t._isActive=!0,Laya.stage.off("mousedown",null,t._stageOnFocus),t._blurPaused&&(t._bgMusic&&t.playMusic(t._bgMusic,t._musicLoops,t._musicCompleteHandler,t._musicPosition),t._blurPaused=!1)},t.playSound=function(e,i,n,r,a){if(void 0===i&&(i=1),void 0===a&&(a=0),!t._isActive)return null;if(t._muted)return null;if(e=URL.formatURL(e),e===t._bgMusic){if(t._musicMuted)return null}else{if(Render.isConchApp){var s=Utils.getFileExtension(e);if("wav"!=s&&"ogg"!=s)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(t._soundMuted)return null}var o=Laya.loader.getRes(e);r||(r=t._soundClass),o||(o=new r,o.load(e),Loader.cacheRes(e,o));var l;return l=o.play(a,i),l.url=e,l.volume=e===t._bgMusic?t.musicVolume:t.soundVolume,l.completeHandler=n,l},t.destroySound=function(t){var e=Laya.loader.getRes(t);e&&(Loader.clearRes(t),e.dispose())},t.playMusic=function(e,i,n,r){return void 0===i&&(i=0),void 0===r&&(r=0),e=URL.formatURL(e),t._bgMusic=e,t._musicChannel&&t._musicChannel.stop(),t._musicChannel=t.playSound(e,i,n,null,r)},t.stopSound=function(e){e=URL.formatURL(e);for(var i,n=t._channels.length-1;n>=0;n--)i=t._channels[n],i.url===e&&i.stop()},t.stopAll=function(){t._bgMusic=null;for(var e,i=t._channels.length-1;i>=0;i--)e=t._channels[i],e.stop()},t.stopAllSound=function(){for(var e,i=t._channels.length-1;i>=0;i--)e=t._channels[i],e.url!==t._bgMusic&&e.stop()},t.stopMusic=function(){t._bgMusic=null,t._musicChannel&&t._musicChannel.stop()},t.setSoundVolume=function(e,i){if(i)i=URL.formatURL(i),t._setVolume(i,e);else{t.soundVolume=e;for(var n,r=t._channels.length-1;r>=0;r--)n=t._channels[r],n.url!==t._bgMusic&&(n.volume=e)}},t.setMusicVolume=function(e){t.musicVolume=e,t._setVolume(t._bgMusic,e)},t._setVolume=function(e,i){e=URL.formatURL(e);for(var n,r=t._channels.length-1;r>=0;r--)n=t._channels[r],n.url===e&&(n.volume=i)},t.musicVolume=1,t.soundVolume=1,t.playbackRate=1,t._muted=!1,t._soundMuted=!1,t._musicMuted=!1,t._bgMusic=null,t._musicChannel=null,t._channels=[],t._autoStopMusic=!1,t._blurPaused=!1,t._isActive=!0,t._musicLoops=0,t._musicPosition=0,t._musicCompleteHandler=null,t._soundClass=null,t}(),AtlasInfoManager=function(){function t(){}return __class(t,"laya.net.AtlasInfoManager"),t.enable=function(e,i){Laya.loader.load(e,Handler.create(null,t._onInfoLoaded,[i]),null,"json")},t._onInfoLoaded=function(e,i){var n,r,a,s=0,o=0;for(n in i)for(a=i[n],r=a[0],a=a[1],o=a.length,s=0;o>s;s++)t._fileLoadDic[r+a[s]]=n;e&&e.run()},t.getFileLoadPath=function(e){return t._fileLoadDic[e]||e},t._fileLoadDic={},t}(),LocalStorage=function(){function t(){}return __class(t,"laya.net.LocalStorage"),t.__init__=function(){var e=Browser.window;if(e.localStorage)try{t.items=e.localStorage,t.setItem("laya","1"),t.removeItem("laya"),t.support=!0}catch(i){}return t.support||console.warn("LocalStorage is not supprot or browser is private mode."),t.support},t.setItem=function(e,i){try{t.support&&t.items.setItem(e,i)}catch(n){console.warn("set localStorage failed",n)}},t.getItem=function(e){return t.support?t.items.getItem(e):null},t.setJSON=function(e,i){try{t.support&&t.items.setItem(e,JSON.stringify(i))}catch(n){console.log("set localStorage failed",n)}},t.getJSON=function(e){return t.support?JSON.parse(t.items.getItem(e)):null},t.removeItem=function(e){t.support&&t.items.removeItem(e)},t.clear=function(){t.support&&t.items.clear()},t.items=null,t.support=!1,t}(),URL=function(){function t(e){this._url=null,this._path=null,this._url=t.formatURL(e),this._path=t.getPath(e)}__class(t,"laya.net.URL");var e=t.prototype;return __getset(0,e,"path",function(){return this._path}),__getset(0,e,"url",function(){return this._url}),t.formatURL=function(e){if(!e)return"null path";if(e.indexOf(":")>0)return e;null!=t.customFormat&&(e=t.customFormat(e));var i=e.charAt(0);if("."===i)return t._formatRelativePath(t.basePath+e);if("~"===i)return t.rootPath+e.substring(1);if("d"===i){if(0===e.indexOf("data:image"))return e}else if("/"===i)return e;return t.basePath+e},t._formatRelativePath=function(t){for(var e=t.split("/"),i=0,n=e.length;n>i;i++)".."==e[i]&&(e.splice(i-1,2),i-=2);return e.join("/")},t.getPath=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(0,e+1):""},t.getFileName=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(e+1):t},t.version={},t.basePath="",t.rootPath="",t.customFormat=function(e){var i=t.version[e];return!Render.isConchApp&&i&&(e+="?v="+i),e},t}(),CommandEncoder=function(){function t(){this._idata=[]}__class(t,"laya.renders.layagl.CommandEncoder");var e=t.prototype;return e.getArrayData=function(){return this._idata},e.getPtrID=function(){return 0},e.beginEncoding=function(){},e.endEncoding=function(){},e.clearEncoding=function(){this._idata.length=0},e.getCount=function(){return this._idata.length},e.add_ShaderValue=function(t){this._idata.push(t)},e.addShaderAttribute=function(t){this.add_ShaderValue(t)},e.addShaderUniform=function(t){this.add_ShaderValue(t)},t}(),LayaGL=function(){function t(){}__class(t,"laya.renders.layagl.LayaGL");var e=t.prototype;return e.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new CommandEncoder(this,t,e,i)},e.beginCommandEncoding=function(){},e.endCommandEncoding=function(){},e.drawTexture=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.drawImage(t,e,i,n,r)},e.drawImage=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this._customCmds.push(DrawImageCmd.create.call(this,t,e,i,n,r))},e.fillText=function(t,e,i,n,r,a){this._customCmds.push(FillTextCmd.create.call(this,t,e,i,n||Text.defaultFontStr(),r,a))},e.save=function(){this._customCmds.push(SaveCmd.create.call(this))},e.restore=function(){this._customCmds.push(RestoreCmd.create.call(this))},e.translate=function(t,e){this._customCmds.push(TranslateCmd.create.call(this,t,e))},e.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._customCmds.push(RotateCmd.create.call(this,t,e,i))},e.scale=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._customCmds.push(ScaleCmd.create.call(this,t,e,i,n))},e.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._customCmds.push(TransformCmd.create.call(this,t,e,i))},t.getFrameCount=function(){return 0},t.syncBufferToRenderThread=function(){},t.createArrayBufferRef=function(){},t.EXECUTE_JS_THREAD_BUFFER=0,t.EXECUTE_RENDER_THREAD_BUFFER=1,t.EXECUTE_COPY_TO_RENDER=2,t.EXECUTE_COPY_TO_RENDER3D=3,t.VALUE_OPERATE_ADD=0,t.VALUE_OPERATE_SUB=1,t.VALUE_OPERATE_MUL=2,t.VALUE_OPERATE_DIV=3,t.VALUE_OPERATE_M2_MUL=4,t.VALUE_OPERATE_M3_MUL=5,t.VALUE_OPERATE_M4_MUL=6,t.VALUE_OPERATE_M32_MUL=7,t.VALUE_OPERATE_SET=8,t.VALUE_OPERATE_M32_TRANSLATE=9,t.VALUE_OPERATE_M32_SCALE=10,t.VALUE_OPERATE_M32_ROTATE=11,t.VALUE_OPERATE_M32_SCALE_PIVOT=12,t.VALUE_OPERATE_M32_ROTATE_PIVOT=13,t.VALUE_OPERATE_M32_TRANSFORM_PIVOT=14,t.VALUE_OPERATE_BYTE4_COLOR_MUL=15,t.instance=null,t}(),LayaGLQuickRunner=function(){function t(){}return __class(t,"laya.renders.layagl.LayaGLQuickRunner"),t.__init__=function(){t.map[515]=t.alpha_transform_drawLayaGL,t.map[513]=t.alpha_drawLayaGL,t.map[514]=t.transform_drawLayaGL,t.map[8194]=t.transform_drawNodes,t.map[259]=t.alpha_transform_drawTexture,t.map[257]=t.alpha_drawTexture,t.map[258]=t.transform_drawTexture,t.map[8704]=t.drawLayaGL_drawNodes},t.transform_drawTexture=function(e,i,n,r){var a=(e._style,e.texture);i.saveTransform(t.curMat),i.transformByMatrix(e.transform,n,r),i.drawTexture(a,0,0,a.width,a.height),i.restoreTransform(t.curMat)},t.alpha_drawTexture=function(t,e){var i=t._style,n=0/0,r=t.texture;if((n=i.alpha)>.01||t._needRepaint()){var a=e.globalAlpha;e.globalAlpha*=n,e.drawTexture(r,-i.pivotX,-i.pivotY,r.width,r.height),e.globalAlpha=a}},t.alpha_transform_drawTexture=function(e,i,n,r){var a=e._style,s=0/0,o=e.texture;if((s=a.alpha)>.01||e._needRepaint()){var l=i.globalAlpha;i.globalAlpha*=s,i.saveTransform(t.curMat),i.transformByMatrix(e.transform,n,r),i.drawTexture(o,-a.pivotX,-a.pivotY,o.width,o.height),i.restoreTransform(t.curMat),i.globalAlpha=l}},t.alpha_transform_drawLayaGL=function(e,i,n,r){var a=e._style,s=0/0;if((s=a.alpha)>.01||e._needRepaint()){{var o=i.globalAlpha;e.transform}i.globalAlpha*=s,i.saveTransform(t.curMat),i.transformByMatrix(e.transform,n,r),e._graphics&&e._graphics._render(e,i,-a.pivotX,-a.pivotY),i.restoreTransform(t.curMat),i.globalAlpha=o}},t.alpha_drawLayaGL=function(t,e,i,n){var r=t._style,a=0/0;if((a=r.alpha)>.01||t._needRepaint()){var s=e.globalAlpha;e.globalAlpha*=a,t._graphics&&t._graphics._render(t,e,i,n),e.globalAlpha=s}},t.transform_drawLayaGL=function(e,i,n,r){var a=e._style,s=e.transform;s?(i.saveTransform(t.curMat),i.transformByMatrix(e.transform,n,r),e._graphics&&e._graphics._render(e,i,-a.pivotX,-a.pivotY),i.restoreTransform(t.curMat)):e._graphics&&e._graphics._render(e,i,-a.pivotX,-a.pivotY)},t.transform_drawNodes=function(e,i,n,r){var a=(e.transform,e._style);i.saveTransform(t.curMat),i.transformByMatrix(e.transform,n,r),n=-a.pivotX,r=-a.pivotY;var s,o=e._children,l=o.length;if(a.viewport){var _=a.viewport,h=_.x,u=_.y,c=_.right,d=_.bottom,f=0/0,m=0/0;for(p=0;l>p;++p)(s=o[p])._visible&&(f=s._x)<c&&f+s.width>h&&(m=s._y)<d&&m+s.height>u&&s.render(i,n,r)}else for(var p=0;l>p;++p)(s=o[p])._visible&&s.render(i,n,r);i.restoreTransform(t.curMat)},t.drawNode=function(){},t.drawLayaGL=function(t,e,i,n){t._graphics&&t._graphics._render(t,e,i-t.pivotX,n-t.pivotY)},t.drawLayaGL_drawNodes=function(t,e,i,n){var r=t._style;i-=r.pivotX,n-=r.pivotY,t._graphics&&t._graphics._render(t,e,i,n);var a,s=t._children,o=s.length;if(r.viewport){var l=r.viewport,_=l.x,h=l.y,u=l.right,c=l.bottom,d=0/0,f=0/0;for(m=0;o>m;++m)(a=s[m])._visible&&(d=a._x)<u&&d+a.width>_&&(f=a._y)<c&&f+a.height>h&&a.render(e,i,n)}else for(var m=0;o>m;++m)(a=s[m])._visible&&a.render(e,i,n)},t.map={},__static(t,["curMat",function(){return this.curMat=new Matrix}]),t}(),LayaGLRunner=function(){function t(){}return __class(t,"laya.renders.layagl.LayaGLRunner"),t.uploadVertexBufferAttributes=function(t,e,i){for(var n,r=e.getArrayData(),a=0,s=0,o=r.length;o>s;s++){n=r[s];var l=i[n.dataOffset];if(null==l){var _=n.location,h=Buffer._bindedAtributeBuffer;LayaGL.instance.disableVertexAttribArray(n.location),h[_]=null}else a+=n.caller._attribute(n,l)}return a},t.uploadMultiVertexBufferAttributes=function(t,e,i){for(var n,r=e.getArrayData(),a=0,s=0,o=r.length;o>s;s++){n=r[s];var l=i[n.dataOffset];null==l?LayaGL.instance.disableVertexAttribArray(n.location):(l[0].bind(),a+=n.caller._attribute(n,l[1]))}return a},t.uploadShaderUniforms=function(t,e,i,n){for(var r=e.getArrayData(),a=0,s=0,o=r.length;o>s;s++){var l=r[s];if(n||-1!==l.textureID){var _=i[l.dataOffset];null!=_&&(a+=l.fun.call(l.caller,l,_))}}return a},t.uploadCustomUniform=function(t,e,i,n){var r=0,a=e[i];return a&&null!=n&&(r+=a.fun.call(a.caller,a,n)),r},t.uploadShaderAttributesForNative=function(t,e,i){return t.uploadShaderAttributes(e,i)},t.uploadShaderUniformsForNative=function(t,e,i){return t.uploadShaderUniforms(e,i)},t}(),LayaNative2D=function(){function t(){}return __class(t,"laya.renders.layagl.LayaNative2D"),t._init_simple_texture_cmdEncoder_=function(){t._SIMPLE_TEXTURE_CMDENCODER_=LayaGL.instance.createCommandEncoder(124,32,!0),t._SIMPLE_TEXTURE_CMDENCODER_.useProgramEx(laya.renders.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),t._SIMPLE_TEXTURE_CMDENCODER_.useVDO(laya.renders.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),t._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.renders.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),t._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.renders.layagl.LayaNative2D.GLOBALVALUE_CLIPDIR,1),t._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.renders.layagl.LayaNative2D.GLOBALVALUE_CLIPSIZE,2),t._SIMPLE_TEXTURE_CMDENCODER_.uniformTextureByParamData(0,4,8),t._SIMPLE_TEXTURE_CMDENCODER_.setRectMeshByParamData(12,20,16),t._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.renders.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),t._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.renders.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),LayaGL.syncBufferToRenderThread(t._SIMPLE_TEXTURE_CMDENCODER_)
},t.__init__=function(){if(Render.isConchApp){var e=LayaGL.instance;t.GLOBALVALUE_MATRIX32=e.addGlobalValueDefine(0,5126,6,new Float32Array([1,0,0,1,0,0])),t.GLOBALVALUE_DRAWTEXTURE_COLOR=e.addGlobalValueDefine(0,5124,1,new Uint32Array([4294967295])),t.GLOBALVALUE_ITALICDEG=e.addGlobalValueDefine(0,5126,1,new Float32Array([0])),t.GLOBALVALUE_CLIPDIR=e.addGlobalValueDefine(0,5126,4,new Float32Array([1e6,0,0,1e6])),t.GLOBALVALUE_CLIPSIZE=e.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),t.GLOBALVALUE_COLORFILTER_COLOR=e.addGlobalValueDefine(0,5126,16,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),t.GLOBALVALUE_COLORFILTER_ALPHA=e.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,1])),e.endGlobalValueDefine(),t.PROGRAMEX_DRAWTEXTURE=LayaGL.instance.createProgramEx("/*\n	texture��fillrectʹ�õġ�\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipDir;\nuniform vec2 clipRect;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n	uniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n	vec4 pos=mmat*vec4(posuv.xy,0.,1.);\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n	gl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n	v_texcoordAlpha.xy = posuv.zw;\n	//v_texcoordAlpha.z = attribColor.a/255.0;\n	v_color = attribColor/255.0;\n	v_color.xyz*=v_color.w;//��������ҲҪԤ��\n	\n	v_useTex = attribFlags.r/255.0;\n	float clipw = length(clipDir.xy);\n	float cliph = length(clipDir.zw);\n	vec2 clippos = posuv.xy - clipRect.xy;	//pos�Ѿ�Ӧ�þ����ˣ�Ϊ�˼��������壬clip��λ��ҲҪ����\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//ת��0��1֮�䡣/clipw/clipw ��ʾclippos��normalize֮���clip������֮���ٳ���clipw\n		cliped=vec2( dot(clippos,clipDir.xy)/clipw/clipw, dot(clippos,clipDir.zw)/cliph/cliph);\n	}\n\n}","/*\n	texture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\nvoid main() {\n	if(cliped.x<0.) discard;\n	if(cliped.x>1.) discard;\n	if(cliped.y<0.) discard;\n	if(cliped.y>1.) discard;\n	\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n	gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n	gl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n	gl_FragColor =   blur();\n	gl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n	mat4 alphaMat =colorMat;\n\n	alphaMat[0][3] *= gl_FragColor.a;\n	alphaMat[1][3] *= gl_FragColor.a;\n	alphaMat[2][3] *= gl_FragColor.a;\n\n	gl_FragColor = gl_FragColor * alphaMat;\n	gl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n	const float c_IterationTime = 10.0;\n	float floatIterationTotalTime = c_IterationTime * c_IterationTime;\n	vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n	vec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\n	vec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\n	float maxNum = u_blurX * u_blurY;\n	vec2 vec2Off = vec2(0.0,0.0);\n	float floatOff = c_IterationTime/2.0;\n	for(float i = 0.0;i<=c_IterationTime; ++i){\n		for(float j = 0.0;j<=c_IterationTime; ++j){\n			vec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n			vec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n		}\n	}\n	gl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\n	gl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}","posuv,attribColor,attribFlags","size,clipDir,clipRect,texture,colorMat,colorAlpha"),t.PROGRAMEX_DRAWVG=LayaGL.instance.createProgramEx("attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipDir;\nuniform vec2 clipRect;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n	vec4 tPos = vec4(position.x,position.y ,position.z,position.w);\n	vec4 pos=mmat*tPos;\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n	float clipw = length(clipDir.xy);\n	float cliph = length(clipDir.zw);\n	vec2 clippos = tPos.xy - clipRect.xy;	//pos�Ѿ�Ӧ�þ����ˣ�Ϊ�˼��������壬clip��λ��ҲҪ����\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//clipdir�Ǵ����ŵķ�����������clippos�������ź�Ŀռ����ģ�������Ҫ�ѷ�����normalizeһ��\n		cliped=vec2( dot(clippos,clipDir.xy)/clipw/clipw, dot(clippos,clipDir.zw)/cliph/cliph);\n	}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}","precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n	//vec4 a=vec4(color.r, color.g, color.b, 1);\n	//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n	gl_FragColor.rgb*=color.a;\n	if(cliped.x<0.) discard;\n	if(cliped.x>1.) discard;\n	if(cliped.y<0.) discard;\n	if(cliped.y>1.) discard;\n}","position,attribColor","size,clipDir,clipRect"),t.VDO_MESHQUADTEXTURE=e.createVDO(new Int32Array([5126,0,4,24,5121,16,4,24,5121,20,4,24])),t.VDO_MESHVG=e.createVDO(new Int32Array([5126,0,2,12,5121,8,4,12])),t._init_simple_texture_cmdEncoder_(),t.SHADER_MACRO_COLOR_FILTER=LayaGL.instance.defineShaderMacro("#define COLOR_FILTER",[{uname:4,id:t.GLOBALVALUE_COLORFILTER_COLOR},{uname:5,id:t.GLOBALVALUE_COLORFILTER_ALPHA}]),LayaGLTemplate.__init__(),new CharBook,CharPages.charRender=new CharRender_Native}},t._SIMPLE_TEXTURE_CMDENCODER_=null,t.PROGRAMEX_DRAWTEXTURE=0,t.PROGRAMEX_DRAWVG=0,t.PROGRAMEX_DRAWRECT=0,t.VDO_MESHQUADTEXTURE=0,t.VDO_MESHVG=0,t.GLOBALVALUE_VIEWS=0,t.GLOBALVALUE_MATRIX32=0,t.GLOBALVALUE_DRAWTEXTURE_COLOR=0,t.GLOBALVALUE_ITALICDEG=0,t.GLOBALVALUE_CLIPDIR=0,t.GLOBALVALUE_CLIPSIZE=0,t.GLOBALVALUE_COLORFILTER_COLOR=0,t.GLOBALVALUE_COLORFILTER_ALPHA=0,t.SHADER_MACRO_COLOR_FILTER=0,t}(),Render=function(){function t(e,i){function n(e,i,n){return n?(t._context=n.getContext("2d"),t._context.__tx=0,t._context.__ty=0):(n=HTMLCanvas.create("3D"),t._context=RunDriver.createWebGLContext2D(n),n._setContext(t._context)),n.size(e,i),t._context}function r(){Laya.stage._loop(),Browser.window.requestAnimationFrame(r)}this._timeId=0;var a=t._mainCanvas.source.style;a.position="absolute",a.top=a.left="0px",a.background="#000000",t._mainCanvas.source.id="layaCanvas";var s=laya.renders.Render.isWebGL;t._mainCanvas.source.width=e,t._mainCanvas.source.height=i,s&&t.WebGL.init(t._mainCanvas,e,i),Browser.container.appendChild(t._mainCanvas.source),t._context=n(e,i,s?null:t._mainCanvas),Browser.window.requestAnimationFrame(r),Laya.stage.on("visibilitychange",this,this._onVisibilitychange)}__class(t,"laya.renders.Render");var e=t.prototype;return e._onVisibilitychange=function(){Laya.stage.isVisibility?0!=this._timeId&&Browser.window.clearInterval(this._timeId):this._timeId=Browser.window.setInterval(this._enterFrame,1e3)},e._enterFrame=function(){Laya.stage._loop()},__getset(1,t,"context",function(){return t._context}),__getset(1,t,"canvas",function(){return t._mainCanvas.source}),t._context=null,t._mainCanvas=null,t.WebGL=null,t.isConchApp=!1,t.isWebGL=!1,t.is3DMode=!1,t.optimizeTextureMemory=function(){return!0},t.__init$=function(){t.isConchApp=null!=window.conch},t}(),RenderContext=function(){function t(t,e,i){this.x=0,this.y=0,this._drawTexture=function(){},this._fillTexture=function(t,e,i){i[0]._loaded&&this.ctx.fillTexture(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._drawTextureWithTransform=function(t,e,i){i[0]._loaded&&this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],t,e,i[6],i[7])},this._fillQuadrangle=function(t,e,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])},this._drawPie=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(i[8]),n.beginPath(),Render.isWebGL?(n.movePath(i[0]+t,i[1]+e),n.moveTo(0,0)):n.moveTo(t+i[0],e+i[1]),n.arc(t+i[0],e+i[1],i[2],i[3],i[4]),n.closePath(),this._fillAndStroke(i[5],i[6],i[7],!0)},this._clipRect=function(t,e,i){this.ctx.clipRect(t+i[0],e+i[1],i[2],i[3])},this._fillRect=function(t,e,i){this.ctx._drawRect(t+i[0],e+i[1],i[2],i[3],i[4])},this._setShader=function(t,e,i){this.ctx.setShader(i[0])},this._drawLine=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(i[6]),n.beginPath(),n.strokeStyle=i[4],n.lineWidth=i[5],Render.isWebGL?(n.movePath(t,e),n.moveTo(i[0],i[1]),n.lineTo(i[2],i[3])):(n.moveTo(t+i[0],e+i[1]),n.lineTo(t+i[2],e+i[3])),n.stroke()},this._drawLines=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(i[5]),n.beginPath(),t+=i[0],e+=i[1],Render.isWebGL&&n.movePath(t,e),n.strokeStyle=i[3],n.lineWidth=i[4];var r=i[2],a=2,s=r.length;if(Render.isWebGL)for(n.moveTo(r[0],r[1]);s>a;)n.lineTo(r[a++],r[a++]);else for(n.moveTo(t+r[0],e+r[1]);s>a;)n.lineTo(t+r[a++],e+r[a++]);n.stroke()},this._drawLinesWebGL=function(t,e,i){this.ctx.drawLines(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])},this._drawCurves=function(){},this._draw=function(t,e,i){i[0].call(null,this,t,e)},this._transformByMatrix=function(t,e,i){this.ctx.transformByMatrix(i[0])},this._setTransform=function(t,e,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},this._setTransformByMatrix=function(t,e,i){this.ctx.setTransformByMatrix(i[0])},this._save=function(){this.ctx.save()},this._restore=function(){this.ctx.restore()},this._translate=function(t,e,i){this.ctx.translate(i[0],i[1])},this._transform=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);var n=i[0];this.ctx.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.ctx.translate(-t-i[1],-e-i[2])},this._rotate=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e),this.ctx.rotate(i[0]),this.ctx.translate(-t-i[1],-e-i[2])},this._scale=function(t,e,i){this.ctx.translate(i[2]+t,i[3]+e),this.ctx.scale(i[0],i[1]),this.ctx.translate(-t-i[2],-e-i[3])},this._alpha=function(t,e,i){this.ctx.globalAlpha*=i[0]},this._setAlpha=function(t,e,i){this.ctx.globalAlpha=i[0]},this._fillText=function(t,e,i){this.ctx.drawText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5])},this._strokeText=function(t,e,i){this.ctx.strokeWord(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])},this._fillBorderText=function(t,e,i){this.ctx.fillBorderText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._fillWords=function(t,e,i){this.ctx.fillWords(i[0],i[1]+t,i[2]+e,i[3],i[4])},this._fillBorderWords=function(t,e,i){this.ctx.fillBorderWords(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])},this._blendMode=function(t,e,i){this.ctx.globalCompositeOperation=i[0]},this._beginClip=function(t,e,i){this.ctx.beginClip&&this.ctx.beginClip(t+i[0],e+i[1],i[2],i[3])},this._setIBVB=function(t,e,i){this.ctx.setIBVB(i[0]+t,i[1]+e,i[2],i[3],i[4],i[5],i[6],i[7])},this._fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1]+t,i[2]+e,i[3],i[4])},this._drawPath=function(t,e,i){var n=this.ctx;Render.isWebGL&&n.setPathId(-1),n.beginPath(),t+=i[0],e+=i[1];for(var r=i[2],a=0,s=r.length;s>a;a++){var o=r[a];switch(o[0]){case"moveTo":n.moveTo(t+o[1],e+o[2]);break;case"lineTo":n.lineTo(t+o[1],e+o[2]);break;case"arcTo":n.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":n.closePath()}}var l=i[3];null!=l&&(n.fillStyle=l.fillStyle,n.fill());var _=i[4];null!=_&&(n.strokeStyle=_.strokeStyle,n.lineWidth=_.lineWidth||1,n.lineJoin=_.lineJoin,n.lineCap=_.lineCap,n.miterLimit=_.miterLimit,n.stroke())},this.drawPoly=function(t,e,i){this.ctx.drawPoly(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._drawPoly=function(t,e,i){var n=this.ctx,r=i[2],a=2,s=r.length;if(Render.isWebGL)for(n.setPathId(i[6]),n.beginPath(),t+=i[0],e+=i[1],n.movePath(t,e),n.moveTo(r[0],r[1]);s>a;)n.lineTo(r[a++],r[a++]);else for(n.beginPath(),t+=i[0],e+=i[1],n.moveTo(t+r[0],e+r[1]);s>a;)n.lineTo(t+r[a++],e+r[a++]);n.closePath(),this._fillAndStroke(i[3],i[4],i[5],i[7])},this._drawSkin=function(t,e,i){var n=i[0];if(n){var r=this.ctx;n.render(r,t,e)}},this._drawParticle=function(t,e,i){this.ctx.drawParticle(t+this.x,e+this.y,i[0])},i?this.ctx=i.getContext("2d"):(i=HTMLCanvas.create("3D"),this.ctx=RunDriver.createWebGLContext2D(i),i._setContext(this.ctx)),i.size(t,e),this.canvas=i}__class(t,"laya.renders.RenderContext");var e=t.prototype;return e.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},e.drawTexture=function(){},e._drawTextures=function(t,e,i){i[0]._loaded&&this.ctx.drawTextures(i[0],i[1],t+this.x,e+this.y)},e.fillQuadrangle=function(t,e,i,n,r){this.ctx.fillQuadrangle(t,e,i,n,r)},e.drawCanvas=function(t,e,i,n,r){this.ctx.drawCanvas(t,e+this.x,i+this.y,n,r)},e.drawRect=function(t,e,i,n,r,a,s){var o=this.ctx;null!=r&&(o.fillStyle=r,o.fillRect(t,e,i,n)),null!=a&&(o.strokeStyle=a,o.lineWidth=s,o.strokeRect(t,e,i,n))},e._fillAndStroke=function(t,e,i,n){void 0===n&&(n=!1);var r=this.ctx;null!=t&&(r.fillStyle=t,Render.isWebGL?r.fill(n):r.fill()),null!=e&&i>0&&(r.strokeStyle=e,r.lineWidth=i,r.stroke())},e.clipRect=function(t,e,i,n){this.ctx.clipRect(t+this.x,e+this.y,i,n)},e.fillRect=function(t,e,i,n,r){this.ctx._drawRect(t+this.x,e+this.y,i,n,r)},e.drawCircle=function(e,i,n,r,a){void 0===a&&(a=1),Stat.drawCall++;var s=this.ctx;s.beginPath(),s.strokeStyle=r,s.lineWidth=a,s.arc(e+this.x,i+this.y,n,0,t.PI2),s.stroke()},e._drawCircle=function(e,i,n){var r=this.ctx;Render.isWebGL&&r.setPathId(n[6]),Stat.drawCall++,r.beginPath(),Render.isWebGL&&r.movePath(n[0]+e,n[1]+i),r.arc(n[0]+e,n[1]+i,n[2],0,t.PI2),r.closePath(),this._fillAndStroke(n[3],n[4],n[5],!0)},e.drawTriangles=function(t,e,i){var n=i[4],r=0,a=n.length,s=this.ctx;for(r=0;a>r;r+=3){var o=2*n[r],l=2*n[r+1],_=2*n[r+2];s.drawTriangle(i[2],i[3],i[5],o,l,_,i[6],!0)}},e.fillCircle=function(e,i,n,r){Stat.drawCall++;var a=this.ctx;a.beginPath(),a.fillStyle=r,a.arc(e+this.x,i+this.y,n,0,t.PI2),a.fill()},e._fillCircle=function(e,i,n){Stat.drawCall++;var r=this.ctx;r.beginPath(),r.fillStyle=n[3],r.arc(n[0]+e,n[1]+i,n[2],0,t.PI2),r.fill()},e.setShader=function(t){this.ctx.setShader(t)},e.drawLine=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=this.ctx;s.beginPath(),s.strokeStyle=r,s.lineWidth=a,s.moveTo(this.x+t,this.y+e),s.lineTo(this.x+i,this.y+n),s.stroke()},e.clear=function(){this.ctx.clear()},e.transformByMatrix=function(t){this.ctx.transformByMatrix(t)},e.setTransform=function(t,e,i,n,r,a){this.ctx.setTransform(t,e,i,n,r,a)},e.setTransformByMatrix=function(t){this.ctx.setTransformByMatrix(t)},e.save=function(){this.ctx.save()},e.restore=function(){this.ctx.restore()},e.translate=function(t,e){this.ctx.translate(t,e)},e.transform=function(t,e,i,n,r,a){this.ctx.transform(t,e,i,n,r,a)},e.rotate=function(t){this.ctx.rotate(t)},e.scale=function(t,e){this.ctx.scale(t,e)},e.alpha=function(t){this.ctx.globalAlpha*=t},e.setAlpha=function(t){this.ctx.globalAlpha=t},e.fillText=function(t,e,i,n,r,a){this.ctx.drawText(t,e+this.x,i+this.y,n,r,a)},e.strokeText=function(t,e,i,n,r,a,s){this.ctx.strokeWord(t,e+this.x,i+this.y,n,r,a,s)},e.blendMode=function(t){this.ctx.globalCompositeOperation=t},e.flush=function(){this.ctx.flush&&this.ctx.flush()},e.addRenderObject=function(t){this.ctx.addRenderObject(t)},e.beginClip=function(t,e,i,n){this.ctx.beginClip&&this.ctx.beginClip(t,e,i,n)},e.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},e.fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],i.length>4?i[4]:null)},t.PI2=2*Math.PI,t}(),RenderData=function(){function t(){this.context=null,this.sprite=null,this.data=null,this.x=0/0,this.y=0/0}return __class(t,"laya.renders.RenderData"),t}(),RenderSprite=function(){function t(e,i){if(LayaGLQuickRunner.map[e])return this._fun=LayaGLQuickRunner.map[e],this._next=t.NORENDER,void 0;switch(this._next=i||t.NORENDER,e){case 0:return this._fun=this._no,void 0;case 1:return this._fun=this._alpha,void 0;case 2:return this._fun=this._transform,void 0;case 4:return this._fun=this._blend,void 0;case 8:return this._fun=this._canvas,void 0;case 32:return this._fun=this._mask,void 0;case 64:return this._fun=this._clip,void 0;case 128:return this._fun=this._style,void 0;case 512:return this._fun=this._graphics,void 0;case 8192:return this._fun=this._children,void 0;case 2048:return this._fun=this._custom,void 0;case 256:return this._fun=this._texture,void 0;case 16:return this._fun=Filter._filter,void 0;case 69905:return this._fun=t._initRenderFun,void 0}this.onCreate(e)}__class(t,"laya.renders.RenderSprite");var e=t.prototype;return e.onCreate=function(){},e._style=function(t,e,i,n){var r=t._style;null!=r.render&&r.render(t,e,i,n);var a=this._next;a._fun.call(a,t,e,i,n)},e._no=function(){},e._custom=function(t,e,i,n){t.customRender(e,i,n),this._next._fun.call(this._next,t,e,i-t.pivotX,n-t.pivotY)},e._clip=function(e,i,n,r){var a=this._next;if(a!=t.NORENDER){var s=e._style.scrollRect;i.save(),i.clipRect(n,r,s.width,s.height),a._fun.call(a,e,i,n-s.x,r-s.y),i.restore()}},e._blend=function(t,e,i,n){var r=t._style;r.blendMode&&(e.globalCompositeOperation=r.blendMode);var a=this._next;a._fun.call(a,t,e,i,n),e.globalCompositeOperation="source-over"},e._mask=function(t,e,i,n){var r=this._next;r._fun.call(r,t,e,i,n);var a=t.mask;a&&(e.globalCompositeOperation="destination-in",(a.numChildren>0||!a.graphics._isOnlyOne())&&(a.cacheAs="bitmap"),a.render(e,i-t._style.pivotX,n-t._style.pivotY)),e.globalCompositeOperation="source-over"},e._texture=function(t,e,i,n){var r=t.texture;e.drawTexture(r,i-t.pivotX,n-t.pivotY,r.width,r.height);var a=this._next;a._fun.call(a,t,e,i,n)},e._graphics=function(t,e,i,n){t._graphics&&t._graphics._render(t,e,i-t.pivotX,n-t.pivotY);var r=this._next;r._fun.call(r,t,e,i,n)},e._image=function(t,e,i,n){var r=t._style;e.drawTexture2(i,n,r.pivotX,r.pivotY,t.transform,t._graphics._one)},e._image2=function(t,e,i,n){var r=t._style;e.drawTexture2(i,n,r.pivotX,r.pivotY,t.transform,t._graphics._one)},e._alpha=function(t,e,i,n){var r,a=t._style;if((r=a.alpha)>.01||t._needRepaint()){var s=e.globalAlpha;e.globalAlpha*=r;var o=this._next;o._fun.call(o,t,e,i,n),e.globalAlpha=s}},e._transform=function(e,i,n,r){{var a=e.transform,s=this._next;e._style}a&&s!=t.NORENDER?(i.save(),i.transform(a.a,a.b,a.c,a.d,a.tx+n,a.ty+r),s._fun.call(s,e,i,0,0),i.restore()):s._fun.call(s,e,i,n,r)},e._children=function(t,e,i,n){var r,a=t._style,s=t._children,o=s.length;if(i-=t.pivotX,n-=t.pivotY,a.viewport){var l=a.viewport,_=l.x,h=l.y,u=l.right,c=l.bottom,d=0/0,f=0/0;for(m=0;o>m;++m)(r=s[m])._visible&&(d=r._x)<u&&d+r.width>_&&(f=r._y)<c&&f+r.height>h&&r.render(e,i,n)}else for(var m=0;o>m;++m)(r=s[m])._visible&&r.render(e,i,n)},e._canvas=function(t,e,i,n){var r=t._cacheStyle,a=this._next;if(!r.enableCanvasRender)return a._fun.call(a,t,e,i,n),void 0;if("bitmap"===r.cacheAs?Stat.canvasBitmap++:Stat.canvasNormal++,t._needRepaint()||!r.canvas)this._canvas_repaint(t,e,i,n);else{var s=r.cacheRect;e.drawCanvas(r.canvas,i+s.x,n+s.y,s.width,s.height)}},e._canvas_repaint=function(t,e,i,n){var r,a,s,o,l,_,h,u,c,d=t._cacheStyle,f=this._next,m=d.canvas,p=d.cacheAs;if(c=d._calculateCacheRect(t,p,i,n),h=c.x,u=c.y,o=d.cacheRect,l=o.width*h,_=o.height*u,a=o.x,s=o.y,Render.isWebGL&&"bitmap"===p&&(l>2048||_>2048))return console.warn("cache bitmap size larger than 2048,cache ignored"),d.releaseContext(),f._fun.call(f,t,e,i,n),void 0;if(m||(d.createContext(),m=d.canvas),r=m.context,m.context.sprite=t,(m.width!=l||m.height!=_)&&m.size(l,_),"bitmap"===p?m.context.asBitmap=!0:"normal"===p&&(m.context.asBitmap=!1),m.clear(),"normal"===p&&(r.touches=[]),1!=h||1!=u){var g=r;g.save(),g.scale(h,u),f._fun.call(f,t,r,-a,-s),g.restore(),t._applyFilters()}else g=r,f._fun.call(f,t,r,-a,-s),t._applyFilters();d.staticCache&&(d.reCache=!1),Stat.canvasReCache++,e.drawCanvas(m,i+a,n+s,o.width,o.height)},t.__init__=function(){LayaGLQuickRunner.__init__();var e,i=0,n=0;for(e=RunDriver.createRenderSprite(69905,null),n=t.renders.length=16384,i=0;n>i;i++)t.renders[i]=e;t.renders[0]=RunDriver.createRenderSprite(0,null)},t._initRenderFun=function(e,i,n,r){var a=e._renderType,s=t.renders[a]=t._getTypeRender(a);s._fun(e,i,n,r)},t._getTypeRender=function(t){if(LayaGLQuickRunner.map[t])return RunDriver.createRenderSprite(t,null);for(var e=null,i=8192;i>0;)i&t&&(e=RunDriver.createRenderSprite(i,e)),i>>=1;return e},t.INIT=69905,t.renders=[],t.NORENDER=new t(0,null),t}(),Context=function(){function t(){}__class(t,"laya.resource.Context");var e=t.prototype;return e.drawCanvas=function(t,e,i,n,r){Stat.drawCall++,this.drawImage(t._source,e,i,n,r)},e._drawRect=function(t,e,i,n,r){Stat.drawCall++,r&&(this.fillStyle=r),this.fillRect(t,e,i,n)},e.drawText=function(t,e,i,n,r,a){Stat.drawCall++,arguments.length>3&&null!=n&&(this.font=n,this.fillStyle=r,this.textAlign=a,this.textBaseline="top"),this.fillText(t,e,i)},e.fillBorderText=function(t,e,i,n,r,a,s,o){Stat.drawCall++,this.font=n,this.fillStyle=r,this.textBaseline="top",this.strokeStyle=a,this.lineWidth=s,this.textAlign=o,this.strokeText(t,e,i),this.fillText(t,e,i)},e.fillWords=function(t,e,i,n,r){n&&(this.font=n),r&&(this.fillStyle=r),this.textBaseline="top",this.textAlign="left";for(var a=0,s=t.length;s>a;a++){var o=t[a];this.fillText(o.char,o.x+e,o.y+i)}},e.fillBorderWords=function(t,e,i,n,r,a,s){n&&(this.font=n),r&&(this.fillStyle=r),this.textBaseline="top",this.lineWidth=s,this.textAlign="left",this.strokeStyle=a;for(var o=0,l=t.length;l>o;o++){var _=t[o];this.strokeText(_.char,_.x+e,_.y+i),this.fillText(_.char,_.x+e,_.y+i)}},e.strokeWord=function(t,e,i,n,r,a,s){Stat.drawCall++,arguments.length>3&&null!=n&&(this.font=n,this.strokeStyle=r,this.lineWidth=a,this.textAlign=s,this.textBaseline="top"),this.strokeText(t,e,i)},e.setTransformByMatrix=function(t){this.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.clipRect=function(t,e,i,n){Stat.drawCall++,this.beginPath(),this.rect(t,e,i,n),this.clip()},e.drawTextureWithTransform=function(t,e,i,n,r,a,s,o,l,_){"use strict";if(t.getEnabled()){Stat.drawCall++;var h=1!==l;if(h){var u=this.globalAlpha;this.globalAlpha*=l}_&&(this.globalCompositeOperation=_);var c=t.uv,d=t.bitmap._w,f=t.bitmap._h;a?(this.save(),this.transform(a.a,a.b,a.c,a.d,a.tx+s,a.ty+o),this.drawImage(t.bitmap._source,c[0]*d,c[1]*f,(c[2]-c[0])*d,(c[5]-c[3])*f,e,i,n,r),this.restore()):this.drawImage(t.bitmap._source,c[0]*d,c[1]*f,(c[2]-c[0])*d,(c[5]-c[3])*f,s+e,o+i,n,r),h&&(this.globalAlpha=u),_&&(this.globalCompositeOperation="source-over")}},e.drawTexture2=function(t,e,i,n,r,a){"use strict";var s=a[0];if(s.getEnabled()){Stat.drawCall++;var o=s.uv,l=s.bitmap._w,_=s.bitmap._h;r?(this.save(),this.transform(r.a,r.b,r.c,r.d,r.tx+t,r.ty+e),this.drawImage(s.bitmap._source,o[0]*l,o[1]*_,(o[2]-o[0])*l,(o[5]-o[3])*_,a[1]-i,a[2]-n,a[3],a[4]),this.restore()):this.drawImage(s.bitmap._source,o[0]*l,o[1]*_,(o[2]-o[0])*l,(o[5]-o[3])*_,a[1]-i+t,a[2]-n+e,a[3],a[4])}},e.fillTexture=function(t,e,i,n,r,a,s,o){if(!o.pat){if(t.uv!=Texture.DEF_UV){var l=new HTMLCanvas("2D");l.getContext("2d"),l.size(t.width,t.height),l.context.drawTexture(t,0,0,t.width,t.height),t=new Texture(l)}o.pat=this.createPattern(t.bitmap.source,a)}var _=e,h=i,u=0,c=0;s&&(_+=s.x%t.width,h+=s.y%t.height,u-=s.x%t.width,c-=s.y%t.height),this.translate(_,h),this._drawRect(u,c,n,r,o.pat),this.translate(-_,-h)},e.flush=function(){return 0},e.destroy=function(){this.canvas.width=this.canvas.height=0},e.clear=function(){Render.isConchApp||this.clearRect(0,0,this._canvas.width,this._canvas.height)},e.drawTriangle=function(t,e,i,n,r,a,s,o){var l=t.bitmap,_=l._getSource(),h=t.width,u=t.height,c=l.width,d=l.height,f=i[n]*c,m=i[r]*c,p=i[a]*c,g=i[n+1]*d,v=i[r+1]*d,x=i[a+1]*d,y=e[n],T=e[r],D=e[a],E=e[n+1],S=e[r+1],M=e[a+1];if(o){var R=1,A=1,C=(y+T+D)/3,L=(E+S+M)/3,I=y-C,w=E-L,b=Math.sqrt(I*I+w*w);y=C+I/b*(b+R),E=L+w/b*(b+A),I=T-C,w=S-L,b=Math.sqrt(I*I+w*w),T=C+I/b*(b+R),S=L+w/b*(b+A),I=D-C,w=M-L,b=Math.sqrt(I*I+w*w),D=C+I/b*(b+R),M=L+w/b*(b+A)}this.save(),s&&this.transform(s.a,s.b,s.c,s.d,s.tx,s.ty),this.beginPath(),this.moveTo(y,E),this.lineTo(T,S),this.lineTo(D,M),this.closePath(),this.clip();var P=f*v+g*p+m*x-v*p-g*m-f*x,V=1/P,O=y*v+g*D+T*x-v*D-g*T-y*x,N=f*T+y*p+m*D-T*p-y*m-f*D,B=f*v*D+g*T*p+y*m*x-y*v*p-g*m*D-f*T*x,F=E*v+g*M+S*x-v*M-g*S-E*x,U=f*S+E*p+m*M-S*p-E*m-f*M,G=f*v*M+g*S*p+E*m*x-E*v*p-g*m*M-f*S*x;this.transform(O*V,F*V,N*V,U*V,B*V,G*V),this.drawImage(_,t.uv[0]*c,t.uv[1]*d,h,u,t.uv[0]*c,t.uv[1]*d,h,u),this.restore()},e.transformByMatrix=function(t,e,i){this.transform(t.a,t.b,t.c,t.d,t.tx+e,t.ty+i)},e.saveTransform=function(){this.save()},e.restoreTransform=function(){this.restore()},e.drawRect=function(t,e,i,n,r,a,s){var o=this;null!=r&&(o.fillStyle=r,o.fillRect(t,e,i,n)),null!=a&&(o.strokeStyle=a,o.lineWidth=s,o.strokeRect(t,e,i,n))},e.drawTexture=function(t,e,i,n,r){if(t.loaded){Stat.drawCall++;var a=t.uv,s=t.bitmap.width,o=t.bitmap.height;this.drawImage(t.bitmap._source,a[0]*s,a[1]*o,(a[2]-a[0])*s,(a[5]-a[3])*o,e,i,n,r)}},e.drawTextures=function(t,e,i,n){Stat.drawCall+=e.length/2;for(var r=t.width,a=t.height,s=0,o=e.length;o>s;s+=2)this.drawTexture(t,e[s]+i,e[s+1]+n,r,a)},e.drawTriangles=function(t,e,i,n,r,a,s){var o=0,l=a.length;for(this.translate(e,i),o=0;l>o;o+=3){var _=2*a[o],h=2*a[o+1],u=2*a[o+2];this.drawTriangle(t,n,r,_,h,u,s,!0)}this.translate(-e,-i)},e.alpha=function(t){this.globalAlpha*=t},e._transform=function(t,e,i){this.translate(e,i),this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty),this.translate(-e,-i)},e._rotate=function(t,e,i){this.translate(e,i),this.rotate(t),this.translate(-e,-i)},e._scale=function(t,e,i,n){this.translate(i,n),this.scale(t,e),this.translate(-i,-n)},e._drawLine=function(t,e,i,n,r,a,s,o){this.ctx;this.beginPath(),this.strokeStyle=s,this.lineWidth=o,this.moveTo(t+i,e+n),this.lineTo(t+r,e+a),this.stroke()},e._drawLines=function(t,e,i,n,r,a){Render.isWebGL&&this.setPathId(a),this.beginPath(),this.strokeStyle=n,this.lineWidth=r;var s=2,o=i.length;if(Render.isWebGL)this.addPath(i.slice(),!1,!1,t,e);else for(this.moveTo(t+i[0],e+i[1]);o>s;)this.lineTo(t+i[s++],e+i[s++]);this.stroke()},e.drawCurves=function(t,e,i,n,r){this.beginPath(),this.strokeStyle=n,this.lineWidth=r,this.moveTo(t+i[0],e+i[1]);for(var a=2,s=i.length;s>a;)this.quadraticCurveTo(t+i[a++],e+i[a++],t+i[a++],e+i[a++]);this.stroke()},e._fillAndStroke=function(t,e,i,n){void 0===n&&(n=!1),null!=t&&(this.fillStyle=t,this.fill()),null!=e&&i>0&&(this.strokeStyle=e,this.lineWidth=i,this.stroke())},e._drawCircle=function(e,i,n,r,a,s){Stat.drawCall++,Render.isWebGL?this.beginPath(!0):this.beginPath(),this.arc(e,i,n,0,t.PI2),this.closePath(),this._fillAndStroke(r,a,s)},e._drawPie=function(t,e,i,n,r,a,s,o){this.beginPath(),this.moveTo(t,e),this.arc(t,e,i,n,r),this.closePath(),this._fillAndStroke(a,s,o)},e._drawPoly=function(t,e,i,n,r,a,s,o){var l=2,_=i.length;if(this.beginPath(),Render.isWebGL)this.setPathId(o),this.addPath(i.slice(),!0,s,t,e);else for(this.moveTo(t+i[0],e+i[1]);_>l;)this.lineTo(t+i[l++],e+i[l++]);this.closePath(),this._fillAndStroke(n,r,a,s)},e._drawPath=function(t,e,i,n,r){this.ctx;this.beginPath();for(var a=0,s=i.length;s>a;a++){var o=i[a];switch(o[0]){case"moveTo":this.moveTo(t+o[1],e+o[2]);break;case"lineTo":this.lineTo(t+o[1],e+o[2]);break;case"arcTo":this.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":this.closePath()}}null!=n&&(this.fillStyle=n.fillStyle,this.fill()),null!=r&&(this.strokeStyle=r.strokeStyle,this.lineWidth=r.lineWidth||1,this.lineJoin=r.lineJoin,this.lineCap=r.lineCap,this.miterLimit=r.miterLimit,this.stroke())},t.__init__=function(t){var e=laya.resource.Context.prototype;if(t=t||CanvasRenderingContext2D.prototype,!t.init2d){t.init2d=!0;var i=["saveTransform","restoreTransform","transformByMatrix","drawTriangles","drawTriangle","drawTextures","fillWords","fillBorderWords","drawRect","strokeWord","drawText","fillTexture","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves","_drawRect","alpha","_transform","_rotate","_scale","_drawLine","_drawLines","_drawCircle","_fillAndStroke","_drawPie","_drawPoly","_drawPath","drawTextureWithTransform"];i.forEach(function(i){t[i]=e[i]})}},t.PI2=2*Math.PI,t}(),ResourceManager=function(){function t(e){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._id=++t._uniqueIDCounter,this._name=e?e:"Content Manager",t._isResourceManagersSorted=!1,this._memorySize=0,t._resourceManagers.push(this),this._resources=[]}__class(t,"laya.resource.ResourceManager");var e=t.prototype;return Laya.imps(e,{"laya.resource.IDispose":!0}),e.getResourceByIndex=function(t){return this._resources[t]},e.getResourcesLength=function(){return this._resources.length},e.addResource=function(t){t.resourceManager&&t.resourceManager.removeResource(t);var e=this._resources.indexOf(t);return-1===e?(t._resourceManager=this,this._resources.push(t),this.addSize(t.gpuMemory),!0):!1},e.removeResource=function(t){var e=this._resources.indexOf(t);return-1!==e?(this._resources.splice(e,1),t._resourceManager=null,this._memorySize-=t.gpuMemory,!0):!1},e.unload=function(){for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++){var i=t[e];i.destroy()}t.length=0},e.dispose=function(){if(this===t._systemResourceManager)throw new Error("systemResourceManager不能被释放！");t._resourceManagers.splice(t._resourceManagers.indexOf(this),1),t._isResourceManagersSorted=!1;for(var e=this._resources.slice(0,this._resources.length),i=0;i<e.length;i++){var n=e[i];n.resourceManager.removeResource(n),n.destroy()}e.length=0},e.addSize=function(t){t&&(this._memorySize+=t)},__getset(0,e,"id",function(){return this._id}),__getset(0,e,"name",function(){return this._name},function(e){!e&&""===e||this._name===e||(this._name=e,t._isResourceManagersSorted=!1)}),__getset(0,e,"memorySize",function(){return this._memorySize}),__getset(1,t,"systemResourceManager",function(){return t._systemResourceManager}),t.__init__=function(){t.currentResourceManager=t.systemResourceManager},t.getLoadedResourceManagerByIndex=function(e){return t._resourceManagers[e]},t.getLoadedResourceManagersCount=function(){return t._resourceManagers.length},t.recreateContentManagers=function(t){void 0===t&&(t=!1)},t.releaseContentManagers=function(e){void 0===e&&(e=!1);
for(var i=t.currentResourceManager,n=0;n<t._resourceManagers.length;n++){t.currentResourceManager=t._resourceManagers[n];for(var r=0;r<t.currentResourceManager._resources.length;r++){var a=t.currentResourceManager._resources[r];!a.released&&a.releaseResource(e)}}t.currentResourceManager=i},t._uniqueIDCounter=0,t._isResourceManagersSorted=!1,t._resourceManagers=[],__static(t,["_systemResourceManager",function(){return this._systemResourceManager=new t("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=t._systemResourceManager}]),t}(),ConchCmdReplace=function(){function t(){}return __class(t,"laya.runtime.ConchCmdReplace"),t.__init__=function(){var t,e=laya.display.cmd,i=laya.display.cmdNative;for(t in e)i[t+"Native"]&&(e[t].create=i[t+"Native"].create)},t}(),ConchGraphicsAdpt=function(){function t(){this._commandEncoder=null}__class(t,"laya.runtime.ConchGraphicsAdpt");var e=t.prototype;return e._createData=function(){this._commandEncoder=LayaGL.instance.createCommandEncoder(128,64,!0)},e._clearData=function(){this._commandEncoder&&this._commandEncoder.clearEncoding()},e._destroyData=function(){this._commandEncoder&&(this._commandEncoder.clearEncoding(),this._commandEncoder=null)},t.__init__=function(){var e=Graphics.prototype,i=t.prototype,n=["_createData","_clearData","_destroyData"],r=0,a=0;a=n.length;var s;for(r=0;a>r;r++)s=n[r],e[s]=i[s]},t}(),LayaGLTemplate=function(){function t(){this._commStr="",this._id=0,this._commandEncoder=LayaGL.instance.createCommandEncoder(64,16,!1)}__class(t,"laya.runtime.LayaGLTemplate");var e=t.prototype;return e.addComd=function(t,e){this._commStr+=t+"("+e+");",this._commandEncoder[t].apply(this._commandEncoder,e)},t.createByRenderType=function(e){var i=t.GLS[e]=new t;Render.isConchApp&&window.conch.setGLTemplate(e,i._commandEncoder.getPtrID());for(var n=1;8192>=n;){var r=e&n;if(r&&t.__FUN_PARAM__[n])for(var a=t.__FUN_PARAM__[n],s=0,o=a.length;o>s;s++){var l=a[s];i.addComd(l.func,l.args)}n<<=1}return i._id=e,console.log("template="+i._commStr),i},t.__init__=function(){t.__FUN_PARAM__[1]=[{func:"setGlobalValueByParamData",args:[LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,15,84]}],t.__FUN_PARAM__[2]=[{func:"calcLocalMatrix32",args:[56,60,20,24,28,32,36,40,44,48,52]},{func:"setGlobalValueByParamData",args:[LayaNative2D.GLOBALVALUE_MATRIX32,7,60]}],t.__FUN_PARAM__[256]=[{func:"useCommandEncoder",args:[92,96,1]}],t.__FUN_PARAM__[512]=[{func:"useCommandEncoder",args:[88,-1,1]}],t.__FUN_PARAM__[1024]=[{func:"useCommandEncoder",args:[100,-1,3]}],t.__FUN_PARAM__[2048]=[{func:"useCommandEncoder",args:[104,-1,1]}],t.__FUN_PARAM__[64]=[{func:"setClipByParamData",args:[LayaNative2D.GLOBALVALUE_CLIPDIR,LayaNative2D.GLOBALVALUE_CLIPSIZE,LayaNative2D.GLOBALVALUE_MATRIX32,108]},{func:"setGlobalValueByParamData",args:[LayaNative2D.GLOBALVALUE_MATRIX32,9,124]}],t.__FUN_PARAM__[16]=[{func:"addShaderMacro",args:[LayaNative2D.SHADER_MACRO_COLOR_FILTER]},{func:"setGlobalValueByParamData",args:[LayaNative2D.GLOBALVALUE_COLORFILTER_COLOR,8,132]},{func:"setGlobalValueByParamData",args:[LayaNative2D.GLOBALVALUE_COLORFILTER_ALPHA,8,196]}]},t.GLS=[],t.__FUN_PARAM__=[],t}(),MatrixConch=function(){function t(t,e,i,n,r,a,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),this._nums=s=s?s:new Float32Array(6),s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=r,s[5]=a,this._checkTransform()}__class(t,"laya.runtime.MatrixConch");var e=t.prototype;return e.identity=function(){var t=this._nums;return t[0]=t[3]=1,t[1]=t[4]=t[5]=t[2]=0,this._bTransform=!1,this},e._checkTransform=function(){var t=this._nums;return this._bTransform=1!==t[0]||0!==t[1]||0!==t[2]||1!==t[3]},e.setTranslate=function(t,e){return this._nums[4]=t,this._nums[5]=e,this},e.translate=function(t,e){return this._nums[4]+=t,this._nums[5]+=e,this},e.scale=function(t,e){var i=this._nums;return i[0]*=t,i[3]*=e,i[2]*=t,i[1]*=e,i[4]*=t,i[5]*=e,this._bTransform=!0,this},e.rotate=function(t){var e=this._nums,i=Math.cos(t),n=Math.sin(t),r=e[0],a=e[2],s=e[4];return e[0]=r*i-e[1]*n,e[1]=r*n+e[1]*i,e[2]=a*i-e[3]*n,e[3]=a*n+e[3]*i,e[4]=s*i-e[5]*n,e[5]=s*n+e[5]*i,this._bTransform=!0,this},e.skew=function(t,e){var i=this._nums,n=Math.tan(t),r=Math.tan(e),a=i[0],s=i[1];return i[0]+=r*i[2],i[1]+=r*i[3],i[2]+=n*a,i[3]+=n*s,this},e.invertTransformPoint=function(t){var e=this._nums,i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=i*a-n*r,l=a/o,_=-n/o,h=-r/o,u=i/o,c=(r*e[5]-a*s)/o,d=-(i*e[5]-n*s)/o;return t.setTo(l*t.x+h*t.y+c,_*t.x+u*t.y+d)},e.transformPoint=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},e.transformPointN=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y)},e.getScaleX=function(){var t=this._nums;return 0===t[1]?this.a:Math.sqrt(t[0]*t[0]+t[1]*t[1])},e.getScaleY=function(){var t=this._nums;return 0===t[2]?t[3]:Math.sqrt(t[2]*t[2]+t[3]*t[3])},e.invert=function(){var t=this._nums,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=e*r-i*n;return t[0]=r/s,t[1]=-i/s,t[2]=-n/s,t[3]=e/s,t[4]=(n*this.ty-r*a)/s,t[5]=-(e*this.ty-i*a)/s,this},e.setTo=function(t,e,i,n,r,a){var s=this._nums;return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=r,s[5]=a,this},e.concat=function(t){var e=this._nums,i=t._nums,n=e[0],r=e[2],a=e[4];return e[0]=n*i[0]+e[1]*i[2],e[1]=n*i[1]+e[1]*i[3],e[2]=r*i[0]+e[3]*i[2],e[3]=r*i[1]+e[3]*i[3],e[4]=a*i[0]+e[5]*i[2]+i[4],e[5]=a*i[1]+e[5]*i[3]+i[5],this},e.scaleEx=function(t,e){var i=this._nums,n=i[0],r=i[1],a=i[2],s=i[3];0!==r||0!==a?(i[0]=t*n,i[1]=t*r,i[2]=e*a,i[3]=e*s):(i[0]=t*n,i[1]=0*s,i[2]=0*n,i[3]=e*s),this._bTransform=!0},e.rotateEx=function(t){var e=this._nums,i=Math.cos(t),n=Math.sin(t),r=e[0],a=e[1],s=e[2],o=e[3];0!==a||0!==s?(e[0]=i*r+n*s,e[1]=i*a+n*o,e[2]=-n*r+i*s,e[3]=-n*a+i*o):(e[0]=i*r,e[1]=n*o,e[2]=-n*r,e[3]=i*o),this._bTransform=!0},e.clone=function(){var e=this._nums,i=t.create(),n=i._nums;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],i._bTransform=this._bTransform,i},e.copyTo=function(t){var e=this._nums,i=t._nums;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],t._bTransform=this._bTransform,t},e.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},e.destroy=function(){this.recover()},e.recover=function(){t._pool.push(this)},__getset(0,e,"a",function(){return this._nums[0]},function(t){this._nums[0]=t}),__getset(0,e,"b",function(){return this._nums[1]},function(t){this._nums[1]=t}),__getset(0,e,"c",function(){return this._nums[2]},function(t){this._nums[2]=t}),__getset(0,e,"d",function(){return this._nums[3]},function(t){this._nums[3]=t}),__getset(0,e,"tx",function(){return this._nums[4]},function(t){this._nums[4]=t}),__getset(0,e,"ty",function(){return this._nums[5]},function(t){this._nums[5]=t}),t.mul=function(t,e,i){var n=t._nums,r=e._nums,a=i._nums,s=n[0],o=n[1],l=n[2],_=n[3],h=n[4],u=n[5],c=r[0],d=r[1],f=r[2],m=r[3],p=r[4],g=r[5];return 0!==d||0!==f?(a[0]=s*c+o*f,a[1]=s*d+o*m,a[2]=l*c+_*f,a[3]=l*d+_*m,a[4]=c*h+f*u+p,a[5]=d*h+m*u+g):(a[0]=s*c,a[1]=o*m,a[2]=l*c,a[3]=_*m,a[4]=c*h+p,a[5]=m*u+g),i},t.mul16=function(t,e,i){var n=t._nums,r=e._nums,a=n[0],s=n[1],o=n[2],l=n[3],_=n[4],h=n[5],u=r[0],c=r[1],d=r[2],f=r[3],m=r[4],p=r[5];return 0!==c||0!==d?(i[0]=a*u+s*d,i[1]=a*c+s*f,i[4]=o*u+l*d,i[5]=o*c+l*f,i[12]=u*_+d*h+m,i[13]=c*_+f*h+p):(i[0]=a*u,i[1]=s*f,i[4]=o*u,i[5]=l*f,i[12]=u*_+m,i[13]=f*h+p),i},t.mulPre=function(t,e,i,n,r,a,s,o){var l=t._nums,_=o._nums,h=l[0],u=l[1],c=l[2],d=l[3],f=l[4],m=l[5];return 0!==i||0!==n?(_[0]=h*e+u*n,_[1]=h*i+u*r,_[2]=c*e+d*n,_[3]=c*i+d*r,_[4]=e*f+n*m+a,_[5]=i*f+r*m+s):(_[0]=h*e,_[1]=u*r,_[2]=c*e,_[3]=d*r,_[4]=e*f+a,_[5]=r*m+s),o},t.mulPos=function(t,e,i,n,r,a,s,o){var l=t._nums,_=o._nums,h=l[0],u=l[1],c=l[2],d=l[3],f=l[4],m=l[5];return 0!==u||0!==c?(_[0]=e*h+i*c,_[1]=e*u+i*d,_[2]=n*h+r*c,_[3]=n*u+r*d,_[4]=h*a+c*s+f,_[5]=u*a+d*s+m):(_[0]=e*h,_[1]=i*d,_[2]=n*h,_[3]=r*d,_[4]=h*a+f,_[5]=d*s+m),o},t.preMul=function(t,e,i){var n=t._nums,r=e._nums,a=i._nums,s=n[0],o=n[1],l=n[2],_=n[3],h=r[0],u=r[1],c=r[2],d=r[3],f=r[4],m=r[5];return a[0]=h*s,a[1]=a[2]=0,a[3]=d*_,a[4]=f*s+n[4],a[5]=m*_+n[5],(0!==u||0!==c||0!==o||0!==l)&&(a[0]+=u*l,a[3]+=c*o,a[1]+=h*o+u*_,a[2]+=c*s+d*l,a[4]+=m*l,a[5]+=f*o),i},t.preMulXY=function(t,e,i,n){var r=t._nums,a=n._nums,s=r[0],o=r[1],l=r[2],_=r[3];return a[0]=s,a[1]=o,a[2]=l,a[3]=_,a[4]=e*s+r[4]+i*l,a[5]=i*_+r[5]+e*o,n},t.create=function(e){var i;return t._pool.length?(i=t._pool.pop(),e&&(i._nums=e),i.identity(),i):new t(1,0,0,1,0,0,e)},t.A=0,t.B=1,t.C=2,t.D=3,t.TX=4,t.TY=5,t.EMPTY=new t,t.TEMP=new t,t._pool=[],t}(),System=function(){function System(){}return __class(System,"laya.system.System"),System.changeDefinition=function(name,classObj){Laya[name]=classObj;var str=name+"=classObj";eval(str)},System.__init__=function(){Render.isConchApp&&window.conch&&(window.conch.disableConchResManager(),window.conch.disableConchAutoRestoreLostedDevice())},System}(),Browser=function(){function t(){}return __class(t,"laya.utils.Browser"),__getset(1,t,"pixelRatio",function(){if(t._pixelRatio<0)if(t.__init__(),t.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1)t._pixelRatio=2;else{var e=t.context,i=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;t._pixelRatio=(t._window.devicePixelRatio||1)/i,t._pixelRatio<1&&(t._pixelRatio=1)}return t._pixelRatio}),__getset(1,t,"height",function(){return t.__init__(),(Laya.stage&&Laya.stage.canvasRotation?t.clientWidth:t.clientHeight)*t.pixelRatio}),__getset(1,t,"clientWidth",function(){return t.__init__(),t._window.innerWidth||t._document.body.clientWidth}),__getset(1,t,"window",function(){return t._window||t.__init__()}),__getset(1,t,"clientHeight",function(){return t.__init__(),t._window.innerHeight||t._document.body.clientHeight||t._document.documentElement.clientHeight}),__getset(1,t,"width",function(){return t.__init__(),(Laya.stage&&Laya.stage.canvasRotation?t.clientHeight:t.clientWidth)*t.pixelRatio}),__getset(1,t,"container",function(){return t._container||(t.__init__(),t._container=t.createElement("div"),t._container.id="layaContainer",t._document.body.appendChild(t._container)),t._container},function(e){t._container=e}),__getset(1,t,"document",function(){return t.__init__(),t._document}),t.__init__=function(){if(t._window)return t._window;var e=t._window=window,i=t._document=e.document;e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)};var n=i.body.style;n.margin=0,n.overflow="hidden",n["-webkit-user-select"]="none",n["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";for(var r=i.getElementsByTagName("meta"),a=0,s=!1,o="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";a<r.length;){var l=r[a];if("viewport"==l.name){l.content=o,s=!0;break}a++}s||(l=i.createElement("meta"),l.name="viewport",l.content=o,i.getElementsByTagName("head")[0].appendChild(l));var _=t.userAgent=e.navigator.userAgent;return t.onMobile=_.indexOf("Mobile")>-1,t.onIOS=!!_.match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),t.onIPhone=_.indexOf("iPhone")>-1,t.onIPad=_.indexOf("iPad")>-1,t.onAndroid=_.indexOf("Android")>-1||_.indexOf("Adr")>-1,t.onWP=_.indexOf("Windows Phone")>-1,t.onQQBrowser=_.indexOf("QQBrowser")>-1,t.onMQQBrowser=_.indexOf("MQQBrowser")>-1||_.indexOf("Mobile")>-1&&_.indexOf("QQ")>-1,t.onIE=!!e.ActiveXObject||"ActiveXObject"in e,t.onWeiXin=_.indexOf("MicroMessenger")>-1,t.onSafari=!!_.match(/Version\/\d+\.\d\x20Mobile\/\S+\x20Safari/),t.onPC=!t.onMobile,t.onMiniGame=_.indexOf("MiniGame")>-1,t.onLimixiu=_.indexOf("limixiu")>-1,t.supportLocalStorage=LocalStorage.__init__(),t.supportWebAudio=SoundManager.__init__(),Render._mainCanvas=HTMLCanvas.create("2D"),t.canvas=HTMLCanvas.create("2D"),t.context=t.canvas.getContext("2d"),e},t.createElement=function(e){return t.__init__(),t._document.createElement(e)},t.getElementById=function(e){return t.__init__(),t._document.getElementById(e)},t.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},t.now=function(){return Date.now()},t.userAgent=null,t.onMobile=!1,t.onIOS=!1,t.onIPhone=!1,t.onIPad=!1,t.onAndroid=!1,t.onWP=!1,t.onQQBrowser=!1,t.onMQQBrowser=!1,t.onSafari=!1,t.onIE=!1,t.onWeiXin=!1,t.onPC=!1,t.onMiniGame=!1,t.onLimixiu=!1,t.supportWebAudio=!1,t.supportLocalStorage=!1,t.canvas=null,t.context=null,t._window=null,t._document=null,t._container=null,t._pixelRatio=-1,t}(),Byte=function(){function t(t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this._resizeBuffer(this._allocated_)}__class(t,"laya.utils.Byte");var e=t.prototype;return e._resizeBuffer=function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(i){throw"Invalid typed array length:"+t}},e.getString=function(){return this.readString()},e.readString=function(){return this._rUTF(this.getUint16())},e.getFloat32Array=function(t,e){return this.readFloat32Array(t,e)},e.readFloat32Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Float32Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getUint8Array=function(t,e){return this.readUint8Array(t,e)},e.readUint8Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Uint8Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getInt16Array=function(t,e){return this.readInt16Array(t,e)},e.readInt16Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Int16Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getFloat32=function(){return this.readFloat32()},e.readFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},e.getFloat64=function(){return this.readFloat64()},e.readFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t},e.writeFloat32=function(t){this._ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},e.writeFloat64=function(t){this._ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8},e.getInt32=function(){return this.readInt32()},e.readInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},e.getUint32=function(){return this.readUint32()},e.readUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},e.writeInt32=function(t){this._ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},e.writeUint32=function(t){this._ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},e.getInt16=function(){return this.readInt16()},e.readInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},e.getUint16=function(){return this.readUint16()},e.readUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},e.writeUint16=function(t){this._ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},e.writeInt16=function(t){this._ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},e.getUint8=function(){return this.readUint8()},e.readUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},e.writeUint8=function(t){this._ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++},e._getUInt8=function(t){return this._readUInt8(t)},e._readUInt8=function(t){return this._d_.getUint8(t)},e._getUint16=function(t){return this._readUint16(t)},e._readUint16=function(t){return this._d_.getUint16(t,this._xd_)},e._getMatrix=function(){return this._readMatrix()},e._readMatrix=function(){var t=new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32());return t},e._rUTF=function(t){for(var e="",i=this._pos_+t,n=0,r=0,a=0,s=String.fromCharCode,o=this._u8d_,l=0;this._pos_<i;)n=o[this._pos_++],128>n?0!=n&&(e+=s(n)):224>n?e+=s((63&n)<<6|127&o[this._pos_++]):240>n?(r=o[this._pos_++],e+=s((31&n)<<12|(127&r)<<6|127&o[this._pos_++])):(r=o[this._pos_++],a=o[this._pos_++],e+=s((15&n)<<18|(127&r)<<12|a<<6&127|127&o[this._pos_++])),l++;return e},e.getCustomString=function(t){return this.readCustomString(t)},e.readCustomString=function(t){for(var e="",i=0,n=0,r=0,a=String.fromCharCode,s=this._u8d_;t>0;)if(n=s[this._pos_],128>n)e+=a(n),this._pos_++,t--;else for(i=n-128,this._pos_++,t-=i;i>0;)n=s[this._pos_++],r=s[this._pos_++],e+=a(r<<8|n),i--;return e},e.clear=function(){this._pos_=0,this.length=0},e.__getBuffer=function(){return this._d_.buffer},e.writeUTFBytes=function(t){t+="";for(var e=0,i=t.length;i>e;e++){var n=t.charCodeAt(e);127>=n?this.writeByte(n):2047>=n?(this._ensureWrite(this._pos_+2),this._u8d_.set([192|n>>6,128|63&n],this._pos_),this._pos_+=2):65535>=n?(this._ensureWrite(this._pos_+3),this._u8d_.set([224|n>>12,128|n>>6&63,128|63&n],this._pos_),this._pos_+=3):(this._ensureWrite(this._pos_+4),this._u8d_.set([240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n],this._pos_),this._pos_+=4)}},e.writeUTFString=function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;this._d_.setUint16(e,i,this._xd_)},e.readUTFString=function(){return this.readUTFBytes(this.getUint16())},e.getUTFString=function(){return this.readUTFString()},e.readUTFBytes=function(t){if(void 0===t&&(t=-1),0===t)return"";var e=this.bytesAvailable;if(t>e)throw"readUTFBytes error - Out of bounds";return t=t>0?t:e,this._rUTF(t)},e.getUTFBytes=function(t){return void 0===t&&(t=-1),this.readUTFBytes(t)},e.writeByte=function(t){this._ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},e.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},e.getByte=function(){return this.readByte()},e._ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)},e.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),0>e||0>i)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this._ensureWrite(this._pos_+i);var n=new Uint8Array(t);this._u8d_.set(n.subarray(e,e+i),this._pos_),this._pos_+=i},__getset(0,e,"buffer",function(){var t=this._d_.buffer;return t.byteLength===this._length?t:t.slice(0,this._length)}),__getset(0,e,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_="littleEndian"===t}),__getset(0,e,"length",function(){return this._length},function(t){this._allocated_<t?this._resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this._resizeBuffer(this._allocated_=t),this._length=t}),__getset(0,e,"pos",function(){return this._pos_},function(t){this._pos_=t}),__getset(0,e,"bytesAvailable",function(){return this._length-this._pos_}),t.getSystemEndian=function(){if(!t._sysEndian){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,!0),t._sysEndian=256===new Int16Array(e)[0]?"littleEndian":"bigEndian"}return t._sysEndian},t.BIG_ENDIAN="bigEndian",t.LITTLE_ENDIAN="littleEndian",t._sysEndian=null,t}(),CacheManger=function(){function t(){}return __class(t,"laya.utils.CacheManger"),t.regCacheByFunction=function(e,i){t.unRegCacheByFunction(e,i);var n;n={tryDispose:e,getCacheList:i},t._cacheList.push(n)},t.unRegCacheByFunction=function(e,i){var n=0,r=0;for(r=t._cacheList.length,n=0;r>n;n++)if(t._cacheList[n].tryDispose==e&&t._cacheList[n].getCacheList==i)return t._cacheList.splice(n,1),void 0},t.forceDispose=function(){var e=0,i=t._cacheList.length;for(e=0;i>e;e++)t._cacheList[e].tryDispose(!0)},t.beginCheck=function(e){void 0===e&&(e=15e3),Laya.timer.loop(e,null,t._checkLoop)},t.stopCheck=function(){Laya.timer.clear(null,t._checkLoop)},t._checkLoop=function(){var e=t._cacheList;if(!(e.length<1)){var i=Browser.now(),n=0,r=0;for(r=n=e.length;n>0&&(t._index++,t._index=t._index%r,e[t._index].tryDispose(!1),!(Browser.now()-i>t.loopTimeLimit));)n--}},t.loopTimeLimit=2,t._cacheList=[],t._index=0,t}(),ClassUtils=function(){function t(){}return __class(t,"laya.utils.ClassUtils"),t.regClass=function(e,i){t._classMap[e]=i},t.regShortClassName=function(e){for(var i=0;i<e.length;i++){var n=e[i],r=n.name;t._classMap[r]=n}},t.getRegClass=function(e){return t._classMap[e]},t.getClass=function(e){var i=t._classMap[e]||e;return"string"==typeof i?Laya.__classmap[i]||Laya[e]:i},t.getInstance=function(e){var i=t.getClass(e);return i?new i:(console.warn("[error] Undefined class:",e),null)},t.createByJson=function(e,i,n,r,a){"string"==typeof e&&(e=JSON.parse(e));var s=e.props;if(!i&&(i=a?a.runWith(e):t.getInstance(s.runtime||e.type),!i))return null;var o=e.child;if(o)for(var l=0,_=o.length;_>l;l++){var h=o[l];if("render"!==h.props.name&&"render"!==h.props.renderType||!i._$set_itemRender)if("Graphic"==h.type)t._addGraphicsToSprite(h,i);else if(t._isDrawType(h.type))t._addGraphicToSprite(h,i,!0);else{var u=t.createByJson(h,null,n,r,a);"Script"===h.type?u.hasOwnProperty("owner")?u.owner=i:u.hasOwnProperty("target")&&(u.target=i):"mask"==h.props.renderType?i.mask=u:i.addChild(u)}else i.itemRender=h}if(s)for(var c in s){var d=s[c];"var"===c&&n?n[d]=i:d instanceof Array&&"function"==typeof i[c]?i[c].apply(i,d):i[c]=d}return r&&e.customProps&&r.runWith([i,e]),i.created&&i.created(),i},t._addGraphicsToSprite=function(e,i){var n=e.child;if(n&&!(n.length<1)){var r=t._getGraphicsFromSprite(e,i),a=0,s=0;e.props&&(a=t._getObjVar(e.props,"x",0),s=t._getObjVar(e.props,"y",0)),0!=a&&0!=s&&r.translate(a,s);var o=0,l=0;for(l=n.length,o=0;l>o;o++)t._addGraphicToGraphics(n[o],r);0!=a&&0!=s&&r.translate(-a,-s)}},t._addGraphicToSprite=function(e,i,n){void 0===n&&(n=!1);var r=n?t._getGraphicsFromSprite(e,i):i.graphics;t._addGraphicToGraphics(e,r)},t._getGraphicsFromSprite=function(t,e){if(!t||!t.props)return e.graphics;var i=t.props.renderType;if("hit"===i||"unHit"===i){var n=e._style.hitArea||(e.hitArea=new HitArea);n[i]||(n[i]=new Graphics);var r=n[i]}return r||(r=e.graphics),r},t._getTransformData=function(e){var i;(e.hasOwnProperty("pivotX")||e.hasOwnProperty("pivotY"))&&(i=i||new Matrix,i.translate(-t._getObjVar(e,"pivotX",0),-t._getObjVar(e,"pivotY",0)));{var n=t._getObjVar(e,"scaleX",1),r=t._getObjVar(e,"scaleY",1),a=t._getObjVar(e,"rotation",0);t._getObjVar(e,"skewX",0),t._getObjVar(e,"skewY",0)}return(1!=n||1!=r||0!=a)&&(i=i||new Matrix,i.scale(n,r),i.rotate(.0174532922222222*a)),i},t._addGraphicToGraphics=function(e,i){var n;if(n=e.props){var r;if(r=t.DrawTypeDic[e.type]){var a=i,s=t._getParams(n,r[1],r[2],r[3]),o=t._tM;(o||1!=t._alpha)&&(a.save(),o&&a.transform(o),1!=t._alpha&&a.alpha(t._alpha)),a[r[0]].apply(a,s),(o||1!=t._alpha)&&a.restore()}}},t._adptLineData=function(t){return t[2]=parseFloat(t[0])+parseFloat(t[2]),t[3]=parseFloat(t[1])+parseFloat(t[3]),t},t._adptTextureData=function(t){return t[0]=Loader.getRes(t[0]),t},t._adptLinesData=function(e){return e[2]=t._getPointListByStr(e[2]),e},t._isDrawType=function(e){return"Image"===e?!1:t.DrawTypeDic.hasOwnProperty(e)},t._getParams=function(e,i,n,r){void 0===n&&(n=0);var a=t._temParam;a.length=i.length;var s=0,o=0;for(o=i.length,s=0;o>s;s++)a[s]=t._getObjVar(e,i[s][0],i[s][1]);t._alpha=t._getObjVar(e,"alpha",1);var l;return l=t._getTransformData(e),l?(n||(n=0),l.translate(a[n],a[n+1]),a[n]=a[n+1]=0,t._tM=l):t._tM=null,r&&t[r]&&(a=t[r](a)),a},t._getPointListByStr=function(t){var e=t.split(","),i=0,n=0;for(n=e.length,i=0;n>i;i++)e[i]=parseFloat(e[i]);return e},t._getObjVar=function(t,e,i){return t.hasOwnProperty(e)?t[e]:i},t._temParam=[],t._classMap={Sprite:Sprite,Scene:Scene,Text:Text,Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivParser",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement",link:"laya.html.dom.HTMLLinkElement"},t._tM=null,t._alpha=0/0,__static(t,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),t}(),Color=function(){function t(e){if(this.arrColor=[],null==e)return this.strColor="#00000000",this.numColor=0,this.arrColor=[0,0,0,0],void 0;var i=0,n=0,r=0;if("string"==typeof e)if(e.indexOf("rgba(")>=0){var a=e,s=0,o=0;for(s=a.indexOf("("),o=a.indexOf(")"),a=a.substring(s+1,o),this.arrColor=a.split(","),n=this.arrColor.length,i=0;n>i;i++)this.arrColor[i]=parseFloat(this.arrColor[i]);r=256*(256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2])+Math.round(255*this.arrColor[3]),this.strColor=e}else{if(this.strColor=e,"#"===e.charAt(0)&&(e=e.substr(1)),n=e.length,3===n||4===n){var l="";for(i=0;n>i;i++)l+=e[i]+e[i];e=l}r=parseInt(e,16)}else r=e,this.strColor=Utils.toHexColor(r);this.strColor.indexOf("rgba")>=0||9===this.strColor.length?(this.arrColor=[((4278190080&r)>>>24)/255,((16711680&r)>>16)/255,((65280&r)>>8)/255,(255&r)/255],this.numColor=(4278190080&r)>>>24|(16711680&r)>>8|(65280&r)<<8|(255&r)<<24):(this.arrColor=[((16711680&r)>>16)/255,((65280&r)>>8)/255,(255&r)/255,1],this.numColor=4278190080|(16711680&r)>>16|65280&r|(255&r)<<16),this.arrColor.__id=++t._COLODID}return __class(t,"laya.utils.Color"),t._initDefault=function(){t._DEFAULT={};for(var e in t._COLOR_MAP)t._SAVE[e]=t._DEFAULT[e]=new t(t._COLOR_MAP[e]);return t._DEFAULT},t._initSaveMap=function(){t._SAVE_SIZE=0,t._SAVE={};for(var e in t._DEFAULT)t._SAVE[e]=t._DEFAULT[e]},t.create=function(e){var i=e+"",n=t._SAVE[i];return null!=n?n:(t._SAVE_SIZE<1e3&&t._initSaveMap(),t._SAVE[i]=new t(e))},t._SAVE={},t._SAVE_SIZE=0,t._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#808080"},t._DEFAULT=t._initDefault(),t._COLODID=1,t}(),Dragging=function(){function t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}__class(t,"laya.utils.Dragging");var e=t.prototype;return e.start=function(t,e,i,n,r,a,s,o){void 0===o&&(o=.92),this.clearTimer(),this.target=t,this.area=e,this.hasInertia=i,this.elasticDistance=e?n:0,this.elasticBackTime=r,this.data=a,this._disableMouseEvent=s,this.ratio=o,this._parent=1!=t.globalScaleX||1!=t.globalScaleY?t.parent:Laya.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,Laya.stage.on("mouseup",this,this.onStageMouseUp),Laya.stage.on("mouseout",this,this.onStageMouseUp),Laya.timer.frameLoop(1,this,this.loop)},e.clearTimer=function(){Laya.timer.clear(this,this.loop),Laya.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},e.stop=function(){this._dragging&&(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},e.loop=function(){var t=this._parent.getMousePoint(),e=t.x,i=t.y,n=e-this._lastX,r=i-this._lastY;if(this._clickOnly){if(!(Math.abs(n*Laya.stage._canvasTransform.getScaleX())>1||Math.abs(r*Laya.stage._canvasTransform.getScaleY())>1))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),MouseManager.instance.disableMouseEvent=this._disableMouseEvent}else this._offsets.push(n,r);(0!==n||0!==r)&&(this._lastX=e,this._lastY=i,this.target.x+=n*this._elasticRateX,this.target.y+=r*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},e.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target._x<this.area.x)var t=this.area.x-this.target._x;else t=this.target._x>this.area.x+this.area.width?this.target._x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target._y<this.area.y)var e=this.area.y-this.target.y;else e=this.target._y>this.area.y+this.area.height?this.target._y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}},e.backToArea=function(){this.target.x=Math.min(Math.max(this.target._x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target._y,this.area.y),this.area.y+this.area.height)},e.onStageMouseUp=function(){if(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),Laya.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var t=this._offsets.length,e=Math.min(t,6),i=this._offsets.length-e,n=t-1;n>i;n--)this._offsetY+=this._offsets[n--],this._offsetX+=this._offsets[n];this._offsetX=this._offsetX/e*2,this._offsetY=this._offsetY/e*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset),Laya.timer.frameLoop(1,this,this.tweenMove)}else this.elasticDistance>0?this.checkElastic():this.clear()},e.checkElastic=function(){var t=0/0,e=0/0;if(this.target.x<this.area.x?t=this.area.x:this.target._x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target._y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=Tween.to(this.target,i,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,!1,!1)}},e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(Laya.timer.clear(this,this.tweenMove),this.elasticDistance>0?this.checkElastic():this.clear())
},e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event("dragend",this.data)}},t}(),Ease=function(){function t(){}return __class(t,"laya.utils.Ease"),t.linearNone=function(t,e,i,n){return i*t/n+e},t.linearIn=function(t,e,i,n){return i*t/n+e},t.linearInOut=function(t,e,i,n){return i*t/n+e},t.linearOut=function(t,e,i,n){return i*t/n+e},t.bounceIn=function(e,i,n,r){return n-t.bounceOut(r-e,0,n,r)+i},t.bounceInOut=function(e,i,n,r){return.5*r>e?.5*t.bounceIn(2*e,0,n,r)+i:.5*t.bounceOut(2*e-r,0,n,r)+.5*n+i},t.bounceOut=function(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},t.backIn=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},t.backInOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=.5*n)<1?.5*i*t*t*(((r*=1.525)+1)*t-r)+e:i/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+e},t.backOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},t.elasticIn=function(e,i,n,r,a,s){void 0===a&&(a=0),void 0===s&&(s=0);var o;return 0==e?i:1==(e/=r)?i+n:(s||(s=.3*r),!a||n>0&&n>a||0>n&&-n>a?(a=n,o=s/4):o=s/t.PI2*Math.asin(n/a),-(a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*t.PI2/s))+i)},t.elasticInOut=function(e,i,n,r,a,s){void 0===a&&(a=0),void 0===s&&(s=0);var o;return 0==e?i:2==(e/=.5*r)?i+n:(s||(s=.3*r*1.5),!a||n>0&&n>a||0>n&&-n>a?(a=n,o=s/4):o=s/t.PI2*Math.asin(n/a),1>e?-.5*a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*t.PI2/s)+i:a*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*t.PI2/s)*.5+n+i)},t.elasticOut=function(e,i,n,r,a,s){void 0===a&&(a=0),void 0===s&&(s=0);var o;return 0==e?i:1==(e/=r)?i+n:(s||(s=.3*r),!a||n>0&&n>a||0>n&&-n>a?(a=n,o=s/4):o=s/t.PI2*Math.asin(n/a),a*Math.pow(2,-10*e)*Math.sin((e*r-o)*t.PI2/s)+n+i)},t.strongIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},t.strongInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},t.strongOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},t.sineInOut=function(t,e,i,n){return.5*-i*(Math.cos(Math.PI*t/n)-1)+e},t.sineIn=function(e,i,n,r){return-n*Math.cos(e/r*t.HALF_PI)+n+i},t.sineOut=function(e,i,n,r){return n*Math.sin(e/r*t.HALF_PI)+i},t.quintIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},t.quintInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},t.quintOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},t.quartIn=function(t,e,i,n){return i*(t/=n)*t*t*t+e},t.quartInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e},t.quartOut=function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},t.cubicIn=function(t,e,i,n){return i*(t/=n)*t*t+e},t.cubicInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e},t.cubicOut=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},t.quadIn=function(t,e,i,n){return i*(t/=n)*t+e},t.quadInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e},t.quadOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},t.expoIn=function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},t.expoInOut=function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=.5*n)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(-Math.pow(2,-10*--t)+2)+e},t.expoOut=function(t,e,i,n){return t==n?e+i:i*(-Math.pow(2,-10*t/n)+1)+e},t.circIn=function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},t.circInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e},t.circOut=function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},t.HALF_PI=.5*Math.PI,t.PI2=2*Math.PI,t}(),HitArea=function(){function t(){this._hit=null,this._unHit=null}__class(t,"laya.utils.HitArea");var e=t.prototype;return e.contains=function(e,i){return t._isHitGraphic(e,i,this.hit)?!t._isHitGraphic(e,i,this.unHit):!1},__getset(0,e,"hit",function(){return this._hit||(this._hit=new Graphics),this._hit},function(t){this._hit=t}),__getset(0,e,"unHit",function(){return this._unHit||(this._unHit=new Graphics),this._unHit},function(t){this._unHit=t}),t._isHitGraphic=function(e,i,n){if(!n)return!1;var r=n.cmds;if(!r&&n._one&&(r=t._cmds,r.length=1,r[0]=n._one),!r)return!1;var a=0,s=0;s=r.length;var o;for(a=0;s>a;a++)if(o=r[a]){var l=Render._context;switch(o.callee){case l._translate:case 6:e-=o[0],i-=o[1]}if(t._isHitCmd(e,i,o))return!0}return!1},t._isHitCmd=function(e,i,n){if(!n)return!1;var r=Render._context,a=!1;switch(n.callee){case r._drawRect:case 13:t._rect.setTo(n[0],n[1],n[2],n[3]),a=t._rect.contains(e,i);break;case r._drawCircle:case r._fillCircle:case 14:var s=0/0;e-=n[0],i-=n[1],s=e*e+i*i,a=s<n[2]*n[2];break;case r._drawPoly:case 18:e-=n[0],i-=n[1],a=t._ptInPolygon(e,i,n[2])}return a},t._ptInPolygon=function(e,i,n){var r=t._ptPoint;r.setTo(e,i);var a=0,s=0/0,o=0/0,l=0/0,_=0/0,h=0;h=n.length;for(var u=0;h>u;u+=2)if(s=n[u],o=n[u+1],l=n[(u+2)%h],_=n[(u+3)%h],o!=_&&!(r.y<Math.min(o,_)||r.y>=Math.max(o,_))){var c=(r.y-o)*(l-s)/(_-o)+s;c>r.x&&a++}return a%2==1},t._cmds=[],__static(t,["_rect",function(){return this._rect=new Rectangle},"_ptPoint",function(){return this._ptPoint=new Point}]),t}(),HTMLChar=function(){function t(){this.reset()}__class(t,"laya.utils.HTMLChar");var e=t.prototype;return e.setData=function(e,i,n,r){return this.char=e,this.charNum=e.charCodeAt(0),this.x=this.y=0,this.width=i,this.height=n,this.style=r,this.isWord=!t._isWordRegExp.test(e),this},e.reset=function(){return this.x=this.y=this.width=this.height=0,this.isWord=!1,this.char=null,this.charNum=0,this.style=null,this},e.recover=function(){Pool.recover("HTMLChar",this.reset())},e._isChar=function(){return!0},e._getCSSStyle=function(){return this.style},t.create=function(){return Pool.getItemByClass("HTMLChar",t)},t._isWordRegExp=new RegExp("[\\w.]",""),t}(),PerfData=function(){function t(t,e,i,n){this.id=0,this.name=null,this.color=0,this.scale=1,this.datapos=0,this.datas=new Array(PerfHUD.DATANUM),this.id=t,this.color=e,this.name=i,this.scale=n}__class(t,"laya.utils.PerfData");var e=t.prototype;return e.addData=function(t){this.datas[this.datapos]=t,this.datapos++,this.datapos%=PerfHUD.DATANUM},t}(),Pool=function(){function t(){}return __class(t,"laya.utils.Pool"),t.getPoolBySign=function(e){return t._poolDic[e]||(t._poolDic[e]=[])},t.clearBySign=function(e){t._poolDic[e]&&(t._poolDic[e].length=0)},t.recover=function(e,i){i.__InPool||(i.__InPool=!0,t.getPoolBySign(e).push(i))},t.getItemByClass=function(e,i){var n=t.getPoolBySign(e);if(n.length){var r=n.pop();r.__InPool=!1}else r=new i;return r},t.getItemByCreateFun=function(e,i){var n=t.getPoolBySign(e),r=n.length?n.pop():i();return r.__InPool=!1,r},t.getItem=function(e){var i=t.getPoolBySign(e),n=i.length?i.pop():null;return n&&(n.__InPool=!1),n},t.POOLSIGN="__InPool",t._poolDic={},t}(),RunDriver=function(){function t(){}return __class(t,"laya.utils.RunDriver"),t.enableNative=function(){LayaGLRunner.uploadVertexBufferAttributes=LayaGLRunner.uploadShaderAttributesForNative,LayaGLRunner.uploadShaderUniforms=LayaGLRunner.uploadShaderUniformsForNative;var t=Sprite;t.prototype.render=t.prototype.renderToNative,t.prototype.repaint=t.prototype.repaintForNative,t.prototype.parentRepaint=t.prototype.parentRepaintForNative;var e=Stage;if(e.prototype.repaint=e.prototype.repaintForNative,window.conch){CommandEncoder=window.GLCommandEncoder;var i=window.LayaGLContext.prototype,n=LayaGL.prototype;LayaGL=window.LayaGLContext,i.drawImage=n.drawImage,i.drawTexture=n.drawTexture,i.fillText=n.fillText,i.save=n.save,i.restore=n.restore,i.translate=n.translate,i.scale=n.scale,i.rotate=n.rotate,i.transform=n.transform}ConchSpriteAdpt.init()},t.FILTER_ACTIONS=[],t.getIncludeStr=function(){return null},t.createShaderCondition=function(t){var e="(function() {return "+t+";})";return Browser.window.eval(e)},t.fontMap=[],t.measureText=function(e,i){var n=t.hanzi.test(e);if(n&&t.fontMap[i])return t.fontMap[i];var r=Browser.context;r.font=i;var a=r.measureText(e);return n&&(t.fontMap[i]=a),a},t.flashFlushImage=function(){},t.drawToCanvas=function(){return null},t.createParticleTemplate2D=null,t.createGLTextur=null,t.createWebGLContext2D=null,t.changeWebGLSize=function(){},t.createRenderSprite=function(t,e){return new RenderSprite(t,e)},t.createFilterAction=function(){return new ColorFilterAction},t.createGraphics=function(){return new Graphics},t.clear=function(){Render.isConchApp||Render._context.clear()},t.getTexturePixels=function(){return null},t.skinAniSprite=function(){return null},t.cancelLoadByUrl=function(){},__static(t,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),t}(),SceneUtils=function(){function t(){}var e,i;return __class(t,"laya.utils.SceneUtils"),t.getBindFun=function(e){var i=t._funMap.get(e);if(null==i){var n='"'+e+'"';n=n.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"');var r="(function(data){if(data==null)return;with(data){try{\nreturn "+n+"\n}catch(e){}}})";i=Browser.window.eval(r),t._funMap.set(e,i)}return i},t.createByData=function(e,n){var r=i.create();if(r._root=e,t.createComp(n,e,e,null,r),n.animations){var a,s,o=[],l=n.animations,_=0,h=l.length;for(_=0;h>_;_++){switch(a=new FrameAnimation,s=l[_],a._setUp(r._idMap,s),e[s.name]=a,a._setControlNode(e),s.action){case 1:a.play(0,!1);break;case 2:a.play(0,!0)}o.push(a)}e._aniList=o}e._width>0&&null==n.props.hitTestPrior&&!e.mouseThrough&&(e.hitTestPrior=!0),r.beginLoad()},t.createComp=function(e,i,n,r,a){if(i=i||t.getCompInstance(e),!i)return e.props&&e.props.runtime?console.warn("runtime not found:"+e.props.runtime):console.warn("can not create:"+e.type),null;var s=e.child;if(s)for(var o="List"==i._$componentType,l=0,_=s.length;_>l;l++){var h=s[l];if(!i.hasOwnProperty("itemRender")||"render"!=h.props.name&&"render"!==h.props.renderType)if("Graphic"==h.type)ClassUtils._addGraphicsToSprite(h,i);else if(ClassUtils._isDrawType(h.type))ClassUtils._addGraphicToSprite(h,i,!0);else{if(o){var u=[],c=t.createComp(h,null,n,u,a);u.length&&(c._$bindData=u)}else c=t.createComp(h,null,n,r,a);"Script"==h.type?c instanceof laya.components.Component?i._addComponentInstance(c,!1):"owner"in c?c.owner=i:"target"in c&&(c.target=i):"mask"==h.props.renderType||"mask"==h.props.name?i.mask=c:c instanceof laya.display.Sprite&&i.addChild(c)}else i.itemRender=h}var d=e.props;for(var f in d){var m=d[f];"string"==typeof m&&(m.indexOf("@node:")>=0||m.indexOf("@Prefab:")>=0)?a&&a.addNodeRef(i,f,m):t.setCompValue(i,f,m,n,r)}return i._afterInited&&(a?a.addInitItem(i):i._afterInited()),e.compId&&a&&a._idMap&&(a._idMap[e.compId]=i),i},t.setCompValue=function(i,n,r,a,s){if("string"==typeof r&&r.indexOf("${")>-1){if(t._sheet||(t._sheet=ClassUtils.getClass("laya.data.Table")),!t._sheet)return console.warn("Can not find class Sheet"),void 0;if(s)s.push(i,n,r);else if(a){-1==r.indexOf("].")&&(r=r.replace(".","[0]."));var o=new e(i,n,r);o.exe(a);for(var l,_,h=r.replace(/\[.*?\]\./g,".");null!=(l=t._parseWatchData.exec(h));){for(var u=l[1];null!=(_=t._parseKeyWord.exec(u));){var c=_[0],d=a._watchMap[c]||(a._watchMap[c]=[]);d.push(o),t._sheet.I.notifer.on(c,a,a.changeData,[c])}d=a._watchMap[u]||(a._watchMap[u]=[]),d.push(o),t._sheet.I.notifer.on(u,a,a.changeData,[u])}}}else"var"===n&&a?a[r]=i:i[n]="true"===r?!0:"false"===r?!1:r},t.getCompInstance=function(t){var e=t.props&&t.props.runtime||t.type,i=ClassUtils.getClass(e);if(!i)throw"Can not find class "+e;return t.props&&t.props.hasOwnProperty("renderType")&&"instance"==t.props.renderType?i.instance:new i},t._sheet=null,__static(t,["_funMap",function(){return this._funMap=new WeakObject},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),t.__init$=function(){e=function(){function e(t,e,i){this.comp=null,this.prop=null,this.value=null,this.comp=t,this.prop=e,this.value=i}__class(e,"");var i=e.prototype;return i.exe=function(e){var i=t.getBindFun(this.value);this.comp[this.prop]=i.call(this,e)},e}(),i=function(){function t(){this._nodeRefList=null,this._initList=null,this._loadList=null,this._idMap=null,this._root=null}__class(t,"");var e=t.prototype;return e.reset=function(){this._nodeRefList=null,this._initList=null,this._idMap=null,this._loadList=null,this._root=null},e.recover=function(){this.reset(),Pool.recover("InitTool",this)},e.addLoadRes=function(t,e){this._loadList||(this._loadList=[]),e?this._loadList.push({url:t,type:e}):this._loadList.push(t)},e.addNodeRef=function(t,e,i){this._nodeRefList||(this._nodeRefList=[]),this._nodeRefList.push([t,e,i]),i.indexOf("@Prefab:")>=0&&this.addLoadRes(i.replace("@Prefab:",""),"json")},e.setNodeRef=function(){if(this._nodeRefList){if(!this._idMap)return this._nodeRefList=null,void 0;var t=0,e=0;e=this._nodeRefList.length;var i;for(t=0;e>t;t++)i=this._nodeRefList[t],i[0][i[1]]=this.getReferData(i[2]);this._nodeRefList=null}},e.getReferData=function(t){if(t.indexOf("@Prefab:")>=0){var e;return e=new Prefab,e.json=Loader.getRes(t.replace("@Prefab:","")),e}if(t.indexOf("@arr:")>=0){t=t.replace("@arr:","");var i;i=t.split(",");var n,r=0,a=0;for(a=i.length,r=0;a>r;r++)n=i[r],i[r]=n?this._idMap[n.replace("@node:","")]:null;return i}return this._idMap[t.replace("@node:","")]},e.addInitItem=function(t){this._initList||(this._initList=[]),this._initList.push(t)},e.doInits=function(){if(this._initList){var t=0,e=0;for(e=this._initList.length,t=0;e>t;t++)this._initList[t]._afterInited();this._initList=null}},e.finish=function(){this.setNodeRef(),this.doInits(),this._root&&this._root._awake&&this._root._awake(),this.recover()},e.beginLoad=function(){!this._loadList||this._loadList.length<1?this.finish():Laya.loader.load(this._loadList,Handler.create(this,this.finish))},t.create=function(){var e=Pool.getItemByClass("InitTool",t);return e._idMap=[],e},t}()},t}(),Stat=function(){function t(){}return __class(t,"laya.utils.Stat"),__getset(1,t,"onclick",null,function(e){t._sp&&t._sp.on("click",t._sp,e),t._canvas&&(t._canvas.source.onclick=e,t._canvas.source.style.pointerEvents="")}),t.show=function(e,i){return void 0===e&&(e=0),void 0===i&&(i=0),Render.isConchApp?(Browser.window.conch.showFPS&&Browser.window.conch.showFPS(e,i),void 0):(Browser.onMiniGame||Browser.onLimixiu||(t._useCanvas=!0),t._show=!0,t._fpsData.length=60,t._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},t._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},t._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"},t._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},Render.isWebGL?(t._view[4]={title:"Shader",value:"shaderCall",color:"white",units:"int"},Render.is3DMode?(t._view[0].title="FPS(3D)",t._view[5]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},t._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},t._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"}):(t._view[0].title="FPS(WebGL)",t._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"})):t._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},t._useCanvas?t.createUIPre(e,i):t.createUI(e,i),t.enable(),void 0)},t.createUIPre=function(e,i){var n=Browser.pixelRatio;t._width=130*n,t._vx=75*n,t._height=n*(12*t._view.length+3*n)+4,t._fontSize=12*n;for(var r=0;r<t._view.length;r++)t._view[r].x=4,t._view[r].y=r*t._fontSize+2*n;t._canvas||(t._canvas=new HTMLCanvas("2D"),t._canvas.size(t._width,t._height),t._ctx=t._canvas.getContext("2d"),t._ctx.textBaseline="top",t._ctx.font=t._fontSize+"px Sans-serif",t._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+e+"px;top:"+i+"px;width:"+t._width/n+"px;height:"+t._height/n+"px;"),t._first=!0,t.loop(),t._first=!1,Browser.container.appendChild(t._canvas.source)},t.createUI=function(e,i){var n=t._sp,r=Browser.pixelRatio;n||(n=new Sprite,t._leftText=new Text,t._leftText.pos(5,5),t._leftText.color="#ffffff",n.addChild(t._leftText),t._txt=new Text,t._txt.pos(80*r,5),t._txt.color="#ffffff",n.addChild(t._txt),t._sp=n),n.pos(e,i);for(var a="",s=0;s<t._view.length;s++){var o=t._view[s];a+=o.title+"\n"}t._leftText.text=a;var l=138*r,_=r*(12*t._view.length+3*r)+4;t._txt.fontSize=t._fontSize*r,t._leftText.fontSize=t._fontSize*r,n.size(l,_),n.graphics.clear(),n.graphics.alpha(.5),n.graphics.drawRect(0,0,l,_,"#999999"),n.graphics.alpha(2),t.loop()},t.enable=function(){Laya.timer.frameLoop(1,t,t.loop)},t.hide=function(){t._show=!1,Laya.timer.clear(t,t.loop),t._canvas&&Browser.removeElement(t._canvas.source)},t.clear=function(){t.trianglesFaces=t.drawCall=t.shaderCall=t.spriteCount=t.spriteRenderUseCacheCount=t.treeNodeCollision=t.treeSpriteCollision=t.canvasNormal=t.canvasBitmap=t.canvasReCache=0},t.loop=function(){t._count++;var e=Browser.now();if(!(e-t._timer<1e3)){var i=t._count;if(t.FPS=Math.round(1e3*i/(e-t._timer)),t._show){t.trianglesFaces=Math.round(t.trianglesFaces/i),t._useCanvas?(t.drawCall=Math.round(t.drawCall/i),t.shaderCall=Math.round(t.shaderCall/i),t.spriteCount=Math.round(t.spriteCount/i)-1):(t.drawCall=Math.round(t.drawCall/i)-1,t.shaderCall=Math.round(t.shaderCall/i),t.spriteCount=Math.round(t.spriteCount/i)-4),t.spriteRenderUseCacheCount=Math.round(t.spriteRenderUseCacheCount/i),t.canvasNormal=Math.round(t.canvasNormal/i),t.canvasBitmap=Math.round(t.canvasBitmap/i),t.canvasReCache=Math.ceil(t.canvasReCache/i),t.treeNodeCollision=Math.round(t.treeNodeCollision/i),t.treeSpriteCollision=Math.round(t.treeSpriteCollision/i);var n=t.FPS>0?Math.floor(1e3/t.FPS).toString():" ";t._fpsStr=t.FPS+(t.renderSlow?" slow":"")+" "+n,t._spriteStr=t.spriteCount+(t.spriteRenderUseCacheCount?"/"+t.spriteRenderUseCacheCount:""),t._canvasStr=t.canvasReCache+"/"+t.canvasNormal+"/"+t.canvasBitmap,t.currentMemorySize=ResourceManager.systemResourceManager.memorySize,t._useCanvas?t.renderInfoPre():t.renderInfo(),t.clear()}t._count=0,t._timer=e}},t.renderInfoPre=function(){if(t._canvas){var e=t._ctx;e.clearRect(t._first?0:t._vx,0,t._width,t._height);for(var i=0;i<t._view.length;i++){var n=t._view[i];t._first&&(e.fillStyle="white",e.fillText(n.title,n.x,n.y)),e.fillStyle=n.color;var r=t[n.value];"M"==n.units&&(r=Math.floor(r/1048576*100)/100+" M"),e.fillText(r+"",n.x+t._vx,n.y)}}},t.renderInfo=function(){for(var e="",i=0;i<t._view.length;i++){var n=t._view[i],r=t[n.value];"M"==n.units&&(r=Math.floor(r/1048576*100)/100+" M"),"K"==n.units&&(r=Math.floor(r/1024*100)/100+" K"),e+=r+"\n"}t._txt.text=e},t.FPS=0,t.loopCount=0,t.shaderCall=0,t.drawCall=0,t.trianglesFaces=0,t.spriteCount=0,t.spriteRenderUseCacheCount=0,t.treeNodeCollision=0,t.treeSpriteCollision=0,t.canvasNormal=0,t.canvasBitmap=0,t.canvasReCache=0,t.renderSlow=!1,t.currentMemorySize=0,t._fpsStr=null,t._canvasStr=null,t._spriteStr=null,t._fpsData=[],t._timer=0,t._count=0,t._view=[],t._fontSize=12,t._txt=null,t._leftText=null,t._sp=null,t._show=!1,t._useCanvas=!1,t._canvas=null,t._ctx=null,t._first=!1,t._vx=0/0,t._width=0,t._height=100,t}(),StringKey=function(){function t(){this._strsToID={},this._idToStrs=[],this._length=0}__class(t,"laya.utils.StringKey");var e=t.prototype;return e.add=function(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)},e.getID=function(t){var e=this._strsToID[t];return null==e?-1:e},e.getName=function(t){var e=this._idToStrs[t];return null==e?void 0:e},t}(),Timer=function(){function t(){this.scale=1,this.currFrame=0,this._mid=1,this._map=[],this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._delta=0,this.currTimer=Browser.now(),this._lastTimer=Browser.now()}var e;__class(t,"laya.utils.Timer");var i=t.prototype;return i._update=function(){if(this.scale<=0)return this._lastTimer=Browser.now(),void 0;var t=this.currFrame=this.currFrame+this.scale,e=Browser.now();this._delta=(e-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;var n=this._handlers;for(this._count=0,s=0,o=n.length;o>s;s++)if(l=n[s],null!==l.method){var r=l.userFrame?t:i;if(r>=l.exeTime)if(l.repeat)if(l.jumpFrame)for(;r>=l.exeTime;)l.exeTime+=l.delay,l.run(!1);else l.exeTime+=l.delay,l.run(!1),r>l.exeTime&&(l.exeTime+=Math.ceil((r-l.exeTime)/l.delay)*l.delay);else l.run(!0)}else this._count++;(this._count>30||t%200===0)&&this._clearHandlers();for(var a=this._laters,s=0,o=a.length-1;o>=s;s++){var l=a[s];null!==l.method&&(this._map[l.key]=null,l.run(!1)),this._recoverHandler(l),s===o&&(o=a.length-1)}a.length=0},i._clearHandlers=function(){for(var t=this._handlers,e=0,i=t.length;i>e;e++){var n=t[e];null!==n.method?this._temp.push(n):this._recoverHandler(n)}this._handlers=this._temp,t.length=0,this._temp=t},i._recoverHandler=function(e){this._map[e.key]==e&&(this._map[e.key]=null),e.clear(),t._pool.push(e)},i._create=function(i,n,r,a,s,o,l){if(!r)return s.apply(a,o),null;if(l){var _=this._getHandler(a,s);if(_)return _.repeat=n,_.userFrame=i,_.delay=r,_.caller=a,_.method=s,_.args=o,_.exeTime=r+(i?this.currFrame:this.currTimer+Browser.now()-this._lastTimer),_}return _=t._pool.length>0?t._pool.pop():new e,_.repeat=n,_.userFrame=i,_.delay=r,_.caller=a,_.method=s,_.args=o,_.exeTime=r+(i?this.currFrame:this.currTimer+Browser.now()-this._lastTimer),this._indexHandler(_),this._handlers.push(_),_},i._indexHandler=function(t){var e=t.caller,i=t.method,n=e?e.$_GID||(e.$_GID=Utils.getGID()):0,r=i.$_TID||(i.$_TID=1e5*this._mid++);t.key=n+r,this._map[t.key]=t},i.once=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!1,!1,t,e,i,n,r)},i.loop=function(t,e,i,n,r,a){void 0===r&&(r=!0),void 0===a&&(a=!1);var s=this._create(!1,!0,t,e,i,n,r);s&&(s.jumpFrame=a)},i.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!1,t,e,i,n,r)},i.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!0,t,e,i,n,r)},i.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+t._pool.length},i.clear=function(t,e){var i=this._getHandler(t,e);i&&(this._map[i.key]=null,i.key=0,i.clear())},i.clearAll=function(t){if(t)for(var e=0,i=this._handlers.length;i>e;e++){var n=this._handlers[e];n.caller===t&&(this._map[n.key]=null,n.key=0,n.clear())}},i._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=Utils.getGID()):0,n=e.$_TID||(e.$_TID=1e5*this._mid++);return this._map[i+n]},i.callLater=function(i,n,r){if(null==this._getHandler(i,n)){if(t._pool.length)var a=t._pool.pop();else a=new e;a.caller=i,a.method=n,a.args=r,this._indexHandler(a),this._laters.push(a)}},i.runCallLater=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))},i.runTimer=function(t,e){this.runCallLater(t,e)},__getset(0,i,"delta",function(){return this._delta}),t._pool=[],t.__init$=function(){e=function(){function t(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}__class(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null},e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,n=this.args;t&&this.clear(),null!=i&&(n?i.apply(e,n):i.call(e))},t}()},t}(),Tween=function(){function t(){this.gid=0}__class(t,"laya.utils.Tween");var e=t.prototype;return e.to=function(t,e,i,n,r,a,s){return void 0===a&&(a=0),void 0===s&&(s=!1),this._create(t,e,i,n,r,a,s,!0,!1,!0)},e.from=function(t,e,i,n,r,a,s){return void 0===a&&(a=0),void 0===s&&(s=!1),this._create(t,e,i,n,r,a,s,!1,!1,!0)},e._create=function(e,i,n,r,a,s,o,l,_,h){if(!e)throw new Error("Tween:target is null");this._target=e,this._duration=n,this._ease=r||i.ease||t.easeNone,this._complete=a||i.complete,this._delay=s,this._props=[],this._usedTimer=0,this._startTimer=Browser.now(),this._usedPool=_,this.update=i.update;var u=e.$_GID||(e.$_GID=Utils.getGID());return t.tweenMap[u]?(o&&t.clearTween(e),t.tweenMap[u].push(this)):t.tweenMap[u]=[this],h?0>=s?this.firstStart(e,i,l):Laya.timer.once(s,this,this.firstStart,[e,i,l]):this._initProps(e,i,l),this},e.firstStart=function(t,e,i){return t.destroyed?(this.clear(),void 0):(this._initProps(t,e,i),this._beginLoop(),void 0)},e._initProps=function(t,e,i){for(var n in e)if("number"==typeof t[n]){var r=i?t[n]:e[n],a=i?e[n]:t[n];this._props.push([n,r,a-r]),i||(t[n]=r)}},e._beginLoop=function(){Laya.timer.frameLoop(1,this,this._doEase)},e._doEase=function(){this._updateEase(Browser.now())},e._updateEase=function(e){var i=this._target;if(i){if(i.destroyed)return t.clearTween(i);var n=this._usedTimer=e-this._startTimer-this._delay;if(!(0>n)){if(n>=this._duration)return this.complete();for(var r=n>0?this._ease(n,0,1,this._duration):0,a=this._props,s=0,o=a.length;o>s;s++){var l=a[s];i[l[0]]=l[1]+r*l[2]}this.update&&this.update.run()}}},e.complete=function(){if(this._target){Laya.timer.runTimer(this,this.firstStart);for(var t=this._target,e=this._props,i=this._complete,n=0,r=e.length;r>n;n++){var a=e[n];t[a[0]]=a[1]+a[2]}this.update&&this.update.run(),this.clear(),i&&i.run()}},e.pause=function(){Laya.timer.clear(this,this._beginLoop),Laya.timer.clear(this,this._doEase)},e.setStartTime=function(t){this._startTimer=t},e.clear=function(){this._target&&(this._remove(),this._clear())},e._clear=function(){this.pause(),Laya.timer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._usedPool&&(this.update=null,Pool.recover("tween",this))},e.recover=function(){this._usedPool=!0,this._clear()},e._remove=function(){var e=t.tweenMap[this._target.$_GID];if(e)for(var i=0,n=e.length;n>i;i++)if(e[i]===this){e.splice(i,1);break}},e.restart=function(){this.pause(),this._usedTimer=0,this._startTimer=Browser.now();for(var t=this._props,e=0,i=t.length;i>e;e++){var n=t[e];this._target[n[0]]=n[1]}Laya.timer.once(this._delay,this,this._beginLoop)},e.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Browser.now()-this._usedTimer-this._delay,this._beginLoop())},__getset(0,e,"progress",null,function(t){var e=t*this._duration;this._startTimer=Browser.now()-this._delay-e}),t.to=function(e,i,n,r,a,s,o,l){return void 0===s&&(s=0),void 0===o&&(o=!1),void 0===l&&(l=!0),Pool.getItemByClass("tween",t)._create(e,i,n,r,a,s,o,!0,l,!0)},t.from=function(e,i,n,r,a,s,o,l){return void 0===s&&(s=0),void 0===o&&(o=!1),void 0===l&&(l=!0),Pool.getItemByClass("tween",t)._create(e,i,n,r,a,s,o,!1,l,!0)},t.clearAll=function(e){if(e&&e.$_GID){var i=t.tweenMap[e.$_GID];if(i){for(var n=0,r=i.length;r>n;n++)i[n]._clear();i.length=0}}},t.clear=function(t){t.clear()},t.clearTween=function(e){t.clearAll(e)},t.easeNone=function(t,e,i,n){return i*t/n+e},t.tweenMap=[],t}(),Utils=function(){function t(){}return __class(t,"laya.utils.Utils"),t.toRadian=function(e){return e*t._pi2},t.toAngle=function(e){return e*t._pi},t.toHexColor=function(t){if(0>t||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e},t.getGID=function(){return t._gid++},t.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,n=e.length;for(i=0;n>i;i++)t.push(e[i]);return t},t.clearArray=function(t){return t?(t.length=0,t):t},t.copyArray=function(t,e){if(t||(t=[]),!e)return t;t.length=e.length;var i=0,n=e.length;for(i=0;n>i;i++)t[i]=e[i];return t},t.getGlobalRecByPoints=function(t,e,i,n,r){var a;a=Point.create().setTo(e,i),a=t.localToGlobal(a);var s;s=Point.create().setTo(n,r),s=t.localToGlobal(s);var o=Rectangle._getWrapRec([a.x,a.y,s.x,s.y]);return a.recover(),s.recover(),o},t.getGlobalPosAndScale=function(e){return t.getGlobalRecByPoints(e,0,0,1,1)},t.bind=function(t,e){var i=t;return i=t.bind(e)},t.measureText=function(t,e){return RunDriver.measureText(t,e)},t.updateOrder=function(t){if(!t||t.length<2)return!1;for(var e,i=1,n=0,r=t.length,a=0/0;r>i;){for(n=i,e=t[n],a=t[n]._zOrder;--n>-1&&t[n]._zOrder>a;)t[n+1]=t[n];t[n+1]=e,i++}return!0},t.transPointList=function(t,e,i){var n=0,r=t.length;for(n=0;r>n;n+=2)t[n]+=e,t[n+1]+=i},t.parseInt=function(t,e){void 0===e&&(e=0);var i=Browser.window.parseInt(t,e);return isNaN(i)?0:i},t.getFileExtension=function(e){t._extReg.lastIndex=e.lastIndexOf(".");var i=t._extReg.exec(e);return i&&i.length>1?i[1].toLowerCase():null},t.getTransformRelativeToWindow=function(t,e,i){var n=Laya.stage,r=laya.utils.Utils.getGlobalPosAndScale(t),a=n._canvasTransform.clone(),s=a.tx,o=a.ty;a.rotate(-Math.PI/180*Laya.stage.canvasDegree),a.scale(Laya.stage.clientScaleX,Laya.stage.clientScaleY);var l=Laya.stage.canvasDegree%180!=0,_=0/0,h=0/0;l?(_=i+r.y,h=e+r.x,_*=a.d,h*=a.a,90==Laya.stage.canvasDegree?(_=s-_,h+=o):(_+=s,h=o-h)):(_=e+r.x,h=i+r.y,_*=a.a,h*=a.d,_+=s,h+=o),h+=Laya.stage._safariOffsetY;var u=0/0,c=0/0;return l?(u=a.d*r.height,c=a.a*r.width):(u=a.a*r.width,c=a.d*r.height),{x:_,y:h,scaleX:u,scaleY:c}},t.fitDOMElementInArea=function(e,i,n,r,a,s){e._fitLayaAirInitialized||(e._fitLayaAirInitialized=!0,e.style.transformOrigin=e.style.webKittransformOrigin="left top",e.style.position="absolute");var o=t.getTransformRelativeToWindow(i,n,r);e.style.transform=e.style.webkitTransform="scale("+o.scaleX+","+o.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",e.style.width=a+"px",e.style.height=s+"px",e.style.left=o.x+"px",e.style.top=o.y+"px"},t.isOkTextureList=function(t){if(!t)return!1;var e,i=0,n=t.length;for(i=0;n>i;i++)if(e=t[i],!e||!e.source)return!1;return!0},t.isOKCmdList=function(t){if(!t)return!1;var e,i=0,n=t.length;for(i=0;n>i;i++)e=t[i];return!0},t._gid=1,t._pi=180/Math.PI,t._pi2=Math.PI/180,t._extReg=/\.(\w+)\??/g,t.parseXMLFromString=function(t){var e;if(t=t.replace(/>\s+</g,"><"),e=(new DOMParser).parseFromString(t,"text/xml"),e.firstChild.textContent.indexOf("This page contains the following errors")>-1)throw new Error(e.firstChild.firstChild.textContent);return e},t}(),VectorGraphManager=function(){function t(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],Render.isWebGL&&CacheManger.regCacheByFunction(Utils.bind(this.startDispose,this),Utils.bind(this.getCacheList,this))}__class(t,"laya.utils.VectorGraphManager");var e=t.prototype;return e.getId=function(){return this._id++},e.addShape=function(t,e){this.shapeDic[t]=e,this.useDic[t]||(this.useDic[t]=!0)},e.addLine=function(t,e){this.shapeLineDic[t]=e,this.shapeLineDic[t]||(this.shapeLineDic[t]=!0)},e.getShape=function(t){this._checkKey&&null!=this.useDic[t]&&(this.useDic[t]=!0)},e.deleteShape=function(t){this.shapeDic[t]&&(this.shapeDic[t]=null,delete this.shapeDic[t]),this.shapeLineDic[t]&&(this.shapeLineDic[t]=null,delete this.shapeLineDic[t]),null!=this.useDic[t]&&delete this.useDic[t]},e.getCacheList=function(){var t,e=[];for(t in this.shapeDic)e.push(this.shapeDic[t]);for(t in this.shapeLineDic)e.push(this.shapeLineDic[t]);return e},e.startDispose=function(){var t;for(t in this.useDic)this.useDic[t]=!1;this._checkKey=!0},e.endDispose=function(){if(this._checkKey){var t;for(t in this.useDic)this.useDic[t]||this.deleteShape(t);this._checkKey=!1}},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),WeakObject=function(){function t(){this._obj=null,this._obj=t.supportWeakMap?new Browser.window.WeakMap:{},t.supportWeakMap||t._maps.push(this)}__class(t,"laya.utils.WeakObject");var e=t.prototype;return e.set=function(e,i){if(null!=e)if(t.supportWeakMap){var n=e;("string"==typeof e||"number"==typeof e)&&(n=t._keys[e],n||(n=t._keys[e]={k:e})),this._obj.set(n,i)}else"string"==typeof e||"number"==typeof e?this._obj[e]=i:(e.$_GID||(e.$_GID=Utils.getGID()),this._obj[e.$_GID]=i)},e.get=function(e){if(null==e)return null;if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;return this._obj.get(i)}return"string"==typeof e||"number"==typeof e?this._obj[e]:this._obj[e.$_GID]},e.del=function(e){if(null!=e)if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;_obj.delete(i)}else"string"==typeof e||"number"==typeof e?delete this._obj[e]:delete this._obj[this._obj.$_GID]
},e.has=function(e){if(null==e)return!1;if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;return this._obj.has(i)}return"string"==typeof e||"number"==typeof e?null!=this._obj[e]:null!=this._obj[this._obj.$_GID]},t.__init__=function(){t.supportWeakMap=null!=Browser.window.WeakMap,t.supportWeakMap||Laya.timer.loop(t.delInterval,null,t.clearCache)},t.clearCache=function(){for(var e=0,i=t._maps.length;i>e;e++){var n=t._maps[e];n._obj={}}},t.supportWeakMap=!1,t.delInterval=6e5,t._keys={},t._maps=[],__static(t,["I",function(){return this.I=new t}]),t}(),WordText=function(){function t(){this.id=0/0,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null,this.width=-1,this.pageChars=[]}__class(t,"laya.utils.WordText");var e=t.prototype;return e.setText=function(t){this.changed=!0,this._text=t,this.width=-1,this.pageChars=[]},e.toString=function(){return this._text},e.charCodeAt=function(t){return this._text?this._text.charCodeAt(t):0/0},e.charAt=function(t){return this._text?this._text.charAt(t):null},e.cleanCache=function(){this.pageChars=[]},__getset(0,e,"length",function(){return this._text?this._text.length:0}),t}(),FilterActionGL=function(){function t(){}__class(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=function(){},e.setValueMix=function(){},e.apply3d=function(){return null},e.apply=function(){return null},__getset(0,e,"typeMix",function(){return 0}),t}(),Arith=function(){function t(){}return __class(t,"laya.maths.Arith"),t.formatR=function(t){return t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI),t},t.isPOT=function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)},t.setMatToArray=function(t,e){t.a,t.b,t.c,t.d,t.tx+20,t.ty+20,1,e[0]=t.a,e[1]=t.b,e[4]=t.c,e[5]=t.d,e[12]=t.tx,e[13]=t.ty},t}(),BlendMode=function(){function t(){}return __class(t,"laya.webgl.canvas.BlendMode"),t._init_=function(){t.fns=[t.BlendNormal,t.BlendAdd,t.BlendMultiply,t.BlendScreen,t.BlendOverlay,t.BlendLight,t.BlendMask,t.BlendDestinationOut],t.targetFns=[t.BlendNormalTarget,t.BlendAddTarget,t.BlendMultiplyTarget,t.BlendScreenTarget,t.BlendOverlayTarget,t.BlendLightTarget,t.BlendMask,t.BlendDestinationOut]},t.BlendNormal=function(t){WebGLContext.setBlendFunc(t,1,771)},t.BlendAdd=function(t){WebGLContext.setBlendFunc(t,1,772)},t.BlendMultiply=function(t){WebGLContext.setBlendFunc(t,774,771)},t.BlendScreen=function(t){WebGLContext.setBlendFunc(t,1,1)},t.BlendOverlay=function(t){WebGLContext.setBlendFunc(t,1,769)},t.BlendLight=function(t){WebGLContext.setBlendFunc(t,1,1)},t.BlendNormalTarget=function(t){WebGLContext.setBlendFunc(t,1,771)},t.BlendAddTarget=function(t){WebGLContext.setBlendFunc(t,1,772)},t.BlendMultiplyTarget=function(t){WebGLContext.setBlendFunc(t,774,771)},t.BlendScreenTarget=function(t){WebGLContext.setBlendFunc(t,1,1)},t.BlendOverlayTarget=function(t){WebGLContext.setBlendFunc(t,1,769)},t.BlendLightTarget=function(t){WebGLContext.setBlendFunc(t,1,1)},t.BlendMask=function(t){WebGLContext.setBlendFunc(t,0,770)},t.BlendDestinationOut=function(t){WebGLContext.setBlendFunc(t,0,0)},t.activeBlendFunction=null,t.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],t.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},t.NORMAL="normal",t.ADD="add",t.MULTIPLY="multiply",t.SCREEN="screen",t.LIGHT="light",t.OVERLAY="overlay",t.DESTINATIONOUT="destination-out",t.fns=[],t.targetFns=[],t}(),DrawStyle=function(){function t(t){this._color=null,this.setValue(t)}__class(t,"laya.webgl.canvas.DrawStyle");var e=t.prototype;return e.setValue=function(t){this._color=t?t instanceof laya.utils.Color?t:Color.create(t):Color.create("#000000")},e.reset=function(){this._color=Color.create("#000000")},e.toInt=function(){return this._color.numColor},e.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.Color?this._color.numColor===t.numColor:!1},e.toColorStr=function(){return this._color.strColor},t.create=function(e){if(e){var i=e instanceof laya.utils.Color?e:Color.create(e);return i._drawStyle||(i._drawStyle=new t(e))}return t.DEFAULT},t.DEFAULT=new t("#000000"),t}(),Path=function(){function t(){this._x=0,this._y=0,this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}var e;__class(t,"laya.webgl.canvas.Path");var i=t.prototype;return i.beginPath=function(t){this.paths.length=1,this._curPath=this.paths[0]=new e,this._curPath.convex=t},i.closePath=function(){this._curPath.loop=!0},i.newPath=function(){this._curPath=new e,this.paths.push(this._curPath)},i.addPoint=function(t,e){this._curPath.path.push(t,e)},i.getEndPointX=function(){return this._curPath&&this._curPath.path.length>2?this._curPath.path[this._curPath.path.length-2]:0},i.getEndPointY=function(){return this._curPath&&this._curPath.path.length>2?this._curPath.path[this._curPath.path.length-1]:0},i.push=function(t,i){this._curPath?this._curPath.path.length>0&&(this._curPath=new e,this.paths.push(this._curPath)):(this._curPath=new e,this.paths.push(this._curPath));var n=this._curPath;n.path=t.slice(),n.convex=i},i.polygon=function(){},i.setGeomtry=function(){},i.drawLine=function(){},i.update=function(){},i.reset=function(){this.paths.length=0},i.recover=function(){},t.__init$=function(){e=function(){function t(){this.path=[],this.loop=!1,this.convex=!1}return __class(t,""),t}()},t}(),SaveClipRect=function(){function t(){this._clipInfoID=-1,this._transedClipInfo=new Array(6),this._clipRect=new Rectangle}__class(t,"laya.webgl.canvas.save.SaveClipRect");var e=t.prototype;return Laya.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._transedClipInfo[0]=this._transedClipInfo[0],e._transedClipInfo[1]=this._transedClipInfo[1],e._transedClipInfo[2]=this._transedClipInfo[2],e._transedClipInfo[3]=this._transedClipInfo[3],e._transedClipInfo[4]=this._transedClipInfo[4],e._transedClipInfo[5]=this._transedClipInfo[5],this._clipRect.clone(e._clipRect),e._clipInfoID=this._clipInfoID,t.POOL[t.POOL._length++]=this},t.save=function(e){if(131072!=(131072&e._saveMark._saveuse)){e._saveMark._saveuse|=131072;var i=t.POOL,n=i._length>0?i[--i._length]:new t;n._transedClipInfo[0]=e._transedClipInfo[0],n._transedClipInfo[1]=e._transedClipInfo[1],n._transedClipInfo[2]=e._transedClipInfo[2],n._transedClipInfo[3]=e._transedClipInfo[3],n._transedClipInfo[4]=e._transedClipInfo[4],n._transedClipInfo[5]=e._transedClipInfo[5],e._clipRect.clone(n._clipRect),n._clipInfoID=e._clipInfoID;var r=e._save;r[r._length++]=n}},t.POOL=SaveBase._createArray(),t}(),SaveClipRectStencil=function(){function t(){this._contextX=0,this._contextY=0,this._clipRect=new Rectangle,this._rect=new Rectangle,this._matrix=new Matrix}__class(t,"laya.webgl.canvas.save.SaveClipRectStencil");var e=t.prototype;return Laya.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){SubmitStencil.restore(e,this._rect,this._saveMatrix,this._contextX,this._contextY),e._clipRect=this._clipSaveRect,e._curMat=this._saveMatrix,e._x=this._contextX,e._y=this._contextY,t.POOL[t.POOL._length++]=this,e._curSubmit=Submit.RENDERBASE},t.save=function(e,i,n,r,a,s){if(262144!=(262144&e._saveMark._saveuse)){e._saveMark._saveuse|=262144;var o=t.POOL,l=o._length>0?o[--o._length]:new t;l._clipSaveRect=e._clipRect,e._clipRect=l._clipRect.copyFrom(e._clipRect),l._rect.x=n,l._rect.y=r,l._rect.width=a,l._rect.height=s,l._contextX=e._x,l._contextY=e._y,l._saveMatrix=e._curMat,e._curMat.copyTo(l._matrix),e._curMat=l._matrix,l._submitStencil=i;var _=e._save;_[_._length++]=l}},t.POOL=SaveBase._createArray(),t}(),SaveMark=function(){function t(){this._saveuse=0}__class(t,"laya.webgl.canvas.save.SaveMark");var e=t.prototype;return Laya.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!0},e.restore=function(e){e._saveMark=this._preSaveMark,t.POOL[t.POOL._length++]=this},t.Create=function(e){var i=t.POOL,n=i._length>0?i[--i._length]:new t;return n._saveuse=0,n._preSaveMark=e._saveMark,e._saveMark=n,n},t.POOL=SaveBase._createArray(),t}(),SaveTransform=function(){function t(){this._matrix=new Matrix}__class(t,"laya.webgl.canvas.save.SaveTransform");var e=t.prototype;return Laya.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat=this._savematrix,t.POOL[t.POOL._length++]=this},t.save=function(e){var i=e._saveMark;if(2048!==(2048&i._saveuse)){i._saveuse|=2048;var n=t.POOL,r=n._length>0?n[--n._length]:new t;r._savematrix=e._curMat,e._curMat=e._curMat.copyTo(r._matrix);var a=e._save;a[a._length++]=r}},t.POOL=SaveBase._createArray(),t}(),SaveTranslate=function(){function t(){this._mat=new Matrix}__class(t,"laya.webgl.canvas.save.SaveTranslate");var e=t.prototype;return Laya.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._mat.copyTo(e._curMat),t.POOL[t.POOL._length++]=this},t.save=function(e){var i=t.POOL,n=i._length>0?i[--i._length]:new t;e._curMat.copyTo(n._mat);var r=e._save;r[r._length++]=n},t.POOL=SaveBase._createArray(),t}(),CharBook=function(){function t(){this.fontPages=[],this.fontPagesName=[],this._curPage=null,this.tempUV=[0,0,1,0,1,1,0,1],this.fontScale=1,this._curStrPos=0,this.tempMat=new Matrix,t.charbookInst=this,CharPages.charRender=Render.isConchApp?new CharRender_Native:new CharRender_Canvas}__class(t,"laya.webgl.resource.CharBook");var e=t.prototype;return e.selectFont=function(e,i){var n,r=CharPages.getBmpSize(i),a=Math.floor(r/t.gridSize),s=e+a,o=this.fontPagesName.indexOf(s);if(0>o){var l=new CharPages(e,i,r);this.fontPages.push(l),this.fontPagesName.push(s),n=l}else n=this.fontPages[o];return n.selectSize(i,r),n},e.isEmoji=function(e){return t._emojiReg.test(e)},e.getNextChar=function(t){var e=t.length,i=this._curStrPos;if(i>=e)return null;for(var n=i,r=0;e>n;n++){var a=t.charCodeAt(n);if(55296!=(55296&a))if(65038!==a&&65039!==a){if(8205!=a){if(1==r)break;n++;break}r=1}else r=1;else r=1}return this._curStrPos=n,t.substring(i,n)},e.filltext=function(e,i,n,r,a,s,o,l,_,h){if(void 0===h&&(h=0),!(i.length<=0)){var u=Color.create(s),c=o?Color.create(o):null,d=u.numColor,f=c?c.numColor:0;if(t._curFont=a,this.fontScale=1,t.scaleFontWithCtx){var m=e._curMat.getScaleX(),p=e._curMat.getScaleY();if(1e-4>m||.1>p)return;if(m>1||p>1){if(e._curMat.copyTo(this.tempMat),m>p){this.fontScale=m;var g=p/m/m;this.tempMat.a/=m,this.tempMat.b/=m,this.tempMat.c*=g,this.tempMat.d*=g}else{this.fontScale=p;var g=m/p/p;this.tempMat.a*=g,this.tempMat.b*=g,this.tempMat.c/=p,this.tempMat.d/=p}n*=m,n=Math.floor(n+.5),r*=p,r=Math.floor(r+.5)}}var v=FontInContext.create(a),x=v.getFamily(),y=v.getBold()>=0;v.getItalic()>=0&&(e._italicDeg=12),this._curPage=this.selectFont(x,v.size*this.fontScale);var T=n,D=i,E=i,S=0,M=E instanceof WordText,R=t.cacheRenderInfoInWordText&&M?D.pageChars:[];switch(M?(E=D.toString(),S=D.width,0>S&&(S=D.width=this._curPage.getWidth(E))):S=this._curPage.getWidth(E),_){case"center":T=n-S/2;break;case"right":T=n-S;break;default:T=n}if(R){for(var A=!1,C=0,L=R.length;L>C;C++){var I=R[C];if(I){for(var w=0,b=I.length;b>w;w++){var P=I[w];if(P.ri.tex.__destroyed){A=!0;break}}if(A)break}}A&&(R=D.pageChars=[])}if(!R||R.length<=0){var V=0;this._curStrPos=0;for(var O=this.getNextChar(E);O;){var N=this.isEmoji(O),B=this._curPage.getChar(O,!1,0,d,y,!1);if(B.isSpace);else{var F=R[B.tex.id];if(F||(R[B.tex.id]=F=[]),o&&l>0){var U=this._curPage.getChar(O,!1,l,f,y,!1);F=R[U.tex.id],F||(F=[],R[U.tex.id]=F),F.push({ri:U,isEmoji:!1,x:V,color:o,nColor:f})}F.push({ri:B,isEmoji:N,x:V,color:s,nColor:d})}V+=B.width,O=this.getNextChar(E)}}var G=e._drawTextureUseColor;this._drawReSortedWords(e,T,R,r),e._drawTextureUseColor=G,e._italicDeg=0}},e._drawReSortedWords=function(e,i,n,r){for(var a=0,s=0,o=n.length;o>s;s++){var l=n[s];if(l)for(var _=0,h=l.length;h>_;_++){var u=l[_],c=u.ri;c.isSpace||(e._drawTextureUseColor=t.getFontBmpWithColor?!1:!u.isEmoji,a!=u.nColor&&(e.fillStyle=u.color,a=u.nColor),c.touch(),this._drawCharRenderInfo(e,u.ri,i+u.x,r))}}},e._drawCharRenderInfo=function(t,e,i,n){var r=null;1!=this.fontScale&&(r=this.tempMat),t._drawTextureM(e.tex.texture,i-this._curPage.margin_left,n-this._curPage.margin_top,e.bmpWidth,e.bmpHeight,r,1,e.uv),t.touches&&t.touches.push(e)},e.GC=function(){var t=this.fontPages.length;if(t){var e=Stat.loopCount%t;this.fontPages[e].removeLRU()}},t.textureWidth=256,t.cacheRenderInfoInWordText=!0,t.scaleFontWithCtx=!1,t.getFontBmpWithColor=!0,t.gridSize=16,t.debug=!1,t._curFont=null,t.charbookInst=null,t._fontMem=0,__static(t,["_emojiReg",function(){return this._emojiReg=/(?:0\u20E3|1\u20E3|2\u20E3|3\u20E3|4\u20E3|5\u20E3|6\u20E3|7\u20E3|8\u20E3|9\u20E3|#\u20E3|\*\u20E3|\uD83C(?:\uDDE6\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF2|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFD|\uDDFF)|\uDDE7\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFC|\uDDFE|\uDDFF)|\uDDE8\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDE9\uD83C(?:\uDDEA|\uDDEC|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDFF)|\uDDEA\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDED|\uDDF7|\uDDF8|\uDDF9|\uDDFA)|\uDDEB\uD83C(?:\uDDEE|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDF7)|\uDDEC\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF1|\uDDF2|\uDDF3|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFE)|\uDDED\uD83C(?:\uDDF0|\uDDF2|\uDDF3|\uDDF7|\uDDF9|\uDDFA)|\uDDEE\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9)|\uDDEF\uD83C(?:\uDDEA|\uDDF2|\uDDF4|\uDDF5)|\uDDF0\uD83C(?:\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDF2|\uDDF3|\uDDF5|\uDDF7|\uDDFC|\uDDFE|\uDDFF)|\uDDF1\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDEE|\uDDF0|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFE)|\uDDF2\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDF3\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFF)|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C(?:\uDDE6|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF7|\uDDF8|\uDDF9|\uDDFC|\uDDFE)|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C(?:\uDDEA|\uDDF4|\uDDF8|\uDDFA|\uDDFC)|\uDDF8\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDE9|\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFD|\uDDFE|\uDDFF)|\uDDF9\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF9|\uDDFB|\uDDFC|\uDDFF)|\uDDFA\uD83C(?:\uDDE6|\uDDEC|\uDDF2|\uDDF8|\uDDFE|\uDDFF)|\uDDFB\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDEE|\uDDF3|\uDDFA)|\uDDFC\uD83C(?:\uDDEB|\uDDF8)|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C(?:\uDDEA|\uDDF9)|\uDDFF\uD83C(?:\uDDE6|\uDDF2|\uDDFC)))|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2694\u2696\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD79\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED0\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3]|\uD83E[\uDD10-\uDD18\uDD80-\uDD84\uDDC0]/g}]),t}(),CharInternalTexture=function(){function t(t){this._par=null,this._loaded=!0,this.bitmap={},this.bitmap.id=t.id,this._par=t}__class(t,"laya.webgl.resource.CharInternalTexture");var e=t.prototype;return e._getSource=function(){return this._par._source},t}(),CharPages=function(){function t(t,e,i){this.pages=[],this.fontFamily=null,this.fontsize=0,this._slotW=0,this._gridW=0,this._gridNum=0,this._baseSize=0,this._lastSz=0,this._spaceWidthMap=[],this._minScoreID=-1,this._selectedSize=0,this._selectedSizeIdx=0,this.margin_left=0,this.margin_top=0,this.margin_bottom=0,this.margin_right=0,this._textureWidth=CharBook.textureWidth,this.fontFamily=t,this.fontsize=e,this.margin_left=this.margin_right=this.margin_top=this.margin_bottom=Render.isConchApp?0:Math.ceil(e/4),this._baseSize=Math.floor(i/CharBook.gridSize)*CharBook.gridSize,this._selectedSize=e,this._selectedSizeIdx=i-this._baseSize,this._slotW=Math.ceil(i/CharBook.gridSize)*CharBook.gridSize,this._gridW=Math.floor(this._textureWidth/this._slotW),this._gridNum=this._gridW*this._gridW,console.log("gridInfo:slotW="+this._slotW+",gridw="+this._gridW+",gridNum="+this._gridNum+",textureW="+this._textureWidth)}__class(t,"laya.webgl.resource.CharPages");var e=t.prototype;return e.getWidth=function(e){return t.charRender.getWidth(e)},e.selectSize=function(t,e){this._selectedSize=t,this._selectedSizeIdx=e-this._baseSize},e.getSpaceChar=function(){if(this._spaceWidthMap[this._selectedSizeIdx])return this._spaceWidthMap[this._selectedSizeIdx];var t=new CharRenderInfo;return this._spaceWidthMap[this._selectedSizeIdx]=t,t.width=this.getWidth(" "),t.isSpace=!0,t},e.getChar=function(t,e,i,n,r,a){if(" "===t)return this.getSpaceChar(a);var s,o=i>0?t+"_":t;n=16777215&n,CharBook.getFontBmpWithColor&&(o+=16777215===n?"#w":16711680===n?"#b":1048320===n?"#g":255===n?"#r":"#"+n.toString(16)),r&&(o+="B");for(var l=0,_=this.pages.length;_>l;l++){var h=this.pages[l],u=h.charMaps[this._selectedSizeIdx];if(u&&(s=u[o]))return a&&s.touch(),s}s=new CharRenderInfo,this._getASlot(s);var c=s.tex.charMaps[this._selectedSizeIdx];!c&&(c=s.tex.charMaps[this._selectedSizeIdx]={}),c[o]=s,a&&s.touch();var d="";CharBook.getFontBmpWithColor&&(d=((65280&n)+((255&n)<<16)+((16711680&n)>>16)).toString(16),d="#000000".substr(0,7-d.length)+d),s.height=this._selectedSize;var f=this.getCharBmp(t,CharBook._curFont,i,d,s);s.bmpWidth=f.width,s.bmpHeight=f.height;var m=Math.floor(s.pos/this._gridW),p=s.pos%this._gridW,g=p*this._slotW,v=m*this._slotW,x=this._textureWidth,y=g/x,T=v/x,D=(g+f.width)/x,E=(v+f.height)/x,S=s.uv;return S[0]=y,S[1]=T,S[2]=D,S[3]=T,S[4]=D,S[5]=E,S[6]=y,S[7]=E,s.tex.addChar(f,g,v),s},e.getCharStroke=function(){return null},e._getASlot=function(t){for(var e,i=this.pages.length,n=0,r=0;i>r;r++)if(e=this.pages[r],n=e.findAGrid(),n>=0)return t.tex=e,t.pos=n,void 0;if(e=new CharPageTexture(this),this.pages.push(e),n=e.findAGrid(),-1==n)throw"_getASlot error!";t.tex=e,t.pos=n},e.getAllPageScore=function(){for(var t=0,e=this.pages.length,i=Stat.loopCount,n=0,r=1e4;e>t;t++){var a=this.pages[t];a._scoreTick==i?n+=a._score:a._score=0,a._score<r&&(r=a._score,this._minScoreID=t)}return n},e.removeLRU=function(){var t,e=this._gridNum*this.pages.length-this.getAllPageScore();if(e>=this._gridNum&&this._minScoreID>=0){console.log("remove font page "+this._minScoreID),t=this.pages[this._minScoreID];var i=t._score;t.destroy(),this.pages[this._minScoreID]=this.pages[this.pages.length-1],this.pages.pop();for(var n=Stat.loopCount,r=0,a=this.pages.length;a>r&&i>0;r++){t=this.pages[r];var s=t.removeOld(n);i-=s}}},e.getCharBmp=function(e,i,n,r,a){return t.charRender.getCharBmp(e,i,n,r,a,this.margin_left,this.margin_top,this.margin_right,this.margin_bottom)},t.getBmpSize=function(t){return 1.5*t},t.charRender=null,t}(),CharRenderInfo=function(){function t(){this.tex=null,this.uv=[0,0,1,1],this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.touchTick=0,this.isSpace=!1}__class(t,"laya.webgl.resource.CharRenderInfo");var e=t.prototype;return e.touch=function(){var t=Stat.loopCount;this.tex._scoreTick!=t&&(this.tex._score=0,this.tex._scoreTick=t),this.touchTick!=t&&this.tex._score++,this.touchTick=t},t}(),CharRender_Canvas=function(){function t(){t.canvas||(t.canvas=window.document.createElement("canvas"),t.canvas.width=512,t.canvas.height=512,t.canvas.style.left="-1000px",t.canvas.style.position="absolute",document.body.appendChild(t.canvas),t.ctx=t.canvas.getContext("2d"))}__class(t,"laya.webgl.resource.CharRender_Canvas");var e=t.prototype;return e.getWidth=function(e){return t.ctx?(t.ctx._lastFont!=CharBook._curFont&&(t.ctx.font=CharBook._curFont,t.ctx._lastFont=CharBook._curFont),t.ctx.measureText(e).width):0},e.getCharBmp=function(e,i,n,r,a,s,o,l,_){t.ctx.font!=i&&(t.ctx.font=i,t.ctx._lastFont=i);var h=a.width=t.ctx.measureText(e).width,u=a.height;return h+=s+l,u+=o+_,t.ctx.clearRect(0,0,h,u),t.ctx.textBaseline="top",n>0?(t.ctx.strokeStyle=r,t.ctx.lineWidth=n,t.ctx.strokeText(e,s,o)):(t.ctx.fillStyle=r,t.ctx.fillText(e,s,o)),CharBook.debug&&(t.ctx.strokeStyle="#ff0000",t.ctx.strokeRect(0,0,h,u),t.ctx.strokeStyle="#00ff00",t.ctx.strokeRect(s,o,a.width,a.height)),t.ctx.getImageData(0,0,h,u)},t.canvas=null,t.ctx=null,t}(),CharRender_Native=function(){function t(){this.lastFont=""}__class(t,"laya.webgl.resource.CharRender_Native");var e=t.prototype;return e.getWidth=function(t){return window.conchTextCanvas?(this.lastFont!=CharBook._curFont&&(window.conchTextCanvas.font=CharBook._curFont,this.lastFont=CharBook._curFont),window.conchTextCanvas.measureText(t).width):0},e.getCharBmp=function(t,e,i,n,r,a,s,o,l){if(!window.conchTextCanvas)return null;this.lastFont!=e&&(window.conchTextCanvas.font=CharBook._curFont,this.lastFont=CharBook._curFont);var _=r.width=window.conchTextCanvas.measureText(t).width,h=r.height;_+=a+o,h+=s+l;var u=window.conchTextCanvas.getTextBitmapData(t,4294967295);return u},t}(),WebGLRTMgr=function(){function t(){}return __class(t,"laya.webgl.resource.WebGLRTMgr"),t.getRT=function(e,i){e=0|e,i=0|i,e>=1e4&&console.error("getRT error! w too big");var n,r=1e4*i+e,a=t.dict[r];return a&&a.length>0?(n=a.pop(),n._mgrKey=r,n):(n=new RenderTexture2D(e,i,1,-1),n._mgrKey=r,n)},t.releaseRT=function(e){if(!(e._mgrKey<=0)){var i=t.dict[e._mgrKey];!i&&(i=[],t.dict[e._mgrKey]=i),e._mgrKey=0,i.push(e)}},t.dict={},t}(),Shader2D=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new ShaderDefines2D}__class(t,"laya.webgl.shader.d2.Shader2D");var e=t.prototype;return e.destroy=function(){this.defines=null,this.filters=null},e.getRenderKey=function(){return[this.ALPHA,this.shader?this.shader.id:0,this.filters?this.filters.key:0].join("/")},t.__init__=function(){Shader.addInclude("parts/ColorFilter.glsl","#begin code ColorFilter_ps_logic\n	mat4 alphaMat =colorMat;\n\n	alphaMat[0][3] *= gl_FragColor.a;\n	alphaMat[1][3] *= gl_FragColor.a;\n	alphaMat[2][3] *= gl_FragColor.a;\n\n	gl_FragColor = gl_FragColor * alphaMat;\n	gl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n#end\n\n#begin code ColorFilter_ps_uniform\n	uniform vec4 colorAlpha;\n	uniform mat4 colorMat;\n#end\n\n#begin function void test(void)\n{\n	\n}\n#end"),Shader.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Shader.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n	for(float j = 0.0;j<=c_IterationTime; ++j){\n		vec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n		vec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n	}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),Shader.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=v_color.w;"),Shader.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Shader.addInclude("parts/ColorAdd.glsl","#begin code ColorAdd_ps_logic\n	gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n	gl_FragColor.xyz *= colorAdd.a;\n#end\n\n#begin code ColorAdd_ps_uniform\n	uniform vec4 colorAdd;\n#end\n");var t,e;t="/*\n	texture��fillrectʹ�õġ�\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipDir;\nuniform vec2 clipRect;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n	uniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n	vec4 pos=mmat*vec4(posuv.xy,0.,1.);\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n	gl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n	v_texcoordAlpha.xy = posuv.zw;\n	//v_texcoordAlpha.z = attribColor.a/255.0;\n	v_color = attribColor/255.0;\n	v_color.xyz*=v_color.w;//��������ҲҪԤ��\n	\n	v_useTex = attribFlags.r/255.0;\n	float clipw = length(clipDir.xy);\n	float cliph = length(clipDir.zw);\n	vec2 clippos = posuv.xy - clipRect.xy;	//pos�Ѿ�Ӧ�þ����ˣ�Ϊ�˼��������壬clip��λ��ҲҪ����\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//ת��0��1֮�䡣/clipw/clipw ��ʾclippos��normalize֮���clip������֮���ٳ���clipw\n		cliped=vec2( dot(clippos,clipDir.xy)/clipw/clipw, dot(clippos,clipDir.zw)/cliph/cliph);\n	}\n\n}",e="/*\n	texture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\nvoid main() {\n	if(cliped.x<0.) discard;\n	if(cliped.x>1.) discard;\n	if(cliped.y<0.) discard;\n	if(cliped.y>1.) discard;\n	\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n	gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n	gl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n	gl_FragColor =   blur();\n	gl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n	mat4 alphaMat =colorMat;\n\n	alphaMat[0][3] *= gl_FragColor.a;\n	alphaMat[1][3] *= gl_FragColor.a;\n	alphaMat[2][3] *= gl_FragColor.a;\n\n	gl_FragColor = gl_FragColor * alphaMat;\n	gl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n	const float c_IterationTime = 10.0;\n	float floatIterationTotalTime = c_IterationTime * c_IterationTime;\n	vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n	vec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\n	vec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\n	float maxNum = u_blurX * u_blurY;\n	vec2 vec2Off = vec2(0.0,0.0);\n	float floatOff = c_IterationTime/2.0;\n	for(float i = 0.0;i<=c_IterationTime; ++i){\n		for(float j = 0.0;j<=c_IterationTime; ++j){\n			vec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n			vec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n		}\n	}\n	gl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\n	gl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",Shader.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipDir;\nuniform vec2 clipRect;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n	vec4 tPos = vec4(position.x,position.y ,position.z,position.w);\n	vec4 pos=mmat*tPos;\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n	float clipw = length(clipDir.xy);\n	float cliph = length(clipDir.zw);\n	vec2 clippos = tPos.xy - clipRect.xy;	//pos�Ѿ�Ӧ�þ����ˣ�Ϊ�˼��������壬clip��λ��ҲҪ����\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//clipdir�Ǵ����ŵķ�����������clippos�������ź�Ŀռ����ģ�������Ҫ�ѷ�����normalizeһ��\n		cliped=vec2( dot(clippos,clipDir.xy)/clipw/clipw, dot(clippos,clipDir.zw)/cliph/cliph);\n	}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n	//vec4 a=vec4(color.r, color.g, color.b, 1);\n	//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n	gl_FragColor.rgb*=color.a;\n	if(cliped.x<0.) discard;\n	if(cliped.x>1.) discard;\n	if(cliped.y<0.) discard;\n	if(cliped.y>1.) discard;\n}",Shader.preCompile2D(0,4,t,e,null),t="/*\n	texture��fillrectʹ�õġ�\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipDir;\nuniform vec2 clipRect;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n	uniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n	vec4 pos=mmat*vec4(posuv.xy,0.,1.);\n	gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n	gl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n	v_texcoordAlpha.xy = posuv.zw;\n	//v_texcoordAlpha.z = attribColor.a/255.0;\n	v_color = attribColor/255.0;\n	v_color.xyz*=v_color.w;//��������ҲҪԤ��\n	\n	v_useTex = attribFlags.r/255.0;\n	float clipw = length(clipDir.xy);\n	float cliph = length(clipDir.zw);\n	vec2 clippos = posuv.xy - clipRect.xy;	//pos�Ѿ�Ӧ�þ����ˣ�Ϊ�˼��������壬clip��λ��ҲҪ����\n	if(clipw>20000. && cliph>20000.)\n		cliped = vec2(0.5,0.5);\n	else {\n		//ת��0��1֮�䡣/clipw/clipw ��ʾclippos��normalize֮���clip������֮���ٳ���clipw\n		cliped=vec2( dot(clippos,clipDir.xy)/clipw/clipw, dot(clippos,clipDir.zw)/cliph/cliph);\n	}\n\n}",e='#ifdef FSHIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n\n#import?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n\n#import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_uniform;\n\n#import?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n\n#import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_uniform;\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   \n   #import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_logic;\n   \n   #import?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   \n   #import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_logic;\n   \n   #import?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Shader.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n	vec4 t_color = texture2D(texture, v_texcoord);\n	gl_FragColor = t_color.rgba * v_color;\n	gl_FragColor *= alpha;\n}",Shader.preCompile2D(0,512,t,e,null)
},t}(),ShaderDefines=function(){function t(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}__class(t,"laya.webgl.shader.ShaderDefines");var e=t.prototype;return e.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},e.addInt=function(t){return this._value|=t,this._value},e.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},e.isDefine=function(t){return(this._value&t)===t},e.getValue=function(){return this._value},e.setValue=function(t){this._value=t},e.toNameDic=function(){var e=this._int2nameMap[this._value];return e?e:t._toText(this._value,this._int2name,this._int2nameMap)},t._reg=function(t,e,i,n){i[t]=e,n[e]=t},t._toText=function(t,e,i){var n=i[t];if(n)return n;for(var r={},a=1,s=0;32>s&&(a=1<<s,!(a>t));s++)if(t&a){var o=e[a];o&&(r[o]="")}return i[t]=r,r},t._toInt=function(t,e){for(var i=t.split("."),n=0,r=0,a=i.length;a>r;r++){var s=e[i[r]];if(!s)throw new Error("Defines to int err:"+t+"/"+i[r]);n|=s}return n},t}(),SkinMesh=function(){function t(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new Matrix}__class(t,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var e=t.prototype;return e.init=function(e,i,n){if(i)this._vs=i;else{this._vs=[];var r=e.width,a=e.height,s=1,o=1,l=1,_=1;this._vs.push(0,0,0,0,s,o,l,_),this._vs.push(r,0,1,0,s,o,l,_),this._vs.push(r,a,1,1,s,o,l,_),this._vs.push(0,a,0,1,s,o,l,_)}n?this._ps=n:(t._defaultPS||(t._defaultPS=[],t._defaultPS.push(0,1,3,3,1,2)),this._ps=t._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=e},e.init2=function(t,e,i,n,r){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=n,this._uvs=r,this.mEleNum=this._ps.length,this.mTexture=t},e._initMyData=function(){var e=0,i=0,n=this._verticles.length,r=4*n;this._vs=t._tempVS;var a=!1;if(this._vs.length<r&&(this._vs.length=r,a=!0),t._tVSLen=r,a)for(;r>e;)this._vs[e]=this._verticles[i],this._vs[e+1]=this._verticles[i+1],this._vs[e+2]=this._uvs[i],this._vs[e+3]=this._uvs[i+1],this._vs[e+4]=1,this._vs[e+5]=1,this._vs[e+6]=1,this._vs[e+7]=1,e+=8,i+=2;else for(;r>e;)this._vs[e]=this._verticles[i],this._vs[e+1]=this._verticles[i+1],this._vs[e+2]=this._uvs[i],this._vs[e+3]=this._uvs[i+1],e+=8,i+=2},e.getData2=function(e,i,n){this.mVBBuffer=e,this.mIBBuffer=i,this._initMyData(),e.appendEx2(this._vs,Float32Array,t._tVSLen,4),this._indexStart=i._byteLength;var r;r=t._tempIB,r.length<this._ps.length&&(r.length=this._ps.length);for(var a=0,s=this._ps.length;s>a;a++)r[a]=this._ps[a]+n;i.appendEx2(r,Uint16Array,this._ps.length,2)},e.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e._byteLength,this.mIBData.start!=i){for(var n=0,r=this._ps.length;r>n;n++)this.mIBData[n]=this._ps[n]+i;this.mIBData.start=i}e.append(this.mIBData)},e.render=function(t,e,i){if(Render.isWebGL&&this.mTexture){SkinMeshBuffer.getInstance().addSkinMesh(this);var n=Submit.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Value2D.create(512,0));this.transform||(this.transform=Matrix.EMPTY),this.transform.translate(e,i),Matrix.mul(this.transform,t._curMat,this._tempMatrix),this.transform.translate(-e,-i);var r=n.shaderValue,a=r.u_mmat2;RenderState2D.mat2MatArray(this._tempMatrix,a),r.textureHost=this.mTexture,r.offsetX=0,r.offsetY=0,r.u_mmat2=a,r.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=n}else Render.isConchApp&&this.mTexture&&(this.transform||(this.transform=Matrix.EMPTY),t.setSkinMesh&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},t._tempVS=[],t._tempIB=[],t._defaultPS=null,t._tVSLen=0,t}(),SkinMeshBuffer=function(){function t(){this.ib=null,this.vb=null;WebGL.mainContext;this.ib=IndexBuffer2D.create(35048),this.vb=VertexBuffer2D.create(8)}__class(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),Value2D=function(){function t(e,i){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipDir=[99999999,0,0,99999999],this.clipRect=[0,0],this.defines=new ShaderDefines2D,this.mainID=e,this.subID=i,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=e|i,this._inClassCache=t._cache[this._cacheID],e>0&&!this._inClassCache&&(this._inClassCache=t._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}__class(t,"laya.webgl.shader.d2.value.Value2D");var e=t.prototype;return e.setValue=function(){},e._ShaderWithCompile=function(){var t=Shader.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Shader2X.create,this._attribLocation);return t},e.upload=function(){var t=RenderState2D;RenderState2D.worldMatrix4===RenderState2D.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4;var e=Shader.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},e.getRenderKey=function(){return[this.ALPHA,this.shader?this.shader.id:0,this.filters?this.filters.key:0].join("/")},e.setFilters=function(t){if(this.filters=t,t)for(var e,i=t.length,n=0;i>n;n++)e=t[n],e&&(this.defines.add(e.type),e.action.setValue(this))},e.clear=function(){this.defines._value=this.subID+(WebGL.shaderHighPrecision?1024:0)},e.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.fillStyle=null,this.strokeStyle=null,this.clear(),this.filters=null,this.ref=1)},t._initone=function(e,i){t._typeClass[e]=i,t._cache[e]=[],t._cache[e]._length=0},t.__init__=function(){t._initone(4,PrimitiveSV),t._initone(256,FillTextureSV),t._initone(512,SkinSV),t._initone(1,TextureSV),t._initone(65,TextSV),t._initone(9,TextureSV)},t.create=function(e,i){var n=t._cache[e|i];return n._length?n[--n._length]:new t._typeClass[e|i](i)},t._cache=[],t._typeClass=[],t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t}(),ShaderValue=function(){function t(){}return __class(t,"laya.webgl.shader.ShaderValue"),t}(),BasePoly=function(){function t(t,e,i,n,r,a,s,o,l){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===l&&(l=0),this.x=t,this.y=e,this.width=i,this.height=n,this.edges=r,this.color=a,this.borderWidth=s,this.borderColor=o}__class(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;return Laya.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(){},e.rebuild=function(){},e.setMatrix=function(){},e.needUpdate=function(){return!0},e.sector=function(t,e,i){var n=this.x,r=this.y,a=this.edges,s=(this.r1-this.r0)/a,o=this.width,l=this.height,_=this.color,h=(_>>16&255)/255,u=(_>>8&255)/255,c=(255&_)/255;t.push(n,r,h,u,c);for(var d=0;a+1>d;d++)t.push(n+Math.sin(s*d+this.r0)*o,r+Math.cos(s*d+this.r0)*l),t.push(h,u,c);for(d=0;a>d;d++)e.push(i,i+d+1,i+d+2)},e.createLoopLine=function(t,e,i,n,r,a){var s=t.concat(),o=r?r:t,l=this.borderColor,_=(l>>16&255)/255,h=(l>>8&255)/255,u=(255&l)/255;s.splice(0,5);var c=[s[0],s[1]],d=[s[s.length-5],s[s.length-4]],f=d[0]+.5*(c[0]-d[0]),m=d[1]+.5*(c[1]-d[1]);s.unshift(f,m,0,0,0),s.push(f,m,0,0,0);var p,g,v,x,y,T,D,E,S,M,R,A,C,L,I,w,b,P,V,O,N,B=s.length/5,F=n,U=i/2;v=s[0],x=s[1],y=s[5],T=s[6],S=-(x-T),M=v-y,N=Math.sqrt(S*S+M*M),S=S/N*U,M=M/N*U,o.push(v-S,x-M,_,h,u,v+S,x+M,_,h,u);for(var G=1;B-1>G;G++)v=s[5*(G-1)],x=s[5*(G-1)+1],y=s[5*G],T=s[5*G+1],D=s[5*(G+1)],E=s[5*(G+1)+1],S=-(x-T),M=v-y,N=Math.sqrt(S*S+M*M),S=S/N*U,M=M/N*U,R=-(T-E),A=y-D,N=Math.sqrt(R*R+A*A),R=R/N*U,A=A/N*U,C=-M+x-(-M+T),L=-S+y-(-S+v),I=(-S+v)*(-M+T)-(-S+y)*(-M+x),w=-A+E-(-A+T),b=-R+y-(-R+D),P=(-R+D)*(-A+T)-(-R+y)*(-A+E),V=C*b-w*L,Math.abs(V)<.1?(V+=10.1,o.push(y-S,T-M,_,h,u,y+S,T+M,_,h,u)):(p=(L*P-b*I)/V,g=(w*I-C*P)/V,O=(p-y)*(p-y)+(g-T)+(g-T),o.push(p,g,_,h,u,y-(p-y),T-(g-T),_,h,u));a&&(e=a);var H=this.edges+1;for(G=1;H>G;G++)e.push(F+2*(G-1),F+2*(G-1)+1,F+2*G+1,F+2*G+1,F+2*G,F+2*(G-1));return e.push(F+2*(G-1),F+2*(G-1)+1,F+1,F+1,F,F+2*(G-1)),o},t.createLine2=function(t,e,i,n,r,a){var s=t.concat();a&&s.push(s[0],s[1]);var o,l,_,h,u,c,d,f,m,p,g,v,x,y,T,D,E,S,M,R,A,C=r,L=s.length/2,I=n,w=i/2;_=s[0],h=s[1],u=s[2],c=s[3],m=-(h-c),p=_-u,A=Math.sqrt(m*m+p*p),m=m/A*w,p=p/A*w,C.push(_-m,h-p,_+m,h+p);for(var b=1;L-1>b;b++)_=s[2*(b-1)],h=s[2*(b-1)+1],u=s[2*b],c=s[2*b+1],d=s[2*(b+1)],f=s[2*(b+1)+1],m=-(h-c),p=_-u,A=Math.sqrt(m*m+p*p),m=m/A*w,p=p/A*w,g=-(c-f),v=u-d,A=Math.sqrt(g*g+v*v),g=g/A*w,v=v/A*w,x=-p+h-(-p+c),y=-m+u-(-m+_),T=(-m+_)*(-p+c)-(-m+u)*(-p+h),D=-v+f-(-v+c),E=-g+u-(-g+d),S=(-g+d)*(-v+c)-(-g+u)*(-v+f),M=x*E-D*y,Math.abs(M)<.1?(M+=10.1,C.push(u-m,c-p,u+m,c+p)):(o=(y*S-E*T)/M,l=(D*T-x*S)/M,R=(o-u)*(o-u)+(l-c)+(l-c),C.push(o,l,u-(o-u),c-(l-c)));for(_=s[s.length-4],h=s[s.length-3],u=s[s.length-2],c=s[s.length-1],m=-(h-c),p=_-u,A=Math.sqrt(m*m+p*p),m=m/A*w,p=p/A*w,C.push(u-m,c-p,u+m,c+p),b=1;L>b;b++)e.push(I+2*(b-1),I+2*(b-1)+1,I+2*b+1,I+2*b+1,I+2*b,I+2*(b-1));return C},t.createLineTriangle=function(t,e,i,n){var r=t.slice(),a=r.length,s=r[0],o=r[1],l=r[2],_=r[2],h=0,u=0,c=0,d=0,f=a/2;if(!(1>=f)&&2!=f){for(var m=new Array(4*f),p=0,g=0,v=0;f-1>v;v++)s=r[g++],o=r[g++],l=r[g++],_=r[g++],c=l-s,d=_-o,0!=c&&0!=d&&(h=Math.sqrt(c*c+d*d),h>.001&&(u=4*p,m[u]=s,m[u+1]=o,m[u+2]=c/h,m[u+3]=d/h,p++));for(n?(s=r[a-2],o=r[a-1],l=r[0],_=r[1],c=l-s,d=_-o,0!=c&&0!=d&&(h=Math.sqrt(c*c+d*d),h>.001&&(u=4*p,m[u]=s,m[u+1]=o,m[u+2]=c/h,m[u+3]=d/h,p++))):(u=4*p,m[u]=s,m[u+1]=o,m[u+2]=c/h,m[u+3]=d/h,p++),g=0,v=0;f>v;v++){s=r[g],o=r[g+1],l=r[g+2],_=r[g+3];{r[g+4],r[g+5]}}}},t}(),Earcut=function(){function t(){}var e;return __class(t,"laya.webgl.shapes.Earcut"),t.earcut=function(e,i,n){n=n||2;var r=i&&i.length,a=r?i[0]*n:e.length,s=t.linkedList(e,0,a,n,!0),o=[];if(!s)return o;var l,_,h,u,c,d,f;if(r&&(s=t.eliminateHoles(e,i,s,n)),e.length>80*n){l=h=e[0],_=u=e[1];for(var m=n;a>m;m+=n)c=e[m],d=e[m+1],l>c&&(l=c),_>d&&(_=d),c>h&&(h=c),d>u&&(u=d);f=Math.max(h-l,u-_),f=0!==f?1/f:0}return t.earcutLinked(s,o,n,l,_,f),o},t.linkedList=function(e,i,n,r,a){var s,o;if(a===t.signedArea(e,i,n,r)>0)for(s=i;n>s;s+=r)o=t.insertNode(s,e[s],e[s+1],o);else for(s=n-r;s>=i;s-=r)o=t.insertNode(s,e[s],e[s+1],o);return o&&t.equals(o,o.next)&&(t.removeNode(o),o=o.next),o},t.filterPoints=function(e,i){if(!e)return e;i||(i=e);var n,r=e;do if(n=!1,r.steiner||!t.equals(r,r.next)&&0!==t.area(r.prev,r,r.next))r=r.next;else{if(t.removeNode(r),r=i=r.prev,r===r.next)break;n=!0}while(n||r!==i);return i},t.earcutLinked=function(e,i,n,r,a,s,o){if(e){!o&&s&&t.indexCurve(e,r,a,s);for(var l,_,h=e;e.prev!==e.next;)if(l=e.prev,_=e.next,s?t.isEarHashed(e,r,a,s):t.isEar(e))i.push(l.i/n,e.i/n,_.i/n),t.removeNode(e),e=_.next,h=_.next;else if(e=_,e===h){o?1===o?(e=t.cureLocalIntersections(e,i,n),t.earcutLinked(e,i,n,r,a,s,2)):2===o&&t.splitEarcut(e,i,n,r,a,s):t.earcutLinked(t.filterPoints(e),i,n,r,a,s,1);break}}},t.isEar=function(e){var i=e.prev,n=e,r=e.next;if(t.area(i,n,r)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(t.pointInTriangle(i.x,i.y,n.x,n.y,r.x,r.y,a.x,a.y)&&t.area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0},t.isEarHashed=function(e,i,n,r){var a=e.prev,s=e,o=e.next;if(t.area(a,s,o)>=0)return!1;for(var l=a.x<s.x?a.x<o.x?a.x:o.x:s.x<o.x?s.x:o.x,_=a.y<s.y?a.y<o.y?a.y:o.y:s.y<o.y?s.y:o.y,h=a.x>s.x?a.x>o.x?a.x:o.x:s.x>o.x?s.x:o.x,u=a.y>s.y?a.y>o.y?a.y:o.y:s.y>o.y?s.y:o.y,c=t.zOrder(l,_,i,n,r),d=t.zOrder(h,u,i,n,r),f=e.nextZ;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&t.pointInTriangle(a.x,a.y,s.x,s.y,o.x,o.y,f.x,f.y)&&t.area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=e.prevZ;f&&f.z>=c;){if(f!==e.prev&&f!==e.next&&t.pointInTriangle(a.x,a.y,s.x,s.y,o.x,o.y,f.x,f.y)&&t.area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0},t.cureLocalIntersections=function(e,i,n){var r=e;do{var a=r.prev,s=r.next.next;!t.equals(a,s)&&t.intersects(a,r,r.next,s)&&t.locallyInside(a,s)&&t.locallyInside(s,a)&&(i.push(a.i/n),i.push(r.i/n),i.push(s.i/n),t.removeNode(r),t.removeNode(r.next),r=e=s),r=r.next}while(r!==e);return r},t.splitEarcut=function(e,i,n,r,a,s){var o=e;do{for(var l=o.next.next;l!==o.prev;){if(o.i!==l.i&&t.isValidDiagonal(o,l)){var _=t.splitPolygon(o,l);return o=t.filterPoints(o,o.next),_=t.filterPoints(_,_.next),t.earcutLinked(o,i,n,r,a,s),t.earcutLinked(_,i,n,r,a,s),void 0}l=l.next}o=o.next}while(o!==e)},t.eliminateHoles=function(e,i,n,r){var a,s,o,l,_,h=[];for(a=0,s=i.length;s>a;a++)o=i[a]*r,l=s-1>a?i[a+1]*r:e.length,_=t.linkedList(e,o,l,r,!1),_===_.next&&(_.steiner=!0),h.push(t.getLeftmost(_));for(h.sort(t.compareX),a=0;a<h.length;a++)t.eliminateHole(h[a],n),n=t.filterPoints(n,n.next);return n},t.compareX=function(t,e){return t.x-e.x},t.eliminateHole=function(e,i){if(i=t.findHoleBridge(e,i)){var n=t.splitPolygon(i,e);t.filterPoints(n,n.next)}},t.findHoleBridge=function(e,i){var n,r=i,a=e.x,s=e.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var l=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a>=l&&l>o){if(o=l,l===a){if(s===r.y)return r;if(s===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==i);if(!n)return null;if(a===o)return n.prev;var _,h=n,u=n.x,c=n.y,d=1/0;for(r=n.next;r!==h;)a>=r.x&&r.x>=u&&a!==r.x&&t.pointInTriangle(c>s?a:o,s,u,c,c>s?o:a,s,r.x,r.y)&&(_=Math.abs(s-r.y)/(a-r.x),(d>_||_===d&&r.x>n.x)&&t.locallyInside(r,e)&&(n=r,d=_)),r=r.next;return n},t.indexCurve=function(e,i,n,r){var a=e;do null===a.z&&(a.z=t.zOrder(a.x,a.y,i,n,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,t.sortLinked(a)},t.sortLinked=function(t){var e,i,n,r,a,s,o,l,_=1;do{for(i=t,t=null,a=null,s=0;i;){for(s++,n=i,o=0,e=0;_>e&&(o++,n=n.nextZ,n);e++);for(l=_;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,_*=2}while(s>1);return t},t.zOrder=function(t,e,i,n,r){return t=32767*(t-i)*r,e=32767*(e-n)*r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1},t.getLeftmost=function(t){var e=t,i=t;do e.x<i.x&&(i=e),e=e.next;while(e!==t);return i},t.pointInTriangle=function(t,e,i,n,r,a,s,o){return(r-s)*(e-o)-(t-s)*(a-o)>=0&&(t-s)*(n-o)-(i-s)*(e-o)>=0&&(i-s)*(a-o)-(r-s)*(n-o)>=0},t.isValidDiagonal=function(e,i){return e.next.i!==i.i&&e.prev.i!==i.i&&!t.intersectsPolygon(e,i)&&t.locallyInside(e,i)&&t.locallyInside(i,e)&&t.middleInside(e,i)},t.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},t.equals=function(t,e){return t.x===e.x&&t.y===e.y},t.intersects=function(e,i,n,r){return t.equals(e,i)&&t.equals(n,r)||t.equals(e,r)&&t.equals(n,i)?!0:t.area(e,i,n)>0!=t.area(e,i,r)>0&&t.area(n,r,e)>0!=t.area(n,r,i)>0},t.intersectsPolygon=function(e,i){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==i.i&&n.next.i!==i.i&&t.intersects(n,n.next,e,i))return!0;n=n.next}while(n!==e);return!1},t.locallyInside=function(e,i){return t.area(e.prev,e,e.next)<0?t.area(e,i,e.next)>=0&&t.area(e,e.prev,i)>=0:t.area(e,i,e.prev)<0||t.area(e,e.next,i)<0},t.middleInside=function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n},t.splitPolygon=function(t,i){var n=new e(t.i,t.x,t.y),r=new e(i.i,i.x,i.y),a=t.next,s=i.prev;return t.next=i,i.prev=t,n.next=a,a.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r},t.insertNode=function(t,i,n,r){var a=new e(t,i,n);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a},t.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},t.signedArea=function(t,e,i,n){for(var r=0,a=e,s=i-n;i>a;a+=n)r+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return r},t.__init$=function(){e=function(){function t(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return __class(t,""),t}()},t}(),Submit=function(){function t(e){this.clipInfoID=-1,this._numEle=0,this._ref=1,this._key=new SubmitKey,void 0===e&&(e=1e4),this._renderType=e,this._id=++t.ID}__class(t,"laya.webgl.submit.Submit");var e=t.prototype;return Laya.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.getID=function(){return this._id},e.releaseRender=function(){t.RENDERBASE!=this&&--this._ref<1&&(t.POOL[t._poolSize++]=this,this.shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.getRenderType=function(){return this._renderType},e.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=WebGL.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),BlendMode.activeBlendFunction!==this._blendFn&&(WebGLContext.setBlend(i,!0),this._blendFn(i),BlendMode.activeBlendFunction=this._blendFn),i.drawElements(4,this._numEle,5123,this._startIdx),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,1},e._cloneInit=function(t,e,i,n){t._ref=1,t._mesh=i,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=n*CONST3D2D.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},e.clone=function(){},e.reUse=function(){},e.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},t.__init__=function(){var e=t.RENDERBASE=new t(-1);e.shaderValue=new Value2D(0,0),e.shaderValue.ALPHA=1,e._ref=4294967295},t.create=function(e,i,n){var r=t._poolSize?t.POOL[--t._poolSize]:new t;r._ref=1,r._mesh=i,r._key.clear(),r._startIdx=i.indexNum*CONST3D2D.BYTES_PIDX,r._numEle=0;var a=e._nBlendType;r._blendFn=e._targets?BlendMode.targetFns[a]:BlendMode.fns[a],r.shaderValue=n,r.shaderValue.setValue(e._shader2D);var s=e._shader2D.filters;return s&&r.shaderValue.setFilters(s),r},t.createShape=function(e,i,n,r){var a=t._poolSize?t.POOL[--t._poolSize]:new t;a._mesh=i,a._numEle=n,a._startIdx=2*i.indexNum,a._ref=1,a.shaderValue=r,a.shaderValue.setValue(e._shader2D);var s=e._nBlendType;return a._blendFn=e._targets?BlendMode.targetFns[s]:BlendMode.fns[s],a},t.TYPE_2D=1e4,t.TYPE_CANVAS=10003,t.TYPE_CMDSETRT=10004,t.TYPE_CUSTOM=10005,t.TYPE_BLURRT=10006,t.TYPE_CMDDESTORYPRERT=10007,t.TYPE_DISABLESTENCIL=10008,t.TYPE_OTHERIBVB=10009,t.TYPE_PRIMITIVE=10010,t.TYPE_RT=10011,t.TYPE_BLUR_RT=10012,t.TYPE_TARGET=10013,t.TYPE_CHANGE_VALUE=10014,t.TYPE_SHAPE=10015,t.TYPE_TEXTURE=10016,t.TYPE_FILLTEXTURE=10017,t.KEY_ONCE=-1,t.KEY_FILLRECT=1,t.KEY_DRAWTEXTURE=2,t.KEY_VG=3,t.KEY_TRIANGLES=4,t.RENDERBASE=null,t.ID=1,t.preRender=null,t._poolSize=0,t.POOL=[],t}(),SubmitCMD=function(){function t(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new SubmitKey}__class(t,"laya.webgl.submit.SubmitCMD");var e=t.prototype;return Laya.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},e.getRenderType=function(){return 0},e.reUse=function(t,e){return this._ref++,e},e.releaseRender=function(){if(--this._ref<1){var e=t.POOL;e[e._length++]=this}},e.clone=function(){return null},t.create=function(e,i,n){var r=t.POOL._length?t.POOL[--t.POOL._length]:new t;return r.fun=i,r.args=e,r._this=n,r._ref=1,r._key.clear(),r},t.POOL=(t.POOL=[],t.POOL._length=0,t.POOL),t}(),SubmitCMDScope=function(){function t(){this.variables={}}__class(t,"laya.webgl.submit.SubmitCMDScope");var e=t.prototype;return e.getValue=function(t){return this.variables[t]},e.addValue=function(t,e){return this.variables[t]=e},e.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},e.clear=function(){for(var t in this.variables)delete this.variables[t]},e.recycle=function(){this.clear(),t.POOL.push(this)},t.create=function(){return new t},t.POOL=[],t}(),SubmitKey=function(){function t(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}__class(t,"laya.webgl.submit.SubmitKey");var e=t.prototype;return e.clear=function(){this.submitType=-1,this.blendShader=this.other=0},e.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},e.copyFrom2=function(t,e,i){this.blendShader=t.blendShader,this.other=i,this.submitType=e},e.equal3_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal4_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},e.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},t}(),SubmitOtherIBVB=function(){function t(){this.offset=0,this._ref=1,this.startIndex=0,this._key=new SubmitKey,this._mat=Matrix.create()}__class(t,"laya.webgl.submit.SubmitOtherIBVB");var e=t.prototype;return Laya.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){if(--this._ref<1){var e=t.POOL;e[e._length++]=this}},e.getRenderType=function(){return 10009},e.reUse=function(t,e){return this._ref++,e},e.clone=function(){return null},e.renderSubmit=function(){var e=this.shaderValue.textureHost;if(e){var i=e.source;if(!e.bitmap||!i)return 1;this.shaderValue.texture=i}this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind();var n=RenderState2D.worldMatrix4,r=Matrix.TEMP;Matrix.mulPre(this._mat,n[0],n[1],n[4],n[5],n[12],n[13],r);var a=RenderState2D.worldMatrix4=t.tempMatrix4;a[0]=r.a,a[1]=r.b,a[4]=r.c,a[5]=r.d,a[12]=r.tx,a[13]=r.ty,this.shaderValue.size[0]=RenderState2D.width,this.shaderValue.size[1]=RenderState2D.height,this.shaderValue.alpha=this.shaderValue.ALPHA*RenderState2D.worldAlpha,this.shaderValue.mmat=RenderState2D.worldMatrix4,this._shader.upload(this.shaderValue);var s=WebGL.mainContext;return BlendMode.activeBlendFunction!==this._blendFn&&(WebGLContext.setBlend(s,!0),this._blendFn(s),BlendMode.activeBlendFunction=this._blendFn),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,s.drawElements(4,this._numEle,5123,this.startIndex),RenderState2D.worldMatrix4=n,BaseShader.activeShader=null,1},t.create=function(e,i,n,r,a,s,o){var l=t.POOL._length?t.POOL[--t.POOL._length]:new t;l._ib=n,l._vb=i,l._numEle=r,l._shader=a,l._key.clear(),l._ref=1,l.shaderValue=s;var _=e._nBlendType;return l._blendFn=e._targets?BlendMode.targetFns[_]:BlendMode.fns[_],l.startIndex=o,l},t.POOL=[],t.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t}(),SubmitScissor=function(){function t(){this.submitIndex=0,this.submitLength=0,this.context=null,this._numEle=0,this._ref=1,this.clipRect=new Rectangle,this.screenRect=new Rectangle,this._key=new SubmitKey}__class(t,"laya.webgl.submit.SubmitScissor");var e=t.prototype;return Laya.imps(e,{"laya.webgl.submit.ISubmit":!0}),e._scissor=function(t,e,i,n){var r=RenderState2D.worldMatrix4,a=r[0],s=r[5],o=r[12],l=r[13];if(t=t*a+o,e=e*s+l,i*=a,n*=s,1>i||1>n)return!1;var _=t+i,h=e+n;0>t&&(t=0,i=_-t),0>e&&(e=0,n=h-e);var u=RenderState2D.worldClipRect;if(t=Math.max(t,u.x),e=Math.max(e,u.y),i=Math.min(_,u.right)-t,n=Math.min(h,u.bottom)-e,1>i||1>n)return!1;var c=RenderState2D.worldScissorTest;return this.screenRect.copyFrom(u),u.x=t,u.y=e,u.width=i,u.height=n,RenderState2D.worldScissorTest=!0,e=RenderState2D.height-e-n,WebGL.mainContext.scissor(t,e,i,n),WebGL.mainContext.enable(3089),this.context.submitNextElement(this.submitLength),c?(e=RenderState2D.height-this.screenRect.y-this.screenRect.height,WebGL.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),WebGL.mainContext.enable(3089)):(WebGL.mainContext.disable(3089),RenderState2D.worldScissorTest=!1),u.copyFrom(this.screenRect),!0},e._scissorWithTagart=function(t,e,i,n){if(1>i||1>n)return!1;var r=t+i,a=e+n;0>t&&(t=0,i=r-t),0>e&&(e=0,n=a-e);var s=RenderState2D.worldClipRect;if(t=Math.max(t,s.x),e=Math.max(e,s.y),i=Math.min(r,s.right)-t,n=Math.min(a,s.bottom)-e,1>i||1>n)return!1;var o=RenderState2D.worldScissorTest;return this.screenRect.copyFrom(s),RenderState2D.worldScissorTest=!0,s.x=t,s.y=e,s.width=i,s.height=n,e=RenderState2D.height-e-n,WebGL.mainContext.scissor(t,e,i,n),WebGL.mainContext.enable(3089),this.context.submitNextElement(this.submitLength),o?(e=RenderState2D.height-this.screenRect.y-this.screenRect.height,WebGL.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),WebGL.mainContext.enable(3089)):(WebGL.mainContext.disable(3089),RenderState2D.worldScissorTest=!1),s.copyFrom(this.screenRect),!0},e.renderSubmit=function(){return this.clipRect.width<1||this.clipRect.height<1?this.submitLength+1:(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height),this.submitLength+1)},e.getRenderType=function(){return 0},e.releaseRender=function(){if(--this._ref<1){var e=t.POOL;e[e._length++]=this,this.context=null}},e.clone=function(){return null},e.reUse=function(t,e){return this._key.clear(),this._ref++,this._numEle=0,this.context=t,e},t.create=function(e){var i=t.POOL._length?t.POOL[--t.POOL._length]:new t;return i.context=e,i._key.clear(),i._ref=1,i},t.POOL=(t.POOL=[],t.POOL._length=0,t.POOL),t}(),SubmitStencil=function(){function t(){this.step=0,this.blendMode=null,this._ref=1,this.level=0,this._key=new SubmitKey}__class(t,"laya.webgl.submit.SubmitStencil");var e=t.prototype;return Laya.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},e.getRenderType=function(){return 0},e.releaseRender=function(){if(--this._ref<1){var e=t.POOL;e[e._length++]=this}},e.clone=function(){return null},e.reUse=function(t,e){return this._ref++,e},e.do1=function(){var t=WebGL.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},e.do2=function(){var t=WebGL.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},e.do3=function(){var t=WebGL.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},e.do4=function(){var t=WebGL.mainContext;0==this.level&&(t.enable(2960),t.clear(1024)),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,0,255),t.stencilOp(7680,7680,7682)},e.do5=function(){var t=WebGL.mainContext;t.stencilFunc(514,this.level,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},e.do6=function(){var t=WebGL.mainContext;BlendMode.targetFns[BlendMode.TOINT[this.blendMode]](t)},e.do7=function(){var t=WebGL.mainContext;t.colorMask(!1,!1,!1,!1),t.stencilOp(7680,7680,7683)},e.do8=function(){var t=WebGL.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7680)},t.restore=function(e,i,n){var r;if(t._mask>0&&t._mask--,0==t._mask)r=laya.webgl.submit.SubmitStencil.create(3),e.addRenderObject(r),e._curSubmit=Submit.RENDERBASE;else{r=laya.webgl.submit.SubmitStencil.create(7),e.addRenderObject(r);{var a=e._vb;a._byteLength>>2}if(GlUtils.fillRectImgVb(a,null,i.x,i.y,i.width,i.height,Texture.DEF_UV,n)){var s=(e._shader2D,e._curSubmit=Submit.create(e,e._ib,a,(a._byteLength-4*WebGLContext2D._RECTVBSIZE)/32*3,Value2D.create(ShaderDefines2D.COLOR2D,0)));s.shaderValue.ALPHA=1,s._key.clear(),e._submits[e._submits._length++]=s,e._curSubmit._numEle+=6,e._curSubmit=Submit.RENDERBASE}else alert("clipRect calc stencil rect error");r=laya.webgl.submit.SubmitStencil.create(8),e.addRenderObject(r)}},t.restore2=function(e,i){var n;i._key.clear(),t._mask>0&&t._mask--,0==t._mask?(n=laya.webgl.submit.SubmitStencil.create(3),e.addRenderObject(n),e._curSubmit=Submit.RENDERBASE):(n=laya.webgl.submit.SubmitStencil.create(7),e.addRenderObject(n),e._submits[e._submits._length++]=i,n=laya.webgl.submit.SubmitStencil.create(8),e.addRenderObject(n))},t.create=function(e){var i=t.POOL._length?t.POOL[--t.POOL._length]:new t;return i.step=e,i._ref=1,5==e&&++t._mask,i.level=t._mask,i},t._mask=0,t.POOL=(t.POOL=[],t.POOL._length=0,t.POOL),t}(),SubmitTarget=function(){function t(){this._renderType=0,this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this._ref=1,this.scope=null,this._key=new SubmitKey}__class(t,"laya.webgl.submit.SubmitTarget");var e=t.prototype;return Laya.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){var t=WebGL.mainContext;this._mesh.useMesh(t);var e=this.scope.getValue(this.proName);return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[e.width,e.height]),this.shaderValue.upload(),this.blend(),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,WebGL.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},e.blend=function(){if(BlendMode.activeBlendFunction!==BlendMode.fns[this.blendType]){var t=WebGL.mainContext;t.enable(3042),BlendMode.fns[this.blendType](t),BlendMode.activeBlendFunction=BlendMode.fns[this.blendType]}},e.getRenderType=function(){return 0},e.releaseRender=function(){if(--this._ref<1){var e=t.POOL;e[e._length++]=this}},e.clone=function(){return null},e.reUse=function(t,e){return this._startIdx=e,this._ref++,e},t.create=function(e,i,n,r){var a=t.POOL._length?t.POOL[--t.POOL._length]:new t;return a._mesh=i,a.proName=r,a._startIdx=i.indexNum*CONST3D2D.BYTES_PIDX,a._ref=1,a._key.clear(),a._numEle=0,a.blendType=e._nBlendType,a.shaderValue=n,a.shaderValue.setValue(e._shader2D),a},t.POOL=(t.POOL=[],t.POOL._length=0,t.POOL),t}(),ArabicReshaper=function(){function t(){}__class(t,"laya.webgl.text.ArabicReshaper");var e=t.prototype;return e.characterMapContains=function(e){for(var i=0;i<t.charsMap.length;++i)if(t.charsMap[i][0]===e)return!0;return!1},e.getCharRep=function(e){for(var i=0;i<t.charsMap.length;++i)if(t.charsMap[i][0]===e)return t.charsMap[i];return!1},e.getCombCharRep=function(e,i){for(var n=0;n<t.combCharsMap.length;++n)if(t.combCharsMap[n][0][0]===e&&t.combCharsMap[n][0][1]===i)return t.combCharsMap[n];return!1},e.isTransparent=function(e){for(var i=0;i<t.transChars.length;++i)if(t.transChars[i]===e)return!0;return!1},e.getOriginalCharsFromCode=function(e){var i;for(i=0;i<t.charsMap.length;++i)if(t.charsMap[i].indexOf(e)>-1)return String.fromCharCode(t.charsMap[i][0]);for(i=0;i<t.combCharsMap.length;++i)if(t.combCharsMap[i].indexOf(e)>-1)return String.fromCharCode(t.combCharsMap[i][0][0])+String.fromCharCode(t.combCharsMap[i][0][1]);return String.fromCharCode(e)},e.convertArabic=function(t){for(var e,i,n="",r=0;r<t.length;++r){var a=t.charCodeAt(r);if(this.characterMapContains(a)){for(var s=null,o=null,l=r-1,_=r+1;l>=0&&this.isTransparent(t.charCodeAt(l));--l);for(s=l>=0?t.charCodeAt(l):null,e=s?this.getCharRep(s):!1,(!e||null==e[2]&&null==e[3])&&(s=null);_<t.length&&this.isTransparent(t.charCodeAt(_));++_);if(o=_<t.length?t.charCodeAt(_):null,e=o?this.getCharRep(o):!1,(!e||null==e[3]&&null==e[4])&&(o=null),1604===a&&null!=o&&(1570===o||1571===o||1573===o||1575===o)){i=this.getCombCharRep(a,o),n+=null!=s?String.fromCharCode(i[4]):String.fromCharCode(i[1]),++r;
continue}if(e=this.getCharRep(a),null!=s&&null!=o&&null!=e[3]){n+=String.fromCharCode(e[3]);continue}if(null!=s&&null!=e[4]){n+=String.fromCharCode(e[4]);continue}if(null!=o&&null!=e[2]){n+=String.fromCharCode(e[2]);continue}n+=String.fromCharCode(e[1])}else n+=String.fromCharCode(a)}return n},e.convertArabicBack=function(t){var e,i,n="";for(i=0;i<t.length;++i)e=t.charCodeAt(i),n+=this.getOriginalCharsFromCode(e);return n},__static(t,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}]),t}(),FontInContext=function(){function t(e){this._index=0,this._size=14,this._italic=-2,this._bold=-1,t._cache2=t._cache2||[],this.setFont(e||"14px Arial")}__class(t,"laya.webgl.text.FontInContext");var e=t.prototype;return e.setFont=function(e){var i=t._cache2[e];if(i)this._words=i[0],this._size=i[1];else{this._words=e.split(" ");for(var n=0,r=this._words.length;r>n;n++)if(this._words[n].indexOf("px")>0||this._words[n].indexOf("pt")>0){this._index=n;break}this._size=parseInt(this._words[this._index]),t._cache2[e]=[this._words,this._size]}this._text=null,this._italic=-2},e.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},e.getBold=function(){return-1===this._bold&&(this._bold=this.hasType("bold")),this._bold},e.getFamily=function(){return this._words[this._index+1]},e.hasType=function(t){for(var e=0,i=this._words.length;i>e;e++)if(this._words[e]===t)return e;return-1},e.removeType=function(t){for(var e=0,i=this._words.length;i>e;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},e.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},e.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},__getset(0,e,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),t.create=function(e){var i=t._cache[e];return i?i:i=t._cache[e]=new t(e)},t.EMPTY=new t,t._cache={},t._cache2=null,t}(),CONST3D2D=function(){function t(){}return __class(t,"laya.webgl.utils.CONST3D2D"),t.BYTES_PE=4,t.BYTES_PIDX=2,t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,t}(),GlUtils=function(){function t(){}return __class(t,"laya.webgl.utils.GlUtils"),t.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},t.fillIBQuadrangle=function(t,e){if(e>65535/4)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),n=0,r=0;e>r;r++)i[n++]=4*r,i[n++]=4*r+2,i[n++]=4*r+1,i[n++]=4*r,i[n++]=4*r+3,i[n++]=4*r+2;return t.setNeedUpload(),!0},t.expandIBQuadrangle=function(e,i){e.bufferLength>=6*i*2||t.fillIBQuadrangle(e,i)},t.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},t.fillTranglesVB=function(t,e,i,n,r,a,s){var o=(t._byteLength>>2)+n.length;t.byteLength=o<<2;var l=t.getFloat32Array();o-=n.length;for(var _=n.length,h=r.a,u=r.b,c=r.c,d=r.d,f=0;_>f;f+=4)if(l[o+f+2]=n[f+2],l[o+f+3]=n[f+3],1!==h||0!==u||0!==c||1!==d){r._bTransform=!0;var m=r.tx+a,p=r.ty+s;l[o+f]=(n[f]+e)*h+(n[f+1]+i)*c+m,l[o+f+1]=(n[f]+e)*u+(n[f+1]+i)*d+p}else r._bTransform=!1,e+=r.tx+a,i+=r.ty+s,l[o+f]=e+n[f],l[o+f+1]=i+n[f+1];return t._upload=!0,!0},t._fillLineArray=new Array(20),t}(),MatirxArray=function(){function t(){}return __class(t,"laya.webgl.utils.MatirxArray"),t.ArrayMul=function(e,i,n){if(!e)return t.copyArray(i,n),void 0;if(!i)return t.copyArray(e,n),void 0;for(var r=0/0,a=0/0,s=0/0,o=0/0,l=0;4>l;l++)r=e[l],a=e[l+4],s=e[l+8],o=e[l+12],n[l]=r*i[0]+a*i[1]+s*i[2]+o*i[3],n[l+4]=r*i[4]+a*i[5]+s*i[6]+o*i[7],n[l+8]=r*i[8]+a*i[9]+s*i[10]+o*i[11],n[l+12]=r*i[12]+a*i[13]+s*i[14]+o*i[15]},t.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]},t}(),Mesh2D=function(){function t(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new VertexBuffer2D(t,35048),e?this._vb._resizeBuffer(e,!1):Config.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new IndexBuffer2D,i&&this._ib._resizeBuffer(i,!1)}__class(t,"laya.webgl.utils.Mesh2D");var e=t.prototype;return e.cloneWithNewVB=function(){var e=new t(this._stride,0,0);return e._ib=this._ib,e._quadNum=this._quadNum,e._attribInfo=this._attribInfo,e},e.cloneWithNewVBIB=function(){var e=new t(this._stride,0,0);return e._attribInfo=this._attribInfo,e},e.getVBW=function(){return this._vb.setNeedUpload(),this._vb},e.getVBR=function(){return this._vb},e.getIBR=function(){return this._ib},e.getIBW=function(){return this._ib.setNeedUpload(),this._ib},e.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,n=0,r=0;t>r;r++)e[i++]=n,e[i++]=n+2,e[i++]=n+1,e[i++]=n,e[i++]=n+3,e[i++]=n+2,n+=4;this._ib.setNeedUpload()},e.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},e.configVAO=function(t){this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,i=0,n=0;e>n;n++){var r=this._attribInfo[i+1],a=this._attribInfo[i],s=this._attribInfo[i+2];t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r,a,!1,this._stride,s),i+=3}WebGLContext.bindVertexArray(t,null)},e.useMesh=function(t){this.configVAO(t);for(var e=this._attribInfo.length/3,i=Buffer._bindedAtributeBuffer,n=0;e>n;n++)i[n]||(t.enableVertexAttribArray(n),i[n]=this._vb);WebGLContext.bindVertexArray(t,this._vao),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},e.getEleNum=function(){return this._ib.getBuffer().byteLength/2},e.releaseMesh=function(){},e.destroy=function(){},e.clearVB=function(){this._vb.clear()},t._gvaoid=0,t}(),RenderState2D=function(){function t(){}return __class(t,"laya.webgl.utils.RenderState2D"),t.mat2MatArray=function(e,i){var n=e,r=i;return r[0]=n.a,r[1]=n.b,r[2]=t.EMPTYMAT4_ARRAY[2],r[3]=t.EMPTYMAT4_ARRAY[3],r[4]=n.c,r[5]=n.d,r[6]=t.EMPTYMAT4_ARRAY[6],r[7]=t.EMPTYMAT4_ARRAY[7],r[8]=t.EMPTYMAT4_ARRAY[8],r[9]=t.EMPTYMAT4_ARRAY[9],r[10]=t.EMPTYMAT4_ARRAY[10],r[11]=t.EMPTYMAT4_ARRAY[11],r[12]=n.tx,r[13]=n.ty,r[14]=t.EMPTYMAT4_ARRAY[14],r[15]=t.EMPTYMAT4_ARRAY[15],i},t.restoreTempArray=function(){t.TEMPMAT4_ARRAY[0]=1,t.TEMPMAT4_ARRAY[1]=0,t.TEMPMAT4_ARRAY[4]=0,t.TEMPMAT4_ARRAY[5]=1,t.TEMPMAT4_ARRAY[12]=0,t.TEMPMAT4_ARRAY[13]=0},t.clear=function(){t.worldScissorTest=!1,t.worldAlpha=1},t._MAXSIZE=99999999,t.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.worldMatrix4=t.TEMPMAT4_ARRAY,t.worldAlpha=1,t.worldScissorTest=!1,t.width=0,t.height=0,__static(t,["worldMatrix",function(){return this.worldMatrix=new Matrix}]),t}(),ShaderCompile=function(){function t(t,i,n,r){function a(t){var i=[],n=new e(i);return s._compileToTree(n,t.split("\n"),0,i,r),n}var s=this,o=Browser.now();this._VS=a(t),this._PS=a(i),this._nameMap=n,Browser.now()-o>2&&console.log("ShaderCompile use time:"+(Browser.now()-o)+"  size:"+t.length+"/"+i.length)}var e,i;__class(t,"laya.webgl.utils.ShaderCompile");var n=t.prototype;return n._compileToTree=function(i,n,r,a,s){var o,l,_,h,u,c,d,f=0,m=0,p=0,g=0;for(m=r;m<n.length;m++)if(_=n[m],!(_.length<1)&&(f=_.indexOf("//"),0!==f)){if(f>=0&&(_=_.substr(0,f)),o=d||new e(a),d=null,o.text=_,o.noCompile=!0,(f=_.indexOf("#"))>=0){for(h="#",g=f+1,p=_.length;p>g;g++){var v=_.charAt(g);if(" "===v||"	"===v||"?"===v)break;h+=v}switch(o.name=h,h){case"#ifdef":case"#ifndef":if(o.src=_,o.noCompile=null!=_.match(/[!&|()=<>]/),o.noCompile?console.log("function():Boolean{return "+_.substr(f+o.name.length)+"}"):(c=_.replace(/^\s*/,"").split(/\s+/),o.setCondition(c[1],"#ifdef"===h?1:2),o.text="//"+o.text),o.setParent(i),i=o,s)for(c=_.substr(g).split(t._splitToWordExps3),g=0;g<c.length;g++)_=c[g],_.length&&(s[_]=!0);continue;case"#if":if(o.src=_,o.noCompile=!0,o.setParent(i),i=o,s)for(c=_.substr(g).split(t._splitToWordExps3),g=0;g<c.length;g++)_=c[g],_.length&&"defined"!=_&&(s[_]=!0);continue;case"#else":o.src=_,i=i.parent,l=i.childs[i.childs.length-1],(o.noCompile=l.noCompile)||(o.condition=l.condition,o.conditionType=1==l.conditionType?2:1,o.text="//"+o.text+" "+l.text+" "+o.conditionType),o.setParent(i),i=o;continue;case"#endif":i=i.parent,l=i.childs[i.childs.length-1],(o.noCompile=l.noCompile)||(o.text="//"+o.text),o.setParent(i);continue;case"#include":c=t.splitToWords(_,null);var x=t.includes[c[1]];if(!x)throw"ShaderCompile error no this include file:"+c[1];if((f=c[0].indexOf("?"))<0){o.setParent(i),_=x.getWith("with"==c[2]?c[3]:null),this._compileToTree(o,_.split("\n"),0,a,s),o.text="";continue}o.setCondition(c[0].substr(f+1),1),o.text=x.getWith("with"==c[2]?c[3]:null);break;case"#import":c=t.splitToWords(_,null),u=c[1],a.push({node:o,file:t.includes[u],ofs:o.text.length});continue}}else{if(l=i.childs[i.childs.length-1],l&&!l.name){a.length>0&&t.splitToWords(_,l),d=o,l.text+="\n"+_;continue}a.length>0&&t.splitToWords(_,o)}o.setParent(i)}},n.createShader=function(t,e,i,n){var r={},a="";if(t)for(var s in t)a+="#define "+s+"\n",r[s]=!0;var o=this._VS.toscript(r,[]),l=this._PS.toscript(r,[]);return(i||Shader.create)(a+o.join("\n"),a+l.join("\n"),e,this._nameMap,n)},t._parseOne=function(e,i,n,r,a,s){var o={type:t.shaderParamsMap[n[r+1]],name:n[r+2],size:isNaN(parseInt(n[r+3]))?1:parseInt(n[r+3])};return s&&("attribute"==a?e.push(o):i.push(o)),":"==n[r+3]&&(o.type=n[r+4],r+=2),r+=2},t.addInclude=function(e,n){if(!n||0===n.length)throw new Error("add shader include file err:"+e);if(t.includes[e])throw new Error("add shader include file err, has add:"+e);t.includes[e]=new i(n)},t.preGetParams=function(e,i){var n=[e,i],r={},a=[],s=[],o={},l=[];r.attributes=a,r.uniforms=s,r.defines=o;for(var _=0,h=0,u=0;2>u;u++){n[u]=n[u].replace(t._removeAnnotation,"");var c,d=n[u].match(t._reg);for(_=0,h=d.length;h>_;_++){var f=d[_];if("attribute"==f||"uniform"==f)_=t._parseOne(a,s,d,_,f,!0);else{if("#define"==f){f=d[++_],l[f]=1;continue}if("#ifdef"==f){c=d[++_];{o[c]=o[c]||[]}for(_++;h>_;_++)if(f=d[_],"attribute"==f||"uniform"==f)_=t._parseOne(a,s,d,_,f,l[c]);else if("#else"==f)for(_++;h>_;_++)if(f=d[_],"attribute"==f||"uniform"==f)_=t._parseOne(a,s,d,_,f,!l[c]);else if("#endif"==f)break}}}}return r},t.splitToWords=function(t,e){for(var i,n,r=[],a=-1,s=0,o=t.length;o>s;s++)if(i=t.charAt(s)," 	=+-*/&%!<>()'\",;".indexOf(i)>=0){if(a>=0&&s-a>1&&(n=t.substr(a,s-a),r.push(n)),'"'==i||"'"==i){var l=t.indexOf(i,s+1);if(0>l)throw"Sharder err:"+t;r.push(t.substr(s+1,l-s-1)),s=l,a=-1;continue}"("==i&&e&&r.length>0&&(n=r[r.length-1]+";","vec4;main;".indexOf(n)<0&&(e.useFuns+=n)),a=-1}else 0>a&&(a=s);return o>a&&o-a>1&&(n=t.substr(a,o-a),r.push(n)),r},t.IFDEF_NO=0,t.IFDEF_YES=1,t.IFDEF_ELSE=2,t.IFDEF_PARENT=3,t._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),t._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),t._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),t.includes={},__static(t,["shaderParamsMap",function(){return this.shaderParamsMap={"float":5126,"int":5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),t.__init$=function(){e=function(){function t(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}__class(t,"");var e=t.prototype;return e.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},e.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},e.toscript=function(e,i){return this._toscript(e,i,++t.__id)},e._toscript=function(t,e,i){if(this.childs.length<1&&!this.text)return e;e.length;if(this.condition){var n=!!this.condition.call(t);if(2===this.conditionType&&(n=!n),!n)return e}if(this.text&&e.push(this.text),this.childs.length>0&&this.childs.forEach(function(n){n._toscript(t,e,i)}),this.includefiles.length>0&&this.useFuns.length>0)for(var r,a=0,s=this.includefiles.length;s>a;a++)this.includefiles[a].curUseID!=i&&(r=this.includefiles[a].file.getFunsScript(this.useFuns),r.length>0&&(this.includefiles[a].curUseID=i,e[0]=r+e[0]));return e},t.__id=1,t}(),i=function(){function e(e){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=e;for(var i=0,n=0,r=0;;){if(i=e.indexOf("#begin",i),0>i)break;for(r=i+5;;){if(r=e.indexOf("#end",r),0>r)break;if("i"!==e.charAt(r+4))break;r+=5}if(0>r)throw"add include err,no #end:"+e;n=e.indexOf("\n",i);var a=t.splitToWords(e.substr(i,n-i),null);"code"==a[1]?this.codes[a[2]]=e.substr(n+1,r-n-1):"function"==a[1]&&(n=e.indexOf("function",i),n+="function".length,this.funs[a[3]]=e.substr(n+1,r-n-1),this.funnames+=a[3]+";"),i=r+1}}__class(e,"");var i=e.prototype;return i.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},i.getFunsScript=function(t){var e="";for(var i in this.funs)t.indexOf(i+";")>=0&&(e+=this.funs[i]);return e},e}()},t}(),WebGL=function(){function t(){}return __class(t,"laya.webgl.WebGL"),t._uint8ArraySlice=function(){for(var t=this,e=t.length,i=new Uint8Array(t.length),n=0;e>n;n++)i[n]=t[n];return i},t._float32ArraySlice=function(){for(var t=this,e=t.length,i=new Float32Array(t.length),n=0;e>n;n++)i[n]=t[n];return i},t._uint16ArraySlice=function(){var t,e=arguments,i=this,n=0,r=0;if(0===e.length)for(n=i.length,t=new Uint16Array(n),r=0;n>r;r++)t[r]=i[r];else if(2===e.length){var a=e[0],s=e[1];if(s>a)for(n=s-a,t=new Uint16Array(n),r=a;s>r;r++)t[r-a]=i[r];else t=new Uint16Array(0)}return t},t.expandContext=function(){var t=Context.prototype,e=CanvasRenderingContext2D.prototype;e.fillTrangles=t.fillTrangles,Buffer2D.__int__(null),e.setIBVB=function(t,e,i,n,r,a,s,o,l,_){void 0===l&&(l=0),void 0===_&&(_=0),null===i&&(this._ib=this._ib||IndexBuffer2D.QuadrangleIB,i=this._ib,GlUtils.expandIBQuadrangle(i,n.byteLength/64+8)),this._setIBVB(t,e,i,n,r,a,s,o,l,_)},e.fillTrangles=function(t,e,i,n,r){this._curMat=this._curMat||Matrix.create(),this._vb=this._vb||VertexBuffer2D.create(),this._ib||(this._ib=IndexBuffer2D.create(),GlUtils.fillIBQuadrangle(this._ib,s/4));var a=this._vb,s=n.length>>4;GlUtils.fillTranglesVB(a,e,i,n,r||this._curMat,0,0),GlUtils.expandIBQuadrangle(this._ib,a.byteLength/64+8);var o=new Value2D(1,0);o.textureHost=t;var l=new Shader2X("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");a._vertType=3,this._setIBVB(e,i,this._ib,a,6*s,r,l,o,0,0)}},t.enable=function(){function e(e){var i,n=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];Config.useWebGL2||n.shift();for(var r=0;r<n.length;r++){try{i=e.getContext(n[r],{stencil:Config.isStencil,alpha:Config.isAlpha,antialias:Config.isAntialias,premultipliedAlpha:Config.premultipliedAlpha,preserveDrawingBuffer:Config.preserveDrawingBuffer})}catch(a){}if(i)return"webgl2"===n[r]&&(laya.webgl.WebGL._isWebGL2=!0),r>=2&&(t._isExperimentalWebgl=!0),new LayaGL(i),i}return null}if(Browser.__init__(),Render.isConchApp){HTMLImage.create=function(){return new Texture2D(1,!0,!1)};var i=BaseTexture;return i.prototype._getGLFormat=i.prototype._getGLFormatForNative,WebGLContext.__init_native(),RenderState2D.width=Browser.window.innerWidth,RenderState2D.height=Browser.window.innerHeight,!0}if(t.mainContext=e(Render._mainCanvas),null==t.mainContext)return!1;if(Render.isWebGL)return!0;var n=t.mainContext;if(WebGLContext.__init__(n),!laya.webgl.WebGL._isWebGL2){var r=n.rawgl||n,a=r.getExtension("OES_vertex_array_object");a?(console.log("EXT:webgl support OES_vertex_array_object！"),n.createVertexArray=function(){return a.createVertexArrayOES()},n.bindVertexArray=function(t){a.bindVertexArrayOES(t)}):(n.createVertexArray=function(){throw"not implemented"},n.bindVertexArray=function(){throw"not implemented"})}HTMLImage.create=function(){return new Texture2D(1,!0,!1)},Render.WebGL=t,Render.isWebGL=!0,RunDriver.createRenderSprite=function(t,e){return new RenderSprite3D(t,e)},RunDriver.createWebGLContext2D=function(t){return new WebGLContext2D(t)},RunDriver.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},RunDriver.createGraphics=function(){return new GraphicsGL};var s=RunDriver.createFilterAction;return RunDriver.createFilterAction=s?s:function(){return new ColorFilterActionGL},RunDriver.clear=function(t){RenderState2D.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=Render.context,i=0==e._submits._length||Config.preserveDrawingBuffer?Color.create(t).arrColor:Laya.stage._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),RenderState2D.clear()},RunDriver.drawToCanvas=function(){},RunDriver.createFilterAction=function(t){var e;switch(t){case 32:e=new ColorFilterActionGL}return e},RunDriver.getTexturePixels=function(t,e,i,n,r){Render.context.clear();var a=new Sprite;a.graphics.drawImage(t,-e,-i);var s=laya.webgl.resource.RenderTarget2D.create(n,r);s.start(),s.clear(0,0,0,0),a.render(Render.context,0,0),Render.context.flush(),s.end();for(var o=s.getData(0,0,n,r),l=[],_=0,h=r-1;h>=0;h--)for(var u=0;n>u;u++)_=4*(h*n+u),l.push(o[_]),l.push(o[_+1]),l.push(o[_+2]),l.push(o[_+3]);return l},RunDriver.skinAniSprite=function(){var t=new SkinMesh;return t},Filter._recycleScope=function(t){t.recycle()},Filter._filter2=function(t,e,i,n){var r=this._next;if(r){var a=t.filters,s=a.length;if(1==s&&32==a[0].type)return e.save(),e.setFilters([a[0]]),r._fun.call(r,t,e,i,n),e.restore(),void 0;var o=e,l=(o._submits,t),_=(l._cacheStyle.canvas.context,e._getTransformMatrix(),t._$P._filterCache?t._$P._filterCache:null);if(!_||t._repaint){var h=t.getSelfBounds(),u=h.width,c=h.height,d=(WebGLRTMgr.getRT(u,c),0),f=t.x-i+d,m=t.y-n+d;r._fun.call(r,t,e,f,m),t._set$P("_filterCache",_)}}},Filter._filter=function(t,e,i,n){var r=this._next;if(r){var a=t.filters,s=a.length;if(1==s&&32==a[0].type)return e.save(),e.setFilters([a[0]]),r._fun.call(r,t,e,i,n),e.restore(),void 0;var o,l,_=SubmitCMDScope.create(),h=Point.TEMP,u=e._getTransformMatrix(),c=Matrix.create();u.copyTo(c);var d=0,f=0,m=!1,p=t._$P._filterCache?t._$P._filterCache:null;if(!p||t._repaint){m=t._isHaveGlowFilter(),_.addValue("_isHaveGlowFilter",m),m&&(d=50,f=25),l=new Rectangle,l.copyFrom(t.getSelfBounds()),l.x+=t.x,l.y+=t.y,l.x-=t.pivotX+4,l.y-=t.pivotY+4;var g=l.x,v=l.y;if(l.width+=d+8,l.height+=d+8,h.x=l.x*c.a+l.y*c.c,h.y=l.y*c.d+l.x*c.b,l.x=h.x,l.y=h.y,h.x=l.width*c.a+l.height*c.c,h.y=l.height*c.d+l.width*c.b,l.width=h.x,l.height=h.y,l.width<=0||l.height<=0)return;p&&WebGLRTMgr.releaseRT(p),_.addValue("bounds",l);var x=WebGLRTMgr.getRT(l.width,l.height);_.addValue("src",x);var y=WebGLRTMgr.getRT(l.width,l.height);_.addValue("out",y),t._set$P("_filterCache",p);var T=e;T.pushRT(),T.useRT(x);var D=t.x-g+f,E=t.y-v+f;r._fun.call(r,t,e,D,E),T.useRT(y);for(var S=0;s>S;S++){0!=S&&(T.useRT(x),o=Value2D.create(1,0),Matrix.TEMP.identity(),T.drawTarget(_,0,0,l.width,l.height,Matrix.TEMP,"out",o,null,BlendMode.TOINT.overlay),T.useRT(y));var M=a[S];M.action.apply3d(_,t,e,0,0)}T.popRT()}else{if(m=t._$P._isHaveGlowFilter?t._$P._isHaveGlowFilter:!1,m&&(d=50,f=25),l=t.getBounds(),l.width<=0||l.height<=0)return;l.width+=d,l.height+=d,h.x=l.x*c.a+l.y*c.c,h.y=l.y*c.d+l.x*c.b,l.x=h.x,l.y=h.y,h.x=l.width*c.a+l.height*c.c,h.y=l.height*c.d+l.width*c.b,l.width=h.x,l.height=h.y,_.addValue("out",p)}i=i-f-t.x,n=n-f-t.y,h.setTo(i,n),c.transformPoint(h),i=h.x+l.x,n=h.y+l.y,o=Value2D.create(1,0),Matrix.TEMP.identity(),T._drawRenderTexture(y,i,n,l.width,l.height,Matrix.TEMP,1,RenderTexture2D.defuv);var R=SubmitCMD.create([_],Filter._recycleScope);e.addRenderObject(R),c.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=t._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=t._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=t._uint8ArraySlice),!0},t.onStageResize=function(e,i){null!=t.mainContext&&(t.mainContext.viewport(0,0,e,i),RenderState2D.width=e,RenderState2D.height=i)},t.isExperimentalWebgl=function(){return t._isExperimentalWebgl},t.onInvalidGLRes=function(){ResourceManager.releaseContentManagers(!0),t.doNodeRepaint(Laya.stage),t.mainContext.viewport(0,0,RenderState2D.width,RenderState2D.height),Laya.stage.event("devicelost")},t.doNodeRepaint=function(e){0==e.numChildren&&e.repaint();for(var i=0;i<e.numChildren;i++)t.doNodeRepaint(e.getChildAt(i))},t.init=function(e,i,n){t.mainCanvas=e,HTMLCanvas._createContext=function(t){return new WebGLContext2D(t)},t._isExperimentalWebgl=t._isExperimentalWebgl&&(Browser.onWeiXin||Browser.onMQQBrowser),t.shaderHighPrecision=!1;var r=laya.webgl.WebGL.mainContext;try{var a=r.getShaderPrecisionFormat(35632,36338);t.shaderHighPrecision=a.precision?!0:!1}catch(s){}if(r.deleteTexture1=r.deleteTexture,r.deleteTexture=function(t){t==WebGLContext.curBindTexValue&&(WebGLContext.curBindTexValue=null),r.deleteTexture1(t)},t.onStageResize(i,n),null==t.mainContext)throw new Error("webGL getContext err!");LayaGL.instance=t.mainContext,System.__init__(),ShaderDefines2D.__init__(),Submit.__init__(),WebGLContext2D.__init__(),Value2D.__init__(),Shader2D.__init__(),Buffer2D.__int__(r),BlendMode._init_(r)},t.mainCanvas=null,t.mainContext=null,t.antialias=!0,t.shaderHighPrecision=!1,t._bg_null=[0,0,0,0],t._isExperimentalWebgl=!1,t._isWebGL2=!1,t}(),WebGLContext=function(){function t(){}__class(t,"laya.webgl.WebGLContext");var e=t.prototype;return e.getContextAttributes=function(){return null},e.isContextLost=function(){},e.getSupportedExtensions=function(){return null},e.getExtension=function(){return null},e.activeTexture=function(){},e.attachShader=function(){},e.bindAttribLocation=function(){},e.bindBuffer=function(){},e.bindFramebuffer=function(){},e.bindRenderbuffer=function(){},e.bindTexture=function(){},e.useTexture=function(){},e.blendColor=function(){},e.blendEquation=function(){},e.blendEquationSeparate=function(){},e.blendFunc=function(){},e.blendFuncSeparate=function(){},e.bufferData=function(){},e.bufferSubData=function(){},e.checkFramebufferStatus=function(){return null},e.clear=function(){},e.clearColor=function(){},e.clearDepth=function(){},e.clearStencil=function(){},e.colorMask=function(){},e.compileShader=function(){},e.copyTexImage2D=function(){},e.copyTexSubImage2D=function(){},e.createBuffer=function(){},e.createFramebuffer=function(){},e.createProgram=function(){},e.createRenderbuffer=function(){},e.createShader=function(){},e.createTexture=function(){return null},e.cullFace=function(){},e.deleteBuffer=function(){},e.deleteFramebuffer=function(){},e.deleteProgram=function(){},e.deleteRenderbuffer=function(){},e.deleteShader=function(){},e.deleteTexture=function(){},e.depthFunc=function(){},e.depthMask=function(){},e.depthRange=function(){},e.detachShader=function(){},e.disable=function(){},e.disableVertexAttribArray=function(){},e.drawArrays=function(){},e.drawElements=function(){},e.enable=function(){},e.enableVertexAttribArray=function(){},e.finish=function(){},e.flush=function(){},e.framebufferRenderbuffer=function(){},e.framebufferTexture2D=function(){},e.frontFace=function(){return null},e.generateMipmap=function(){return null},e.getActiveAttrib=function(){return null},e.getActiveUniform=function(){return null},e.getAttribLocation=function(){return 0},e.getParameter=function(){return null},e.getBufferParameter=function(){return null},e.getError=function(){return null},e.getFramebufferAttachmentParameter=function(){},e.getProgramParameter=function(){return 0},e.getProgramInfoLog=function(){return null},e.getRenderbufferParameter=function(){return null},e.getShaderPrecisionFormat=function(){return null},e.getShaderParameter=function(){},e.getShaderInfoLog=function(){return null},e.getShaderSource=function(){return null},e.getTexParameter=function(){},e.getUniform=function(){},e.getUniformLocation=function(){return null},e.getVertexAttrib=function(){return null},e.getVertexAttribOffset=function(){return null},e.hint=function(){},e.isBuffer=function(){},e.isEnabled=function(){},e.isFramebuffer=function(){},e.isProgram=function(){},e.isRenderbuffer=function(){},e.isShader=function(){},e.isTexture=function(){},e.lineWidth=function(){},e.linkProgram=function(){},e.pixelStorei=function(){},e.polygonOffset=function(){},e.readPixels=function(){},e.renderbufferStorage=function(){},e.sampleCoverage=function(){},e.scissor=function(){},e.shaderSource=function(){},e.stencilFunc=function(){},e.stencilFuncSeparate=function(){},e.stencilMask=function(){},e.stencilMaskSeparate=function(){},e.stencilOp=function(){},e.stencilOpSeparate=function(){},e.texImage2D=function(){},e.texParameterf=function(){},e.texParameteri=function(){},e.texSubImage2D=function(){},e.uniform1f=function(){},e.uniform1fv=function(){},e.uniform1i=function(){},e.uniform1iv=function(){},e.uniform2f=function(){},e.uniform2fv=function(){},e.uniform2i=function(){},e.uniform2iv=function(){},e.uniform3f=function(){},e.uniform3fv=function(){},e.uniform3i=function(){},e.uniform3iv=function(){},e.uniform4f=function(){},e.uniform4fv=function(){},e.uniform4i=function(){},e.uniform4iv=function(){},e.uniformMatrix2fv=function(){},e.uniformMatrix3fv=function(){},e.uniformMatrix4fv=function(){},e.useProgram=function(){},e.validateProgram=function(){},e.vertexAttrib1f=function(){},e.vertexAttrib1fv=function(){},e.vertexAttrib2f=function(){},e.vertexAttrib2fv=function(){},e.vertexAttrib3f=function(){},e.vertexAttrib3fv=function(){},e.vertexAttrib4f=function(){},e.vertexAttrib4fv=function(){},e.vertexAttribPointer=function(){},e.viewport=function(){},e.configureBackBuffer=function(t,e,i,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1)},e.compressedTexImage2D=function(){},t.__init__=function(e){t.__init_native(),t.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic")},t.__init_native=function(){Render.isConchApp&&(laya.webgl.WebGLContext.useProgram=laya.webgl.WebGLContext.useProgramForNative,laya.webgl.WebGLContext.activeTexture=laya.webgl.WebGLContext.activeTextureForNative,laya.webgl.WebGLContext.bindTexture=laya.webgl.WebGLContext.bindTextureForNative,laya.webgl.WebGLContext.bindVertexArray=laya.webgl.WebGLContext.bindVertexArrayForNative,laya.webgl.WebGLContext.setDepthTest=laya.webgl.WebGLContext.setDepthTestForNative,laya.webgl.WebGLContext.setDepthMask=laya.webgl.WebGLContext.setDepthMaskForNative,laya.webgl.WebGLContext.setDepthFunc=laya.webgl.WebGLContext.setDepthFuncForNative,laya.webgl.WebGLContext.setBlend=laya.webgl.WebGLContext.setBlendForNative,laya.webgl.WebGLContext.setBlendFunc=laya.webgl.WebGLContext.setBlendFuncForNative,laya.webgl.WebGLContext.setCullFace=laya.webgl.WebGLContext.setCullFaceForNative,laya.webgl.WebGLContext.setFrontFace=laya.webgl.WebGLContext.setFrontFaceForNative)},t.useProgram=function(e,i){return t._useProgram===i?!1:(e.useProgram(i),t._useProgram=i,!0)},t.setDepthTest=function(e,i){i!==t._depthTest&&(t._depthTest=i,i?e.enable(2929):e.disable(2929))},t.setDepthMask=function(e,i){i!==t._depthMask&&(t._depthMask=i,e.depthMask(i))},t.setDepthFunc=function(e,i){i!==t._depthFunc&&(t._depthFunc=i,e.depthFunc(i))},t.setBlend=function(e,i){i!==t._blend&&(t._blend=i,i?e.enable(3042):e.disable(3042))},t.setBlendFunc=function(e,i,n){(i!==t._sFactor||n!==t._dFactor)&&(t._sFactor=i,t._dFactor=n,e.blendFunc(i,n))},t.setCullFace=function(e,i){i!==t._cullFace&&(t._cullFace=i,i?e.enable(2884):e.disable(2884))},t.setFrontFace=function(e,i){i!==t._frontFace&&(t._frontFace=i,e.frontFace(i))},t.activeTexture=function(e,i){t._activedTextureID!==i&&(e.activeTexture(i),t._activedTextureID=i)},t.bindTexture=function(e,i,n){t._activeTextures[t._activedTextureID-33984]!==n&&(e.bindTexture(i,n),t._activeTextures[t._activedTextureID-33984]=n)},t.bindVertexArray=function(e,i){t._bindedVAO!==i&&(e.bindVertexArray(i),t._bindedVAO=i)},t.useProgramForNative=function(t,e){return t.useProgram(e),!0},t.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},t.setDepthMaskForNative=function(t,e){t.depthMask(e)},t.setDepthFuncForNative=function(t,e){t.depthFunc(e)},t.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},t.setBlendFuncForNative=function(t,e,i){t.blendFunc(e,i)},t.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},t.setFrontFaceForNative=function(t,e){t.frontFace(e)},t.activeTextureForNative=function(t,e){t.activeTexture(e)},t.bindTextureForNative=function(t,e,i){t.bindTexture(e,i)},t.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},t.DEPTH_BUFFER_BIT=256,t.STENCIL_BUFFER_BIT=1024,t.COLOR_BUFFER_BIT=16384,t.POINTS=0,t.LINES=1,t.LINE_LOOP=2,t.LINE_STRIP=3,t.TRIANGLES=4,t.TRIANGLE_STRIP=5,t.TRIANGLE_FAN=6,t.ZERO=0,t.ONE=1,t.SRC_COLOR=768,t.ONE_MINUS_SRC_COLOR=769,t.SRC_ALPHA=770,t.ONE_MINUS_SRC_ALPHA=771,t.DST_ALPHA=772,t.ONE_MINUS_DST_ALPHA=773,t.DST_COLOR=774,t.ONE_MINUS_DST_COLOR=775,t.SRC_ALPHA_SATURATE=776,t.FUNC_ADD=32774,t.BLEND_EQUATION=32777,t.BLEND_EQUATION_RGB=32777,t.BLEND_EQUATION_ALPHA=34877,t.FUNC_SUBTRACT=32778,t.FUNC_REVERSE_SUBTRACT=32779,t.BLEND_DST_RGB=32968,t.BLEND_SRC_RGB=32969,t.BLEND_DST_ALPHA=32970,t.BLEND_SRC_ALPHA=32971,t.CONSTANT_COLOR=32769,t.ONE_MINUS_CONSTANT_COLOR=32770,t.CONSTANT_ALPHA=32771,t.ONE_MINUS_CONSTANT_ALPHA=32772,t.BLEND_COLOR=32773,t.ARRAY_BUFFER=34962,t.ELEMENT_ARRAY_BUFFER=34963,t.ARRAY_BUFFER_BINDING=34964,t.ELEMENT_ARRAY_BUFFER_BINDING=34965,t.STREAM_DRAW=35040,t.STATIC_DRAW=35044,t.DYNAMIC_DRAW=35048,t.BUFFER_SIZE=34660,t.BUFFER_USAGE=34661,t.CURRENT_VERTEX_ATTRIB=34342,t.FRONT=1028,t.BACK=1029,t.CULL_FACE=2884,t.FRONT_AND_BACK=1032,t.BLEND=3042,t.DITHER=3024,t.STENCIL_TEST=2960,t.DEPTH_TEST=2929,t.SCISSOR_TEST=3089,t.POLYGON_OFFSET_FILL=32823,t.SAMPLE_ALPHA_TO_COVERAGE=32926,t.SAMPLE_COVERAGE=32928,t.NO_ERROR=0,t.INVALID_ENUM=1280,t.INVALID_VALUE=1281,t.INVALID_OPERATION=1282,t.OUT_OF_MEMORY=1285,t.CW=2304,t.CCW=2305,t.LINE_WIDTH=2849,t.ALIASED_POINT_SIZE_RANGE=33901,t.ALIASED_LINE_WIDTH_RANGE=33902,t.CULL_FACE_MODE=2885,t.FRONT_FACE=2886,t.DEPTH_RANGE=2928,t.DEPTH_WRITEMASK=2930,t.DEPTH_CLEAR_VALUE=2931,t.DEPTH_FUNC=2932,t.STENCIL_CLEAR_VALUE=2961,t.STENCIL_FUNC=2962,t.STENCIL_FAIL=2964,t.STENCIL_PASS_DEPTH_FAIL=2965,t.STENCIL_PASS_DEPTH_PASS=2966,t.STENCIL_REF=2967,t.STENCIL_VALUE_MASK=2963,t.STENCIL_WRITEMASK=2968,t.STENCIL_BACK_FUNC=34816,t.STENCIL_BACK_FAIL=34817,t.STENCIL_BACK_PASS_DEPTH_FAIL=34818,t.STENCIL_BACK_PASS_DEPTH_PASS=34819,t.STENCIL_BACK_REF=36003,t.STENCIL_BACK_VALUE_MASK=36004,t.STENCIL_BACK_WRITEMASK=36005,t.VIEWPORT=2978,t.SCISSOR_BOX=3088,t.COLOR_CLEAR_VALUE=3106,t.COLOR_WRITEMASK=3107,t.UNPACK_ALIGNMENT=3317,t.PACK_ALIGNMENT=3333,t.MAX_TEXTURE_SIZE=3379,t.MAX_VIEWPORT_DIMS=3386,t.SUBPIXEL_BITS=3408,t.RED_BITS=3410,t.GREEN_BITS=3411,t.BLUE_BITS=3412,t.ALPHA_BITS=3413,t.DEPTH_BITS=3414,t.STENCIL_BITS=3415,t.POLYGON_OFFSET_UNITS=10752,t.POLYGON_OFFSET_FACTOR=32824,t.TEXTURE_BINDING_2D=32873,t.SAMPLE_BUFFERS=32936,t.SAMPLES=32937,t.SAMPLE_COVERAGE_VALUE=32938,t.SAMPLE_COVERAGE_INVERT=32939,t.NUM_COMPRESSED_TEXTURE_FORMATS=34466,t.COMPRESSED_TEXTURE_FORMATS=34467,t.DONT_CARE=4352,t.FASTEST=4353,t.NICEST=4354,t.GENERATE_MIPMAP_HINT=33170,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.DEPTH_COMPONENT=6402,t.ALPHA=6406,t.RGB=6407,t.RGBA=6408,t.LUMINANCE=6409,t.LUMINANCE_ALPHA=6410,t.UNSIGNED_SHORT_4_4_4_4=32819,t.UNSIGNED_SHORT_5_5_5_1=32820,t.UNSIGNED_SHORT_5_6_5=33635,t.FRAGMENT_SHADER=35632,t.VERTEX_SHADER=35633,t.MAX_VERTEX_ATTRIBS=34921,t.MAX_VERTEX_UNIFORM_VECTORS=36347,t.MAX_VARYING_VECTORS=36348,t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,t.MAX_TEXTURE_IMAGE_UNITS=34930,t.MAX_FRAGMENT_UNIFORM_VECTORS=36349,t.SHADER_TYPE=35663,t.DELETE_STATUS=35712,t.LINK_STATUS=35714,t.VALIDATE_STATUS=35715,t.ATTACHED_SHADERS=35717,t.ACTIVE_UNIFORMS=35718,t.ACTIVE_ATTRIBUTES=35721,t.SHADING_LANGUAGE_VERSION=35724,t.CURRENT_PROGRAM=35725,t.NEVER=512,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.NOTEQUAL=517,t.GEQUAL=518,t.ALWAYS=519,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.VENDOR=7936,t.RENDERER=7937,t.VERSION=7938,t.NEAREST=9728,t.LINEAR=9729,t.NEAREST_MIPMAP_NEAREST=9984,t.LINEAR_MIPMAP_NEAREST=9985,t.NEAREST_MIPMAP_LINEAR=9986,t.LINEAR_MIPMAP_LINEAR=9987,t.TEXTURE_MAG_FILTER=10240,t.TEXTURE_MIN_FILTER=10241,t.TEXTURE_WRAP_S=10242,t.TEXTURE_WRAP_T=10243,t.TEXTURE_2D=3553,t.TEXTURE_3D=32879,t.TEXTURE=5890,t.TEXTURE_CUBE_MAP=34067,t.TEXTURE_BINDING_CUBE_MAP=34068,t.TEXTURE_CUBE_MAP_POSITIVE_X=34069,t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,t.MAX_CUBE_MAP_TEXTURE_SIZE=34076,t.TEXTURE0=33984,t.TEXTURE1=33985,t.TEXTURE2=33986,t.TEXTURE3=33987,t.TEXTURE4=33988,t.TEXTURE5=33989,t.TEXTURE6=33990,t.TEXTURE7=33991,t.TEXTURE8=33992,t.TEXTURE9=33993,t.TEXTURE10=33994,t.TEXTURE11=33995,t.TEXTURE12=33996,t.TEXTURE13=33997,t.TEXTURE14=33998,t.TEXTURE15=33999,t.TEXTURE16=34e3,t.TEXTURE17=34001,t.TEXTURE18=34002,t.TEXTURE19=34003,t.TEXTURE20=34004,t.TEXTURE21=34005,t.TEXTURE22=34006,t.TEXTURE23=34007,t.TEXTURE24=34008,t.TEXTURE25=34009,t.TEXTURE26=34010,t.TEXTURE27=34011,t.TEXTURE28=34012,t.TEXTURE29=34013,t.TEXTURE30=34014,t.TEXTURE31=34015,t.ACTIVE_TEXTURE=34016,t.REPEAT=10497,t.CLAMP_TO_EDGE=33071,t.MIRRORED_REPEAT=33648,t.FLOAT_VEC2=35664,t.FLOAT_VEC3=35665,t.FLOAT_VEC4=35666,t.INT_VEC2=35667,t.INT_VEC3=35668,t.INT_VEC4=35669,t.BOOL=35670,t.BOOL_VEC2=35671,t.BOOL_VEC3=35672,t.BOOL_VEC4=35673,t.FLOAT_MAT2=35674,t.FLOAT_MAT3=35675,t.FLOAT_MAT4=35676,t.SAMPLER_2D=35678,t.SAMPLER_CUBE=35680,t.VERTEX_ATTRIB_ARRAY_ENABLED=34338,t.VERTEX_ATTRIB_ARRAY_SIZE=34339,t.VERTEX_ATTRIB_ARRAY_STRIDE=34340,t.VERTEX_ATTRIB_ARRAY_TYPE=34341,t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,t.VERTEX_ATTRIB_ARRAY_POINTER=34373,t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,t.COMPILE_STATUS=35713,t.LOW_FLOAT=36336,t.MEDIUM_FLOAT=36337,t.HIGH_FLOAT=36338,t.LOW_INT=36339,t.MEDIUM_INT=36340,t.HIGH_INT=36341,t.FRAMEBUFFER=36160,t.RENDERBUFFER=36161,t.RGBA4=32854,t.RGB5_A1=32855,t.RGB565=36194,t.DEPTH_COMPONENT16=33189,t.STENCIL_INDEX=6401,t.STENCIL_INDEX8=36168,t.DEPTH_STENCIL=34041,t.RENDERBUFFER_WIDTH=36162,t.RENDERBUFFER_HEIGHT=36163,t.RENDERBUFFER_INTERNAL_FORMAT=36164,t.RENDERBUFFER_RED_SIZE=36176,t.RENDERBUFFER_GREEN_SIZE=36177,t.RENDERBUFFER_BLUE_SIZE=36178,t.RENDERBUFFER_ALPHA_SIZE=36179,t.RENDERBUFFER_DEPTH_SIZE=36180,t.RENDERBUFFER_STENCIL_SIZE=36181,t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,t.COLOR_ATTACHMENT0=36064,t.DEPTH_ATTACHMENT=36096,t.STENCIL_ATTACHMENT=36128,t.DEPTH_STENCIL_ATTACHMENT=33306,t.NONE=0,t.FRAMEBUFFER_COMPLETE=36053,t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,t.FRAMEBUFFER_UNSUPPORTED=36061,t.FRAMEBUFFER_BINDING=36006,t.RENDERBUFFER_BINDING=36007,t.MAX_RENDERBUFFER_SIZE=34024,t.INVALID_FRAMEBUFFER_OPERATION=1286,t.UNPACK_FLIP_Y_WEBGL=37440,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,t.CONTEXT_LOST_WEBGL=37442,t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,t.BROWSER_DEFAULT_WEBGL=37444,t.extTextureFilterAnisotropic=null,t._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],t._useProgram=null,t._depthTest=!0,t._depthMask=!0,t._depthFunc=513,t._blend=!1,t._sFactor=1,t._dFactor=0,t._cullFace=!1,t._frontFace=2305,t._activedTextureID=33984,t._bindedVAO=null,__static(t,["_activeTextures",function(){return this._activeTextures=new Array(8)
}]),t}(),AnimationContent=function(){function t(){this.nodes=null,this.name=null,this.playTime=0/0,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return __class(t,"laya.ani.AnimationContent"),t}(),AnimationNodeContent=function(){function t(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=0/0,this.extenData=null,this.dataOffset=0}return __class(t,"laya.ani.AnimationNodeContent"),t}(),AnimationParser01=function(){function t(){}return __class(t,"laya.ani.AnimationParser01"),t.parse=function(t,e){var i=e.__getBuffer(),n=0,r=0,a=0,s=0,o=0,l=0,_=0,h=e.readUTFString();t._aniClassName=h;var u,c=e.readUTFString().split("\n"),d=e.getUint8(),f=e.getUint32(),m=e.getUint32();f>0&&(u=i.slice(f,m));var p=new Byte(u);for(m>0&&(t._publicExtData=i.slice(m,i.byteLength)),t._useParent=!!e.getUint8(),t._anis.length=d,n=0;d>n;n++){var g=t._anis[n]=new AnimationContent;g.nodes=new Array;var v=g.name=c[e.getUint16()];t._aniMap[v]=n,g.bone3DMap={},g.playTime=e.getFloat32();var x=g.nodes.length=e.getUint8();for(g.totalKeyframeDatasLength=0,r=0;x>r;r++){var y=g.nodes[r]=new AnimationNodeContent;y.childs=[];var T=e.getInt16();T>=0&&(y.name=c[T],g.bone3DMap[y.name]=r),y.keyFrame=new Array,y.parentIndex=e.getInt16(),y.parent=-1==y.parentIndex?null:g.nodes[y.parentIndex],y.lerpType=e.getUint8();var D=e.getUint32();p.pos=D;var E=y.keyframeWidth=p.getUint16();if(g.totalKeyframeDatasLength+=E,0===y.lerpType||1===y.lerpType)for(y.interpolationMethod=[],y.interpolationMethod.length=E,a=0;E>a;a++)y.interpolationMethod[a]=AnimationTemplet.interpolation[p.getUint8()];null!=y.parent&&y.parent.childs.push(y);var S=e.getUint16();S>0&&(y.extenData=i.slice(e.pos,e.pos+S),e.pos+=S);var M=e.getUint16();y.keyFrame.length=M;var R,A=0;for(a=0,s=M;s>a;a++){if(R=y.keyFrame[a]=new KeyFramesContent,R.duration=e.getFloat32(),R.startTime=A,2===y.lerpType){R.interpolationData=[];var C=e.getUint8(),L=0;switch(L=e.getFloat32()){case 254:for(R.interpolationData.length=E,_=0;E>_;_++)R.interpolationData[_]=0;break;case 255:for(R.interpolationData.length=E,_=0;E>_;_++)R.interpolationData[_]=5;break;default:for(R.interpolationData.push(L),l=1;C>l;l++)R.interpolationData.push(e.getFloat32())}}for(R.data=new Float32Array(E),R.dData=new Float32Array(E),R.nextData=new Float32Array(E),o=0;E>o;o++)R.data[o]=e.getFloat32(),R.data[o]>-1e-8&&R.data[o]<1e-8&&(R.data[o]=0);A+=R.duration}R.startTime=g.playTime,y.playTime=g.playTime,t._calculateKeyFrame(y,M,E)}}},t}(),AnimationParser02=function(){function t(){}return __class(t,"laya.ani.AnimationParser02"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;e>r;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;i>r;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._templet=e,t._reader=i;i.__getBuffer();t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;r>n;n++){var a=i.getUint16(),s=t._strings[a],o=t["READ_"+s];if(null==o)throw new Error("model file err,no this function:"+a+" "+s);o.call()}},t.READ_ANIMATIONS=function(){var e=t._reader,i=e.__getBuffer(),n=0,r=0,a=0,s=0,o=e.getUint16(),l=[];for(l.length=o,n=0;o>n;n++)l[n]=AnimationTemplet.interpolation[e.getByte()];var _=e.getUint8();for(t._templet._anis.length=_,n=0;_>n;n++){var h=t._templet._anis[n]={};h.nodes=new Array;var u=h.name=t._strings[e.getUint16()];t._templet._aniMap[u]=n,h.bone3DMap={},h.playTime=e.getFloat32();var c=h.nodes.length=e.getInt16();for(h.totalKeyframeDatasLength=0,r=0;c>r;r++){var d=h.nodes[r]={};d.keyframeWidth=o,d.childs=[];var f=e.getUint16();f>=0&&(d.name=t._strings[f],h.bone3DMap[d.name]=r),d.keyFrame=new Array,d.parentIndex=e.getInt16(),d.parent=-1==d.parentIndex?null:h.nodes[d.parentIndex],h.totalKeyframeDatasLength+=o,d.interpolationMethod=l,null!=d.parent&&d.parent.childs.push(d);var m=e.getUint16();d.keyFrame.length=m;var p=null,g=null;for(a=0,s=m;s>a;a++){p=d.keyFrame[a]={},p.startTime=e.getFloat32(),g&&(g.duration=p.startTime-g.startTime),p.dData=new Float32Array(o),p.nextData=new Float32Array(o);var v=t._DATA.offset,x=e.getUint32(),y=4*o,T=i.slice(v+x,v+x+y);p.data=new Float32Array(T),g=p}p.duration=0,d.playTime=h.playTime,t._templet._calculateKeyFrame(d,m,o)}}},t._templet=null,t._reader=null,t._strings=[],__static(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),AnimationState=function(){function t(){}return __class(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2,t}(),KeyFramesContent=function(){function t(){this.startTime=0/0,this.duration=0/0,this.interpolationData=null,this.data=null,this.dData=null,this.nextData=null}return __class(t,"laya.ani.KeyFramesContent"),t}(),BezierLerp=function(){function t(){}return __class(t,"laya.ani.math.BezierLerp"),t.getBezierRate=function(e,i,n,r,a){var s=t._getBezierParamKey(i,n,r,a),o=100*s+e;if(t._bezierResultCache[o])return t._bezierResultCache[o];var l=t._getBezierPoints(i,n,r,a,s),_=0,h=0;for(h=l.length,_=0;h>_;_+=2)if(e<=l[_])return t._bezierResultCache[o]=l[_+1],l[_+1];return t._bezierResultCache[o]=1,1},t._getBezierParamKey=function(t,e,i,n){return 100*(100*(100*(100*t+e)+i)+n)},t._getBezierPoints=function(e,i,n,r,a){if(t._bezierPointsCache[a])return t._bezierPointsCache[a];var s;s=[0,0,e,i,n,r,1,1];var o;o=new Bezier;var l;return l=o.getBezierPoints(s,100,3),t._bezierPointsCache[a]=l,l},t._bezierResultCache={},t._bezierPointsCache={},t}(),AnimationClipParser01=function(){function t(){}return __class(t,"laya.d3.animation.AnimationClipParser01"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;e>r;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;i>r;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._animationClip=e,t._reader=i;i.__getBuffer();t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;r>n;n++){var a=i.getUint16(),s=t._strings[a],o=t["READ_"+s];if(null==o)throw new Error("model file err,no this function:"+a+" "+s);o.call()}},t.READ_ANIMATIONS=function(){var e,i=0,n=0,r=t._reader,a=r.__getBuffer(),s=[],o=r.getUint8();for(s.length=o,i=0;o>i;i++)s[i]=r.getUint16();var l=[],_=r.getUint16();for(l.length=_,i=0;_>i;i++)l[i]=r.getFloat32();var h=t._animationClip;h.name=t._strings[r.getUint16()];var u=h._duration=r.getFloat32();h.islooping=!!r.getByte(),h._frameRate=r.getInt16();var c=r.getInt16(),d=h._nodes=new Array;d.length=c;var f=h._publicClipDatas=[];f.length=c;var m=h._nodesMap={};for(i=0;c>i;i++){e=d[i]=new KeyframeNode,e._indexInList=i;var p=r.getUint16(),g=e.path=[];for(g.length=p,n=0;p>n;n++)g[n]=t._strings[r.getUint16()];var v=g.join("/"),x=m[v];x||(m[v]=x=[]),x.push(e);var y=r.getInt16();-1!==y&&(e.componentType=t._strings[y]);var T=AnimationNode._propertyIndexDic[t._strings[r.getUint16()]];if(null==T)throw new Error("AnimationClipParser01:unknown property name.");e.propertyNameID=T;var D=s[r.getUint8()];e.keyFrameWidth=D/4;var E=e.keyFrames=[],S=E.length=r.getUint16(),M=null,R=0/0;for(n=0;S>n;n++){var A=E[n]=new Keyframe;R=A.startTime=l[r.getUint16()];var C=r.pos;A.inTangent=new Float32Array(a.slice(C,C+D)),r.pos+=D,C=r.pos,A.outTangent=new Float32Array(a.slice(C,C+D)),r.pos+=D,C=r.pos,A.data=new Float32Array(a.slice(C,C+D)),r.pos+=D,M&&(M.next=A,M.duration=R-M.startTime),M=A}A.next=null,A.duration=u-R}},t._animationClip=null,t._reader=null,t._strings=[],__static(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),AnimationClipParser02=function(){function t(){}return __class(t,"laya.d3.animation.AnimationClipParser02"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;e>r;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;i>r;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._animationClip=e,t._reader=i;i.__getBuffer();t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;r>n;n++){var a=i.getUint16(),s=t._strings[a],o=t["READ_"+s];if(null==o)throw new Error("model file err,no this function:"+a+" "+s);o.call()}},t.READ_ANIMATIONS=function(){var e,i=0,n=0,r=t._reader,a=r.__getBuffer(),s=[],o=r.getUint8();for(s.length=o,i=0;o>i;i++)s[i]=r.getUint16();var l=[],_=r.getUint16();for(l.length=_,i=0;_>i;i++)l[i]=r.getFloat32();var h=t._animationClip;h.name=t._strings[r.getUint16()];var u=h._duration=r.getFloat32();h.islooping=!!r.getByte(),h._frameRate=r.getInt16();var c=r.getInt16(),d=h._nodes=new Array;d.length=c;var f=h._publicClipDatas=[];f.length=c;var m=h._nodesMap={},p=h._nodesDic={};for(i=0;c>i;i++){e=d[i]=new KeyframeNode,e._indexInList=i;var g=r.getUint16(),v=e.path=[];for(v.length=g,n=0;g>n;n++)v[n]=t._strings[r.getUint16()];var x=v.join("/"),y=m[x];y||(m[x]=y=[]),y.push(e);var T=r.getInt16();-1!==T&&(e.componentType=t._strings[T]);var D=AnimationNode._propertyIndexDic[t._strings[r.getUint16()]];if(null==D)throw new Error("AnimationClipParser02:unknown property name.");e.propertyNameID=D;var E=x+"_"+D;p[E]=e,e.fullPath=E;var S=s[r.getUint8()];e.keyFrameWidth=S/4;var M=e.keyFrames=[],R=M.length=r.getUint16(),A=null,C=0/0;for(n=0;R>n;n++){var L=M[n]=new Keyframe;C=L.startTime=l[r.getUint16()];var I=r.pos;L.inTangent=new Float32Array(a.slice(I,I+S)),r.pos+=S,I=r.pos,L.outTangent=new Float32Array(a.slice(I,I+S)),r.pos+=S,I=r.pos,L.data=new Float32Array(a.slice(I,I+S)),r.pos+=S,A&&(A.next=L,A.duration=C-A.startTime),A=L}L.next=null,L.duration=u-C}var w=r.getUint16();for(i=0;w>i;i++){var b=new AnimationEvent;b.time=r.getFloat32(),b.eventName=t._strings[r.getUint16()];var P,V=r.getUint16();for(V>0&&(b.params=P=[]),n=0;V>n;n++){var O=r.getByte();switch(O){case 0:P.push(!!r.getByte());break;case 1:P.push(r.getInt32());break;case 2:P.push(r.getFloat32());break;case 3:P.push(t._strings[r.getUint16()]);break;default:throw new Error("unknown type.")}}h.addEvent(b)}},t._animationClip=null,t._reader=null,t._strings=[],__static(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),AnimationEvent=function(){function t(){this.time=0/0,this.eventName=null,this.params=null}return __class(t,"laya.d3.animation.AnimationEvent"),t}(),AnimationNode=function(){function t(t,e,i,n){this._children=[],this.transform=new AnimationTransform3D(this,t,e,i,n)}__class(t,"laya.d3.animation.AnimationNode");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.addChild=function(t){t._parent=this,t.transform.setParent(this.transform),this._children.push(t)},e.removeChild=function(t){var e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1)},e.getChildByName=function(t){for(var e=0,i=this._children.length;i>e;e++){var n=this._children[e];if(n.name===t)return n}return null},e.getChildByIndex=function(t){return this._children[t]},e.getChildCount=function(){return this._children.length},e.cloneTo=function(t){var e=t;e.name=this.name;for(var i=0,n=this._children.length;n>i;i++){var r=this._children[i],a=r.clone();e.addChild(a);var s=r.transform,o=a.transform;o.setLocalPosition(s.getLocalPosition(),!1,1),o.setLocalRotation(s.getLocalRotation(),!1,1),o.setLocalScale(s.getLocalScale(),!1,1)}},e.clone=function(){var e=new t;return this.cloneTo(e),e},e._cloneNative=function(e,i,n,r,a,s,o){var l=o._nativeCurCloneCount;a[l]=s;var _=new Float32Array(e.buffer,3*l*4,3),h=new Float32Array(i.buffer,4*l*4,4),u=new Float32Array(n.buffer,3*l*4,3),c=new Float32Array(r.buffer,16*l*4,16),d=new t(_,h,u,c);return d._worldMatrixIndex=l,this._cloneToNative(d,e,i,n,r,a,l,o),d},e._cloneToNative=function(t,e,i,n,r,a,s,o){var l=t;l.name=this.name;for(var _=0,h=this._children.length;h>_;_++){var u=this._children[_];o._nativeCurCloneCount++;var c=u._cloneNative(e,i,n,r,a,s,o);l.addChild(c);var d=u.transform,f=c.transform;f.setLocalPosition(d.getLocalPosition(),!1,1),f.setLocalRotation(d.getLocalRotation(),!1,1),f.setLocalScale(d.getLocalScale(),!1,1)}},t.__init__=function(){t.registerAnimationNodeProperty("localPosition",t._getLocalPosition,t._setLocalPosition,t._setCrossLocalPosition),t.registerAnimationNodeProperty("localRotation",t._getLocalRotation,t._setLocalRotation,t._setCrossLocalRotation),t.registerAnimationNodeProperty("localScale",t._getLocalScale,t._setLocalScale,t._setCrossLocalScale),t.registerAnimationNodeProperty("localRotationEuler",t._getLocalRotationEuler,t._setLocalRotationEuler,null),t.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",t._getParticleRenderSharedMaterialTintColor,t._setParticleRenderSharedMaterialTintColor,null),t.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",t._getMeshRenderSharedMaterialTilingOffset,t._setMeshRenderSharedMaterialTilingOffset,null),t.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",t._getMeshRenderSharedMaterialAlbedo,t._setMeshRenderSharedMaterialAlbedo,null),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",t._getSkinnedMeshRenderSharedMaterialTilingOffset,t._setSkinnedMeshRenderSharedMaterialTilingOffset,null),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",t._getSkinnedMeshRenderSharedMaterialAlbedo,t._setSkinnedMeshRenderSharedMaterialAlbedo,null),t.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",t._getMeshRenderSharedMaterialAlbedo,t._setMeshRenderSharedMaterialAlbedo,null),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",t._getSkinnedMeshRenderSharedMaterialAlbedo,t._setSkinnedMeshRenderSharedMaterialAlbedo,null)},t.registerAnimationNodeProperty=function(e,i,n,r){if(t._propertyIndexDic[e])throw new Error("AnimationNode: this propertyName has registered.");t._propertyIndexDic[e]=t._propertyIDCounter,t._propertyGetFuncs[t._propertyIDCounter]=i,t._propertySetFuncs[t._propertyIDCounter]=n,t._propertySetCrossFuncs[t._propertyIDCounter]=r,t._propertyIDCounter++},t._getLocalPosition=function(t,e){return t?t.transform.getLocalPosition():e._transform.localPosition.elements},t._setLocalPosition=function(t,e,i,n,r){if(t)t.transform.setLocalPosition(i,n,r);else{var a=e._transform,s=a.localPosition;s.elements=i,a.localPosition=s}},t._setCrossLocalPosition=function(t,e,i,n,r,a,s){if(t)t.transform.setCrossLocalPosition(i,n,r,a,s);else{var o=e._transform,l=o.localPosition;l.elements=i,o.localPosition=l}},t._getLocalRotation=function(t,e){return t?t.transform.getLocalRotation():e._transform.localRotation.elements},t._setLocalRotation=function(t,e,i,n,r){if(t)t.transform.setLocalRotation(i,n,r);else{var a=e._transform,s=a.localRotation;s.elements=i,a.localRotation=s}},t._setCrossLocalRotation=function(t,e,i,n,r,a,s){if(t)t.transform.setCrossLocalRotation(i,n,r,a,s);else{var o=e._transform,l=o.localRotation;l.elements=i,o.localRotation=l}},t._getLocalScale=function(t,e){return t?t.transform.getLocalScale():e._transform.localScale.elements},t._setLocalScale=function(t,e,i,n,r){if(t)t.transform.setLocalScale(i,n,r);else{var a=e._transform,s=a.localScale;s.elements=i,a.localScale=s}},t._setCrossLocalScale=function(t,e,i,n,r,a,s){if(t)t.transform.setCrossLocalScale(i,n,r,a,s);else{var o=e._transform,l=o.localScale;l.elements=i,o.localScale=l}},t._getLocalRotationEuler=function(t,e){return t?t.transform.getLocalRotationEuler():e._transform.localRotationEuler.elements},t._setLocalRotationEuler=function(t,e,i,n,r){if(t)t.transform.setLocalRotationEuler(i,n,r);else{var a=e._transform,s=a.localRotationEuler;s.elements=i,a.localRotationEuler=s}},t._getMeshRenderSharedMaterialTilingOffset=function(t,e){var i;if(t){var n=t.transform._entity;return n?(i=n.owner.meshRender.sharedMaterial,i.tilingOffset.elements):null}return i=e.meshRender.sharedMaterial,i.tilingOffset.elements},t._setMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&(n=a.owner.meshRender.material,r=n.tilingOffset,r.elements=i,n.tilingOffset=r)}else n=e.meshRender.material,r=n.tilingOffset,r.elements=i,n.tilingOffset=r},t._getMeshRenderSharedMaterialAlbedo=function(t,e){var i;if(t){var n=t.transform._entity;return n?(i=n.owner.meshRender.sharedMaterial,i.albedoColor.elements):null}return i=e.meshRender.sharedMaterial,i.albedoColor.elements},t._setMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&(n=a.owner.meshRender.material,r=n.albedoColor,r.elements=i,n.albedoColor=r)}else n=e.meshRender.material,r=n.albedoColor,r.elements=i,n.albedoColor=r},t._getSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e){var i;if(t){var n=t.transform._entity;return n?(i=n.owner.skinnedMeshRender.sharedMaterial,i.tilingOffset.elements):null}return i=e.skinnedMeshRender.sharedMaterial,i.tilingOffset.elements},t._setSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&(n=a.owner.skinnedMeshRender.material,r=n.tilingOffset,r.elements=i,n.tilingOffset=r)}else n=e.skinnedMeshRender.material,r=n.tilingOffset,r.elements=i,n.tilingOffset=r},t._getSkinnedMeshRenderSharedMaterialAlbedo=function(t,e){var i;if(t){var n=t.transform._entity;return n?(i=n.owner.skinnedMeshRender.sharedMaterial,i.albedoColor.elements):null}return i=e.skinnedMeshRender.sharedMaterial,i.albedoColor.elements},t._setSkinnedMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&(n=a.owner.skinnedMeshRender.material,r=n.albedoColor,r.elements=i,n.albedoColor=r)}else n=e.skinnedMeshRender.material,r=n.albedoColor,r.elements=i,n.albedoColor=r},t._getParticleRenderSharedMaterialTintColor=function(t,e){var i;if(t){var n=t.transform._entity;return n?(i=n.owner.particleRender.sharedMaterial,i.tintColor.elements):null}return i=e.particleRender.sharedMaterial,i.tintColor.elements},t._setParticleRenderSharedMaterialTintColor=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&(n=a.owner.particleRender.material,r=n.tintColor,r.elements=i,n.tintColor=r)}else n=e.particleRender.material,r=n.tintColor,r.elements=i,n.tintColor=r},t._propertyIDCounter=0,t._propertyIndexDic={},t._propertyGetFuncs=[],t._propertySetFuncs=[],t._propertySetCrossFuncs=[],t}(),Keyframe=function(){function t(){this.startTime=0/0,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=0/0,this.next=null}return __class(t,"laya.d3.animation.Keyframe"),t}(),KeyframeNode=function(){function t(){this._indexInList=0,this.fullPath=null,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return __class(t,"laya.d3.animation.KeyframeNode"),t}(),AnimatorStateInfo=function(){function t(){}__class(t,"laya.d3.component.AnimatorStateInfo");var e=t.prototype;return e._resetPlayState=function(t){this._finish=!1,this._frameTime=0,this._frameIndex=0,this._startPlayTime=t,this._elapsedTime=t,this._playEventIndex=0},e._cloneTo=function(t){t._finish=this._finish,t._frameTime=this._frameTime,t._frameIndex=this._frameIndex,t._startPlayTime=this._startPlayTime,t._elapsedTime=this._elapsedTime,t._playEventIndex=this._playEventIndex},t}(),ClipStateInfo=function(){function t(){this.speed=1,this._nodeOwners=[]}return __class(t,"laya.d3.component.ClipStateInfo"),t}(),KeyFrameNodeOwner=function(){function t(){this.indexInList=-1,this.referenceCount=0,this.updateMark=-1}__class(t,"laya.d3.component.KeyFrameNodeOwner");var e=t.prototype;return e.saveCrossFixedValue=function(t){var e;e=t?AnimationNode._propertyGetFuncs[this.propertyID](this.avatarOwner,null):AnimationNode._propertyGetFuncs[this.propertyID](null,this.spritOwner);var i=e.length;this.crossFixedValue||(this.crossFixedValue=new Float32Array(i));for(var n=0;i>n;n++)this.crossFixedValue[n]=e[n]},t}(),ListPool=function(){function t(){this.length=0,this.elements=[]}__class(t,"laya.d3.component.ListPool");var e=t.prototype;return e.add=function(t){this.length===this.elements.length?this.elements.push(t):this.elements[this.length]=t,t._setIndexInList(this.length++)},e.remove=function(t){this.length--;var e=t._getIndexInList();if(e!==this.length){var i=this.elements[this.length];this.elements[e]=i,i._setIndexInList(e),t._setIndexInList(-1)}},t}(),GeometryElement=function(){function t(){this._destroyed=!1,this._vertexDeclarationDefine=0}__class(t,"laya.d3.core.GeometryElement");var e=t.prototype;return Laya.imps(e,{"laya.resource.IDestroy":!0}),e._setVertexBuffer=function(t){this._vertexBuffer=t,this._vertexDeclarationDefine=t.vertexDeclaration._defineDatas.value,this._singletonVertexBuffer=!0,this._vertexBuffers=null},e._setVertexBuffers=function(t){this._vertexBuffers=t,this._multiVerDecValueData=this._multiVerDecValueData||[],this._multiVerDecValueData.length=0;for(var e=0,i=t.length;i>e;e++){var n=t[e],r=n.vertexDeclaration;this._vertexDeclarationDefine|=r._defineDatas.value;var a=r._shaderValues._data;for(var s in a)this._multiVerDecValueData[s]=[n,a[s]]}this._singletonVertexBuffer=!1,this._vertexBuffer=null},e._prepareRender=function(){return!0},e._render=function(){throw new Error("GeometryElement:must override it.")},e.destroy=function(){if(this._destroyed=!0,this._singletonVertexBuffer)this._vertexBuffer.destroy(),this._vertexBuffer=null;else{for(var t=0,e=this._vertexBuffers.length;e>t;t++)this._vertexBuffers[t].destroy();this._vertexBuffers=null}this._multiVerDecValueData=null},__getset(0,e,"_vertexBufferCount",function(){throw new Error("GeometryElement:must override it.")}),__getset(0,e,"destroyed",function(){return this._destroyed}),__getset(0,e,"triangleCount",function(){throw new Error("GeometryElement:must override it.")}),t}(),Layer=function(){function t(t){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[],this._scene=t}__class(t,"laya.d3.core.Layer");var e=t.prototype;return e._binarySearchIndex=function(){for(var t=this._scene._collsionTestList,e=0,i=t.length-1,n=0;i>=e;){n=Math.floor((e+i)/2);var r=t[n];if(r==this._number)return n;r>this._number?i=n-1:e=n+1}return e},e._addCollider=function(t){0===this._colliders.length&&this._scene._collsionTestList.splice(this._binarySearchIndex(),0,this._number),t._isRigidbody?(this._colliders.unshift(t),this._nonRigidbodyOffset++):this._colliders.push(t)},e._removeCollider=function(t){var e=this._colliders.indexOf(t);e<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(e,1),0===this._colliders.length&&this._scene._collsionTestList.splice(this._scene._collsionTestList.indexOf(this._number),1)},__getset(0,e,"number",function(){return this._number}),__getset(0,e,"visible",function(){return this._visible},function(t){this._visible=t,t?this._scene._visibleLayers|=this._scene._visibleLayers|this.mask:this._scene._visibleLayers=this._scene._visibleLayers&~this.mask}),__getset(0,e,"mask",function(){return this._mask}),t.maxCount=31,t}(),RenderState=function(){function t(){this.cull=0,this.blend=0,this.srcBlend=0,this.dstBlend=0,this.srcBlendRGB=0,this.dstBlendRGB=0,this.srcBlendAlpha=0,this.dstBlendAlpha=0,this.blendConstColor=null,this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=0,this.depthWrite=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new Vector4(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=515,this.depthWrite=!0}__class(t,"laya.d3.core.material.RenderState");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e._setRenderStateBlendDepth=function(){var t=LayaGL.instance;switch(WebGLContext.setDepthMask(t,this.depthWrite),0===this.depthTest?WebGLContext.setDepthTest(t,!1):(WebGLContext.setDepthTest(t,!0),WebGLContext.setDepthFunc(t,this.depthTest)),this.blend){case 0:WebGLContext.setBlend(t,!1);break;case 1:WebGLContext.setBlend(t,!0),WebGLContext.setBlendFunc(t,this.srcBlend,this.dstBlend);break;case 2:WebGLContext.setBlend(t,!0)}},e._setRenderStateFrontFace=function(t,e){var i=LayaGL.instance,n=0;switch(this.cull){case 0:WebGLContext.setCullFace(i,!1);break;case 1:WebGLContext.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2305:2304:e&&e._isFrontFaceInvert?2304:2305,WebGLContext.setFrontFace(i,n);break;case 2:WebGLContext.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2304:2305:e&&e._isFrontFaceInvert?2305:2304,WebGLContext.setFrontFace(i,n)}},e.cloneTo=function(t){var e=t;e.cull=this.cull,e.blend=this.blend,e.srcBlend=this.srcBlend,e.dstBlend=this.dstBlend,e.srcBlendRGB=this.srcBlendRGB,e.dstBlendRGB=this.dstBlendRGB,e.srcBlendAlpha=this.srcBlendAlpha,e.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(e.blendConstColor),e.blendEquation=this.blendEquation,e.blendEquationRGB=this.blendEquationRGB,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.CULL_NONE=0,t.CULL_FRONT=1,t.CULL_BACK=2,t.BLEND_DISABLE=0,t.BLEND_ENABLE_ALL=1,t.BLEND_ENABLE_SEPERATE=2,t.BLENDPARAM_ZERO=0,t.BLENDPARAM_ONE=1,t.BLENDPARAM_SRC_COLOR=768,t.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,t.BLENDPARAM_DST_COLOR=774,t.BLENDPARAM_ONE_MINUS_DST_COLOR=775,t.BLENDPARAM_SRC_ALPHA=770,t.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,t.BLENDPARAM_DST_ALPHA=772,t.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,t.BLENDPARAM_SRC_ALPHA_SATURATE=776,t.BLENDEQUATION_ADD=0,t.BLENDEQUATION_SUBTRACT=1,t.BLENDEQUATION_REVERSE_SUBTRACT=2,t.DEPTHTEST_OFF=0,t.DEPTHTEST_NEVER=512,t.DEPTHTEST_LESS=513,t.DEPTHTEST_EQUAL=514,t.DEPTHTEST_LEQUAL=515,t.DEPTHTEST_GREATER=516,t.DEPTHTEST_NOTEQUAL=517,t.DEPTHTEST_GEQUAL=518,t.DEPTHTEST_ALWAYS=519,t}(),Burst=function(){function t(t,e,i){this._time=0/0,this._minCount=0,this._maxCount=0,this._time=t,this._minCount=e,this._maxCount=i}__class(t,"laya.d3.core.particleShuriKen.module.Burst");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._time=this._time,e._minCount=this._minCount,e._maxCount=this._maxCount},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"time",function(){return this._time}),__getset(0,e,"minCount",function(){return this._minCount}),__getset(0,e,"maxCount",function(){return this._maxCount}),t}(),ColorOverLifetime=function(){function t(t){this._color=null,this.enbale=!1,this._color=t}__class(t,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var e=t.prototype;return e.cloneTo=function(t){var e=t;this._color.cloneTo(e._color),e.enbale=this.enbale},e.clone=function(){var t;switch(this._color.type){case 0:t=GradientColor.createByConstant(this._color.constant.clone());break;case 1:t=GradientColor.createByGradient(this._color.gradient.clone());break;case 2:t=GradientColor.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:t=GradientColor.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},__getset(0,e,"color",function(){return this._color}),t}(),Emission=function(){function t(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}__class(t,"laya.d3.core.particleShuriKen.module.Emission");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),e.destroy=function(){this._bursts=null,this._destroyed=!0},e.getBurstsCount=function(){return this._bursts.length},e.getBurstByIndex=function(t){return this._bursts[t]},e.addBurst=function(t){var e=this._bursts.length;if(e>0)for(var i=0;e>i;i++)this._bursts[i].time>t.time&&this._bursts.splice(i,0,t);this._bursts.push(t)},e.removeBurst=function(t){var e=this._bursts.indexOf(t);-1!==e&&this._bursts.splice(e,1)},e.removeBurstByIndex=function(t){this._bursts.splice(t,1)},e.clearBurst=function(){this._bursts.length=0},e.cloneTo=function(t){var e=t,i=e._bursts;i.length=this._bursts.length;for(var n=0,r=this._bursts.length;r>n;n++){var a=i[n];a?this._bursts[n].cloneTo(a):i[n]=this._bursts[n].clone()}e._emissionRate=this._emissionRate,e.enbale=this.enbale},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"destroyed",function(){return this._destroyed}),__getset(0,e,"emissionRate",function(){return this._emissionRate},function(t){if(0>t)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=t}),t}(),FrameOverTime=function(){function t(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}__class(t,"laya.d3.core.particleShuriKen.module.FrameOverTime");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,this._overTime.cloneTo(e._overTime),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._overTimeMin.cloneTo(e._overTimeMin),this._overTimeMax.cloneTo(e._overTimeMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"frameOverTimeData",function(){return this._overTime}),__getset(0,e,"constant",function(){return this._constant}),__getset(0,e,"type",function(){return this._type}),__getset(0,e,"frameOverTimeDataMin",function(){return this._overTimeMin}),__getset(0,e,"constantMin",function(){return this._constantMin}),__getset(0,e,"frameOverTimeDataMax",function(){return this._overTimeMax}),__getset(0,e,"constantMax",function(){return this._constantMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByOverTime=function(e){var i=new t;return i._type=1,i._overTime=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoOverTime=function(e,i){var n=new t;return n._type=3,n._overTimeMin=e,n._overTimeMax=i,n},t}(),GradientAngularVelocity=function(){function t(){this._type=0,this._separateAxes=!1,this._constant=0/0,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=0/0,this._constantMax=0/0,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}__class(t,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,e._constant=this._constant,this._constantSeparate.cloneTo(e._constantSeparate),this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)
},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"gradientZ",function(){return this._gradientZ}),__getset(0,e,"constant",function(){return this._constant}),__getset(0,e,"gradient",function(){return this._gradient}),__getset(0,e,"separateAxes",function(){return this._separateAxes}),__getset(0,e,"type",function(){return this._type}),__getset(0,e,"constantSeparate",function(){return this._constantSeparate}),__getset(0,e,"gradientX",function(){return this._gradientX}),__getset(0,e,"gradientY",function(){return this._gradientY}),__getset(0,e,"gradientW",function(){return this._gradientW}),__getset(0,e,"gradientMin",function(){return this._gradientMin}),__getset(0,e,"constantMin",function(){return this._constantMin}),__getset(0,e,"gradientMax",function(){return this._gradientMax}),__getset(0,e,"constantMax",function(){return this._constantMax}),__getset(0,e,"gradientWMin",function(){return this._gradientWMin}),__getset(0,e,"constantMinSeparate",function(){return this._constantMinSeparate}),__getset(0,e,"constantMaxSeparate",function(){return this._constantMaxSeparate}),__getset(0,e,"gradientXMin",function(){return this._gradientXMin}),__getset(0,e,"gradientXMax",function(){return this._gradientXMax}),__getset(0,e,"gradientWMax",function(){return this._gradientWMax}),__getset(0,e,"gradientYMin",function(){return this._gradientYMin}),__getset(0,e,"gradientYMax",function(){return this._gradientYMax}),__getset(0,e,"gradientZMin",function(){return this._gradientZMin}),__getset(0,e,"gradientZMax",function(){return this._gradientZMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._separateAxes=!1,i._constant=e,i},t.createByConstantSeparate=function(e){var i=new t;return i._type=0,i._separateAxes=!0,i._constantSeparate=e,i},t.createByGradient=function(e){var i=new t;return i._type=1,i._separateAxes=!1,i._gradient=e,i},t.createByGradientSeparate=function(e,i,n,r){var a=new t;return a._type=1,a._separateAxes=!0,a._gradientX=e,a._gradientY=i,a._gradientZ=n,a._gradientW=r,a},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._separateAxes=!1,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoConstantSeparate=function(e,i){var n=new t;return n._type=2,n._separateAxes=!0,n._constantMinSeparate=e,n._constantMaxSeparate=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=3,n._separateAxes=!1,n._gradientMin=e,n._gradientMax=i,n},t.createByRandomTwoGradientSeparate=function(e,i,n,r,a,s,o,l){var _=new t;return _._type=3,_._separateAxes=!0,_._gradientXMin=e,_._gradientXMax=i,_._gradientYMin=n,_._gradientYMax=r,_._gradientZMin=a,_._gradientZMax=s,_._gradientWMin=o,_._gradientWMax=l,_},t}(),GradientColor=function(){function t(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}__class(t,"laya.d3.core.particleShuriKen.module.GradientColor");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradient.cloneTo(e._gradient),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"gradient",function(){return this._gradient}),__getset(0,e,"constant",function(){return this._constant}),__getset(0,e,"type",function(){return this._type}),__getset(0,e,"gradientMin",function(){return this._gradientMin}),__getset(0,e,"constantMin",function(){return this._constantMin}),__getset(0,e,"gradientMax",function(){return this._gradientMax}),__getset(0,e,"constantMax",function(){return this._constantMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByGradient=function(e){var i=new t;return i._type=1,i._gradient=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=3,n._gradientMin=e,n._gradientMax=i,n},t}(),GradientDataColor=function(){function t(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}__class(t,"laya.d3.core.particleShuriKen.module.GradientDataColor");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.addAlpha=function(t,e){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==t&&(t=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._alphaElements[this._alphaCurrentLength++]=t,this._alphaElements[this._alphaCurrentLength++]=e):console.log("GradientDataColor warning:data count must lessEqual than 4")},e.addRGB=function(t,e){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==t&&(t=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._rgbElements[this._rgbCurrentLength++]=t,this._rgbElements[this._rgbCurrentLength++]=e.x,this._rgbElements[this._rgbCurrentLength++]=e.y,this._rgbElements[this._rgbCurrentLength++]=e.z):console.log("GradientDataColor warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t,i=0,n=0;e._alphaCurrentLength=this._alphaCurrentLength;var r=e._alphaElements;for(r.length=this._alphaElements.length,i=0,n=this._alphaElements.length;n>i;i++)r[i]=this._alphaElements[i];e._rgbCurrentLength=this._rgbCurrentLength;var a=e._rgbElements;for(a.length=this._rgbElements.length,i=0,n=this._rgbElements.length;n>i;i++)a[i]=this._rgbElements[i]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),__getset(0,e,"rgbGradientCount",function(){return this._rgbCurrentLength/4}),t}(),GradientDataInt=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}__class(t,"laya.d3.core.particleShuriKen.module.GradientDataInt");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("Warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;r>n;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),GradientDataNumber=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}__class(t,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("GradientDataNumber warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("GradientDataNumber warning:data count must lessEqual than 4")},e.getKeyByIndex=function(t){return this._elements[2*t]},e.getValueByIndex=function(t){return this._elements[2*t+1]},e.getAverageValue=function(){for(var t=0,e=0,i=this._currentLength-2;i>e;e+=2){var n=this._elements[e+1];n+=this._elements[e+3],n*=this._elements[e+2]-this._elements[e]}return t/2},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;r>n;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),GradientSize=function(){function t(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=0/0,this._constantMax=0/0,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}__class(t,"laya.d3.core.particleShuriKen.module.GradientSize");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.getMaxSizeInGradient=function(){var t=0,e=0,i=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(t=0,e=this._gradientX.gradientCount;e>t;t++)i=Math.max(i,this._gradientX.getValueByIndex(t));for(t=0,e=this._gradientY.gradientCount;e>t;t++)i=Math.max(i,this._gradientY.getValueByIndex(t))}else for(t=0,e=this._gradient.gradientCount;e>t;t++)i=Math.max(i,this._gradient.getValueByIndex(t));break;case 1:this._separateAxes?(i=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),i=Math.max(i,this._constantMinSeparate.y),i=Math.max(i,this._constantMaxSeparate.y)):i=Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(t=0,e=this._gradientXMin.gradientCount;e>t;t++)i=Math.max(i,this._gradientXMin.getValueByIndex(t));for(t=0,e=this._gradientXMax.gradientCount;e>t;t++)i=Math.max(i,this._gradientXMax.getValueByIndex(t));for(t=0,e=this._gradientYMin.gradientCount;e>t;t++)i=Math.max(i,this._gradientYMin.getValueByIndex(t));for(t=0,e=this._gradientZMax.gradientCount;e>t;t++)i=Math.max(i,this._gradientZMax.getValueByIndex(t))}else{for(t=0,e=this._gradientMin.gradientCount;e>t;t++)i=Math.max(i,this._gradientMin.getValueByIndex(t));for(t=0,e=this._gradientMax.gradientCount;e>t;t++)i=Math.max(i,this._gradientMax.getValueByIndex(t))}}return i},e.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"gradientZ",function(){return this._gradientZ}),__getset(0,e,"gradient",function(){return this._gradient}),__getset(0,e,"separateAxes",function(){return this._separateAxes}),__getset(0,e,"type",function(){return this._type}),__getset(0,e,"gradientMin",function(){return this._gradientMin}),__getset(0,e,"constantMin",function(){return this._constantMin}),__getset(0,e,"gradientX",function(){return this._gradientX}),__getset(0,e,"gradientY",function(){return this._gradientY}),__getset(0,e,"gradientMax",function(){return this._gradientMax}),__getset(0,e,"constantMax",function(){return this._constantMax}),__getset(0,e,"constantMinSeparate",function(){return this._constantMinSeparate}),__getset(0,e,"constantMaxSeparate",function(){return this._constantMaxSeparate}),__getset(0,e,"gradientXMin",function(){return this._gradientXMin}),__getset(0,e,"gradientXMax",function(){return this._gradientXMax}),__getset(0,e,"gradientYMin",function(){return this._gradientYMin}),__getset(0,e,"gradientYMax",function(){return this._gradientYMax}),__getset(0,e,"gradientZMin",function(){return this._gradientZMin}),__getset(0,e,"gradientZMax",function(){return this._gradientZMax}),t.createByGradient=function(e){var i=new t;return i._type=0,i._separateAxes=!1,i._gradient=e,i},t.createByGradientSeparate=function(e,i,n){var r=new t;return r._type=0,r._separateAxes=!0,r._gradientX=e,r._gradientY=i,r._gradientZ=n,r},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=1,n._separateAxes=!1,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoConstantSeparate=function(e,i){var n=new t;return n._type=1,n._separateAxes=!0,n._constantMinSeparate=e,n._constantMaxSeparate=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=2,n._separateAxes=!1,n._gradientMin=e,n._gradientMax=i,n},t.createByRandomTwoGradientSeparate=function(e,i,n,r,a,s){var o=new t;return o._type=2,o._separateAxes=!0,o._gradientXMin=e,o._gradientXMax=i,o._gradientYMin=n,o._gradientYMax=r,o._gradientZMin=a,o._gradientZMax=s,o},t}(),GradientVelocity=function(){function t(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}__class(t,"laya.d3.core.particleShuriKen.module.GradientVelocity");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"gradientZ",function(){return this._gradientZ}),__getset(0,e,"constant",function(){return this._constant}),__getset(0,e,"type",function(){return this._type}),__getset(0,e,"gradientXMax",function(){return this._gradientXMax}),__getset(0,e,"constantMin",function(){return this._constantMin}),__getset(0,e,"gradientX",function(){return this._gradientX}),__getset(0,e,"gradientY",function(){return this._gradientY}),__getset(0,e,"gradientXMin",function(){return this._gradientXMin}),__getset(0,e,"constantMax",function(){return this._constantMax}),__getset(0,e,"gradientYMin",function(){return this._gradientYMin}),__getset(0,e,"gradientYMax",function(){return this._gradientYMax}),__getset(0,e,"gradientZMin",function(){return this._gradientZMin}),__getset(0,e,"gradientZMax",function(){return this._gradientZMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByGradient=function(e,i,n){var r=new t;return r._type=1,r._gradientX=e,r._gradientY=i,r._gradientZ=n,r},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoGradient=function(e,i,n,r,a,s){var o=new t;return o._type=3,o._gradientXMin=e,o._gradientXMax=i,o._gradientYMin=n,o._gradientYMax=r,o._gradientZMin=a,o._gradientZMax=s,o},t}(),RotationOverLifetime=function(){function t(t){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=t}__class(t,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._angularVelocity.cloneTo(e._angularVelocity),e.enbale=this.enbale},e.clone=function(){var t;switch(this._angularVelocity.type){case 0:t=this._angularVelocity.separateAxes?GradientAngularVelocity.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):GradientAngularVelocity.createByConstant(this._angularVelocity.constant);break;case 1:t=this._angularVelocity.separateAxes?GradientAngularVelocity.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):GradientAngularVelocity.createByGradient(this._angularVelocity.gradient.clone());break;case 2:t=this._angularVelocity.separateAxes?GradientAngularVelocity.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):GradientAngularVelocity.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:t=this._angularVelocity.separateAxes?GradientAngularVelocity.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):GradientAngularVelocity.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},__getset(0,e,"angularVelocity",function(){return this._angularVelocity}),t}(),BaseShape=function(){function t(){this.enable=!1,this.randomDirection=!1}__class(t,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e._getShapeBoundBox=function(){throw new Error("BaseShape: must override it.")},e._getSpeedBoundBox=function(){throw new Error("BaseShape: must override it.")},e.generatePositionAndDirection=function(){throw new Error("BaseShape: must override it.")},e._calculateProceduralBounds=function(t,e,i){this._getShapeBoundBox(t);var n=t.min,r=t.max;Vector3.multiply(n,e,n),Vector3.multiply(r,e,r);var a=new BoundBox(new Vector3,new Vector3);this.randomDirection?(a.min=new Vector3(-1,-1,-1),a.max=new Vector3(1,1,1)):this._getSpeedBoundBox(a);var s=new BoundBox(new Vector3,new Vector3),o=s.min,l=s.max;Vector3.scale(a.min,i.y,o),Vector3.scale(a.max,i.y,l),Vector3.add(t.min,o,o),Vector3.add(t.max,l,l),Vector3.min(t.min,o,t.min),Vector3.max(t.max,o,t.max);var _=new BoundBox(new Vector3,new Vector3),h=_.min,u=_.max;Vector3.scale(a.min,i.x,h),Vector3.scale(a.max,i.x,u),Vector3.min(_.min,u,o),Vector3.max(_.min,u,l),Vector3.min(t.min,o,t.min),Vector3.max(t.max,o,t.max)},e.cloneTo=function(t){var e=t;e.enable=this.enable},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}(),ShapeUtils=function(){function t(){}return __class(t,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),t._randomPointUnitArcCircle=function(t,e,i){var n=e.elements,r=0/0;r=i?i.getFloat()*t:Math.random()*t,n[0]=Math.cos(r),n[1]=Math.sin(r)},t._randomPointInsideUnitArcCircle=function(e,i,n){var r=i.elements;t._randomPointUnitArcCircle(e,i,n);var a=0/0;a=n?Math.pow(n.getFloat(),.5):Math.pow(Math.random(),.5),r[0]=r[0]*a,r[1]=r[1]*a},t._randomPointUnitCircle=function(t,e){var i=t.elements,n=0/0;n=e?e.getFloat()*Math.PI*2:Math.random()*Math.PI*2,i[0]=Math.cos(n),i[1]=Math.sin(n)},t._randomPointInsideUnitCircle=function(e,i){var n=e.elements;t._randomPointUnitCircle(e);var r=0/0;r=i?Math.pow(i.getFloat(),.5):Math.pow(Math.random(),.5),n[0]=n[0]*r,n[1]=n[1]*r},t._randomPointUnitSphere=function(t,e){var i=t.elements,n=0/0,r=0/0;e?(n=i[2]=2*e.getFloat()-1,r=e.getFloat()*Math.PI*2):(n=i[2]=2*Math.random()-1,r=Math.random()*Math.PI*2);var a=Math.sqrt(1-n*n);i[0]=a*Math.cos(r),i[1]=a*Math.sin(r)},t._randomPointInsideUnitSphere=function(e,i){var n=e.elements;t._randomPointUnitSphere(e);var r=0/0;r=i?Math.pow(i.getFloat(),1/3):Math.pow(Math.random(),1/3),n[0]=n[0]*r,n[1]=n[1]*r,n[2]=n[2]*r},t._randomPointInsideHalfUnitBox=function(t,e){var i=t.elements;e?(i[0]=e.getFloat()-.5,i[1]=e.getFloat()-.5,i[2]=e.getFloat()-.5):(i[0]=Math.random()-.5,i[1]=Math.random()-.5,i[2]=Math.random()-.5)},t}(),SizeOverLifetime=function(){function t(t){this._size=null,this.enbale=!1,this._size=t}__class(t,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._size.cloneTo(e._size),e.enbale=this.enbale},e.clone=function(){var t;switch(this._size.type){case 0:t=this._size.separateAxes?GradientSize.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):GradientSize.createByGradient(this._size.gradient.clone());break;case 1:t=this._size.separateAxes?GradientSize.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):GradientSize.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:t=this._size.separateAxes?GradientSize.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):GradientSize.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},__getset(0,e,"size",function(){return this._size}),t}(),StartFrame=function(){function t(){this._type=0,this._constant=0/0,this._constantMin=0/0,this._constantMax=0/0}__class(t,"laya.d3.core.particleShuriKen.module.StartFrame");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,e._constantMin=this._constantMin,e._constantMax=this._constantMax},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,e,"constant",function(){return this._constant}),__getset(0,e,"type",function(){return this._type}),__getset(0,e,"constantMin",function(){return this._constantMin}),__getset(0,e,"constantMax",function(){return this._constantMax}),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=1,n._constantMin=e,n._constantMax=i,n},t}(),TextureSheetAnimation=function(){function t(t,e){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new Vector2(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=t,this._startFrame=e}__class(t,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this.tiles.cloneTo(e.tiles),e.type=this.type,e.randomRow=this.randomRow,this._frame.cloneTo(e._frame),this._startFrame.cloneTo(e._startFrame),e.cycles=this.cycles,e.enableUVChannels=this.enableUVChannels,e.enable=this.enable},e.clone=function(){var t;switch(this._frame.type){case 0:t=FrameOverTime.createByConstant(this._frame.constant);break;case 1:t=FrameOverTime.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:t=FrameOverTime.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:t=FrameOverTime.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}var e;switch(this._startFrame.type){case 0:e=StartFrame.createByConstant(this._startFrame.constant);break;case 1:e=StartFrame.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var i=new this.constructor(t,e);return this.tiles.cloneTo(i.tiles),i.type=this.type,i.randomRow=this.randomRow,i.cycles=this.cycles,i.enableUVChannels=this.enableUVChannels,i.enable=this.enable,i},__getset(0,e,"frame",function(){return this._frame}),__getset(0,e,"startFrame",function(){return this._startFrame}),t}(),VelocityOverLifetime=function(){function t(t){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=t}__class(t,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._velocity.cloneTo(e._velocity),e.enbale=this.enbale,e.space=this.space},e.clone=function(){var t;switch(this._velocity.type){case 0:t=GradientVelocity.createByConstant(this._velocity.constant.clone());break;case 1:t=GradientVelocity.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:t=GradientVelocity.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:t=GradientVelocity.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e.space=this.space,e},__getset(0,e,"velocity",function(){return this._velocity}),t}(),ShurikenParticleData=function(){function t(){}return __class(t,"laya.d3.core.particleShuriKen.ShurikenParticleData"),t._getStartLifetimeFromGradient=function(t,e){for(var i=1,n=t.gradientCount;n>i;i++){var r=t.getKeyByIndex(i);if(r>=e){var a=t.getKeyByIndex(i-1),s=(e-a)/(r-a);return MathUtil.lerp(t.getValueByIndex(i-1),t.getValueByIndex(i),s)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")},t._randomInvertRoationArray=function(t,e,i,n,r){var a=0/0;n?(n.seed=r[6],a=n.getFloat(),r[6]=n.seed):a=Math.random(),i>a?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])},t._randomInvertRoation=function(t,e,i,n){var r=0/0;return i?(i.seed=n[6],r=i.getFloat(),n[6]=i.seed):r=Math.random(),e>r&&(t=-t),t},t.create=function(e,i,n){var r=e.autoRandomSeed,a=e._rand,s=e._randomSeeds;switch(e.startColorType){case 0:var o=e.startColorConstant.elements;t.startColor[0]=o[0],t.startColor[1]=o[1],t.startColor[2]=o[2],t.startColor[3]=o[3];break;case 2:r?MathUtil.lerpVector4(e.startColorConstantMin.elements,e.startColorConstantMax.elements,Math.random(),t.startColor):(a.seed=s[3],MathUtil.lerpVector4(e.startColorConstantMin.elements,e.startColorConstantMax.elements,a.getFloat(),t.startColor),s[3]=a.seed)}var l=e.colorOverLifetime;if(l&&l.enbale){var _=l.color;switch(_.type){case 0:t.startColor[0]=t.startColor[0]*_.constant.x,t.startColor[1]=t.startColor[1]*_.constant.y,t.startColor[2]=t.startColor[2]*_.constant.z,t.startColor[3]=t.startColor[3]*_.constant.w;break;case 2:var h=0/0;r?h=Math.random():(a.seed=s[10],h=a.getFloat(),s[10]=a.seed);var u=_.constantMin,c=_.constantMax;t.startColor[0]=t.startColor[0]*MathUtil.lerp(u.x,c.x,h),t.startColor[1]=t.startColor[1]*MathUtil.lerp(u.y,c.y,h),t.startColor[2]=t.startColor[2]*MathUtil.lerp(u.z,c.z,h),t.startColor[3]=t.startColor[3]*MathUtil.lerp(u.w,c.w,h)}}var d=t.startSize;switch(e.startSizeType){case 0:if(e.threeDStartSize){var f=e.startSizeConstantSeparate;d[0]=f.x,d[1]=f.y,d[2]=f.z}else d[0]=d[1]=d[2]=e.startSizeConstant;break;case 2:if(e.threeDStartSize){var m=e.startSizeConstantMinSeparate,p=e.startSizeConstantMaxSeparate;r?(d[0]=MathUtil.lerp(m.x,p.x,Math.random()),d[1]=MathUtil.lerp(m.y,p.y,Math.random()),d[2]=MathUtil.lerp(m.z,p.z,Math.random())):(a.seed=s[4],d[0]=MathUtil.lerp(m.x,p.x,a.getFloat()),d[1]=MathUtil.lerp(m.y,p.y,a.getFloat()),d[2]=MathUtil.lerp(m.z,p.z,a.getFloat()),s[4]=a.seed)}else r?d[0]=d[1]=d[2]=MathUtil.lerp(e.startSizeConstantMin,e.startSizeConstantMax,Math.random()):(a.seed=s[4],d[0]=d[1]=d[2]=MathUtil.lerp(e.startSizeConstantMin,e.startSizeConstantMax,a.getFloat()),s[4]=a.seed)}var g=e.sizeOverLifetime;if(g&&g.enbale&&1===g.size.type){var v=g.size;if(v.separateAxes)r?(d[0]=d[0]*MathUtil.lerp(v.constantMinSeparate.x,v.constantMaxSeparate.x,Math.random()),d[1]=d[1]*MathUtil.lerp(v.constantMinSeparate.y,v.constantMaxSeparate.y,Math.random()),d[2]=d[2]*MathUtil.lerp(v.constantMinSeparate.z,v.constantMaxSeparate.z,Math.random())):(a.seed=s[11],d[0]=d[0]*MathUtil.lerp(v.constantMinSeparate.x,v.constantMaxSeparate.x,a.getFloat()),d[1]=d[1]*MathUtil.lerp(v.constantMinSeparate.y,v.constantMaxSeparate.y,a.getFloat()),d[2]=d[2]*MathUtil.lerp(v.constantMinSeparate.z,v.constantMaxSeparate.z,a.getFloat()),s[11]=a.seed);else{var x=0/0;r?x=MathUtil.lerp(v.constantMin,v.constantMax,Math.random()):(a.seed=s[11],x=MathUtil.lerp(v.constantMin,v.constantMax,a.getFloat()),s[11]=a.seed),d[0]=d[0]*x,d[1]=d[1]*x,d[2]=d[2]*x}}var y=i.renderMode;if(1!==y)switch(e.startRotationType){case 0:if(e.threeDStartRotation){var T=e.startRotationConstantSeparate,D=t._tempVector30.elements;t._randomInvertRoationArray(T.elements,D,e.randomizeRotationDirection,r?null:a,s),t.startRotation[0]=D[0],t.startRotation[1]=D[1],t.startRotation[2]=4!==y?-D[2]:D[2]}else t.startRotation[0]=t._randomInvertRoation(e.startRotationConstant,e.randomizeRotationDirection,r?null:a,s);break;case 2:if(e.threeDStartRotation){var E=e.startRotationConstantMinSeparate,S=e.startRotationConstantMaxSeparate,M=t._tempVector30.elements;r?(M[0]=MathUtil.lerp(E.x,S.x,Math.random()),M[1]=MathUtil.lerp(E.y,S.y,Math.random()),M[2]=MathUtil.lerp(E.z,S.z,Math.random())):(a.seed=s[5],M[0]=MathUtil.lerp(E.x,S.x,a.getFloat()),M[1]=MathUtil.lerp(E.y,S.y,a.getFloat()),M[2]=MathUtil.lerp(E.z,S.z,a.getFloat()),s[5]=a.seed),t._randomInvertRoationArray(M,M,e.randomizeRotationDirection,r?null:a,s),t.startRotation[0]=M[0],t.startRotation[1]=M[1],t.startRotation[2]=4!==y?-M[2]:M[2]}else r?t.startRotation[0]=t._randomInvertRoation(MathUtil.lerp(e.startRotationConstantMin,e.startRotationConstantMax,Math.random()),e.randomizeRotationDirection,r?null:a,s):(a.seed=s[5],t.startRotation[0]=t._randomInvertRoation(MathUtil.lerp(e.startRotationConstantMin,e.startRotationConstantMax,a.getFloat()),e.randomizeRotationDirection,r?null:a,s),s[5]=a.seed)}switch(e.startLifetimeType){case 0:t.startLifeTime=e.startLifetimeConstant;break;case 1:t.startLifeTime=t._getStartLifetimeFromGradient(e.startLifeTimeGradient,e.emissionTime);break;case 2:r?t.startLifeTime=MathUtil.lerp(e.startLifetimeConstantMin,e.startLifetimeConstantMax,Math.random()):(a.seed=s[7],t.startLifeTime=MathUtil.lerp(e.startLifetimeConstantMin,e.startLifetimeConstantMax,a.getFloat()),s[7]=a.seed);break;case 3:var R=e.emissionTime;r?t.startLifeTime=MathUtil.lerp(t._getStartLifetimeFromGradient(e.startLifeTimeGradientMin,R),t._getStartLifetimeFromGradient(e.startLifeTimeGradientMax,R),Math.random()):(a.seed=s[7],t.startLifeTime=MathUtil.lerp(t._getStartLifetimeFromGradient(e.startLifeTimeGradientMin,R),t._getStartLifetimeFromGradient(e.startLifeTimeGradientMax,R),a.getFloat()),s[7]=a.seed)}switch(e.startSpeedType){case 0:t.startSpeed=e.startSpeedConstant;break;case 2:r?t.startSpeed=MathUtil.lerp(e.startSpeedConstantMin,e.startSpeedConstantMax,Math.random()):(a.seed=s[8],t.startSpeed=MathUtil.lerp(e.startSpeedConstantMin,e.startSpeedConstantMax,a.getFloat()),s[8]=a.seed)}var A=e.textureSheetAnimation,C=A&&A.enable;if(C){var L=A.tiles,I=L.x,w=L.y,b=1/I,P=1/w,V=0,O=A.startFrame;switch(O.type){case 0:V=O.constant;break;case 1:r?V=MathUtil.lerp(O.constantMin,O.constantMax,Math.random()):(a.seed=s[14],V=MathUtil.lerp(O.constantMin,O.constantMax,a.getFloat()),s[14]=a.seed)}var N=A.frame;switch(N.type){case 0:V+=N.constant;break;case 2:r?V+=MathUtil.lerp(N.constantMin,N.constantMax,Math.random()):(a.seed=s[15],V+=MathUtil.lerp(N.constantMin,N.constantMax,a.getFloat()),s[15]=a.seed)}var B=0;switch(A.type){case 0:B=Math.floor(V/I);break;case 1:A.randomRow?r?B=Math.floor(Math.random()*w):(a.seed=s[13],B=Math.floor(a.getFloat()*w),s[13]=a.seed):B=A.rowIndex}var F=Math.floor(V%I);t.startUVInfo=t.startUVInfo,t.startUVInfo[0]=b,t.startUVInfo[1]=P,t.startUVInfo[2]=F*b,t.startUVInfo[3]=B*P}else t.startUVInfo=t.startUVInfo,t.startUVInfo[0]=1,t.startUVInfo[1]=1,t.startUVInfo[2]=0,t.startUVInfo[3]=0;switch(e.simulationSpace){case 0:var U=n.position.elements;t.simulationWorldPostion[0]=U[0],t.simulationWorldPostion[1]=U[1],t.simulationWorldPostion[2]=U[2];
var G=n.rotation.elements;t.simulationWorldRotation[0]=G[0],t.simulationWorldRotation[1]=G[1],t.simulationWorldRotation[2]=G[2],t.simulationWorldRotation[3]=G[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}},t.startLifeTime=0/0,t.startSpeed=0/0,__static(t,["_tempVector30",function(){return this._tempVector30=new Vector3},"_tempQuaternion",function(){return this._tempQuaternion=new Quaternion},"startColor",function(){return this.startColor=new Float32Array(4)},"startSize",function(){return this.startSize=new Float32Array(3)},"startRotation",function(){return this.startRotation=new Float32Array(3)},"startUVInfo",function(){return this.startUVInfo=new Float32Array(4)},"simulationWorldPostion",function(){return this.simulationWorldPostion=new Float32Array(3)},"simulationWorldRotation",function(){return this.simulationWorldRotation=new Float32Array(4)}]),t}(),PhasorSpriter3D=function(){function t(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=0/0,this._tempNumver1=0/0,this._tempNumver2=0/0,this._tempNumver3=0/0,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=0/0,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new ShaderDatas(null,0),this._vb=new VertexBuffer3D(t._vertexDeclaration.vertexStride*(this._defaultBufferSize/this._floatSizePerVer),35048),this._vb.vertexDeclaration=t._vertexDeclaration,this._ib=IndexBuffer3D.create("ushort",this._defaultBufferSize,35048),this._shaderCompile=Shader3D._preCompileShader.LINE}__class(t,"laya.d3.core.PhasorSpriter3D");var e=t.prototype;return e.line=function(t,e,i,n){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t.x,t.y,t.z,e.x,e.y,e.z,e.w),this.addVertex(i.x,i.y,i.z,n.x,n.y,n.z,n.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},e.circle=function(t,e,i,n,r,a){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*e,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/e,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*t,Math.cos(this._tempNumver0)*t,0,i,n,r,a),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},e.plane=function(t,e,i,n,r,a,s,o,l){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i,a,s,o,l),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i,a,s,o,l),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i,a,s,o,l),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i,a,s,o,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},e.box=function(t,e,i,n,r,a,s,o,l,_){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempNumver2=a/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,s,o,l,_),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,s,o,l,_),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,s,o,l,_),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,s,o,l,_),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,s,o,l,_),this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,s,o,l,_),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,s,o,l,_),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,s,o,l,_),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},e.cone=function(t,e,i,n,r,a,s){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*i+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*i>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/i,this.addVertexIndex(0,e,0,n,r,a,s,this._tempUint0),this.addVertexIndex(0,0,0,n,r,a,s,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<i;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,a,s,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==i-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,a,s,this._tempUint0+(this._tempInt0+i)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==i-1?this.addIndexes(this._tempUint1+i+2):this.addIndexes(this._tempUint1+this._tempInt0+i+1),this.addIndexes(this._tempUint1+this._tempInt0+i),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},e.boundingBoxLine=function(t,e,i,n,r,a,s,o,l,_){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t,r,a,s,o,l,_),this.addVertex(n,r,a,s,o,l,_),this.addVertex(t,e,a,s,o,l,_),this.addVertex(n,e,a,s,o,l,_),this.addVertex(n,r,i,s,o,l,_),this.addVertex(t,r,i,s,o,l,_),this.addVertex(n,e,i,s,o,l,_),this.addVertex(t,e,i,s,o,l,_),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},e.addVertex=function(t,e,i,n,r,a,s){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=t,this._vbData[this._posInVBData+1]=e,this._vbData[this._posInVBData+2]=i,this._vbData[this._posInVBData+3]=n,this._vbData[this._posInVBData+4]=r,this._vbData[this._posInVBData+5]=a,this._vbData[this._posInVBData+6]=s,this._posInVBData+=this._floatSizePerVer,this},e.addVertexIndex=function(t,e,i,n,r,a,s,o){return this._hasBegun||this.addVertexIndexException(),this._vbData[o]=t,this._vbData[o+1]=e,this._vbData[o+2]=i,this._vbData[o+3]=n,this._vbData[o+4]=r,this._vbData[o+5]=a,this._vbData[o+6]=s,o+=this._floatSizePerVer,o>this._posInVBData&&(this._posInVBData=o),this},e.addIndexes=function(){var t=arguments;this._hasBegun||this.addVertexIndexException();for(var e=0;e<t.length;e++)this._ibData[this._posInIBData]=t[e],this._posInIBData++;return this},e.begin=function(t,e){return this._hasBegun&&this.beginException0(),1!==t&&4!==t&&this.beginException1(),this._primitiveType=t,this._camera=e,this._hasBegun=!0,this},e.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},e.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb.bind(),this._ib.bind(),this._shader=this._shaderCompile._passes[0].withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(t._vertexDeclaration._shaderValues),this._spriteShaderValue.setMatrix4x4(1,this._camera.projectionViewMatrix),this._shader.uploadUniforms(null,this._spriteShaderValue,!1),Stat.drawCall++,LayaGL.instance.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},e.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},e.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},e.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},e.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},e.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},e.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(28,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector4",1)])}]),t}(),RenderContext3D=function(){function t(){}return __class(t,"laya.d3.core.render.RenderContext3D"),t.clientWidth=0,t.clientHeight=0,__static(t,["_instance",function(){return this._instance=new t}]),t}(),RenderElement=function(){function t(){}__class(t,"laya.d3.core.render.RenderElement");var e=t.prototype;return e.setTransform=function(t){this._transform=t},e.setGeometry=function(t){this._geometry=t},e.addToOpaqueRenderQueue=function(t,e){e.elements.push(this)},e.addToTransparentRenderQueue=function(t,e){e.elements.push(this),e.lastTransparentBatched=!1,e.lastTransparentRenderElement=this},e.destroy=function(){this._transform=null,this._geometry=null,this.material=null,this.render=null},t}(),RenderQueue=function(){function t(t){void 0===t&&(t=!1),this.isTransparent=t,this.elements=[]}__class(t,"laya.d3.core.render.RenderQueue");var e=t.prototype;return e._compare=function(t,e){var i=t.material.renderQueue-e.material.renderQueue;return 0===i?t.render._distanceForSort-e.render._distanceForSort:i},e._partitionRenderObject=function(t,e){for(var i=this.elements[Math.floor((e+t)/2)];e>=t;){for(;this._compare(this.elements[t],i)<0;)t++;for(;this._compare(this.elements[e],i)>0;)e--;if(e>t){var n=this.elements[t];this.elements[t]=this.elements[e],this.elements[e]=n,t++,e--}else if(t===e){t++;break}}return t},e._quickSort=function(t,e){if(this.elements.length>1){var i=this._partitionRenderObject(t,e),n=i-1;n>t&&this._quickSort(t,n),e>i&&this._quickSort(i,e)}},e._render=function(t,e){for(var i,n,r=Stat.loopCount,a=t.scene,s=t.camera,o=0,l=this.elements.length;l>o;o++){var _=this.isTransparent?this.elements[l-o-1]:this.elements[o],h=_._transform,u=_.render,c=_._geometry,d=_.material;if(t.renderElement=_,r!==u._updateLoopCount?(u._renderUpdate(t,h),u._renderUpdateWithCamera(t,h),u._updateLoopCount=r,u._updateCamera=s):s!==u._updateCamera&&(u._renderUpdateWithCamera(t,h),u._updateCamera=s),c._prepareRender(t))for(var f=d._renderStates,m=d._shader._passes,p=0,g=m.length;g>p;p++){var v=(a._defineDatas.value|c._vertexDeclarationDefine)&~d._disablePublicDefineDatas.value,x=t.shader=m[p].withCompile(v,u._defineDatas.value,d._defineDatas.value),y=x.bind(),T=r!==x._uploadLoopCount;if(c._singletonVertexBuffer){var D=c._vertexBuffer;D.bind(),x.uploadAttributes(D.vertexDeclaration._shaderValues)}else x.uploadMultiAttributes(c._multiVerDecValueData);var E=x._uploadScene!==a||T;(E||y)&&(x.uploadUniforms(x._sceneUniformParamsMap,a._shaderValues,E),x._uploadScene=a);var S=x._uploadCamera!==s,M=S||x._uploadRender!==u||T;(M||y)&&(x.uploadUniforms(x._spriteUniformParamsMap,u._shaderValues,M),x._uploadRender=u);var R=S||T;(R||y)&&(x.uploadUniforms(x._cameraUniformParamsMap,s._shaderValues,R),x._uploadCamera=s);var A=x._uploadMaterial!==d||T;(A||y)&&(x.uploadUniforms(x._materialUniformParamsMap,d._shaderValues,A),x._uploadMaterial=d);var C=f[p];i!==C?(C._setRenderStateBlendDepth(),C._setRenderStateFrontFace(e,h),i=C,n=u):n!==u&&(C._setRenderStateFrontFace(e,h),n=u),c._render(t),x._uploadLoopCount=r}}},e.clear=function(){this.elements.length=0,this.lastTransparentRenderElement=null,this.lastTransparentBatched=!1},t}(),OctreeNode=function(){function t(t,e){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new BoundSphere(new Vector3,0),this._corners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],this._boundingBoxCenter=new Vector3,this._children=__newvec(8),this._objects=[],this._tempBoundBoxCorners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],this._scene=t,this._currentDepth=e}__class(t,"laya.d3.core.scene.OctreeNode");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.scene.ITreeNode":!0}),e.init=function(t,e){var i=new Vector3,n=new Vector3;Vector3.scale(e,-.5,i),Vector3.scale(e,.5,n),Vector3.add(i,t,i),Vector3.add(n,t,n),this.exactBox=new BoundBox(i,n),this.relaxBox=new BoundBox(i,n)},e.addTreeNode=function(t){1===Collision.boxContainsBox(this._relaxBox,t.boundingBox)?this.addNodeDown(t,0):this.addObject(t)},e.addChild=function(e){var i=this._children[e];if(null==i){i=new t(this._scene,this._currentDepth+1),this._children[e]=i,i._parent=this,Vector3.subtract(this._exactBox.max,this._exactBox.min,t.tempSize),Vector3.multiply(t.tempSize,t._octreeSplit[e],t.tempCenter),Vector3.add(this._exactBox.min,t.tempCenter,t.tempCenter),Vector3.scale(t.tempSize,.25,t.tempSize);var n=new Vector3,r=new Vector3;Vector3.subtract(t.tempCenter,t.tempSize,n),Vector3.add(t.tempCenter,t.tempSize,r),i.exactBox=new BoundBox(n,r),Vector3.scale(t.tempSize,t.relax,t.tempSize);var a=new Vector3,s=new Vector3;Vector3.subtract(t.tempCenter,t.tempSize,a),Vector3.add(t.tempCenter,t.tempSize,s),i.relaxBox=new BoundBox(a,s)}return i},e.addObject=function(t){t._treeNode=this,this._objects.push(t)},e.removeObject=function(t){if(t._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var e=this._objects.indexOf(t);return-1!==e?(this._objects.splice(e,1),!0):!1},e.clearObject=function(){this._objects.length=0},e.addNodeUp=function(t,e){this._parent&&1!==Collision.boxContainsBox(this._exactBox,t.boundingBox)?this._parent.addNodeUp(t,e-1):this.addNodeDown(t,e)},e.addNodeDown=function(t,e){if(e<this._scene.treeLevel){var i=this.inChildIndex(t.boundingBoxCenter),n=this.addChild(i);1===Collision.boxContainsBox(n._relaxBox,t.boundingBox)?n.addNodeDown(t,++e):this.addObject(t)}else this.addObject(t)},e.inChildIndex=function(t){var e=t.z<this._boundingBoxCenter.z?0:1,i=t.y<this._boundingBoxCenter.y?0:1,n=t.x<this._boundingBoxCenter.x?0:1;return 4*e+2*i+n},e.updateObject=function(t){1===Collision.boxContainsBox(this._relaxBox,t.boundingBox)?(this.removeObject(t),t._treeNode=null,this.addNodeDown(t,this._currentDepth)):this._parent&&(this.removeObject(t),t._treeNode=null,this._parent.addNodeUp(t,this._currentDepth-1))},e.cullingObjects=function(t,e,i,n,r){var a=0,s=0,o=0,l=0,_=this._scene._dynamicBatchManager;for(a=0,o=this._objects.length;o>a;a++){var h=this._objects[a];if(Layer.isVisible(h._owner.layer.mask)&&h.enable){if(e&&(Stat.treeSpriteCollision+=1,0===t.containsBoundSphere(h.boundingSphere)))continue;h._renderUpdateWithCamera(r),h._distanceForSort=Vector3.distance(h.boundingSphere.center,n)+h.sortingFudge;var u=h._renderElements;for(s=0,l=u.length;l>s;s++){var c=u[s],d=c.staticBatch;if(d)d._addBatchRenderElement(c);else{var f=c._geometry;f.triangleCount<laya.d3.graphics.DynamicBatch.maxCombineTriangleCount&&1===f._vertexBufferCount&&f._getIndexBuffer()&&c.material.renderQueue<2&&c._canDynamicBatch&&!h._owner.isStatic?_._addPrepareRenderElement(c):this._scene._getRenderQueue(c.material.renderQueue).addElement(c)}}}}for(a=0;8>a;a++){var m=this._children[a];if(null!=m){var p=e;if(e){var g=t.containsBoundBox(m._relaxBox);if(Stat.treeNodeCollision+=1,0===g)continue;p=2===g}m.cullingObjects(t,p,i,n,r)}}},e.cullingShadowObjects=function(t,e,i,n,r){{var a=0,s=0,o=0,l=0;this._scene._dynamicBatchManager}for(a=0,o=this._objects.length;o>a;a++){var _=this._objects[a];if(_.castShadow&&Layer.isVisible(_._owner.layer.mask)&&_.enable){if(i&&0===t[0].containsBoundSphere(_.boundingSphere))continue;for(var h=1,u=t.length;u>h;h++){var c=e[h-1];if(0!==t[h].containsBoundSphere(_.boundingSphere)){var d=_._renderElements;for(s=0,l=d.length;l>s;s++)c.addElement(d[s])}}}}for(a=0;8>a;a++){var f=this._children[a];if(null!=f){var m=i;if(i){var p=t[0].containsBoundBox(f._relaxBox);if(0===p)continue;m=2===p}f.cullingShadowObjects(t,e,m,n,r)}}},e.cullingShadowObjectsOnePSSM=function(t,e,i,n,r,a){var s=e[0],o=0,l=0,_=0,h=0;for(o=0,_=this._objects.length;_>o;o++){var u=this._objects[o];if(u.castShadow&&Layer.isVisible(u._owner.layer.mask)&&u.enable){if(n&&0===t.containsBoundSphere(u.boundingSphere))continue;u._renderUpdateWithCamera(i);var c=u._renderElements;for(l=0,h=c.length;h>l;l++)s.addElement(c[l])}}for(o=0;8>o;o++){var d=this._children[o];if(null!=d){var f=n;if(n){var m=t.containsBoundBox(d._relaxBox);if(0===m)continue;f=2===m}d.cullingShadowObjectsOnePSSM(t,e,i,f,r,a)}}},e.renderBoudingBox=function(t){this._renderBoudingBox(t);for(var e=0;8>e;++e){var i=this._children[e];i&&i.renderBoudingBox(t)}},e.buildAllChild=function(t){if(t<this._scene.treeLevel)for(var e=0;8>e;e++){var i=this.addChild(e);i.buildAllChild(t+1)}},e._renderBoudingBox=function(){},__getset(0,e,"exactBox",function(){return this._exactBox},function(t){this._exactBox=t,Vector3.add(t.min,t.max,this._boundingBoxCenter),Vector3.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),__getset(0,e,"relaxBox",function(){return this._relaxBox},function(t){this._relaxBox=t,t.getCorners(this._corners),BoundSphere.createfromPoints(this._corners,this._boundingSphere)}),t.debugMode=!1,t.relax=1.15,t.CHILDNUM=8,__static(t,["tempVector0",function(){return this.tempVector0=new Vector3},"tempSize",function(){return this.tempSize=new Vector3},"tempCenter",function(){return this.tempCenter=new Vector3},"_octreeSplit",function(){return this._octreeSplit=[new Vector3(.25,.25,.25),new Vector3(.75,.25,.25),new Vector3(.25,.75,.25),new Vector3(.75,.75,.25),new Vector3(.25,.25,.75),new Vector3(.75,.25,.75),new Vector3(.25,.75,.75),new Vector3(.75,.75,.75)]}]),t}(),Color$1=function(){function t(t,e,i,n){this._r=0/0,this._g=0/0,this._b=0/0,this._a=0/0,void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),this._r=t,this._g=e,this._b=i,this._a=n}__class(t,"laya.d3.core.trail.module.Color",null,"Color$1");var e=t.prototype;return e.cloneTo=function(t){t._r=this._r,t._g=this._g,t._b=this._b,t._a=this._a},__static(t,["RED",function(){return this.RED=new t(1,0,0,1)},"GREEN",function(){return this.GREEN=new t(0,1,0,1)},"BLUE",function(){return this.BLUE=new t(0,0,1,1)},"CYAN",function(){return this.CYAN=new t(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new t(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new t(1,0,1,1)},"GRAY",function(){return this.GRAY=new t(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new t(1,1,1,1)},"BLACK",function(){return this.BLACK=new t(0,0,0,1)}]),t}(),Gradient=function(){function t(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}__class(t,"laya.d3.core.trail.module.Gradient");var e=t.prototype;return e.setKeys=function(t,e){this._colorKeys=t,this.index=0;for(var i,n=0;n<t.length;n++){i=t[n];var r=i.color;this._colorKeyData[this.index++]=r._r,this._colorKeyData[this.index++]=r._g,this._colorKeyData[this.index++]=r._b,this._colorKeyData[this.index++]=i.time}this._alphaKeys=e,this.index=0;for(var a,s=0;s<e.length;s++)a=e[s],this._alphaKeyData[this.index++]=a.alpha,this._alphaKeyData[this.index++]=a.time},e.cloneTo=function(t){var e=0,i=0,n=this.colorKeys,r=[];for(e=0,i=n.length;i>e;e++){var a=new GradientColorKey(new Color$1,0);n[e].cloneTo(a),r.push(a)}var s=this.alphaKeys,o=[];for(e=0,i=s.length;i>e;e++){var l=new GradientAlphaKey;s[e].cloneTo(l),o.push(l)}t.setKeys(r,o)},__getset(0,e,"mode",function(){return this._mode},function(t){this._mode=t}),__getset(0,e,"colorKeys",function(){return this._colorKeys},function(t){this._colorKeys=t,this.index=0;for(var e=0;e<t.length;e++){var i=t[e],n=i.color;this._colorKeyData[this.index++]=n._r,this._colorKeyData[this.index++]=n._g,this._colorKeyData[this.index++]=n._b,this._colorKeyData[this.index++]=i.time}}),__getset(0,e,"alphaKeys",function(){return this._alphaKeys},function(t){this._alphaKeys=t,this.index=0;for(var e=0;e<t.length;e++){var i=t[e];this._alphaKeyData[this.index++]=i.alpha,this._alphaKeyData[this.index++]=i.time}}),t}(),GradientAlphaKey=function(){function t(t,e){this._alpha=0/0,this._time=0/0,void 0===t&&(t=0),void 0===e&&(e=0),this._alpha=t,this._time=e}__class(t,"laya.d3.core.trail.module.GradientAlphaKey");var e=t.prototype;return e.cloneTo=function(t){t.alpha=this.alpha,t.time=this.time},__getset(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),__getset(0,e,"time",function(){return this._time},function(t){this._time=t}),t}(),GradientColorKey=function(){function t(t,e){this._color=null,this._time=0/0,void 0===e&&(e=0),this._color=t,this._time=e}__class(t,"laya.d3.core.trail.module.GradientColorKey");var e=t.prototype;return e.cloneTo=function(t){this.color.cloneTo(t.color),t.time=this.time},__getset(0,e,"color",function(){return this._color},function(t){this._color=t}),__getset(0,e,"time",function(){return this._time},function(t){this._time=t}),t}(),GradientMode=function(){function t(){}return __class(t,"laya.d3.core.trail.module.GradientMode"),t.Blend=0,t.Fixed=1,t}(),TextureMode=function(){function t(){}return __class(t,"laya.d3.core.trail.module.TextureMode"),t.Stretch=0,t.Tile=1,t}(),TrailKeyFrame=function(){function t(){this.time=0/0,this.inTangent=0/0,this.outTangent=0/0,this.value=0/0}__class(t,"laya.d3.core.trail.module.TrailKeyFrame");var e=t.prototype;return e.cloneTo=function(t){t.time=this.time,t.inTangent=this.inTangent,t.outTangent=this.outTangent,t.value=this.value},t}(),VertexTrail=function(){function t(){}__class(t,"laya.d3.core.trail.VertexTrail");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration1}),__getset(1,t,"vertexDeclaration1",function(){return t._vertexDeclaration1}),__getset(1,t,"vertexDeclaration2",function(){return t._vertexDeclaration2}),__static(t,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new VertexDeclaration(32,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",42),new VertexElement(24,"single",33),new VertexElement(28,"single",41)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new VertexDeclaration(4,[new VertexElement(0,"single",39)])}]),t}(),DynamicBatchManager=function(){function t(){this._batchRenderElementPool=[]}__class(t,"laya.d3.graphics.DynamicBatchManager");var e=t.prototype;return e._clear=function(){this._batchRenderElementPoolIndex=0},e._getBatchRenderElementFromPool=function(){throw"StaticBatch:must override this function."},e.dispose=function(){},t._registerManager=function(e){t._managers.push(e)},t._managers=[],t}(),FrustumCulling=function(){function t(){}return __class(t,"laya.d3.graphics.FrustumCulling"),t.__init__=function(){Render.isConchApp&&(t._cullingBufferLength=0,t._cullingBuffer=new Float32Array(4096))},t.renderObjectCulling=function(t,e,i,n){var r=0,a=0,s=0,o=0,l=e._opaqueQueue,_=e._transparentQueue;l.clear(),_.clear();var h=StaticBatchManager._managers;for(r=0,a=h.length;a>r;r++)h[r]._clear();var u=DynamicBatchManager._managers;for(r=0,a=u.length;a>r;r++)u[r]._clear();var c=n.length,d=n.elements,f=t.boundFrustum;Stat.spriteCount+=c;var m=i.camera._transform.position;for(r=0;c>r;r++){var p=d[r];if(e.isLayerVisible(p._owner._layer)&&p._enable&&p._needRender(f)){p._visible=!0,p._distanceForSort=Vector3.distance(p.boundingSphere.center,m)+p.sortingFudge;var g=p._renderElements;for(s=0,o=g.length;o>s;s++){var v=g[s],x=e._getRenderQueue(v.material.renderQueue);x.isTransparent?v.addToTransparentRenderQueue(i,x):v.addToOpaqueRenderQueue(i,x)}}else p._visible=!1}var y=l.elements.length;y>0&&l._quickSort(0,y-1),y=_.elements.length,y>0&&_._quickSort(0,y-1)},t.renderObjectCullingNative=function(e,i,n,r){var a=0,s=0,o=0,l=0,_=i._opaqueQueue,h=i._transparentQueue;_.clear(),h.clear();var u=StaticBatchManager._managers;for(a=0,s=u.length;s>a;a++)u[a]._clear();var c=DynamicBatchManager._managers;for(a=0,s=c.length;s>a;a++)c[a]._clear();var d=r.length,f=r.elements;for(a=0;d>a;a++)f[a].boundingSphere;e.boundFrustum;t.cullingNative(e._boundFrustumBuffer,t._cullingBuffer,i._cullingBufferIndices,d,i._cullingBufferResult),Stat.spriteCount+=d;var m=n.camera._transform.position;for(a=0;d>a;a++){var p=f[a];if(i.isLayerVisible(p._owner._layer)&&p._enable&&i._cullingBufferResult[a]){p._visible=!0,p._distanceForSort=Vector3.distance(p.boundingSphere.center,m)+p.sortingFudge;var g=p._renderElements;for(o=0,l=g.length;l>o;o++){var v=g[o],x=i._getRenderQueue(v.material.renderQueue);x.isTransparent?v.addToTransparentRenderQueue(n,x):v.addToOpaqueRenderQueue(n,x)}}else p._visible=!1}var y=_.elements.length;y>0&&_._quickSort(0,y-1),y=h.elements.length,y>0&&h._quickSort(0,y-1)},t.cullingNative=function(t,e,i,n,r){return LayaGL.instance.culling(t,e,i,n,r)},t._cullingBufferLength=0,t._cullingBuffer=null,t}(),StaticBatchManager=function(){function t(){this._initBatchSprites=[],this._staticBatches={},this._batchRenderElementPoolIndex=0,this._batchRenderElementPool=[]}__class(t,"laya.d3.graphics.StaticBatchManager");var e=t.prototype;return e._partition=function(t,e,i){for(var n=t[Math.floor((i+e)/2)];i>=e;){for(;this._compare(t[e],n)<0;)e++;for(;this._compare(t[i],n)>0;)i--;if(i>e){var r=t[e];t[e]=t[i],t[i]=r,e++,i--}else if(e===i){e++;break}}return e},e._quickSort=function(t,e,i){if(t.length>1){var n=this._partition(t,e,i),r=n-1;r>e&&this._quickSort(t,e,r),i>n&&this._quickSort(t,n,i)}},e._compare=function(){throw"StaticBatch:must override this function."},e._initStaticBatchs=function(){throw"StaticBatch:must override this function."},e._getBatchRenderElementFromPool=function(){throw"StaticBatch:must override this function."},e._addBatchSprite=function(t){this._initBatchSprites.push(t)},e._clear=function(){this._batchRenderElementPoolIndex=0},e._garbageCollection=function(){throw"StaticBatchManager: must override it."},e.dispose=function(){this._staticBatches=null},t._registerManager=function(e){t._managers.push(e)},t._addToStaticBatchQueue=function(e){e instanceof laya.d3.core.RenderableSprite3D&&e.isStatic&&e._addToInitStaticBatchManager();for(var i=0,n=e.numChildren;n>i;i++)t._addToStaticBatchQueue(e._children[i])},t.combine=function(e,i){var n=0,r=0;if(i)for(n=0,r=i.length;r>n;n++){var a=i[n];a.isStatic&&a._addToInitStaticBatchManager()}else e&&t._addToStaticBatchQueue(e);for(n=0,r=t._managers.length;r>n;n++){var s=t._managers[n];s._initStaticBatchs(e)}},t._managers=[],t}(),MeshRenderStaticBatchOwner=function(){function t(t){this._owner=t,this._batches=[],this._cacheBatchOwner=[]}__class(t,"laya.d3.graphics.MeshRenderStaticBatchOwner");var e=t.prototype;return e._getBatchRender=function(t,e,i){var n=this._cacheBatchOwner[e];n||(n=this._cacheBatchOwner[e]=__newvec(2,null));var r=n[i?1:0];return r||(r=new MeshRender(null,4),r.lightmapIndex=e,r.receiveShadow=i,n[i?1:0]=r),r},t}(),VertexPosition=function(){function t(t){this._position=null,this._position=t}__class(t,"laya.d3.graphics.Vertex.VertexPosition");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(12,[new VertexElement(0,"vector3",0)])}]),t}(),VertexPositionNormal=function(){function t(t,e){this._position=null,this._normal=null,this._position=t,this._normal=e}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormal");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(24,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3)])}]),t}(),VertexPositionNormalColor=function(){function t(t,e,i){this._position=null,this._normal=null,this._color=null,this._position=t,this._normal=e,this._color=i}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColor");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(40,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1)])}]),t}(),VertexPositionNormalColorSkin=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._blendIndex=n,this._blendWeight=r
}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorSkin");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(72,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6)])}]),t}(),VertexPositionNormalColorSkinSTangent=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorSkinSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(88,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6),new VertexElement(72,"vector4",5)])}]),t}(),VertexPositionNormalColorSkinTangent=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorSkinTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(84,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6),new VertexElement(72,"vector3",5)])}]),t}(),VertexPositionNormalColorSTangent=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(56,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector4",5)])}]),t}(),VertexPositionNormalColorTangent=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(52,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector3",5)])}]),t}(),VertexPositionNormalColorTexture=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTexture");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(48,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2)])}]),t}(),VertexPositionNormalColorTexture0Texture1=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTexture0Texture1");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(56,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15)])}]),t}(),VertexPositionNormalColorTexture0Texture1Skin=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._blendIndex=a,this._blendWeight=s}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTexture0Texture1Skin");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(88,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector4",7),new VertexElement(72,"vector4",6)])}]),t}(),VertexPositionNormalColorTexture0Texture1SkinSTangent=function(){function t(t,e,i,n,r,a,s,o){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTexture0Texture1SkinSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(104,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector4",7),new VertexElement(72,"vector4",6),new VertexElement(88,"vector4",5)])}]),t}(),VertexPositionNormalColorTexture0Texture1SkinTangent=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTexture0Texture1SkinTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0SkinTangent=function(t,e,i,n,r,a,s,o){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o},__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(100,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector4",7),new VertexElement(72,"vector4",6),new VertexElement(88,"vector3",5)])}]),t}(),VertexPositionNormalColorTexture0Texture1STangent=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTexture0Texture1STangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(72,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector4",5)])}]),t}(),VertexPositionNormalColorTexture0Texture1Tangent=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTexture0Texture1Tangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0Tangent=function(t,e,i,n,r,a){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a},__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(68,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector3",5)])}]),t}(),VertexPositionNormalColorTextureSkin=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._blendIndex=r,this._blendWeight=a}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTextureSkin");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(80,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector4",7),new VertexElement(64,"vector4",6)])}]),t}(),VertexPositionNormalColorTextureSkinSTangent=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTextureSkinSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(96,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector4",7),new VertexElement(64,"vector4",6),new VertexElement(80,"vector4",5)])}]),t}(),VertexPositionNormalColorTextureSkinTangent=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTextureSkinTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(92,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector4",7),new VertexElement(64,"vector4",6),new VertexElement(80,"vector3",5)])}]),t}(),VertexPositionNormalColorTextureSTangent=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTextureSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(64,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector4",5)])}]),t}(),VertexPositionNormalColorTextureTangent=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalColorTextureTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"color",function(){return this._color}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(60,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector3",5)])}]),t}(),VertexPositionNormalSTangent=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(40,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",5)])}]),t}(),VertexPositionNormalTangent=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(36,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector3",5)])}]),t}(),VertexPositionNormalTexture=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTexture");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(32,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2)])}]),t}(),VertexPositionNormalTexture0Texture1=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTexture0Texture1");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(40,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15)])}]),t}(),VertexPositionNormalTexture0Texture1Skin=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._blendIndex=r,this._blendWeight=a}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTexture0Texture1Skin");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(72,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6)])}]),t}(),VertexPositionNormalTexture0Texture1SkinSTangent=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTexture0Texture1SkinSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(88,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6),new VertexElement(72,"vector4",5)])}]),t}(),VertexPositionNormalTexture0Texture1SkinTangent=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTexture0Texture1SkinTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0SkinTangent=function(t,e,i,n,r,a,s){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s},__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(84,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6),new VertexElement(72,"vector3",5)])}]),t}(),VertexPositionNormalTexture0Texture1STangent=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTexture0Texture1STangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(56,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector4",5)])}]),t}(),VertexPositionNormalTexture0Texture1Tangent=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTexture0Texture1Tangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0Tangent=function(t,e,i,n,r){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r},__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(52,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector3",5)])}]),t}(),VertexPositionNormalTextureSkin=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._blendIndex=n,this._blendWeight=r
}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTextureSkin");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(64,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector4",7),new VertexElement(48,"vector4",6)])}]),t}(),VertexPositionNormalTextureSkinSTangent=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTextureSkinSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(80,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector4",7),new VertexElement(48,"vector4",6),new VertexElement(64,"vector4",5)])}]),t}(),VertexPositionNormalTextureSkinTangent=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTextureSkinTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(76,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector4",7),new VertexElement(48,"vector4",6),new VertexElement(64,"vector3",5)])}]),t}(),VertexPositionNormalTextureSTangent=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTextureSTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(48,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector4",5)])}]),t}(),VertexPositionNormalTextureTangent=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}__class(t,"laya.d3.graphics.Vertex.VertexPositionNormalTextureTangent");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(44,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector3",5)])}]),t}(),VertexPositionNTBTexture=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}__class(t,"laya.d3.graphics.Vertex.VertexPositionNTBTexture");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(56,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector3",5),new VertexElement(36,"vector3",4),new VertexElement(48,"vector2",2)])}]),t}(),VertexPositionNTBTexture0Texture1Skin=function(){function t(t,e,i,n,r,a,s,o){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,i=i,this._blendIndex=s,this._blendWeight=o}__class(t,"laya.d3.graphics.Vertex.VertexPositionNTBTexture0Texture1Skin");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"tangent",function(){return this._tangent}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,e,"blendIndex",function(){return this._blendIndex}),__getset(0,e,"blendWeight",function(){return this._blendWeight}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(96,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector3",5),new VertexElement(36,"vector3",4),new VertexElement(48,"vector2",2),new VertexElement(56,"vector2",15),new VertexElement(64,"vector4",7),new VertexElement(80,"vector4",6)])}]),t}(),VertexPositionTerrain=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=t,this._normal=e,this._textureCoord0=i,this._textureCoord1=n}__class(t,"laya.d3.graphics.Vertex.VertexPositionTerrain");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"normal",function(){return this._normal}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoord0",function(){return this._textureCoord0}),__getset(0,e,"textureCoord1",function(){return this._textureCoord1}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(40,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15)])}]),t}(),VertexPositionTexture0=function(){function t(t,e){this._position=null,this._textureCoordinate0=null,this._position=t,this._textureCoordinate0=e}__class(t,"laya.d3.graphics.Vertex.VertexPositionTexture0");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"position",function(){return this._position}),__getset(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(20,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector2",2)])}]),t}(),VertexShurikenParticleBillboard=function(){function t(t,e,i,n,r,a,s,o,l,_,h,u,c,d){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=0/0,this._time=0/0,this._startSpeed=0/0,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=a,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=_,this._startSpeed=h,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=d}__class(t,"laya.d3.graphics.Vertex.VertexShurikenParticleBillboard");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),__getset(0,e,"random1",function(){return this._randoms1}),__getset(0,e,"startRotation2",function(){return this._startRotation2}),__getset(0,e,"positionStartLifeTime",function(){return this._positionStartLifeTime}),__getset(0,e,"velocity",function(){return this._velocity}),__getset(0,e,"random0",function(){return this._randoms0}),__getset(0,e,"startSize",function(){return this._startSize}),__getset(0,e,"startColor",function(){return this._startColor}),__getset(0,e,"startRotation0",function(){return this._startRotation0}),__getset(0,e,"startRotation1",function(){return this._startRotation1}),__getset(0,e,"startLifeTime",function(){return this._startLifeTime}),__getset(0,e,"time",function(){return this._time}),__getset(0,e,"startSpeed",function(){return this._startSpeed}),__getset(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(152,[new VertexElement(0,"vector4",17),new VertexElement(16,"vector4",30),new VertexElement(32,"vector4",32),new VertexElement(48,"vector4",19),new VertexElement(64,"vector3",20),new VertexElement(76,"vector3",22),new VertexElement(88,"single",31),new VertexElement(92,"vector4",34),new VertexElement(108,"vector4",35),new VertexElement(124,"vector3",36),new VertexElement(136,"vector4",37)])}]),t}(),VertexShurikenParticleMesh=function(){function t(t,e,i,n,r,a,s,o,l,_,h,u,c,d){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=0/0,this._time=0/0,this._startSpeed=0/0,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=a,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=_,this._startSpeed=h,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=d}__class(t,"laya.d3.graphics.Vertex.VertexShurikenParticleMesh");var e=t.prototype;return Laya.imps(e,{"laya.d3.graphics.IVertex":!0}),__getset(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),__getset(0,e,"velocity",function(){return this._velocity}),__getset(0,e,"position",function(){return this._positionStartLifeTime}),__getset(0,e,"random0",function(){return this._randoms0}),__getset(0,e,"startSize",function(){return this._startSize}),__getset(0,e,"startColor",function(){return this._startColor}),__getset(0,e,"startRotation0",function(){return this._startRotation0}),__getset(0,e,"startRotation1",function(){return this._startRotation1}),__getset(0,e,"random1",function(){return this._randoms1}),__getset(0,e,"startRotation2",function(){return this._startRotation2}),__getset(0,e,"startLifeTime",function(){return this._startLifeTime}),__getset(0,e,"time",function(){return this._time}),__getset(0,e,"startSpeed",function(){return this._startSpeed}),__getset(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),__getset(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),__getset(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),__static(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(172,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector4",1),new VertexElement(28,"vector2",2),new VertexElement(36,"vector4",30),new VertexElement(52,"vector4",32),new VertexElement(68,"vector4",19),new VertexElement(84,"vector3",20),new VertexElement(96,"vector3",22),new VertexElement(108,"single",31),new VertexElement(112,"vector4",34),new VertexElement(128,"vector4",35),new VertexElement(144,"vector3",36),new VertexElement(156,"vector4",37)])}]),t}(),VertexDeclaration=function(){function t(e,i){this._id=0,this._vertexStride=0,this._vertexElementsDic=null,this._shaderValues=null,this._defineDatas=null,this.vertexElements=null,this._id=++t._uniqueIDCounter,this._defineDatas=new DefineDatas,this._vertexElementsDic={},this._vertexStride=e,this.vertexElements=i;for(var n=i.length,r=0,a=0;n>a;a++)r=Math.max(r,i[a].elementUsage);this._shaderValues=new ShaderDatas(null,r+1);for(var s=0;n>s;s++){var o=i[s],l=o.elementUsage;this._vertexElementsDic[l]=o;var _=new Int32Array(5);switch(_[0]=t._getTypeSize(o.elementFormat)/4,_[1]=5126,_[2]=0,_[3]=this._vertexStride,_[4]=o.offset,this._shaderValues.setAttribute(l,_),l){case 1:this._defineDatas.add(t.SHADERDEFINE_COLOR);break;case 2:this._defineDatas.add(t.SHADERDEFINE_UV0);break;case 15:this._defineDatas.add(t.SHADERDEFINE_UV1)}}}__class(t,"laya.d3.graphics.VertexDeclaration");var e=t.prototype;return e.getVertexElementByUsage=function(t){return this._vertexElementsDic[t]},e.unBinding=function(){},__getset(0,e,"id",function(){return this._id}),__getset(0,e,"vertexStride",function(){return this._vertexStride}),t._getTypeSize=function(t){switch(t){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":return 4;case"byte4":return 4;case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},t.SHADERDEFINE_UV0=0,t.SHADERDEFINE_COLOR=0,t.SHADERDEFINE_UV1=0,t._uniqueIDCounter=1,t}(),VertexElement=function(){function t(t,e,i){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=t,this.elementFormat=e,this.elementUsage=i}return __class(t,"laya.d3.graphics.VertexElement"),t}(),VertexElementFormat=function(){function t(){}return __class(t,"laya.d3.graphics.VertexElementFormat"),t.Single="single",t.Vector2="vector2",t.Vector3="vector3",t.Vector4="vector4",t.Color="color",t.Byte4="byte4",t.Short2="short2",t.Short4="short4",t.NormalizedShort2="normalizedshort2",t.NormalizedShort4="normalizedshort4",t.HalfVector2="halfvector2",t.HalfVector4="halfvector4",t}(),VertexElementUsage=function(){function t(){}return __class(t,"laya.d3.graphics.VertexElementUsage"),t.POSITION0=0,t.COLOR0=1,t.TEXTURECOORDINATE0=2,t.NORMAL0=3,t.BINORMAL0=4,t.TANGENT0=5,t.BLENDINDICES0=6,t.BLENDWEIGHT0=7,t.DEPTH0=8,t.FOG0=9,t.POINTSIZE0=10,t.SAMPLE0=11,t.TESSELLATEFACTOR0=12,t.COLOR1=13,t.NEXTTEXTURECOORDINATE0=14,t.TEXTURECOORDINATE1=15,t.NEXTTEXTURECOORDINATE1=16,t.CORNERTEXTURECOORDINATE0=17,t.VELOCITY0=18,t.STARTCOLOR0=19,t.STARTSIZE=20,t.AGEADDSCALE0=21,t.STARTROTATION=22,t.ENDCOLOR0=23,t.STARTLIFETIME=24,t.TIME0=33,t.SHAPEPOSITIONSTARTLIFETIME=30,t.DIRECTIONTIME=32,t.SIZEROTATION0=27,t.RADIUS0=28,t.RADIAN0=29,t.STARTSPEED=31,t.RANDOM0=34,t.RANDOM1=35,t.SIMULATIONWORLDPOSTION=36,t.SIMULATIONWORLDROTATION=37,t.TEXCOORD3D0=38,t.TEXTURECOORDINATE0X=39,t.TEXTURECOORDINATE0X1=40,t.TEXTURECOORDINATE0Y=41,t.OFFSETVECTOR=42,t}(),LoadModelV03=function(){function t(){}return __class(t,"laya.d3.loaders.LoadModelV03"),t.parse=function(e,i,n,r,a){t._mesh=n,t._subMeshes=r,t._materialMap=a,t._version=i,t._readData=e,t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var s=0,o=t._BLOCK.count;o>s;s++){t._readData.pos=t._BLOCK.blockStarts[s];var l=t._readData.getUint16(),_=t._strings[l],h=t["READ_"+_];if(null==h)throw new Error("model file err,no this function:"+l+" "+_);h.call()}t._mesh._bindPoseIndices=new Uint16Array(t._bindPoseIndices),t._bindPoseIndices.length=0,t._strings.length=0,t._readData=null,t._version=null,t._mesh=null,t._subMeshes=null,t._materialMap=null},t._readString=function(){return t._strings[t._readData.getUint16()]},t.READ_DATA=function(){t._DATA.offset=t._readData.getUint32(),t._DATA.size=t._readData.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._readData.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;e>r;r++)i.push(t._readData.getUint32()),n.push(t._readData.getUint32())},t.READ_STRINGS=function(){var e=t._readData.getUint32(),i=t._readData.getUint16(),n=t._readData.pos;t._readData.pos=e+t._DATA.offset;for(var r=0;i>r;r++)t._strings[r]=t._readData.readUTFString();t._readData.pos=n},t.READ_MESH=function(){var e=(t._readString(),t._readData.__getBuffer()),i=0,n=t._readData.getInt16(),r=t._DATA.offset;for(i=0;n>i;i++){var a,s=r+t._readData.getUint32(),o=t._readData.getUint32(),l=new Float32Array(e.slice(s,s+o)),_=t._readString();switch(t._version){case"LAYAMODEL:03":a=t._vertexDeclarationMap_Discard[_];break;case"LAYAMODEL:0301":a=t._vertexDeclarationMap[_];break;default:throw new Error("LoadModelV03: unknown version.")}if(!a)throw new Error("LoadModelV03: unknown vertexDeclaration.");var h=new VertexBuffer3D(4*l.length,35044,!0);h.vertexDeclaration=a,h.setData(l),t._mesh._vertexBuffers.push(h),t._mesh._vertexCount+=h.vertexCount}var u=r+t._readData.getUint32(),c=t._readData.getUint32(),d=new Uint16Array(e.slice(u,u+c)),f=IndexBuffer3D.create("ushort",c/2,35044,!0);f.setData(d),t._mesh._indexBuffer=f;var m=t._mesh._boneNames=[],p=t._readData.getUint16();for(m.length=p,i=0;p>i;i++)m[i]=t._strings[t._readData.getUint16()];t._readData.pos+=8;var g=t._readData.getUint32(),v=t._readData.getUint32(),x=new Float32Array(e.slice(r+g,r+g+v)),y=x.length,T=y/16,D=t._mesh._inverseBindPosesBuffer=new ArrayBuffer(4*y);for(t._mesh._inverseBindPoses=__newvec(T),i=0;y>i;i+=16){var E=new Matrix4x4(x[i+0],x[i+1],x[i+2],x[i+3],x[i+4],x[i+5],x[i+6],x[i+7],x[i+8],x[i+9],x[i+10],x[i+11],x[i+12],x[i+13],x[i+14],x[i+15],new Float32Array(D,4*i,16));t._mesh._inverseBindPoses[i/16]=E}return!0},t.READ_SUBMESH=function(){var e=t._readData.__getBuffer(),i=new SubMesh(t._mesh),n=t._readData.getInt16();t._readData.getUint32(),t._readData.getUint32(),i._setVertexBuffer(t._mesh._vertexBuffers[n]);var r=t._readData.getUint32(),a=t._readData.getUint32(),s=t._mesh._indexBuffer;i._indexBuffer=s,i._indexStart=r,i._indexCount=a,i._indices=new Uint16Array(s.getData().buffer,2*r,a);var o=t._DATA.offset,l=i._subIndexBufferStart,_=i._subIndexBufferCount,h=i._boneIndicesList,u=t._readData.getUint16();l.length=u,_.length=u,h.length=u;for(var c=t._mesh._skinDataPathMarks,d=t._bindPoseIndices,f=t._subMeshes.length,m=0;u>m;m++){l[m]=t._readData.getUint32(),_[m]=t._readData.getUint32();var p=t._readData.getUint32(),g=t._readData.getUint32(),v=new Uint8Array(e.slice(o+p,o+p+g));h[m]=v;for(var x=0,y=v.length;y>x;x++){var T=v[x],D=d.indexOf(T);-1===D?(v[x]=d.length,d.push(T),c.push([f,m,x])):v[x]=D}}return t._subMeshes.push(i),!0},t._strings=[],t._readData=null,t._version=null,t._mesh=null,t._subMeshes=null,t._materialMap=null,t._bindPoseIndices=[],__static(t,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTexture0Texture1SkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":VertexPositionNTBTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTexture0Texture1SkinTangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTextureSkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTextureSkin.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTextureSkinTangent.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTextureSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorSkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":VertexPositionNormalColorTexture0Texture1Tangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":VertexPositionNormalColorTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":VertexPositionNormalTexture0Texture1Tangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1":VertexPositionNormalTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":VertexPositionNormalColorTextureTangent.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":VertexPositionNTBTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":VertexPositionNormalColorTexture.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":VertexPositionNormalTextureTangent.vertexDeclaration,"POSITION,NORMAL,UV":VertexPositionNormalTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":VertexPositionNormalColorTangent.vertexDeclaration,"POSITION,NORMAL,COLOR":VertexPositionNormalColor.vertexDeclaration,"POSITION,NORMAL,TANGENT":VertexPositionNormalTangent.vertexDeclaration,"POSITION,NORMAL":VertexPositionNormal.vertexDeclaration,"POSITION,UV":VertexPositionTexture0.vertexDeclaration,POSITION:VertexPosition.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTexture0Texture1SkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":VertexPositionNTBTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTexture0Texture1SkinSTangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTextureSkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTextureSkin.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTextureSkinSTangent.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTextureSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorSkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":VertexPositionNormalColorTexture0Texture1STangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":VertexPositionNormalColorTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":VertexPositionNormalTexture0Texture1STangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1":VertexPositionNormalTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":VertexPositionNormalColorTextureSTangent.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":VertexPositionNTBTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":VertexPositionNormalColorTexture.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":VertexPositionNormalTextureSTangent.vertexDeclaration,"POSITION,NORMAL,UV":VertexPositionNormalTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":VertexPositionNormalColorSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR":VertexPositionNormalColor.vertexDeclaration,"POSITION,NORMAL,TANGENT":VertexPositionNormalSTangent.vertexDeclaration,"POSITION,NORMAL":VertexPositionNormal.vertexDeclaration,"POSITION,UV":VertexPositionTexture0.vertexDeclaration,POSITION:VertexPosition.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),LoadModelV04=function(){function t(){}return __class(t,"laya.d3.loaders.LoadModelV04"),t.parse=function(e,i,n,r,a){t._mesh=n,t._subMeshes=r,t._materialMap=a,t._version=i,t._readData=e,t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var s=0,o=t._BLOCK.count;o>s;s++){t._readData.pos=t._BLOCK.blockStarts[s];var l=t._readData.getUint16(),_=t._strings[l],h=t["READ_"+_];if(null==h)throw new Error("model file err,no this function:"+l+" "+_);h.call()}t._mesh._bindPoseIndices=new Uint16Array(t._bindPoseIndices),t._bindPoseIndices.length=0,t._strings.length=0,t._readData=null,t._version=null,t._mesh=null,t._subMeshes=null,t._materialMap=null},t._readString=function(){return t._strings[t._readData.getUint16()]},t.READ_DATA=function(){t._DATA.offset=t._readData.getUint32(),t._DATA.size=t._readData.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._readData.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;e>r;r++)i.push(t._readData.getUint32()),n.push(t._readData.getUint32())},t.READ_STRINGS=function(){var e=t._readData.getUint32(),i=t._readData.getUint16(),n=t._readData.pos;t._readData.pos=e+t._DATA.offset;for(var r=0;i>r;r++)t._strings[r]=t._readData.readUTFString();t._readData.pos=n},t.READ_MESH=function(){var e=(t._readString(),t._readData.__getBuffer()),i=0,n=t._readData.getInt16(),r=t._DATA.offset;for(i=0;n>i;i++){var a,s=r+t._readData.getUint32(),o=t._readData.getUint32(),l=new Float32Array(e.slice(s,s+o)),_=t._readString();switch(t._version){case"LAYAMODEL:03":a=t._vertexDeclarationMap_Discard[_];break;case"LAYAMODEL:0301":case"LAYAMODEL:0400":a=t._vertexDeclarationMap[_];break;default:throw new Error("LoadModelV03: unknown version.")}if(!a)throw new Error("LoadModelV03: unknown vertexDeclaration.");var h=new VertexBuffer3D(4*l.length,35044,!0);h.vertexDeclaration=a,h.setData(l),t._mesh._vertexBuffers.push(h),t._mesh._vertexCount+=h.vertexCount}var u=r+t._readData.getUint32(),c=t._readData.getUint32(),d=new Uint16Array(e.slice(u,u+c)),f=IndexBuffer3D.create("ushort",c/2,35044,!0);f.setData(d),t._mesh._indexBuffer=f;var m=t._mesh._boneNames=[],p=t._readData.getUint16();for(m.length=p,i=0;p>i;i++)m[i]=t._strings[t._readData.getUint16()];t._readData.pos+=8;var g=t._readData.getUint32(),v=t._readData.getUint32(),x=new Float32Array(e.slice(r+g,r+g+v)),y=x.length,T=y/16,D=t._mesh._inverseBindPosesBuffer=new ArrayBuffer(4*y);for(t._mesh._inverseBindPoses=__newvec(T),i=0;y>i;i+=16){var E=new Matrix4x4(x[i+0],x[i+1],x[i+2],x[i+3],x[i+4],x[i+5],x[i+6],x[i+7],x[i+8],x[i+9],x[i+10],x[i+11],x[i+12],x[i+13],x[i+14],x[i+15],new Float32Array(D,4*i,16));t._mesh._inverseBindPoses[i/16]=E}return!0},t.READ_SUBMESH=function(){var e=t._readData.__getBuffer(),i=new SubMesh(t._mesh),n=t._readData.getInt16();t._readData.getUint32(),t._readData.getUint32(),i._setVertexBuffer(t._mesh._vertexBuffers[n]);var r=t._readData.getUint32(),a=t._readData.getUint32(),s=t._mesh._indexBuffer;i._indexBuffer=s,i._indexStart=r,i._indexCount=a,i._indices=new Uint16Array(s.getData().buffer,2*r,a);var o=t._DATA.offset,l=i._subIndexBufferStart,_=i._subIndexBufferCount,h=i._boneIndicesList,u=t._readData.getUint16();l.length=u,_.length=u,h.length=u;for(var c=t._mesh._skinDataPathMarks,d=t._bindPoseIndices,f=t._subMeshes.length,m=0;u>m;m++){l[m]=t._readData.getUint32(),_[m]=t._readData.getUint32();for(var p=t._readData.getUint32(),g=t._readData.getUint32(),v=h[m]=new Uint16Array(e.slice(o+p,o+p+g)),x=0,y=v.length;y>x;x++){var T=v[x],D=d.indexOf(T);-1===D?(v[x]=d.length,d.push(T),c.push([f,m,x])):v[x]=D}}return t._subMeshes.push(i),!0},t._strings=[],t._readData=null,t._version=null,t._mesh=null,t._subMeshes=null,t._materialMap=null,t._bindPoseIndices=[],__static(t,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTexture0Texture1SkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":VertexPositionNTBTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTexture0Texture1SkinTangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTextureSkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTextureSkin.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTextureSkinTangent.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTextureSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorSkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":VertexPositionNormalColorTexture0Texture1Tangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":VertexPositionNormalColorTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":VertexPositionNormalTexture0Texture1Tangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1":VertexPositionNormalTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":VertexPositionNormalColorTextureTangent.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":VertexPositionNTBTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":VertexPositionNormalColorTexture.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":VertexPositionNormalTextureTangent.vertexDeclaration,"POSITION,NORMAL,UV":VertexPositionNormalTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":VertexPositionNormalColorTangent.vertexDeclaration,"POSITION,NORMAL,COLOR":VertexPositionNormalColor.vertexDeclaration,"POSITION,NORMAL,TANGENT":VertexPositionNormalTangent.vertexDeclaration,"POSITION,NORMAL":VertexPositionNormal.vertexDeclaration,"POSITION,UV":VertexPositionTexture0.vertexDeclaration,POSITION:VertexPosition.vertexDeclaration}
},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTexture0Texture1SkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":VertexPositionNTBTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTexture0Texture1SkinSTangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTextureSkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTextureSkin.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTextureSkinSTangent.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTextureSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorSkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":VertexPositionNormalColorTexture0Texture1STangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":VertexPositionNormalColorTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":VertexPositionNormalTexture0Texture1STangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1":VertexPositionNormalTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":VertexPositionNormalColorTextureSTangent.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":VertexPositionNTBTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":VertexPositionNormalColorTexture.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":VertexPositionNormalTextureSTangent.vertexDeclaration,"POSITION,NORMAL,UV":VertexPositionNormalTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":VertexPositionNormalColorSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR":VertexPositionNormalColor.vertexDeclaration,"POSITION,NORMAL,TANGENT":VertexPositionNormalSTangent.vertexDeclaration,"POSITION,NORMAL":VertexPositionNormal.vertexDeclaration,"POSITION,UV":VertexPositionTexture0.vertexDeclaration,POSITION:VertexPosition.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),MeshReader=function(){function t(){}return __class(t,"laya.d3.loaders.MeshReader"),t.read=function(t,e,i,n){var r=new Byte(t);r.pos=0;var a=r.readUTFString();switch(a){case"LAYAMODEL:03":case"LAYAMODEL:0301":LoadModelV03.parse(r,a,e,i,n);break;case"LAYAMODEL:0400":LoadModelV04.parse(r,a,e,i,n);break;default:throw new Error("MeshReader: unknown mesh version.")}e._setSubMeshes(i)},t}(),BaseVector=function(){function t(){this.elements=null}return __class(t,"laya.d3.math.BaseVector"),t}(),BoundBox=function(){function t(t,e){this.min=null,this.max=null,this.min=t,this.max=e}__class(t,"laya.d3.math.BoundBox");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.getCorners=function(t){t.length=8;var e=this.min.elements,i=this.max.elements,n=e[0],r=e[1],a=e[2],s=i[0],o=i[1],l=i[2];t[0]=new Vector3(n,o,l),t[1]=new Vector3(s,o,l),t[2]=new Vector3(s,r,l),t[3]=new Vector3(n,r,l),t[4]=new Vector3(n,o,a),t[5]=new Vector3(s,o,a),t[6]=new Vector3(s,r,a),t[7]=new Vector3(n,r,a)},e.toDefault=function(){this.min.toDefault(),this.max.toDefault()},e.cloneTo=function(t){var e=t;this.min.cloneTo(e.min),this.max.cloneTo(e.max)},e.clone=function(){var t=new this.constructor(new Vector3,new Vector3);return this.cloneTo(t),t},t.createfromPoints=function(t,e){if(null==t)throw new Error("points");var i=e.min,n=e.max,r=i.elements;r[0]=Number.MAX_VALUE,r[1]=Number.MAX_VALUE,r[2]=Number.MAX_VALUE;var a=n.elements;a[0]=-Number.MAX_VALUE,a[1]=-Number.MAX_VALUE,a[2]=-Number.MAX_VALUE;for(var s=0,o=t.length;o>s;++s)Vector3.min(i,t[s],i),Vector3.max(n,t[s],n)},t.merge=function(t,e,i){Vector3.min(t.min,e.min,i.min),Vector3.max(t.max,e.max,i.max)},t}(),BoundFrustum=function(){function t(e){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=e,this._near=new Plane(new Vector3),this._far=new Plane(new Vector3),this._left=new Plane(new Vector3),this._right=new Plane(new Vector3),this._top=new Plane(new Vector3),this._bottom=new Plane(new Vector3),t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}__class(t,"laya.d3.math.BoundFrustum");var e=t.prototype;return e.equalsBoundFrustum=function(t){return this._matrix.equalsOtherMatrix(t.matrix)},e.equalsObj=function(t){if(t instanceof laya.d3.math.BoundFrustum){var e=t;return this.equalsBoundFrustum(e)}return!1},e.getPlane=function(t){switch(t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},e.getCorners=function(e){t._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(e[0]),t._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(e[1]),t._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(e[2]),t._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(e[3]),t._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(e[4]),t._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(e[5]),t._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(e[6]),t._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(e[7])},e.containsPoint=function(t){for(var e=Plane.PlaneIntersectionType_Front,i=Plane.PlaneIntersectionType_Front,n=0;6>n;n++){switch(n){case 0:i=Collision.intersectsPlaneAndPoint(this._near,t);break;case 1:i=Collision.intersectsPlaneAndPoint(this._far,t);break;case 2:i=Collision.intersectsPlaneAndPoint(this._left,t);break;case 3:i=Collision.intersectsPlaneAndPoint(this._right,t);break;case 4:i=Collision.intersectsPlaneAndPoint(this._top,t);break;case 5:i=Collision.intersectsPlaneAndPoint(this._bottom,t)}switch(i){case Plane.PlaneIntersectionType_Back:return 0;case Plane.PlaneIntersectionType_Intersecting:e=Plane.PlaneIntersectionType_Intersecting}}switch(e){case Plane.PlaneIntersectionType_Intersecting:return 2;default:return 1}},e.containsBoundBox=function(e){for(var i,n=t._tempV30,r=t._tempV31,a=1,s=0;6>s;s++){if(i=this.getPlane(s),this._getBoxToPlanePVertexNVertex(e,i.normal,n,r),Collision.intersectsPlaneAndPoint(i,n)===Plane.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(i,r)===Plane.PlaneIntersectionType_Back&&(a=2)}return a},e.containsBoundSphere=function(t){for(var e=Plane.PlaneIntersectionType_Front,i=Plane.PlaneIntersectionType_Front,n=0;6>n;n++){switch(n){case 0:i=Collision.intersectsPlaneAndSphere(this._near,t);break;case 1:i=Collision.intersectsPlaneAndSphere(this._far,t);break;case 2:i=Collision.intersectsPlaneAndSphere(this._left,t);break;case 3:i=Collision.intersectsPlaneAndSphere(this._right,t);break;case 4:i=Collision.intersectsPlaneAndSphere(this._top,t);break;case 5:i=Collision.intersectsPlaneAndSphere(this._bottom,t)}switch(i){case Plane.PlaneIntersectionType_Back:return 0;case Plane.PlaneIntersectionType_Intersecting:e=Plane.PlaneIntersectionType_Intersecting}}switch(e){case Plane.PlaneIntersectionType_Intersecting:return 2;default:return 1}},e._getBoxToPlanePVertexNVertex=function(t,e,i,n){var r=t.min,a=r.elements,s=t.max,o=s.elements,l=e.elements,_=l[0],h=l[1],u=l[2];r.cloneTo(i);var c=i.elements;_>=0&&(c[0]=o[0]),h>=0&&(c[1]=o[1]),u>=0&&(c[2]=o[2]),s.cloneTo(n);var d=n.elements;_>=0&&(d[0]=a[0]),h>=0&&(d[1]=a[1]),u>=0&&(d[2]=a[2])},__getset(0,e,"top",function(){return this._top}),__getset(0,e,"matrix",function(){return this._matrix},function(e){this._matrix=e,t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),__getset(0,e,"near",function(){return this._near}),__getset(0,e,"far",function(){return this._far}),__getset(0,e,"left",function(){return this._left}),__getset(0,e,"right",function(){return this._right}),__getset(0,e,"bottom",function(){return this._bottom}),t._getPlanesFromMatrix=function(t,e,i,n,r,a,s){var o=t.elements,l=o[0],_=o[1],h=o[2],u=o[3],c=o[4],d=o[5],f=o[6],m=o[7],p=o[8],g=o[9],v=o[10],x=o[11],y=o[12],T=o[13],D=o[14],E=o[15],S=e.normal.elements;S[0]=u+h,S[1]=m+f,S[2]=x+v,e.distance=E+D,e.normalize();var M=i.normal.elements;M[0]=u-h,M[1]=m-f,M[2]=x-v,i.distance=E-D,i.normalize();var R=n.normal.elements;R[0]=u+l,R[1]=m+c,R[2]=x+p,n.distance=E+y,n.normalize();var A=r.normal.elements;A[0]=u-l,A[1]=m-c,A[2]=x-p,r.distance=E-y,r.normalize();var C=a.normal.elements;C[0]=u-_,C[1]=m-d,C[2]=x-g,a.distance=E-T,a.normalize();var L=s.normal.elements;L[0]=u+_,L[1]=m+d,L[2]=x+g,s.distance=E+T,s.normalize()},t._get3PlaneInterPoint=function(e,i,n){var r=e.normal,a=i.normal,s=n.normal;Vector3.cross(a,s,t._tempV30),Vector3.cross(s,r,t._tempV31),Vector3.cross(r,a,t._tempV32);var o=Vector3.dot(r,t._tempV30),l=Vector3.dot(a,t._tempV31),_=Vector3.dot(s,t._tempV32);Vector3.scale(t._tempV30,-e.distance/o,t._tempV33),Vector3.scale(t._tempV31,-i.distance/l,t._tempV34),Vector3.scale(t._tempV32,-n.distance/_,t._tempV35),Vector3.add(t._tempV33,t._tempV34,t._tempV36),Vector3.add(t._tempV35,t._tempV36,t._tempV37);var h=t._tempV37;return h},__static(t,["_tempV30",function(){return this._tempV30=new Vector3},"_tempV31",function(){return this._tempV31=new Vector3},"_tempV32",function(){return this._tempV32=new Vector3},"_tempV33",function(){return this._tempV33=new Vector3},"_tempV34",function(){return this._tempV34=new Vector3},"_tempV35",function(){return this._tempV35=new Vector3},"_tempV36",function(){return this._tempV36=new Vector3},"_tempV37",function(){return this._tempV37=new Vector3}]),t}(),BoundSphere=function(){function t(t,e){this.center=null,this.radius=0/0,this.center=t,this.radius=e}__class(t,"laya.d3.math.BoundSphere");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.toDefault=function(){this.center.toDefault(),this.radius=0},e.intersectsRayDistance=function(t){return Collision.intersectsRayAndSphereRD(t,this)},e.intersectsRayPoint=function(t,e){return Collision.intersectsRayAndSphereRP(t,this,e)},e.cloneTo=function(t){var e=t;this.center.cloneTo(e.center),e.radius=this.radius},e.clone=function(){var t=new this.constructor(new Vector3,new Vector3);return this.cloneTo(t),t},t.createFromSubPoints=function(e,i,n,r){if(null==e)throw new Error("points");if(0>i||i>=e.length)throw new Error("start"+i+"Must be in the range [0, "+(e.length-1)+"]");if(0>n||i+n>e.length)throw new Error("count"+n+"Must be in the range <= "+e.length+"}");var a=i+n,s=t._tempVector3;s.elements[0]=0,s.elements[1]=0,s.elements[2]=0;for(var o=i;a>o;++o)Vector3.add(e[o],s,s);var l=r.center;Vector3.scale(s,1/n,l);var _=0;for(o=i;a>o;++o){var h=Vector3.distanceSquared(l,e[o]);h>_&&(_=h)}r.radius=Math.sqrt(_)},t.createfromPoints=function(e,i){if(null==e)throw new Error("points");t.createFromSubPoints(e,0,e.length,i)},__static(t,["_tempVector3",function(){return this._tempVector3=new Vector3}]),t}(),Collision=function(){function t(){}return __class(t,"laya.d3.math.Collision"),t.distancePlaneToPoint=function(t,e){var i=Vector3.dot(t.normal,e);return i-t.distance},t.distanceBoxToPoint=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],_=s[2],h=e.elements,u=h[0],c=h[1],d=h[2],f=0;return n>u&&(f+=(n-u)*(n-u)),u>o&&(f+=(o-u)*(o-u)),r>c&&(f+=(r-c)*(r-c)),c>l&&(f+=(l-c)*(l-c)),a>d&&(f+=(a-d)*(a-d)),d>_&&(f+=(_-d)*(_-d)),Math.sqrt(f)},t.distanceBoxToBox=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],_=s[2],h=e.min.elements,u=h[0],c=h[1],d=h[2],f=e.max.elements,m=f[0],p=f[1],g=f[2],v=0,x=0/0;return n>m?(x=n-m,v+=x*x):u>o&&(x=u-o,v+=x*x),r>p?(x=r-p,v+=x*x):c>l&&(x=c-l,v+=x*x),a>g?(x=a-g,v+=x*x):d>_&&(x=d-_,v+=x*x),Math.sqrt(v)},t.distanceSphereToPoint=function(t,e){var i=Math.sqrt(Vector3.distanceSquared(t.center,e));return i-=t.radius,Math.max(i,0)},t.distanceSphereToSphere=function(t,e){var i=Math.sqrt(Vector3.distanceSquared(t.center,e.center));return i-=t.radius+e.radius,Math.max(i,0)},t.intersectsRayAndTriangleRD=function(e,i,n,r,a){var s=e.origin,o=s.elements,l=o[0],_=o[1],h=o[2],u=e.direction,c=u.elements,d=c[0],f=c[1],m=c[2],p=i.elements,g=p[0],v=p[1],x=p[2],y=n.elements,T=y[0],D=y[1],E=y[2],S=r.elements,M=S[0],R=S[1],A=S[2],C=t._tempV30.elements,L=C[0],I=C[1],w=C[2];L=T-g,I=D-v,w=E-x;var b=t._tempV31.elements,P=b[0],V=b[1],O=b[2];P=M-g,V=R-v,O=A-x;var N=t._tempV32.elements,B=N[0],F=N[1],U=N[2];B=f*O-m*V,F=m*P-d*O,U=d*V-f*P;var G=L*B+I*F+w*U;if(MathUtils3D.isZero(G))return a=0,!1;var H=1/G,W=t._tempV33.elements,k=W[0],z=W[1],X=W[2];k=l-g,z=_-v,X=h-x;var Y=k*B+z*F+X*U;if(Y*=H,0>Y||Y>1)return a=0,!1;var K=t._tempV34.elements,Z=K[0],j=K[1],q=K[2];Z=z*w-X*I,j=X*L-k*w,q=k*I-z*L;var Q=d*Z+f*j+m*q;if(Q*=H,0>Q||Y+Q>1)return a=0,!1;var $=P*Z+V*j+O*q;return $*=H,0>$?(a=0,!1):(a=$,!0)},t.intersectsRayAndTriangleRP=function(e,i,n,r,a){var s=0/0;return t.intersectsRayAndTriangleRD(e,i,n,r,s)?(Vector3.scale(e.direction,s,t._tempV30),Vector3.add(e.origin,t._tempV30,a),!0):(a=Vector3.ZERO,!1)},t.intersectsRayAndPoint=function(e,i){Vector3.subtract(e.origin,i,t._tempV30);var n=Vector3.dot(t._tempV30,e.direction),r=Vector3.dot(t._tempV30,t._tempV30)-MathUtils3D.zeroTolerance;if(r>0&&n>0)return!1;var a=n*n-r;return 0>a?!1:!0},t.intersectsRayAndRay=function(e,i,n){var r=e.origin,a=r.elements,s=a[0],o=a[1],l=a[2],_=e.direction,h=_.elements,u=h[0],c=h[1],d=h[2],f=i.origin,m=f.elements,p=m[0],g=m[1],v=m[2],x=i.direction,y=x.elements,T=y[0],D=y[1],E=y[2];Vector3.cross(_,x,t._tempV30);var S=t._tempV30.elements,M=Vector3.scalarLength(t._tempV30);if(MathUtils3D.isZero(M)&&MathUtils3D.nearEqual(p,s)&&MathUtils3D.nearEqual(g,o)&&MathUtils3D.nearEqual(v,l))return n=Vector3.ZERO,!0;M*=M;var R=p-s,A=g-o,C=v-l,L=T,I=D,w=E,b=S[0],P=S[1],V=S[2],O=R*I*V+A*w*b+C*L*P-R*w*P-A*L*V-C*I*b;L=u,I=c,w=d;var N=O/M;Vector3.scale(_,N,t._tempV30),Vector3.scale(x,N,t._tempV31),Vector3.add(r,t._tempV30,t._tempV32),Vector3.add(f,t._tempV31,t._tempV33);var B=t._tempV32.elements,F=t._tempV33.elements;return MathUtils3D.nearEqual(F[0],B[0])&&MathUtils3D.nearEqual(F[1],B[1])&&MathUtils3D.nearEqual(F[2],B[2])?(n=t._tempV32,!0):(n=Vector3.ZERO,!1)},t.intersectsPlaneAndTriangle=function(e,i,n,r){var a=t.intersectsPlaneAndPoint(e,i),s=t.intersectsPlaneAndPoint(e,n),o=t.intersectsPlaneAndPoint(e,r);return a==Plane.PlaneIntersectionType_Front&&s==Plane.PlaneIntersectionType_Front&&o==Plane.PlaneIntersectionType_Front?Plane.PlaneIntersectionType_Front:a==Plane.PlaneIntersectionType_Back&&s==Plane.PlaneIntersectionType_Back&&o==Plane.PlaneIntersectionType_Back?Plane.PlaneIntersectionType_Back:Plane.PlaneIntersectionType_Intersecting},t.intersectsRayAndPlaneRD=function(t,e,i){var n=e.normal,r=Vector3.dot(n,t.direction);if(MathUtils3D.isZero(r))return i=0,!1;var a=Vector3.dot(n,t.origin);return i=(-e.distance-a)/r,0>i?(i=0,!1):!0},t.intersectsRayAndPlaneRP=function(e,i,n){var r=0/0;return t.intersectsRayAndPlaneRD(e,i,r)?(Vector3.scale(e.direction,r,t._tempV30),Vector3.add(e.origin,t._tempV30,t._tempV31),n=t._tempV31,!0):(n=Vector3.ZERO,!1)},t.intersectsRayAndBoxRD=function(t,e){var i=t.origin.elements,n=i[0],r=i[1],a=i[2],s=t.direction.elements,o=s[0],l=s[1],_=s[2],h=e.min.elements,u=h[0],c=h[1],d=h[2],f=e.max.elements,m=f[0],p=f[1],g=f[2],v=0,x=MathUtils3D.MaxValue;if(MathUtils3D.isZero(o)){if(u>n||n>m)return-1}else{var y=1/o,T=(u-n)*y,D=(m-n)*y;if(T>D){var E=T;T=D,D=E}if(v=Math.max(T,v),x=Math.min(D,x),v>x)return-1}if(MathUtils3D.isZero(l)){if(c>r||r>p)return-1}else{var S=1/l,M=(c-r)*S,R=(p-r)*S;if(M>R){var A=M;M=R,R=A}if(v=Math.max(M,v),x=Math.min(R,x),v>x)return-1}if(MathUtils3D.isZero(_)){if(d>a||a>g)return-1}else{var C=1/_,L=(d-a)*C,I=(g-a)*C;if(L>I){var w=L;L=I,I=w}if(v=Math.max(L,v),x=Math.min(I,x),v>x)return-1}return v},t.intersectsRayAndBoxRP=function(e,i,n){var r=t.intersectsRayAndBoxRD(e,i);return-1===r?(Vector3.ZERO.cloneTo(n),r):(Vector3.scale(e.direction,r,t._tempV30),Vector3.add(e.origin,t._tempV30,t._tempV31),t._tempV31.cloneTo(n),r)},t.intersectsRayAndSphereRD=function(e,i){var n=i.radius;Vector3.subtract(e.origin,i.center,t._tempV30);var r=Vector3.dot(t._tempV30,e.direction),a=Vector3.dot(t._tempV30,t._tempV30)-n*n;if(a>0&&r>0)return-1;var s=r*r-a;if(0>s)return-1;var o=-r-Math.sqrt(s);return 0>o&&(o=0),o},t.intersectsRayAndSphereRP=function(e,i,n){var r=t.intersectsRayAndSphereRD(e,i);return-1===r?(Vector3.ZERO.cloneTo(n),r):(Vector3.scale(e.direction,r,t._tempV30),Vector3.add(e.origin,t._tempV30,t._tempV31),t._tempV31.cloneTo(n),r)},t.intersectsSphereAndTriangle=function(e,i,n,r){var a=e.center,s=e.radius;t.closestPointPointTriangle(a,i,n,r,t._tempV30),Vector3.subtract(t._tempV30,a,t._tempV31);var o=Vector3.dot(t._tempV31,t._tempV31);return s*s>=o},t.intersectsPlaneAndPoint=function(t,e){var i=Vector3.dot(t.normal,e)+t.distance;return i>0?Plane.PlaneIntersectionType_Front:0>i?Plane.PlaneIntersectionType_Back:Plane.PlaneIntersectionType_Intersecting},t.intersectsPlaneAndPlane=function(e,i){Vector3.cross(e.normal,i.normal,t._tempV30);var n=Vector3.dot(t._tempV30,t._tempV30);return MathUtils3D.isZero(n)?!1:!0},t.intersectsPlaneAndPlaneRL=function(e,i,n){var r=e.normal,a=i.normal;Vector3.cross(r,a,t._tempV34);var s=Vector3.dot(t._tempV34,t._tempV34);return MathUtils3D.isZero(s)?!1:(Vector3.scale(a,e.distance,t._tempV30),Vector3.scale(r,i.distance,t._tempV31),Vector3.subtract(t._tempV30,t._tempV31,t._tempV32),Vector3.cross(t._tempV32,t._tempV34,t._tempV33),Vector3.normalize(t._tempV34,t._tempV34),n=new Ray(t._tempV33,t._tempV34),!0)},t.intersectsPlaneAndBox=function(e,i){var n=e.distance,r=e.normal,a=r.elements,s=a[0],o=a[1],l=a[2],_=i.min.elements,h=_[0],u=_[1],c=_[2],d=i.max.elements,f=d[0],m=d[1],p=d[2];t._tempV30.elements[0]=s>0?h:f,t._tempV30.elements[1]=o>0?u:m,t._tempV30.elements[2]=l>0?c:p,t._tempV31.elements[0]=s>0?f:h,t._tempV31.elements[1]=o>0?m:u,t._tempV31.elements[2]=l>0?p:c;var g=Vector3.dot(r,t._tempV30);return g+n>0?Plane.PlaneIntersectionType_Front:(g=Vector3.dot(r,t._tempV31),0>g+n?Plane.PlaneIntersectionType_Back:Plane.PlaneIntersectionType_Intersecting)},t.intersectsPlaneAndSphere=function(t,e){var i=e.radius,n=Vector3.dot(t.normal,e.center)+t.distance;return n>i?Plane.PlaneIntersectionType_Front:-i>n?Plane.PlaneIntersectionType_Back:Plane.PlaneIntersectionType_Intersecting},t.intersectsBoxAndBox=function(t,e){var i=t.min.elements,n=t.max.elements,r=e.min.elements,a=e.max.elements;return i[0]>a[0]||r[0]>n[0]?!1:i[1]>a[1]||r[1]>n[1]?!1:i[2]>a[2]||r[2]>n[2]?!1:!0},t.intersectsBoxAndSphere=function(e,i){var n=i.center,r=i.radius;Vector3.Clamp(n,e.min,e.max,t._tempV30);var a=Vector3.distanceSquared(n,t._tempV30);return r*r>=a},t.intersectsSphereAndSphere=function(t,e){var i=t.radius+e.radius;return Vector3.distanceSquared(t.center,e.center)<=i*i},t.boxContainsPoint=function(t,e){var i=t.min.elements,n=t.max.elements,r=e.elements;return i[0]<=r[0]&&n[0]>=r[0]&&i[1]<=r[1]&&n[1]>=r[1]&&i[2]<=r[2]&&n[2]>=r[2]?1:0},t.boxContainsBox=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],_=s[2],h=e.min.elements,u=h[0],c=h[1],d=h[2],f=e.max.elements,m=f[0],p=f[1],g=f[2];return u>o||n>m?0:c>l||r>p?0:d>_||a>g?0:u>=n&&m>=m&&c>=r&&l>=p&&d>=a&&_>=g?1:2},t.boxContainsSphere=function(e,i){var n=e.min,r=n.elements,a=r[0],s=r[1],o=r[2],l=e.max,_=l.elements,h=_[0],u=_[1],c=_[2],d=i.center,f=d.elements,m=f[0],p=f[1],g=f[2],v=i.radius;Vector3.Clamp(d,n,l,t._tempV30);var x=Vector3.distanceSquared(d,t._tempV30);return x>v*v?0:m>=a+v&&h-v>=m&&h-a>v&&p>=s+v&&u-v>=p&&u-s>v&&g>=o+v&&c-v>=g&&c-o>v?1:2},t.sphereContainsPoint=function(t,e){return Vector3.distanceSquared(e,t.center)<=t.radius*t.radius?1:0},t.sphereContainsTriangle=function(e,i,n,r){var a=t.sphereContainsPoint(e,i),s=t.sphereContainsPoint(e,n),o=t.sphereContainsPoint(e,r);return 1==a&&1==s&&1==o?1:t.intersectsSphereAndTriangle(e,i,n,r)?2:0},t.sphereContainsBox=function(e,i){var n=e.center,r=n.elements,a=r[0],s=r[1],o=r[2],l=e.radius,_=i.min,h=_.elements,u=h[0],c=h[1],d=h[2],f=i.max,m=f.elements,p=m[0],g=m[1],v=m[2],x=t._tempV30.elements,y=x[0],T=x[1],D=x[2];if(!t.intersectsBoxAndSphere(i,e))return 0;var E=l*l;return y=a-u,T=s-g,D=o-v,Vector3.scalarLengthSquared(t._tempV30)>E?2:(y=a-p,T=s-g,D=o-v,Vector3.scalarLengthSquared(t._tempV30)>E?2:(y=a-p,T=s-c,D=o-v,Vector3.scalarLengthSquared(t._tempV30)>E?2:(y=a-u,T=s-c,D=o-v,Vector3.scalarLengthSquared(t._tempV30)>E?2:(y=a-u,T=s-g,D=o-d,Vector3.scalarLengthSquared(t._tempV30)>E?2:(y=a-p,T=s-g,D=o-d,Vector3.scalarLengthSquared(t._tempV30)>E?2:(y=a-p,T=s-c,D=o-d,Vector3.scalarLengthSquared(t._tempV30)>E?2:(y=a-u,T=s-c,D=o-d,Vector3.scalarLengthSquared(t._tempV30)>E?2:1)))))))},t.sphereContainsSphere=function(t,e){var i=t.radius,n=e.radius,r=Vector3.distance(t.center,e.center);return r>i+n?0:r>i-n?2:1},t.closestPointPointTriangle=function(e,i,n,r,a){Vector3.subtract(n,i,t._tempV30),Vector3.subtract(r,i,t._tempV31),Vector3.subtract(e,i,t._tempV32),Vector3.subtract(e,n,t._tempV33),Vector3.subtract(e,r,t._tempV34);var s=Vector3.dot(t._tempV30,t._tempV32),o=Vector3.dot(t._tempV31,t._tempV32),l=Vector3.dot(t._tempV30,t._tempV33),_=Vector3.dot(t._tempV31,t._tempV33),h=Vector3.dot(t._tempV30,t._tempV34),u=Vector3.dot(t._tempV31,t._tempV34);if(0>=s&&0>=o)return i.cloneTo(a),void 0;if(l>=0&&l>=_)return n.cloneTo(a),void 0;var c=s*_-l*o;if(0>=c&&s>=0&&0>=l){var d=s/(s-l);return Vector3.scale(t._tempV30,d,a),Vector3.add(i,a,a),void 0}if(u>=0&&u>=h)return r.cloneTo(a),void 0;var f=h*o-s*u;if(0>=f&&o>=0&&0>=u){var m=o/(o-u);return Vector3.scale(t._tempV31,m,a),Vector3.add(i,a,a),void 0}var p=l*u-h*_;if(0>=p&&_-l>=0&&h-u>=0){var g=(_-l)/(_-l+(h-u));return Vector3.subtract(r,n,a),Vector3.scale(a,g,a),Vector3.add(n,a,a),void 0}var v=1/(p+f+c),x=f*v,y=c*v;Vector3.scale(t._tempV30,x,t._tempV35),Vector3.scale(t._tempV31,y,t._tempV36),Vector3.add(t._tempV35,t._tempV36,a),Vector3.add(i,a,a)},t.closestPointPlanePoint=function(e,i,n){var r=e.normal,a=Vector3.dot(r,i)-e.distance;Vector3.scale(r,a,t._tempV30),Vector3.subtract(i,t._tempV30,n)},t.closestPointBoxPoint=function(e,i,n){Vector3.max(i,e.min,t._tempV30),Vector3.min(t._tempV30,e.max,n)},t.closestPointSpherePoint=function(t,e,i){var n=t.center;Vector3.subtract(e,n,i),Vector3.normalize(i,i),Vector3.scale(i,t.radius,i),Vector3.add(i,n,i)},t.closestPointSphereSphere=function(t,e,i){var n=t.center;Vector3.subtract(e.center,n,i),Vector3.normalize(i,i),Vector3.scale(i,t.radius,i),Vector3.add(i,n,i)},__static(t,["_tempV30",function(){return this._tempV30=new Vector3},"_tempV31",function(){return this._tempV31=new Vector3},"_tempV32",function(){return this._tempV32=new Vector3},"_tempV33",function(){return this._tempV33=new Vector3},"_tempV34",function(){return this._tempV34=new Vector3},"_tempV35",function(){return this._tempV35=new Vector3},"_tempV36",function(){return this._tempV36=new Vector3}]),t}(),ContainmentType=function(){function t(){}return __class(t,"laya.d3.math.ContainmentType"),t.Disjoint=0,t.Contains=1,t.Intersects=2,t}(),MathUtils3D=function(){function t(){}return __class(t,"laya.d3.math.MathUtils3D"),t.isZero=function(e){return Math.abs(e)<t.zeroTolerance},t.nearEqual=function(e,i){return t.isZero(e-i)?!0:!1},t.fastInvSqrt=function(e){return t.isZero(e)?e:1/Math.sqrt(e)},__static(t,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=3.40282347e38},"MinValue",function(){return this.MinValue=-3.40282347e38}]),t}(),Matrix3x3=function(){function t(){var t=this.elements=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}__class(t,"laya.d3.math.Matrix3x3");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.determinant=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],_=t[8];return e*(_*a-s*l)+i*(-_*r+s*o)+n*(l*r-a*o)},e.translate=function(t,e){var i=e.elements,n=this.elements,r=t.elements,a=n[0],s=n[1],o=n[2],l=n[3],_=n[4],h=n[5],u=n[6],c=n[7],d=n[8],f=r[0],m=r[1];i[0]=a,i[1]=s,i[2]=o,i[3]=l,i[4]=_,i[5]=h,i[6]=f*a+m*l+u,i[7]=f*s+m*_+c,i[8]=f*o+m*h+d},e.rotate=function(t,e){var i=e.elements,n=this.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],_=n[5],h=n[6],u=n[7],c=n[8],d=Math.sin(t),f=Math.cos(t);i[0]=f*r+d*o,i[1]=f*a+d*l,i[2]=f*s+d*_,i[3]=f*o-d*r,i[4]=f*l-d*a,i[5]=f*_-d*s,i[6]=h,i[7]=u,i[8]=c},e.scale=function(t,e){var i=e.elements,n=this.elements,r=t.elements,a=r[0],s=r[1];i[0]=a*n[0],i[1]=a*n[1],i[2]=a*n[2],i[3]=s*n[3],i[4]=s*n[4],i[5]=s*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8]},e.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],_=i[6],h=i[7],u=i[8],c=u*o-l*h,d=-u*s+l*_,f=h*s-o*_,m=n*c+r*d+a*f;m||(t=null),m=1/m,e[0]=c*m,e[1]=(-u*r+a*h)*m,e[2]=(l*r-a*o)*m,e[3]=d*m,e[4]=(u*n-a*_)*m,e[5]=(-l*n+a*s)*m,e[6]=f*m,e[7]=(-h*n+r*_)*m,e[8]=(o*n-r*s)*m},e.transpose=function(t){var e=t.elements,i=this.elements;if(t===this){var n=i[1],r=i[2],a=i[5];e[1]=i[3],e[2]=i[6],e[3]=n,e[5]=i[7],e[6]=r,e[7]=a}else e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8]},e.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},e.cloneTo=function(t){var e,i,n;if(i=this.elements,n=t.elements,i!==n)for(e=0;9>e;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.createFromTranslation=function(t,e){var i=(e.elements,t.elements);e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=i[0],e[7]=i[1],e[8]=1},t.createFromRotation=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[0]=r,i[1]=n,i[2]=0,i[3]=-n,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1},t.createFromScaling=function(t,e){var i=e.elements,n=t.elements;i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1},t.createFromMatrix4x4=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],l=r[2],_=r[3],h=r[4],u=r[5],c=r[6],d=r[7],f=r[8],m=a[0],p=a[1],g=a[2],v=a[3],x=a[4],y=a[5],T=a[6],D=a[7],E=a[8];n[0]=m*s+p*_+g*c,n[1]=m*o+p*h+g*d,n[2]=m*l+p*u+g*f,n[3]=v*s+x*_+y*c,n[4]=v*o+x*h+y*d,n[5]=v*l+x*u+y*f,n[6]=T*s+D*_+E*c,n[7]=T*o+D*h+E*d,n[8]=T*l+D*u+E*f},t.lookAt=function(e,i,n,r){Vector3.subtract(e,i,t._tempV30),Vector3.normalize(t._tempV30,t._tempV30),Vector3.cross(n,t._tempV30,t._tempV31),Vector3.normalize(t._tempV31,t._tempV31),Vector3.cross(t._tempV30,t._tempV31,t._tempV32);var a=t._tempV30.elements,s=t._tempV31.elements,o=t._tempV32.elements,l=r.elements;l[0]=s[0],l[3]=s[1],l[6]=s[2],l[1]=o[0],l[4]=o[1],l[7]=o[2],l[2]=a[0],l[5]=a[1],l[8]=a[2]},t.DEFAULT=new t,__static(t,["_tempV30",function(){return this._tempV30=new Vector3},"_tempV31",function(){return this._tempV31=new Vector3},"_tempV32",function(){return this._tempV32=new Vector3}]),t}(),Matrix4x4=function(){function t(t,e,i,n,r,a,s,o,l,_,h,u,c,d,f,m,p){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===_&&(_=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===f&&(f=0),void 0===m&&(m=1);var g=this.elements=p?p:new Float32Array(16);g[0]=t,g[1]=e,g[2]=i,g[3]=n,g[4]=r,g[5]=a,g[6]=s,g[7]=o,g[8]=l,g[9]=_,g[10]=h,g[11]=u,g[12]=c,g[13]=d,g[14]=f,g[15]=m}__class(t,"laya.d3.math.Matrix4x4");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.setRotation=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2],a=e[3],s=i*i,o=n*n,l=r*r,_=i*n,h=r*a,u=r*i,c=n*a,d=n*r,f=i*a,m=this.elements;m[0]=1-2*(o+l),m[1]=2*(_+h),m[2]=2*(u-c),m[4]=2*(_-h),m[5]=1-2*(l+s),m[6]=2*(d+f),m[8]=2*(u+c),m[9]=2*(d-f),m[10]=1-2*(o+s)},e.setPosition=function(t){var e=t.elements,i=this.elements;i[12]=e[0],i[13]=e[1],i[14]=e[2]},e.getElementByRowColumn=function(t,e){if(0>t||t>3)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(0>e||e>3)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*t+e]},e.setElementByRowColumn=function(t,e,i){if(0>t||t>3)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(0>e||e>3)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*t+e]=i},e.equalsOtherMatrix=function(t){var e=this.elements,i=t.elements;return MathUtils3D.nearEqual(e[0],i[0])&&MathUtils3D.nearEqual(e[1],i[1])&&MathUtils3D.nearEqual(e[2],i[2])&&MathUtils3D.nearEqual(e[3],i[3])&&MathUtils3D.nearEqual(e[4],i[4])&&MathUtils3D.nearEqual(e[5],i[5])&&MathUtils3D.nearEqual(e[6],i[6])&&MathUtils3D.nearEqual(e[7],i[7])&&MathUtils3D.nearEqual(e[8],i[8])&&MathUtils3D.nearEqual(e[9],i[9])&&MathUtils3D.nearEqual(e[10],i[10])&&MathUtils3D.nearEqual(e[11],i[11])&&MathUtils3D.nearEqual(e[12],i[12])&&MathUtils3D.nearEqual(e[13],i[13])&&MathUtils3D.nearEqual(e[14],i[14])&&MathUtils3D.nearEqual(e[15],i[15])},e.decomposeTransRotScale=function(e,i,n){var r=t._tempMatrix4x4;return this.decomposeTransRotMatScale(e,r,n)?(Quaternion.createFromMatrix4x4(r,i),!0):(i.identity(),!1)},e.decomposeTransRotMatScale=function(e,i,n){var r=this.elements,a=e.elements,s=i.elements,o=n.elements;a[0]=r[12],a[1]=r[13],a[2]=r[14];var l=r[0],_=r[1],h=r[2],u=r[4],c=r[5],d=r[6],f=r[8],m=r[9],p=r[10],g=o[0]=Math.sqrt(l*l+_*_+h*h),v=o[1]=Math.sqrt(u*u+c*c+d*d),x=o[2]=Math.sqrt(f*f+m*m+p*p);if(MathUtils3D.isZero(g)||MathUtils3D.isZero(v)||MathUtils3D.isZero(x))return s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[12]=s[13]=s[14]=0,s[0]=s[5]=s[10]=s[15]=1,!1;var y=t._tempVector0,T=y.elements;T[0]=f/x,T[1]=m/x,T[2]=p/x;var D=t._tempVector1,E=D.elements;E[0]=l/g,E[1]=_/g,E[2]=h/g;var S=t._tempVector2;Vector3.cross(y,D,S);var M=t._tempVector1;return Vector3.cross(S,y,M),s[3]=s[7]=s[11]=s[12]=s[13]=s[14]=0,s[15]=1,s[0]=M.x,s[1]=M.y,s[2]=M.z,s[4]=S.x,s[5]=S.y,s[6]=S.z,s[8]=y.x,s[9]=y.y,s[10]=y.z,s[0]*l+s[1]*_+s[2]*h<0&&(o[0]=-g),s[4]*u+s[5]*c+s[6]*d<0&&(o[1]=-v),s[8]*f+s[9]*m+s[10]*p<0&&(o[2]=-x),!0},e.decomposeYawPitchRoll=function(t){var e=t.elements,i=Math.asin(-this.elements[9]);e[1]=i;var n=Math.cos(i);n>MathUtils3D.zeroTolerance?(e[2]=Math.atan2(this.elements[1],this.elements[5]),e[0]=Math.atan2(this.elements[8],this.elements[10])):(e[2]=Math.atan2(-this.elements[4],this.elements[0]),e[0]=0)},e.normalize=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=Math.sqrt(e*e+i*i+n*n);return r?(1!=r&&(r=1/r,t[0]=e*r,t[1]=i*r,t[2]=n*r),void 0):(t[0]=0,t[1]=0,t[2]=0,void 0)},e.transpose=function(){var t,e;return t=this.elements,e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},e.invert=function(t){var e=this.elements,i=t.elements,n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],_=e[6],h=e[7],u=e[8],c=e[9],d=e[10],f=e[11],m=e[12],p=e[13],g=e[14],v=e[15],x=n*l-r*o,y=n*_-a*o,T=n*h-s*o,D=r*_-a*l,E=r*h-s*l,S=a*h-s*_,M=u*p-c*m,R=u*g-d*m,A=u*v-f*m,C=c*g-d*p,L=c*v-f*p,I=d*v-f*g,w=x*I-y*L+T*C+D*A-E*R+S*M;0!==Math.abs(w)&&(w=1/w,i[0]=(l*I-_*L+h*C)*w,i[1]=(a*L-r*I-s*C)*w,i[2]=(p*S-g*E+v*D)*w,i[3]=(d*E-c*S-f*D)*w,i[4]=(_*A-o*I-h*R)*w,i[5]=(n*I-a*A+s*R)*w,i[6]=(g*T-m*S-v*y)*w,i[7]=(u*S-d*T+f*y)*w,i[8]=(o*L-l*A+h*M)*w,i[9]=(r*A-n*L-s*M)*w,i[10]=(m*E-p*T+v*x)*w,i[11]=(c*T-u*E-f*x)*w,i[12]=(l*R-o*C-_*M)*w,i[13]=(n*C-r*R+a*M)*w,i[14]=(p*y-m*D-g*x)*w,i[15]=(u*D-c*y+d*x)*w)},e.identity=function(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1},e.cloneTo=function(t){var e,i,n;
if(i=this.elements,n=t.elements,i!==n)for(e=0;16>e;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.getTranslationVector=function(t){var e=this.elements,i=t.elements;i[0]=e[12],i[1]=e[13],i[2]=e[14]},e.setTranslationVector=function(t){var e=this.elements,i=t.elements;e[12]=i[0],e[13]=i[1],e[14]=i[2]},e.getForward=function(t){var e=this.elements,i=t.elements;i[0]=-e[8],i[1]=-e[9],i[2]=-e[10]},e.setForward=function(t){var e=this.elements,i=t.elements;e[8]=-i[0],e[9]=-i[1],e[10]=-i[2]},t.createRotationX=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[2]=i[3]=i[4]=i[7]=i[8]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[15]=1,i[5]=i[10]=r,i[6]=n,i[9]=-n},t.createRotationY=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[3]=i[4]=i[6]=i[7]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[5]=i[15]=1,i[0]=i[10]=r,i[2]=-n,i[8]=n},t.createRotationZ=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[10]=i[15]=1,i[0]=i[5]=r,i[1]=n,i[4]=-n},t.createRotationYawPitchRoll=function(e,i,n,r){Quaternion.createFromYawPitchRoll(e,i,n,t._tempQuaternion),t.createRotationQuaternion(t._tempQuaternion,r)},t.createRotationAxis=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=Math.cos(e),l=Math.sin(e),_=r*r,h=a*a,u=s*s,c=r*a,d=r*s,f=a*s,m=i.elements;m[3]=m[7]=m[11]=m[12]=m[13]=m[14]=0,m[15]=1,m[0]=_+o*(1-_),m[1]=c-o*c+l*s,m[2]=d-o*d-l*a,m[4]=c-o*c-l*s,m[5]=h+o*(1-h),m[6]=f-o*f+l*r,m[8]=d-o*d+l*a,m[9]=f-o*f-l*r,m[10]=u+o*(1-u)},t.createRotationQuaternion=function(t,e){var i=t.elements,n=e.elements,r=i[0],a=i[1],s=i[2],o=i[3],l=r*r,_=a*a,h=s*s,u=r*a,c=s*o,d=s*r,f=a*o,m=a*s,p=r*o;n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=1-2*(_+h),n[1]=2*(u+c),n[2]=2*(d-f),n[4]=2*(u-c),n[5]=1-2*(h+l),n[6]=2*(m+p),n[8]=2*(d+f),n[9]=2*(m-p),n[10]=1-2*(_+l)},t.createTranslate=function(t,e){var i=t.elements,n=e.elements;n[4]=n[8]=n[1]=n[9]=n[2]=n[6]=n[3]=n[7]=n[11]=0,n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},t.createScaling=function(t,e){var i=t.elements,n=e.elements;n[0]=i[0],n[5]=i[1],n[10]=i[2],n[1]=n[4]=n[8]=n[12]=n[9]=n[13]=n[2]=n[6]=n[14]=n[3]=n[7]=n[11]=0,n[15]=1},t.multiply=function(t,e,i){var n,r,a,s,o,l,_,h;if(r=i.elements,a=t.elements,s=e.elements,r===s)for(s=new Float32Array(16),n=0;16>n;++n)s[n]=r[n];var u=s[0],c=s[1],d=s[2],f=s[3],m=s[4],p=s[5],g=s[6],v=s[7],x=s[8],y=s[9],T=s[10],D=s[11],E=s[12],S=s[13],M=s[14],R=s[15];for(n=0;4>n;n++)o=a[n],l=a[n+4],_=a[n+8],h=a[n+12],r[n]=o*u+l*c+_*d+h*f,r[n+4]=o*m+l*p+_*g+h*v,r[n+8]=o*x+l*y+_*T+h*D,r[n+12]=o*E+l*S+_*M+h*R},t.multiplyForNative=function(t,e,i){window.conch.matrix4x4Multiply(t.elements,e.elements,i.elements)},t.createFromQuaternion=function(t,e){var i=e.elements,n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=r+r,_=a+a,h=s+s,u=r*l,c=a*l,d=a*_,f=s*l,m=s*_,p=s*h,g=o*l,v=o*_,x=o*h;i[0]=1-d-p,i[1]=c+x,i[2]=f-v,i[3]=0,i[4]=c-x,i[5]=1-u-p,i[6]=m+g,i[7]=0,i[8]=f+v,i[9]=m-g,i[10]=1-u-d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1},t.createAffineTransformation=function(t,e,i,n){var r=t.elements,a=e.elements,s=i.elements,o=n.elements,l=a[0],_=a[1],h=a[2],u=a[3],c=l+l,d=_+_,f=h+h,m=l*c,p=l*d,g=l*f,v=_*d,x=_*f,y=h*f,T=u*c,D=u*d,E=u*f,S=s[0],M=s[1],R=s[2];o[0]=(1-(v+y))*S,o[1]=(p+E)*S,o[2]=(g-D)*S,o[3]=0,o[4]=(p-E)*M,o[5]=(1-(m+y))*M,o[6]=(x+T)*M,o[7]=0,o[8]=(g+D)*R,o[9]=(x-T)*R,o[10]=(1-(m+v))*R,o[11]=0,o[12]=r[0],o[13]=r[1],o[14]=r[2],o[15]=1},t.createLookAt=function(e,i,n,r){var a=r.elements,s=t._tempVector0,o=t._tempVector1,l=t._tempVector2;Vector3.subtract(e,i,l),Vector3.normalize(l,l),Vector3.cross(n,l,s),Vector3.normalize(s,s),Vector3.cross(l,s,o),r.identity(),a[0]=s.x,a[4]=s.y,a[8]=s.z,a[1]=o.x,a[5]=o.y,a[9]=o.z,a[2]=l.x,a[6]=l.y,a[10]=l.z,a[12]=-Vector3.dot(s,e),a[13]=-Vector3.dot(o,e),a[14]=-Vector3.dot(l,e)},t.createPerspective=function(t,e,i,n,r){var a=r.elements,s=1/Math.tan(t/2),o=1/(i-n);a[0]=s/e,a[5]=s,a[10]=(n+i)*o,a[11]=-1,a[14]=2*n*i*o,a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[12]=a[13]=a[15]=0},t.createOrthoOffCenterRH=function(t,e,i,n,r,a,s){var o=s.elements,l=1/(t-e),_=1/(i-n),h=1/(r-a);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=0,o[15]=1,o[0]=-2*l,o[5]=-2*_,o[10]=2*h,o[12]=(t+e)*l,o[13]=(n+i)*_,o[14]=(a+r)*h},t.translation=function(t,e){var i=t.elements,n=e.elements;n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},__static(t,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new t},"_tempVector0",function(){return this._tempVector0=new Vector3},"_tempVector1",function(){return this._tempVector1=new Vector3},"_tempVector2",function(){return this._tempVector2=new Vector3},"_tempQuaternion",function(){return this._tempQuaternion=new Quaternion},"DEFAULT",function(){return this.DEFAULT=new t},"ZERO",function(){return this.ZERO=new t(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),t}(),OrientedBoundBox=function(){function t(t,e){this.extents=null,this.transformation=null,this.extents=t,this.transformation=e}__class(t,"laya.d3.math.OrientedBoundBox");var e=t.prototype;return e.getCorners=function(e){var i=t._tempV30.elements,n=t._tempV31.elements,r=t._tempV32.elements,a=this.extents.elements;i[0]=a[0],i[1]=i[2]=0,n[1]=a[1],n[0]=n[2]=0,r[2]=a[2],r[0]=r[1]=0,Vector3.TransformNormal(t._tempV30,this.transformation,t._tempV30),Vector3.TransformNormal(t._tempV31,this.transformation,t._tempV31),Vector3.TransformNormal(t._tempV32,this.transformation,t._tempV32);var s=t._tempV33;this.transformation.getTranslationVector(s),e.length=8,Vector3.add(s,t._tempV30,t._tempV34),Vector3.add(t._tempV34,t._tempV31,t._tempV34),Vector3.add(t._tempV34,t._tempV32,e[0]),Vector3.add(s,t._tempV30,t._tempV34),Vector3.add(t._tempV34,t._tempV31,t._tempV34),Vector3.subtract(t._tempV34,t._tempV32,e[1]),Vector3.subtract(s,t._tempV30,t._tempV34),Vector3.add(t._tempV34,t._tempV31,t._tempV34),Vector3.subtract(t._tempV34,t._tempV32,e[2]),Vector3.subtract(s,t._tempV30,t._tempV34),Vector3.add(t._tempV34,t._tempV31,t._tempV34),Vector3.add(t._tempV34,t._tempV32,e[3]),Vector3.add(s,t._tempV30,t._tempV34),Vector3.subtract(t._tempV34,t._tempV31,t._tempV34),Vector3.add(t._tempV34,t._tempV32,e[4]),Vector3.add(s,t._tempV30,t._tempV34),Vector3.subtract(t._tempV34,t._tempV31,t._tempV34),Vector3.subtract(t._tempV34,t._tempV32,e[5]),Vector3.subtract(s,t._tempV30,t._tempV34),Vector3.subtract(t._tempV34,t._tempV31,t._tempV34),Vector3.subtract(t._tempV34,t._tempV32,e[6]),Vector3.subtract(s,t._tempV30,t._tempV34),Vector3.subtract(t._tempV34,t._tempV31,t._tempV34),Vector3.add(t._tempV34,t._tempV32,e[7])},e.transform=function(t){Matrix4x4.multiply(this.transformation,t,this.transformation)},e.scale=function(t){Vector3.multiply(this.extents,t,this.extents)},e.translate=function(e){this.transformation.getTranslationVector(t._tempV30),Vector3.add(t._tempV30,e,t._tempV31),this.transformation.setTranslationVector(t._tempV31)},e.Size=function(t){Vector3.scale(this.extents,2,t)},e.getSize=function(e){var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],Vector3.TransformNormal(t._tempV30,this.transformation,t._tempV30),Vector3.TransformNormal(t._tempV31,this.transformation,t._tempV31),Vector3.TransformNormal(t._tempV31,this.transformation,t._tempV32);var n=e.elements;n[0]=Vector3.scalarLength(t._tempV30),n[1]=Vector3.scalarLength(t._tempV31),n[2]=Vector3.scalarLength(t._tempV32)},e.getSizeSquared=function(e){var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],Vector3.TransformNormal(t._tempV30,this.transformation,t._tempV30),Vector3.TransformNormal(t._tempV31,this.transformation,t._tempV31),Vector3.TransformNormal(t._tempV31,this.transformation,t._tempV32);var n=e.elements;n[0]=Vector3.scalarLengthSquared(t._tempV30),n[1]=Vector3.scalarLengthSquared(t._tempV31),n[2]=Vector3.scalarLengthSquared(t._tempV32)},e.getCenter=function(t){this.transformation.getTranslationVector(t)},e.containsPoint=function(e){var i=this.extents.elements,n=i[0],r=i[1],a=i[2];this.transformation.invert(t._tempM0),Vector3.transformCoordinate(e,t._tempM0,t._tempV30);var s=t._tempV30.elements,o=Math.abs(s[0]),l=Math.abs(s[1]),_=Math.abs(s[2]);return MathUtils3D.nearEqual(o,n)&&MathUtils3D.nearEqual(l,r)&&MathUtils3D.nearEqual(_,a)?2:n>o&&r>l&&a>_?1:0},e.containsPoints=function(e){var i=this.extents.elements,n=i[0],r=i[1],a=i[2];this.transformation.invert(t._tempM0);for(var s=!0,o=!1,l=0;l<e.length;l++){Vector3.transformCoordinate(e[l],t._tempM0,t._tempV30);var _=t._tempV30.elements,h=Math.abs(_[0]),u=Math.abs(_[1]),c=Math.abs(_[2]);MathUtils3D.nearEqual(h,n)&&MathUtils3D.nearEqual(u,r)&&MathUtils3D.nearEqual(c,a)&&(o=!0),n>h&&r>u&&a>c?o=!0:s=!1}return s?1:o?2:0},e.containsSphere=function(e,i){void 0===i&&(i=!1);var n=this.extents.elements,r=n[0],a=n[1],s=n[2],o=e.radius;this.transformation.invert(t._tempM0),Vector3.transformCoordinate(e.center,t._tempM0,t._tempV30);var l=0/0;i?l=o:(Vector3.scale(Vector3.UnitX,o,t._tempV31),Vector3.TransformNormal(t._tempV31,t._tempM0,t._tempV31),l=Vector3.scalarLength(t._tempV31)),Vector3.scale(this.extents,-1,t._tempV32),Vector3.Clamp(t._tempV30,t._tempV32,this.extents,t._tempV33);var _=Vector3.distanceSquared(t._tempV30,t._tempV33);if(_>l*l)return 0;var h=t._tempV30.elements,u=h[0],c=h[1],d=h[2],f=t._tempV32.elements,m=f[0],p=f[1],g=f[2];return u>=m+l&&r-l>=u&&r-m>l&&c>=p+l&&a-l>=c&&a-p>l&&d>=g+l&&s-l>=d&&s-g>l?1:2},e.containsOrientedBoundBox=function(e){var i=0,n=0;e.getCorners(t._corners);var r=this.containsPoints(t._corners);if(0!=r)return r;var a=this.extents.elements;e.extents.cloneTo(t._tempV35);var s=t._tempV35.elements;t._getRows(this.transformation,t._rows1),t._getRows(e.transformation,t._rows2);var o=0/0,l=0/0,_=0/0,h=0/0;for(i=0;4>i;i++)for(n=0;4>n;n++)3==i||3==n?(t._tempM0.setElementByRowColumn(i,n,0),t._tempM1.setElementByRowColumn(i,n,0)):(h=Vector3.dot(t._rows1[i],t._rows2[n]),t._tempM0.setElementByRowColumn(i,n,h),t._tempM1.setElementByRowColumn(i,n,Math.abs(h)));e.getCenter(t._tempV34),this.getCenter(t._tempV36),Vector3.subtract(t._tempV34,t._tempV36,t._tempV30);var u=t._tempV31.elements;u[0]=Vector3.dot(t._tempV30,t._rows1[0]),u[1]=Vector3.dot(t._tempV30,t._rows1[1]),u[2]=Vector3.dot(t._tempV30,t._rows1[2]);var c=t._tempV32.elements,d=t._tempV33.elements;for(i=0;3>i;i++)if(c[0]=t._tempM1.getElementByRowColumn(i,0),c[1]=t._tempM1.getElementByRowColumn(i,1),c[2]=t._tempM1.getElementByRowColumn(i,2),o=a[i],l=Vector3.dot(t._tempV35,t._tempV32),_=Math.abs(u[i]),_>o+l)return 0;for(n=0;3>n;n++)if(c[0]=t._tempM1.getElementByRowColumn(0,n),c[1]=t._tempM1.getElementByRowColumn(1,n),c[2]=t._tempM1.getElementByRowColumn(2,n),d[0]=t._tempM0.getElementByRowColumn(0,n),d[1]=t._tempM0.getElementByRowColumn(1,n),d[2]=t._tempM0.getElementByRowColumn(2,n),o=Vector3.dot(this.extents,t._tempV32),l=s[n],_=Math.abs(Vector3.dot(t._tempV31,t._tempV33)),_>o+l)return 0;for(i=0;3>i;i++)for(n=0;3>n;n++){var f=(i+1)%3,m=(i+2)%3,p=(n+1)%3,g=(n+2)%3;if(o=a[f]*t._tempM1.getElementByRowColumn(m,n)+a[m]*t._tempM1.getElementByRowColumn(f,n),l=s[p]*t._tempM1.getElementByRowColumn(i,g)+s[g]*t._tempM1.getElementByRowColumn(i,p),_=Math.abs(u[m]*t._tempM0.getElementByRowColumn(f,n)-u[f]*t._tempM0.getElementByRowColumn(m,n)),_>o+l)return 0}return 2},e.containsLine=function(e,i){t._corners[0]=e,t._corners[1]=i;var n=this.containsPoints(t._corners);if(0!=n)return n;var r=this.extents.elements,a=r[0],s=r[1],o=r[2];this.transformation.invert(t._tempM0),Vector3.transformCoordinate(e,t._tempM0,t._tempV30),Vector3.transformCoordinate(i,t._tempM0,t._tempV31),Vector3.add(t._tempV30,t._tempV31,t._tempV32),Vector3.scale(t._tempV32,.5,t._tempV32),Vector3.subtract(t._tempV30,t._tempV32,t._tempV33);var l=t._tempV33.elements,_=l[0],h=l[1],u=l[2],c=t._tempV34.elements,d=c[0]=Math.abs(l[0]),f=c[1]=Math.abs(l[1]),m=c[2]=Math.abs(l[2]),p=t._tempV32.elements,g=p[0],v=p[1],x=p[2];return Math.abs(g)>a+d?0:Math.abs(v)>s+f?0:Math.abs(x)>o+m?0:Math.abs(v*u-x*h)>s*m+o*f?0:Math.abs(g*u-x*_)>a*m+o*d?0:Math.abs(g*h-v*_)>a*f+s*d?0:2},e.containsBoundBox=function(e){var i=0,n=0,r=e.min,a=e.max;e.getCorners(t._corners);var s=this.containsPoints(t._corners);if(0!=s)return s;Vector3.subtract(a,r,t._tempV30),Vector3.scale(t._tempV30,.5,t._tempV30),Vector3.add(r,t._tempV30,t._tempV30),Vector3.subtract(a,t._tempV30,t._tempV31);var o=this.extents.elements,l=t._tempV31.elements;t._getRows(this.transformation,t._rows1),this.transformation.invert(t._tempM0);var _=0/0,h=0/0,u=0/0;for(i=0;3>i;i++)for(n=0;3>n;n++)t._tempM1.setElementByRowColumn(i,n,Math.abs(t._tempM0.getElementByRowColumn(i,n)));this.getCenter(t._tempV35),Vector3.subtract(t._tempV30,t._tempV35,t._tempV32);var c=t._tempV31.elements;c[0]=Vector3.dot(t._tempV32,t._rows1[0]),c[1]=Vector3.dot(t._tempV32,t._rows1[1]),c[2]=Vector3.dot(t._tempV32,t._rows1[2]);var d=t._tempV33.elements,f=t._tempV34.elements;for(i=0;3>i;i++)if(d[0]=t._tempM1.getElementByRowColumn(i,0),d[1]=t._tempM1.getElementByRowColumn(i,1),d[2]=t._tempM1.getElementByRowColumn(i,2),_=o[i],h=Vector3.dot(t._tempV31,t._tempV33),u=Math.abs(c[i]),u>_+h)return 0;for(n=0;3>n;n++)if(d[0]=t._tempM1.getElementByRowColumn(0,n),d[1]=t._tempM1.getElementByRowColumn(1,n),d[2]=t._tempM1.getElementByRowColumn(2,n),f[0]=t._tempM0.getElementByRowColumn(0,n),f[1]=t._tempM0.getElementByRowColumn(1,n),f[2]=t._tempM0.getElementByRowColumn(2,n),_=Vector3.dot(this.extents,t._tempV33),h=l[n],u=Math.abs(Vector3.dot(t._tempV31,t._tempV34)),u>_+h)return 0;for(i=0;3>i;i++)for(n=0;3>n;n++){var m=(i+1)%3,p=(i+2)%3,g=(n+1)%3,v=(n+2)%3;if(_=o[m]*t._tempM1.getElementByRowColumn(p,n)+o[p]*t._tempM1.getElementByRowColumn(m,n),h=l[g]*t._tempM1.getElementByRowColumn(i,v)+l[v]*t._tempM1.getElementByRowColumn(i,g),u=Math.abs(c[p]*t._tempM0.getElementByRowColumn(m,n)-c[m]*t._tempM0.getElementByRowColumn(p,n)),u>_+h)return 0}return 2},e.intersectsRay=function(e,i){Vector3.scale(this.extents,-1,t._tempV30),this.transformation.invert(t._tempM0),Vector3.TransformNormal(e.direction,t._tempM0,t._ray.direction),Vector3.transformCoordinate(e.origin,t._tempM0,t._ray.origin),t._boxBound1.min=t._tempV30,t._boxBound1.max=this.extents;var n=Collision.intersectsRayAndBoxRP(t._ray,t._boxBound1,i);return-1!==n&&Vector3.transformCoordinate(i,this.transformation,i),n},e._getLocalCorners=function(e){e.length=8;var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],Vector3.add(t._tempV30,t._tempV31,t._tempV33),Vector3.add(t._tempV33,t._tempV32,e[0]),Vector3.add(t._tempV30,t._tempV31,t._tempV33),Vector3.subtract(t._tempV33,t._tempV32,e[1]),Vector3.subtract(t._tempV31,t._tempV30,t._tempV33),Vector3.subtract(t._tempV33,t._tempV30,e[2]),Vector3.subtract(t._tempV31,t._tempV30,t._tempV33),Vector3.add(t._tempV33,t._tempV32,e[3]),Vector3.subtract(t._tempV30,t._tempV31,t._tempV33),Vector3.add(t._tempV33,t._tempV32,e[4]),Vector3.subtract(t._tempV30,t._tempV31,t._tempV33),Vector3.subtract(t._tempV33,t._tempV32,e[5]),Vector3.scale(e[0],-1,e[6]),Vector3.subtract(t._tempV32,t._tempV30,t._tempV33),Vector3.subtract(t._tempV33,t._tempV31,e[7])},e.equals=function(t){return this.extents==t.extents&&this.transformation==t.transformation},e.cloneTo=function(t){var e=t;this.extents.cloneTo(e.extents),this.transformation.cloneTo(e.transformation)},t.createByBoundBox=function(e,i){var n=e.min,r=e.max;Vector3.subtract(r,n,t._tempV30),Vector3.scale(t._tempV30,.5,t._tempV30),Vector3.add(n,t._tempV30,t._tempV31),Vector3.subtract(r,t._tempV31,t._tempV32),Matrix4x4.translation(t._tempV31,t._tempM0);var a=t._tempV32.clone(),s=t._tempM0.clone();i.extents=a,i.transformation=s},t.createByMinAndMaxVertex=function(e,i){Vector3.subtract(i,e,t._tempV30),Vector3.scale(t._tempV30,.5,t._tempV30),Vector3.add(e,t._tempV30,t._tempV31),Vector3.subtract(i,t._tempV31,t._tempV32),Matrix4x4.translation(t._tempV31,t._tempM0);var n=new t(t._tempV32,t._tempM0);return n},t._getRows=function(t,e){e.length=3;var i=t.elements,n=e[0].elements;n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=e[1].elements;r[0]=i[4],r[1]=i[5],r[2]=i[6];var a=e[2].elements;a[0]=i[8],a[1]=i[9],a[2]=i[10]},t.getObbtoObbMatrix4x4=function(e,i,n,r){var a=e.transformation,s=i.transformation;if(n){t._getRows(a,t._rows1),t._getRows(s,t._rows2);for(var o=0;3>o;o++)for(var l=0;3>l;l++)r.setElementByRowColumn(o,l,Vector3.dot(t._rows2[o],t._rows1[l]));i.getCenter(t._tempV30),e.getCenter(t._tempV31),Vector3.subtract(t._tempV30,t._tempV31,t._tempV32);var _=r.elements;_[12]=Vector3.dot(t._tempV32,t._rows1[0]),_[13]=Vector3.dot(t._tempV32,t._rows1[1]),_[14]=Vector3.dot(t._tempV32,t._rows1[2]),_[15]=1}else a.invert(t._tempM0),Matrix4x4.multiply(s,t._tempM0,r)},t.merge=function(e,i,n){var r=e.extents,a=e.transformation;t.getObbtoObbMatrix4x4(e,i,n,t._tempM0),i._getLocalCorners(t._corners),Vector3.transformCoordinate(t._corners[0],t._tempM0,t._corners[0]),Vector3.transformCoordinate(t._corners[1],t._tempM0,t._corners[1]),Vector3.transformCoordinate(t._corners[2],t._tempM0,t._corners[2]),Vector3.transformCoordinate(t._corners[3],t._tempM0,t._corners[3]),Vector3.transformCoordinate(t._corners[4],t._tempM0,t._corners[4]),Vector3.transformCoordinate(t._corners[5],t._tempM0,t._corners[5]),Vector3.transformCoordinate(t._corners[6],t._tempM0,t._corners[6]),Vector3.transformCoordinate(t._corners[7],t._tempM0,t._corners[7]),Vector3.scale(r,-1,t._boxBound1.min),r.cloneTo(t._boxBound1.max),BoundBox.createfromPoints(t._corners,t._boxBound2),BoundBox.merge(t._boxBound2,t._boxBound1,t._boxBound3);var s=t._boxBound3.min,o=t._boxBound3.max;Vector3.subtract(o,s,t._tempV30),Vector3.scale(t._tempV30,.5,t._tempV30),Vector3.add(s,t._tempV30,t._tempV32),Vector3.subtract(o,t._tempV32,r),Vector3.transformCoordinate(t._tempV32,a,t._tempV33)},__static(t,["_tempV30",function(){return this._tempV30=new Vector3},"_tempV31",function(){return this._tempV31=new Vector3},"_tempV32",function(){return this._tempV32=new Vector3},"_tempV33",function(){return this._tempV33=new Vector3},"_tempV34",function(){return this._tempV34=new Vector3},"_tempV35",function(){return this._tempV35=new Vector3},"_tempV36",function(){return this._tempV36=new Vector3},"_tempM0",function(){return this._tempM0=new Matrix4x4},"_tempM1",function(){return this._tempM1=new Matrix4x4},"_corners",function(){return this._corners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3]},"_rows1",function(){return this._rows1=[new Vector3,new Vector3,new Vector3]},"_rows2",function(){return this._rows2=[new Vector3,new Vector3,new Vector3]},"_ray",function(){return this._ray=new Ray(new Vector3,new Vector3)},"_boxBound1",function(){return this._boxBound1=new BoundBox(new Vector3,new Vector3)},"_boxBound2",function(){return this._boxBound2=new BoundBox(new Vector3,new Vector3)},"_boxBound3",function(){return this._boxBound3=new BoundBox(new Vector3,new Vector3)}]),t}(),Plane=function(){function t(t,e){this.normal=null,this.distance=0/0,void 0===e&&(e=0),this.normal=t,this.distance=e}__class(t,"laya.d3.math.Plane");var e=t.prototype;return e.normalize=function(){var t=this.normal.elements,e=t[0],i=t[1],n=t[2],r=1/Math.sqrt(e*e+i*i+n*n);t[0]=e*r,t[1]=i*r,t[2]=n*r,this.distance*=r},t.createPlaneBy3P=function(e,i,n){var r=e.elements,a=i.elements,s=n.elements,o=a[0]-r[0],l=a[1]-r[1],_=a[2]-r[2],h=s[0]-r[0],u=s[1]-r[1],c=s[2]-r[2],d=l*c-_*u,f=_*h-o*c,m=o*u-l*h,p=1/Math.sqrt(d*d+f*f+m*m),g=d*p,v=f*p,x=m*p,y=t._TEMPVec3.elements;y[0]=g,y[1]=v,y[2]=x;var T=-(g*r[0]+v*r[1]+x*r[2]),D=new t(t._TEMPVec3,T);return D},t.PlaneIntersectionType_Back=0,t.PlaneIntersectionType_Front=1,t.PlaneIntersectionType_Intersecting=2,__static(t,["_TEMPVec3",function(){return this._TEMPVec3=new Vector3}]),t}(),Quaternion=function(){function t(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.elements[0]=t,this.elements[1]=e,this.elements[2]=i,this.elements[3]=n}__class(t,"laya.d3.math.Quaternion");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.scaling=function(t,e){var i=e.elements,n=this.elements;i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t,i[3]=n[3]*t},e.normalize=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=n*n+r*r+a*a+s*s;o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=s*o)},e.length=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},e.rotateX=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),_=Math.cos(t);i[0]=r*_+o*l,i[1]=a*_+s*l,i[2]=s*_-a*l,i[3]=o*_-r*l},e.rotateY=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),_=Math.cos(t);i[0]=r*_-s*l,i[1]=a*_+o*l,i[2]=s*_+r*l,i[3]=o*_-a*l},e.rotateZ=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),_=Math.cos(t);i[0]=r*_+a*l,i[1]=a*_-r*l,i[2]=s*_+o*l,i[3]=o*_-s*l},e.getYawPitchRoll=function(e){Vector3.transformQuat(Vector3.ForwardRH,this,t.TEMPVector31),Vector3.transformQuat(Vector3.Up,this,t.TEMPVector32);var i=t.TEMPVector32.elements;t.angleTo(Vector3.ZERO,t.TEMPVector31,t.TEMPVector33);var n=t.TEMPVector33.elements;n[0]==Math.PI/2?(n[1]=t.arcTanAngle(i[2],i[0]),n[2]=0):n[0]==-Math.PI/2?(n[1]=t.arcTanAngle(-i[2],-i[0]),n[2]=0):(Matrix4x4.createRotationY(-n[1],t.TEMPMatrix0),Matrix4x4.createRotationX(-n[0],t.TEMPMatrix1),Vector3.transformCoordinate(t.TEMPVector32,t.TEMPMatrix0,t.TEMPVector32),Vector3.transformCoordinate(t.TEMPVector32,t.TEMPMatrix1,t.TEMPVector32),n[2]=t.arcTanAngle(i[1],-i[0])),n[1]<=-Math.PI&&(n[1]=Math.PI),n[2]<=-Math.PI&&(n[2]=Math.PI),n[1]>=Math.PI&&n[2]>=Math.PI&&(n[1]=0,n[2]=0,n[0]=Math.PI-n[0]);var r=e.elements;r[0]=n[1],r[1]=n[0],r[2]=n[2]},e.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=n*n+r*r+a*a+s*s,l=o?1/o:0;e[0]=-n*l,e[1]=-r*l,e[2]=-a*l,e[3]=s*l},e.identity=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=1},e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},e.cloneTo=function(t){var e,i,n;if(i=this.elements,n=t.elements,i!==n)for(e=0;4>e;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.equals=function(t){var e=this.elements,i=t.elements;return MathUtils3D.nearEqual(e[0],i[0])&&MathUtils3D.nearEqual(e[1],i[1])&&MathUtils3D.nearEqual(e[2],i[2])&&MathUtils3D.nearEqual(e[3],i[3])},e.lengthSquared=function(){var t=this.elements[0],e=this.elements[1],i=this.elements[2],n=this.elements[3];return t*t+e*e+i*i+n*n},__getset(0,e,"x",function(){return this.elements[0]}),__getset(0,e,"y",function(){return this.elements[1]}),__getset(0,e,"z",function(){return this.elements[2]}),__getset(0,e,"w",function(){return this.elements[3]}),t.createFromYawPitchRoll=function(t,e,i,n){var r=.5*i,a=.5*e,s=.5*t,o=Math.sin(r),l=Math.cos(r),_=Math.sin(a),h=Math.cos(a),u=Math.sin(s),c=Math.cos(s),d=n.elements;d[0]=c*_*l+u*h*o,d[1]=u*h*l-c*_*o,d[2]=c*h*o-u*_*l,d[3]=c*h*l+u*_*o},t.multiply=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=n[0],o=n[1],l=n[2],_=n[3],h=r[0],u=r[1],c=r[2],d=r[3],f=o*c-l*u,m=l*h-s*c,p=s*u-o*h,g=s*h+o*u+l*c;a[0]=s*d+h*_+f,a[1]=o*d+u*_+m,a[2]=l*d+c*_+p,a[3]=_*d-g},t.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:t>0?Math.atan(e/t):0>t?e>0?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},t.angleTo=function(e,i,n){Vector3.subtract(i,e,t.TEMPVector30),Vector3.normalize(t.TEMPVector30,t.TEMPVector30),n.elements[0]=Math.asin(t.TEMPVector30.y),n.elements[1]=t.arcTanAngle(-t.TEMPVector30.z,-t.TEMPVector30.x)},t.createFromAxisAngle=function(t,e,i){var n=i.elements,r=t.elements;e=.5*e;var a=Math.sin(e);n[0]=a*r[0],n[1]=a*r[1],n[2]=a*r[2],n[3]=Math.cos(e)},t.createFromMatrix3x3=function(t,e){var i,n=e.elements,r=t.elements,a=r[0]+r[4]+r[8];if(a>0)i=Math.sqrt(a+1),n[3]=.5*i,i=.5/i,n[0]=(r[5]-r[7])*i,n[1]=(r[6]-r[2])*i,n[2]=(r[1]-r[3])*i;else{var s=0;r[4]>r[0]&&(s=1),r[8]>r[3*s+s]&&(s=2);var o=(s+1)%3,l=(s+2)%3;i=Math.sqrt(r[3*s+s]-r[3*o+o]-r[3*l+l]+1),n[s]=.5*i,i=.5/i,n[3]=(r[3*o+l]-r[3*l+o])*i,n[o]=(r[3*o+s]+r[3*s+o])*i,n[l]=(r[3*l+s]+r[3*s+l])*i}},t.createFromMatrix4x4=function(t,e){var i,n,r=t.elements,a=e.elements,s=r[0]+r[5]+r[10];s>0?(i=Math.sqrt(s+1),a[3]=.5*i,i=.5/i,a[0]=(r[6]-r[9])*i,a[1]=(r[8]-r[2])*i,a[2]=(r[1]-r[4])*i):r[0]>=r[5]&&r[0]>=r[10]?(i=Math.sqrt(1+r[0]-r[5]-r[10]),n=.5/i,a[0]=.5*i,a[1]=(r[1]+r[4])*n,a[2]=(r[2]+r[8])*n,a[3]=(r[6]-r[9])*n):r[5]>r[10]?(i=Math.sqrt(1+r[5]-r[0]-r[10]),n=.5/i,a[0]=(r[4]+r[1])*n,a[1]=.5*i,a[2]=(r[9]+r[6])*n,a[3]=(r[8]-r[2])*n):(i=Math.sqrt(1+r[10]-r[0]-r[5]),n=.5/i,a[0]=(r[8]+r[2])*n,a[1]=(r[9]+r[6])*n,a[2]=.5*i,a[3]=(r[1]-r[4])*n)},t.slerp=function(t,e,i,n){var r,a,s,o,l,_=t.elements,h=e.elements,u=n.elements,c=_[0],d=_[1],f=_[2],m=_[3],p=h[0],g=h[1],v=h[2],x=h[3];return a=c*p+d*g+f*v+m*x,0>a&&(a=-a,p=-p,g=-g,v=-v,x=-x),1-a>1e-6?(r=Math.acos(a),s=Math.sin(r),o=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(o=1-i,l=i),u[0]=o*c+l*p,u[1]=o*d+l*g,u[2]=o*f+l*v,u[3]=o*m+l*x,u},t.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],_=a[2],h=a[3];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=_+i*(s[2]-_),r[3]=h+i*(s[3]-h)},t.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3]},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},t.rotationLookAt=function(e,i,n){t.lookAt(Vector3.ZERO,e,i,n)},t.lookAt=function(e,i,n,r){Matrix3x3.lookAt(e,i,n,t._tempMatrix3x3),t.rotationMatrix(t._tempMatrix3x3,r)},t.invert=function(t,e){var i=t.elements,n=e.elements,r=t.lengthSquared();MathUtils3D.isZero(r)||(r=1/r,n[0]=-i[0]*r,n[1]=-i[1]*r,n[2]=-i[2]*r,n[3]=i[3]*r)},t.rotationMatrix=function(t,e){var i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],_=i[6],h=i[7],u=i[8],c=e.elements,d=0/0,f=0/0,m=n+o+u;m>0?(d=Math.sqrt(m+1),c[3]=.5*d,d=.5/d,c[0]=(l-h)*d,c[1]=(_-a)*d,c[2]=(r-s)*d):n>=o&&n>=u?(d=Math.sqrt(1+n-o-u),f=.5/d,c[0]=.5*d,c[1]=(r+s)*f,c[2]=(a+_)*f,c[3]=(l-h)*f):o>u?(d=Math.sqrt(1+o-n-u),f=.5/d,c[0]=(s+r)*f,c[1]=.5*d,c[2]=(h+l)*f,c[3]=(_-a)*f):(d=Math.sqrt(1+u-n-o),f=.5/d,c[0]=(_+a)*f,c[1]=(h+l)*f,c[2]=.5*d,c[3]=(r-s)*f)},t.DEFAULT=new t,__static(t,["TEMPVector30",function(){return this.TEMPVector30=new Vector3},"TEMPVector31",function(){return this.TEMPVector31=new Vector3},"TEMPVector32",function(){return this.TEMPVector32=new Vector3},"TEMPVector33",function(){return this.TEMPVector33=new Vector3},"TEMPMatrix0",function(){return this.TEMPMatrix0=new Matrix4x4},"TEMPMatrix1",function(){return this.TEMPMatrix1=new Matrix4x4},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new Matrix3x3},"NAN",function(){return this.NAN=new t(0/0,0/0,0/0,0/0)}]),t}(),Rand=function(){function t(t){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}__class(t,"laya.d3.math.Rand");var e=t.prototype;return e.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^(this._temp[0]^this._temp[0]>>>8),this.seeds[3]},e.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},e.getSignedFloat=function(){return 2*this.getFloat()-1},__getset(0,e,"seed",function(){return this.seeds[0]},function(t){this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),t.getFloatFromInt=function(t){return(8388607&t)*(1/8388607)},t.getByteFromInt=function(t){return(8388607&t)>>>15},t}(),Ray=function(){function t(t,e){this.origin=null,this.direction=null,this.origin=t,this.direction=e}return __class(t,"laya.d3.math.Ray"),t}(),Viewport=function(){function t(t,e,i,n){this.minDepth=0,this.maxDepth=1,this.x=t,this.y=e,this.width=i,this.height=n}__class(t,"laya.d3.math.Viewport");var e=t.prototype;return e.project=function(t,e,i){Vector3.transformV3ToV3(t,e,i);var n=t.elements,r=e.elements,a=i.elements,s=n[0]*r[3]+n[1]*r[7]+n[2]*r[11]+r[15];1!==s&&(a[0]=a[0]/s,a[1]=a[1]/s,a[2]=a[2]/s),a[0]=.5*(a[0]+1)*this.width+this.x,a[1]=.5*(-a[1]+1)*this.height+this.y,a[2]=a[2]*(this.maxDepth-this.minDepth)+this.minDepth},e.unprojectFromMat=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements;a[0]=(n[0]-this.x)/this.width*2-1,a[1]=-((n[1]-this.y)/this.height*2-1);var s=(this.maxDepth-this.minDepth)/2;a[2]=(n[2]-this.minDepth-s)/s;var o=a[0]*r[3]+a[1]*r[7]+a[2]*r[11]+r[15];Vector3.transformV3ToV3(i,e,i),1!==o&&(a[0]=a[0]/o,a[1]=a[1]/o,a[2]=a[2]/o)},e.unprojectFromWVP=function(e,i,n,r,a){Matrix4x4.multiply(i,n,t._tempMatrix4x4),r&&Matrix4x4.multiply(t._tempMatrix4x4,r,t._tempMatrix4x4),t._tempMatrix4x4.invert(t._tempMatrix4x4),this.unprojectFromMat(e,t._tempMatrix4x4,a)},__static(t,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new Matrix4x4}]),t}(),Geometry=function(){function t(t){this._shape=null,this._center=null,this._shape=t,this._center=new Vector3}__class(t,"laya.d3.physics.geometry.Geometry");var e=t.prototype;return e.calculateDefaultMass=function(){return 0},__getset(0,e,"shape",function(){return this._shape},function(t){this._shape=t}),__getset(0,e,"center",function(){return this._center},function(t){this._center=t}),t}(),PhysicsData=function(){function t(){this._physicsId=0,this._mass=0/0,this._friction=0/0,this._restitution=0/0,this._linearFactor=null,this._angularFactor=null,this._physicsId=t._index++}__class(t,"laya.d3.physics.PhysicsData");var e=t.prototype;return __getset(0,e,"mass",function(){return this._mass},function(t){this._mass=t}),__getset(0,e,"linearFactor",function(){return this._linearFactor},function(t){this._linearFactor=t}),__getset(0,e,"friction",function(){return this._friction},function(t){this._friction=t}),__getset(0,e,"restitution",function(){return this._restitution},function(t){this._restitution=t}),__getset(0,e,"angularFactor",function(){return this._angularFactor},function(t){this._angularFactor=t}),t._index=0,t}(),PhysicsSystem=function(){function t(){this._dynamicsWorld=null,this._maxSubSteps=0/0,this.fixedTimeStep=1/60,this._last_simulation_time=0/0,this._last_simulation_duration=0,this._gravity=new Vector3(0,-25,0),this._transform=new Ammo.btTransform,this._massCenterTransform=new Ammo.btTransform,this._ammoGravity=new Ammo.btVector3(0,-25,0),this._ammoV3_1=new Ammo.btVector3(0,0,0),this._ammoV3_2=new Ammo.btVector3(0,0,0),this._ammoQ4=new Ammo.btQuaternion(0,0,0,0),this._objects=new Object,this._motionStates=new Object,this._compoundShapes=new Object,this._sprite3Ds=new Object,this.init()}__class(t,"laya.d3.physics.PhysicsSystem");var e=t.prototype;return e.init=function(){var t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),i=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;this._dynamicsWorld=new Ammo.btDiscreteDynamicsWorld(e,i,n,t),this._dynamicsWorld.setGravity(this._ammoGravity)},e.addPhysicsObject=function(t,e,i,n){var r,a,s;this._ammoV3_1.setValue(0,0,0),t.calculateLocalInertia(e.mass,this._ammoV3_1),this._transform.setIdentity(),this._ammoV3_2.setValue(-i.x,i.y,i.z),this._transform.setOrigin(this._ammoV3_2),this._ammoQ4.setValue(-n.x,n.y,n.z,-n.w),this._transform.setRotation(this._ammoQ4),this._massCenterTransform.setIdentity(),this._ammoV3_2.setValue(10,10,10),this._massCenterTransform.setOrigin(this._ammoV3_2),r=new Ammo.btDefaultMotionState(this._transform),a=new Ammo.btRigidBodyConstructionInfo(e.mass,r,t,this._ammoV3_1),a.set_m_friction(e.friction),a.set_m_restitution(e.restitution),s=new Ammo.btRigidBody(a),s.id=e._physicsId,this._dynamicsWorld.addRigidBody(s),this._objects[e._physicsId]=s,this._motionStates[e._physicsId]=r,this._compoundShapes[e._physicsId]=t,Ammo.destroy(a)},e.removePhysicsObject=function(t){Ammo.destroy(_objects[t]),Ammo.destroy(_motionStates[t]),Ammo.destroy(_compoundShapes[t]),delete _objects[t],delete _motionStates[t],delete _compoundShapes[t],delete _sprite3Ds[t]
},e.addShape=function(t,e){var i=e.center,n=this.createShape(e);n&&(this._transform.setIdentity(),this._ammoV3_2.setValue(-i.x,i.y,i.z),this._transform.setOrigin(this._ammoV3_2),this._ammoQ4.setValue(0,0,0,1),this._transform.setRotation(this._ammoQ4),t.addChildShape(this._transform,n))},e.update=function(t){if(this._dynamicsWorld){if(!t)if(this._last_simulation_time)for(t=0;t+this._last_simulation_duration<=this.fixedTimeStep;)t=(Browser.now()-this._last_simulation_time)/1e3;else t=this.fixedTimeStep;this._maxSubSteps=this._maxSubSteps||Math.ceil(t/this.fixedTimeStep),this._last_simulation_duration=Browser.now(),this._dynamicsWorld.stepSimulation(t,this._maxSubSteps,this.fixedTimeStep),this.updateTransform(),this._last_simulation_duration=(Browser.now()-this._last_simulation_duration)/1e3,this._last_simulation_time=Browser.now()}},e.updateTransform=function(){var t,e,i,n;for(var r in this._objects){t=this._objects[r],e=t.getCenterOfMassTransform(),i=e.getOrigin(),n=e.getRotation();var a=this._sprite3Ds[r].transform,s=a.position.elements;s[0]=-i.x(),s[1]=i.y(),s[2]=i.z();var o=a.rotation.elements;o[0]=-n.x(),o[1]=n.y(),o[2]=n.z(),o[3]=-n.w(),a.position=a.position,a.rotation=a.rotation}},e.createShape=function(t){var e,i=t.shape;switch(i){case"Box":var n=t;this._ammoV3_1.setValue(n.long/2,n.height/2,n.width/2),e=new Ammo.btBoxShape(this._ammoV3_1);break;case"Sphere":var r=t;e=new Ammo.btSphereShape(r.radius);break;case"Capsule":var a=t;e=new Ammo.btCapsuleShape(a.radius,a.height-2*a.radius)}return e},e.setLinearVelocity=function(t,e){var i=this._objects[t];this._ammoV3_2.setValue(-e.x,e.y,e.z),i.setLinearVelocity(this._ammoV3_2),i.activate()},e.setLinearFactor=function(t,e){var i=this._objects[t];this._ammoV3_2.setValue(e.x,e.y,e.z),i.setLinearFactor(this._ammoV3_2)},e.setAngularVelocity=function(t,e){var i=this._objects[t];this._ammoV3_2.setValue(-e.x,e.y,e.z),i.setAngularVelocity(this._ammoV3_2),i.activate()},e.setAngularFactor=function(t,e){var i=this._objects[t];this._ammoV3_2.setValue(e.x,e.y,e.z),i.setAngularFactor(this._ammoV3_2)},__getset(0,e,"gravity",function(){return this._gravity},function(t){this._gravity=t;var e=t.elements;this._ammoGravity.setValue(-e[0],e[1],e[2]),_dynamicsWorld.setGravity(_ammoGravity)}),t}(),SkyBox=function(){function t(){var t=.5,e=.5,i=.5,n=new Float32Array([-i,t,-e,i,t,-e,i,t,e,-i,t,e,-i,-t,-e,i,-t,-e,i,-t,e,-i,-t,e]),r=new Uint8Array([0,1,2,2,3,0,4,7,6,6,5,4,0,3,7,7,4,0,1,5,6,6,2,1,3,2,6,6,7,3,0,4,5,5,1,0]);this._vertexBuffer=new VertexBuffer3D(8*VertexPosition.vertexDeclaration.vertexStride,35044,!1),this._vertexBuffer.vertexDeclaration=VertexPosition.vertexDeclaration,this._indexBuffer=new IndexBuffer3D("ubyte",36,35044,!1),this._vertexBuffer.setData(n),this._indexBuffer.setData(r)}__class(t,"laya.d3.resource.models.SkyBox");var e=t.prototype;return e._render=function(){this._indexBuffer.bind(),LayaGL.instance.drawElements(4,36,5121,0),Stat.trianglesFaces+=12,Stat.drawCall++},t.__init__=function(){t._instance=new t,t._instance._vertexBuffer.lock=!0,t._instance._indexBuffer.lock=!0},t._instance=null,t}(),DefineDatas=function(){function t(){this.value=0}__class(t,"laya.d3.shader.DefineDatas");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t){this.value|=t},e.remove=function(t){this.value&=~t},e.has=function(t){return(this.value&t)>0},e.cloneTo=function(t){var e=t;e.value=this.value},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}(),Shader3D=function(){function t(e,i,n,r,a,s){this._name=e,this._publicDefines=[],this._publicDefinesMap={},this._spriteDefines=[],this._spriteDefinesMap={},this._materialDefines=[],this._materialDefinesMap={},this._addDefines(this._publicDefines,this._publicDefinesMap,t._globleDefines),a&&this._addDefines(this._spriteDefines,this._spriteDefinesMap,a.defines),s&&this._addDefines(this._materialDefines,this._materialDefinesMap,s.defines),this._passes=[],this._attributeMap=i,this._uniformMap=n}__class(t,"laya.d3.shader.Shader3D");var e=t.prototype;return e._addDefines=function(t,e,i){for(var n in i){var r=i[n],a=parseInt(n);t[a]=r,e[r]=a}},e._addShaderPass=function(t,e){this._passes.push(new ShaderPass(this,t,e))},e.getMaterialDefineByName=function(t){return this._materialDefinesMap[t]},t.addInclude=function(t,e){ShaderCompile.addInclude(t,e)},t.registerPublicDefine=function(e){var i=Math.pow(2,t._publicCounter++);return t._globleDefines[i]=e,i},t.compileShader=function(t,e,i,n,r){var a=laya.d3.shader.Shader3D.get(t);if(a){var s=a._passes[e];s?WebGL.shaderHighPrecision?s.withCompile(i,n,r):s.withCompile(i-laya.d3.shader.Shader3D.SHADERDEFINE_HIGHPRECISION,n,r):console.warn("Shader3D: unknown shader passIndex.")}else console.warn("Shader3D: unknown shader name.")},t.add=function(e,i,n,r,a){return laya.d3.shader.Shader3D._preCompileShader[e]=new t(e,i,n,ShaderCompile.includes,r,a)},t.get=function(t){return laya.d3.shader.Shader3D._preCompileShader[t]},t.PERIOD_CUSTOM=0,t.PERIOD_MATERIAL=1,t.PERIOD_SPRITE=2,t.PERIOD_CAMERA=3,t.PERIOD_SCENE=4,t.SHADERDEFINE_HIGHPRECISION=0,t._publicCounter=0,t._globleDefines=[],t._preCompileShader={},t.debugMode=!1,t}(),ShaderDatas=function(){function t(t,e){this._ownerResource=t,this._initData(e)}__class(t,"laya.d3.shader.ShaderDatas");var e=t.prototype;return Laya.imps(e,{"laya.d3.core.IClone":!0}),e._initData=function(t){this._data=new Array(t)},e.getBool=function(t){return this._data[t]},e.setBool=function(t,e){this._data[t]=e},e.getInt=function(t){return this._data[t]},e.setInt=function(t,e){this._data[t]=e},e.getNumber=function(t){return this._data[t]},e.setNumber=function(t,e){this._data[t]=e},e.getVector=function(t){return this._data[t]},e.setVector=function(t,e){this._data[t]=e},e.getQuaternion=function(t){return this._data[t]},e.setQuaternion=function(t,e){this._data[t]=e},e.getMatrix4x4=function(t){return this._data[t]},e.setMatrix4x4=function(t,e){this._data[t]=e},e.getBuffer=function(t){return this._data[t]},e.setBuffer=function(t,e){this._data[t]=e},e.setTexture=function(t,e){var i=this._data[t];this._data[t]=e,this._ownerResource&&this._ownerResource.referenceCount>0&&(i&&i._removeReference(),e&&e._addReference())},e.getTexture=function(t){return this._data[t]},e.setAttribute=function(t,e){this._data[t]=e},e.getAttribute=function(t){return this._data[t]},e.getLength=function(){return this._data.length},e.setLength=function(t){this._data.length=t},e.cloneTo=function(t){var e=t,i=e._data,n=this._data.length;i.length=n;for(var r=0;n>r;r++){var a=this._data[r];if(a)if("number"==typeof a)i[r]=a;else if("number"==typeof a&&Math.floor(a)==a)i[r]=a;else if("boolean"==typeof a)i[r]=a;else if(a instanceof laya.d3.math.Vector2){var s=i[r]||(i[r]=new Vector2);a.cloneTo(s),i[r]=s}else if(a instanceof laya.d3.math.Vector3){var o=i[r]||(i[r]=new Vector3);a.cloneTo(o),i[r]=o}else if(a instanceof laya.d3.math.Vector4){var l=i[r]||(i[r]=new Vector4);a.cloneTo(l),i[r]=l}else if(a instanceof laya.d3.math.Matrix4x4){var _=i[r]||(i[r]=new Matrix4x4);a.cloneTo(_),i[r]=_}else a instanceof laya.webgl.resource.BaseTexture&&(i[r]=a)}},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e._initDataForNative=function(t){t||alert("ShaderData _initDataForNative error length=0"),this._nativeArray=[],this._data=new ArrayBuffer(4*t),this._int32Data=new Int32Array(this._data),this._float32Data=new Float32Array(this._data),LayaGL.createArrayBufferRef(this._data,0,!0)},e.getIntForNative=function(t){return this._int32Data[t]},e.setIntForNative=function(t,e){this._int32Data[t]=e},e.getBoolForNative=function(t){return 1==this._int32Data[t]},e.setBoolForNative=function(t,e){this._int32Data[t]=e},e.getNumberForNative=function(t){return this._float32Data[t]},e.setNumberForNative=function(t,e){this._float32Data[t]=e},e.getMatrix4x4ForNative=function(){return alert("ShaderData getMatrix4x4 can't support"),null},e.setMatrix4x4ForNative=function(t,e){this._nativeArray[t]=e;var i=e.elements;i._ptrID||LayaGL.createArrayBufferRef(i,0,!0),LayaGL.syncBufferToRenderThread(i),this._int32Data[t]=i._ptrID},e.getVectorForNative=function(t){return this._nativeArray[t]},e.setVectorForNative=function(t,e){this._nativeArray[t]=e;var i=e.elements;i._ptrID||LayaGL.createArrayBufferRef(i,0,!0),LayaGL.syncBufferToRenderThread(i),this._int32Data[t]=i._ptrID},e.getQuaternionForNative=function(){return alert("ShaderData getQuaternion can't support"),null},e.setQuaternionForNative=function(t,e){this._nativeArray[t]=e;var i=e.elements;i._ptrID||LayaGL.createArrayBufferRef(i,0,!0),LayaGL.syncBufferToRenderThread(i),this._int32Data[t]=i._ptrID},e.getBufferForNative=function(){return alert("ShaderData getBuffer can't support"),null},e.setBufferForNative=function(t,e){this._nativeArray[t]=e,e._ptrID||LayaGL.createArrayBufferRef(e,0,!0),LayaGL.syncBufferToRenderThread(e),this._int32Data[t]=e._ptrID},e.getAttributeForNative=function(){return alert("ShaderData  getAttribute can't support"),null},e.setAttributeForNative=function(t,e){this._nativeArray[t]=e,e._ptrID||LayaGL.createArrayBufferRef(e,0,!0),LayaGL.syncBufferToRenderThread(e),this._int32Data[t]=e._ptrID},e.getTextureForNative=function(){return alert("ShaderData getTexture can't support"),null},e.setTextureForNative=function(t,e){this._nativeArray[t]=e;var i=this._int32Data[t];this._int32Data[t]=e._getSource(),this._ownerResource.referenceCount>0&&(i&&i._removeReference(),e&&e._addReference())},t}(),ShaderDefines$1=function(){function t(t){this._counter=0,this.defines=null,t?(this._counter=t._counter,this.defines=t.defines.slice()):(this._counter=0,this.defines=[])}__class(t,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1");var e=t.prototype;return e.registerDefine=function(t){var e=Math.pow(2,this._counter++);return this.defines[e]=t,e},t}(),ShaderInit3D=function(){function t(){}return __class(t,"laya.d3.shader.ShaderInit3D"),t.__init__=function(){Shader3D.SHADERDEFINE_HIGHPRECISION=Shader3D.registerPublicDefine("HIGHPRECISION"),VertexDeclaration.SHADERDEFINE_UV0=Shader3D.registerPublicDefine("UV"),VertexDeclaration.SHADERDEFINE_COLOR=Shader3D.registerPublicDefine("COLOR"),VertexDeclaration.SHADERDEFINE_UV1=Shader3D.registerPublicDefine("UV1"),Scene3D.SHADERDEFINE_FOG=Shader3D.registerPublicDefine("FOG"),Scene3D.SHADERDEFINE_DIRECTIONLIGHT=Shader3D.registerPublicDefine("DIRECTIONLIGHT"),Scene3D.SHADERDEFINE_POINTLIGHT=Shader3D.registerPublicDefine("POINTLIGHT"),Scene3D.SHADERDEFINE_SPOTLIGHT=Shader3D.registerPublicDefine("SPOTLIGHT"),Scene3D.SHADERDEFINE_CAST_SHADOW=Shader3D.registerPublicDefine("CASTSHADOW"),Scene3D.SHADERDEFINE_SHADOW_PSSM1=Shader3D.registerPublicDefine("SHADOWMAP_PSSM1"),Scene3D.SHADERDEFINE_SHADOW_PSSM2=Shader3D.registerPublicDefine("SHADOWMAP_PSSM2"),Scene3D.SHADERDEFINE_SHADOW_PSSM3=Shader3D.registerPublicDefine("SHADOWMAP_PSSM3"),Scene3D.SHADERDEFINE_SHADOW_PCF_NO=Shader3D.registerPublicDefine("SHADOWMAP_PCF_NO"),Scene3D.SHADERDEFINE_SHADOW_PCF1=Shader3D.registerPublicDefine("SHADOWMAP_PCF1"),Scene3D.SHADERDEFINE_SHADOW_PCF2=Shader3D.registerPublicDefine("SHADOWMAP_PCF2"),Scene3D.SHADERDEFINE_SHADOW_PCF3=Shader3D.registerPublicDefine("SHADOWMAP_PCF3"),Scene3D.SHADERDEFINE_REFLECTMAP=Shader3D.registerPublicDefine("REFLECTMAP"),Shader3D.addInclude("Lighting.glsl","\nstruct DirectionLight\n{\n	vec3 Color;\n	vec3 Direction;\n};\n\nstruct PointLight\n{\n	vec3 Color;\n	vec3 Position;\n	float Range;\n};\n\nstruct SpotLight\n{\n	vec3 Color;\n	vec3 Position;\n	vec3 Direction;\n	float Spot;\n	float Range;\n};\n\n// U3D中使用衰减纹理,此函数模拟并非正确\n//float U3DAttenuation(in vec3 L,in float invLightRadius)\n//{\n//	float fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\n//	fRatio *= fRatio;\n//	return 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\n//} \n\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\nfloat BasicAttenuation(in vec3 L,in float invLightRadius)\n{\n	vec3 distance = L * invLightRadius;\n	float attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius)); 	\n	return attenuation * attenuation;\n} \n\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread	\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius)\n{\n	float attenuationFactor = 30.0;\n	vec3 distance = L * invLightRadius;\n	float attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\n	attenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\n	// Second we move down the function therewith it reaches zero at abscissa 1:\n	attenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\n	attenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\n	// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\n	attenuation /= 1.0 - attenuationFactor;\n	return attenuation;\n} \n\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor)\n{\n    mediump vec3 h = normalize(viewDir-lightVec);\n    lowp float ln = max (0.0, dot (-lightVec,normal));\n    float nh = max (0.0, dot (h,normal));\n	diffuseColor=lightColor * ln;\n	specularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\n}\n\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n	vec3 lightVec=normalize(light.Direction);\n	LayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec,diffuseColor,specularColor);\n}\n\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n	vec3 lightVec =  pos-light.Position;\n	//if( length(lightVec) > light.Range )\n	//	return;\n	LayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec/length(lightVec),diffuseColor,specularColor);\n	float attenuate = BasicAttenuation(lightVec, 1.0/light.Range);\n	diffuseColor *= attenuate;\n	specularColor*= attenuate;\n}\n\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n	vec3 lightVec =  pos-light.Position;\n	//if( length(lightVec) > light.Range )\n	//	return;\n	vec3 normalLightVec=lightVec/length(lightVec);\n	LayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,normalLightVec,diffuseColor,specularColor);\n	float spot = pow(max(dot(normalLightVec, normalize(light.Direction)), 0.0), light.Spot);\n	float attenuate = spot*BasicAttenuation(lightVec, 1.0/light.Range);\n	diffuseColor *= attenuate;\n	specularColor*= attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal)\n{\n	vec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\n	\n	// Build orthonormal basis.\n	vec3 N = normalize(unitNormal);\n	vec3 T = normalize(tangent);\n	vec3 B = normalize(binormal);\n	mat3 TBN = mat3(T, B, N);\n	\n	// Transform from tangent space to world space.\n	vec3 bumpedNormal = TBN*normalT;\n\n	return bumpedNormal;\n}\n\nvec3 NormalSampleToWorldSpace1(vec4 normalMapSample, vec3 tangent, vec3 binormal, vec3 unitNormal)\n{\n	vec3 normalT;\n	normalT.x = 2.0 * normalMapSample.x - 1.0;\n	normalT.y = 1.0 - 2.0 * normalMapSample.y;\n	normalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n	\n	vec3 T = normalize(tangent);\n	vec3 B = normalize(binormal);\n	vec3 N = normalize(unitNormal);\n	mat3 TBN = mat3(T, B, N);\n	\n	// Transform from tangent space to world space.\n	vec3 bumpedNormal = TBN * normalize(normalT);\n\n	return bumpedNormal;\n}\n\n\n"),Shader3D.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2	  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n	const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n	const vec4 bitMask	= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n	vec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n	res -= res.xxyz * bitMask;\n	return res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n	const vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n	float depth = dot(rgbaDepth, bitShift);\n	return depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n	vec2 texelpos =texcoord / invsize;\n	vec2 lerps = fract( texelpos );\n	float sourcevals[4];\n	sourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n	sourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n	sourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n	sourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n	return mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n	float value = 1.0;\n	int nPSNum = int(posViewZ>pssmDistance.x);\n	nPSNum += int(posViewZ>pssmDistance.y);\n	nPSNum += int(posViewZ>pssmDistance.z);\n	//真SB,webgl不支持在PS中直接访问数组\n	mat4 lightVP;\n	if( nPSNum == 0 )\n	{\n		lightVP = lightShadowVP[1];\n	}\n	else if( nPSNum == 1 )\n	{\n		lightVP = lightShadowVP[2];\n	}\n	else if( nPSNum == 2 )\n	{\n		lightVP = lightShadowVP[3];\n	}\n	vec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n	//为了效率，在CPU计算/2.0 + 0.5\n	//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n	vec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n	float fMyZ = vText.z - zBias;\n	/*\n	bvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n	bool bInFrustum = all( bInFrustumVec );\n	bvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n	bool bFrustumTest = all( bFrustumTestVec );\n	if ( bFrustumTest ) \n	*/\n	if( fMyZ <= 1.0 )\n	{\n		float zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n		if ( nPSNum == 0 )\n		{\n			value =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,	fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,	fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,	fMyZ );\n			value = value/4.0;\n		} \n		else if( nPSNum == 1 )\n		{\n			value = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n		}\n		else if( nPSNum == 2 )\n		{\n			vec4 color = texture2D( shadowMap3,vText.xy );\n			zdepth = unpackDepth(color);\n			value = float(fMyZ < zdepth);\n		}\n#endif\n#ifdef SHADOWMAP_PCF2\n		if ( nPSNum == 0 )\n		{\n			value = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n		}\n		else if( nPSNum == 1 )\n		{\n			value = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n		}\n		else if( nPSNum == 2 )\n		{\n			vec4 color = texture2D( shadowMap3,vText.xy );\n			zdepth = unpackDepth(color);\n			value = float(fMyZ < zdepth);\n		}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n		if ( nPSNum == 0 )\n		{\n			value = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n		}\n		else if( nPSNum == 1 )\n		{\n			vec4 color = texture2D( shadowMap2,vText.xy );\n			zdepth = unpackDepth(color);\n			value = float(fMyZ < zdepth);\n		}\n		else if( nPSNum == 2 )\n		{\n			vec4 color = texture2D( shadowMap3,vText.xy );\n			zdepth = unpackDepth(color);\n			value = float(fMyZ < zdepth);\n		}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n		vec4 color;\n		if ( nPSNum == 0 )\n		{\n			color = texture2D( shadowMap1,vText.xy );\n		}\n		else if( nPSNum == 1 )\n		{\n			color = texture2D( shadowMap2,vText.xy );\n		}\n		else if( nPSNum == 2 )\n		{\n			color = texture2D( shadowMap3,vText.xy );\n		}\n		zdepth = unpackDepth(color);\n		value = float(fMyZ < zdepth);\n#endif\n	}\n	return value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n	float value = 1.0;\n	int nPSNum = int(posViewZ>pssmDistance.x);\n	nPSNum += int(posViewZ>pssmDistance.y);\n	//真SB,webgl不支持在PS中直接访问数组\n	mat4 lightVP;\n	if( nPSNum == 0 )\n	{\n		lightVP = lightShadowVP[1];\n	}\n	else if( nPSNum == 1 )\n	{\n		lightVP = lightShadowVP[2];\n	}\n	vec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n	//为了效率，在CPU计算/2.0 + 0.5\n	//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n	vec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n	float fMyZ = vText.z - zBias;\n	/*\n	bvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n	bool bInFrustum = all( bInFrustumVec );\n	bvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n	bool bFrustumTest = all( bFrustumTestVec );\n	if ( bFrustumTest ) \n	*/\n	if( fMyZ <= 1.0 )\n	{\n		float zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n		if ( nPSNum == 0 )\n		{\n			value =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,	fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,	fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,	fMyZ );\n			value = value/4.0;\n		}\n		else if( nPSNum == 1 )\n		{\n			value = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n		}\n#endif\n#ifdef SHADOWMAP_PCF2\n		if ( nPSNum == 0 )\n		{\n			value = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n		}\n		else if( nPSNum == 1 )\n		{\n			value = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n		}\n#endif\n#ifdef SHADOWMAP_PCF1\n		if ( nPSNum == 0 )\n		{\n			value = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n		}\n		else if( nPSNum == 1 )\n		{\n			vec4 color = texture2D( shadowMap2,vText.xy );\n			zdepth = unpackDepth(color);\n			value = float(fMyZ < zdepth);\n		}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n		vec4 color;\n		if ( nPSNum == 0 )\n		{\n			color = texture2D( shadowMap1,vText.xy );\n		}\n		else if( nPSNum == 1 )\n		{\n			color = texture2D( shadowMap2,vText.xy );\n		}\n		zdepth = unpackDepth(color);\n		value = float(fMyZ < zdepth);\n#endif\n	}\n	return value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n	float value = 1.0;\n	if( posViewZ < pssmDistance.x )\n	{\n		vec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n		float fMyZ = vText.z - zBias;\n		/*\n		bvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n		bool bInFrustum = all( bInFrustumVec );\n		bvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n		bool bFrustumTest = all( bFrustumTestVec );\n		*/\n		if ( fMyZ <= 1.0 ) \n		{\n			float zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n			value =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n			value += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n			value = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2		\n			value = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n			value = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO		\n			vec4 color = texture2D( shadowMap1,vText.xy );\n			zdepth = unpackDepth(color);\n			value = float(fMyZ < zdepth);\n#endif\n		}\n	}\n	return value;\n}"),Shader3D.addInclude("BRDF.glsl","struct LayaGI\n{\n	vec3 diffuse;\n	vec3 specular;\n};\n\nvec4 LayaAirBRDF(in vec3 diffuseColor, in vec3 specularColor, in float oneMinusReflectivity, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n	float perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n	vec3 halfDir = SafeNormalize(viewDir - lightDir);\n	\n	float nv = abs(dot(normal, viewDir));\n	\n	float nl = clamp(dot(normal,   -lightDir),  0.0, 1.0);\n	float nh = clamp(dot(normal,     halfDir),  0.0, 1.0);\n	float lv = clamp(dot(lightDir,   viewDir),  0.0, 1.0);\n	float lh = clamp(dot(lightDir,  -halfDir),  0.0, 1.0);\n	\n	float diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n	\n	float roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n	\n	//#if UNITY_BRDF_GGX\n	float V = SmithJointGGXVisibilityTerm(nl, nv, roughness);\n	float D = GGXTerm(nh, roughness);\n	\n	float specularTerm = V * D * PI;\n	\n	specularTerm = sqrt(max(0.0001, specularTerm));\n	specularTerm = max(0.0, specularTerm * nl);\n	\n	float surfaceReduction = 1.0 - 0.28 * roughness * perceptualRoughness;\n	float grazingTerm = clamp(smoothness + (1.0 - oneMinusReflectivity), 0.0, 1.0);\n	\n	vec4 color;\n	color.rgb = diffuseColor * (gi.diffuse + lightColor * diffuseTerm) \n			  + specularTerm * lightColor * FresnelTerm (specularColor, lh)\n			  + surfaceReduction * gi.specular * FresnelLerp(specularColor, vec3(grazingTerm), nv);\n	\n	color.a = 1.0;\n	return color;\n}"),Shader3D.addInclude("PBRUtils.glsl","struct DirectionLight\n{\n	vec3 Color;\n	vec3 Direction;\n};\n\nvec3 UnpackScaleNormal(in vec2 uv0)\n{\n	#ifdef NORMALTEXTURE\n		vec3 normalT;\n		vec4 normalMapSample = texture2D(u_NormalTexture, uv0);\n		normalT.x = 2.0 * normalMapSample.x - 1.0;\n		normalT.y = 1.0 - 2.0 * normalMapSample.y;\n		normalT.xy *= u_normalScale;\n		normalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n		\n		vec3 T = normalize(v_Tangent);\n		vec3 B = normalize(v_Binormal);\n		vec3 N = normalize(v_Normal);\n		mat3 TBN = mat3(T, B, N);\n		\n		vec3 bumpedNormal = TBN * normalize(normalT);\n		return bumpedNormal;\n	#else\n		return normalize(v_Normal);\n	#endif\n}\n\nvec4 DielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\n\nfloat PI = 3.14159265359;\n\nvec3 FresnelTerm (in vec3 F0, in float cosA)\n{\n	return F0 + (vec3(1.0) - F0) * pow(1.0 - cosA, 5.0);\n}\n\nvec3 FresnelLerp (in vec3 F0, in vec3 F90, float cosA)\n{\n    float t = pow(1.0 - cosA, 5.0);\n    return mix(F0, F90, t);\n}\n\nfloat PerceptualRoughnessToRoughness(in float perceptualRoughness)\n{\n	return perceptualRoughness * perceptualRoughness;\n}\n\nfloat PerceptualRoughnessToSpecularPower(in float perceptualRoughness)\n{\n	float m = PerceptualRoughnessToRoughness(perceptualRoughness);\n	float sq = max(0.0001, m * m);\n	float n = (2.0 / sq) - 2.0;\n	n = max(n, 0.0001);\n	return n;\n}\n\nfloat RoughnessToPerceptualRoughness(in float roughness)\n{\n	return sqrt(roughness);\n}\n\nfloat SmoothnessToRoughness(in float smoothness)\n{\n	return (1.0 - smoothness) * (1.0 - smoothness);\n}\n\nfloat SmoothnessToPerceptualRoughness(in float smoothness)\n{\n	return (1.0 - smoothness);\n}\n\nvec3 SafeNormalize(in vec3 inVec)\n{\n	float dp3 = max(0.001,dot(inVec,inVec));\n	return inVec * (1.0 / sqrt(dp3));\n}\n\nfloat DisneyDiffuse(in float NdotV, in float NdotL, in float LdotH, in float perceptualRoughness)\n{\n	float fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n	float lightScatter	= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotL,5.0));\n	float viewScatter	= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotV,5.0));\n\n	return lightScatter * viewScatter;\n}\n\nfloat SmithJointGGXVisibilityTerm (float NdotL, float NdotV, float roughness)\n{\n	float a = roughness;\n	float lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n	float lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\n	return 0.5 / (lambdaV + lambdaL + 0.00001);\n}\n\nfloat GGXTerm (float NdotH, float roughness)\n{\n	float a2 = roughness * roughness;\n	float d = (NdotH * a2 - NdotH) * NdotH + 1.0;\n	return 0.31830988618 * a2 / (d * d + 0.0000001);\n}\n\nfloat OneMinusReflectivityFromMetallic(in float metallic)\n{\n	float oneMinusDielectricSpec = DielectricSpecularColor.a;\n	return oneMinusDielectricSpec - metallic * oneMinusDielectricSpec;\n}\n\nfloat SpecularStrength(vec3 specular)\n{\n    //(SHADER_TARGET < 30)return specular.r; \n    return max (max (specular.r, specular.g), specular.b);\n}\n\nvec3 DiffuseAndSpecularFromMetallic(in vec3 diffuseColor, in float metallic, out vec3 specularColor, out float oneMinusReflectivity)\n{\n	specularColor = mix(DielectricSpecularColor.rgb, diffuseColor, metallic);\n	oneMinusReflectivity = OneMinusReflectivityFromMetallic(metallic);\n	return diffuseColor * oneMinusReflectivity;\n}\n\nvec3 EnergyConservationBetweenDiffuseAndSpecular(in vec3 diffuseColor, in vec3 specularColor, out float oneMinusReflectivity)\n{\n	oneMinusReflectivity = 1.0 - SpecularStrength(specularColor);\n	return diffuseColor * oneMinusReflectivity;\n}\n\nvec4 Occlusion(in vec2 uv0){\n	#ifdef OCCLUSIONTEXTURE\n		vec4 occlusionTextureColor = texture2D(u_OcclusionTexture, uv0);\n		float occ = occlusionTextureColor.g;\n		float oneMinusT = 1.0 - u_occlusionStrength;\n		float lerpOneTo = oneMinusT + occ * u_occlusionStrength;\n		return occlusionTextureColor * lerpOneTo;\n	#else\n		return vec4(1.0);\n	#endif\n}\n\nvec2 ParallaxOffset(in vec3 viewDir){\n	#ifdef PARALLAXTEXTURE\n		float h = texture2D(u_ParallaxTexture, v_Texcoord0).g;\n		h = h * u_parallaxScale - u_parallaxScale / 2.0;\n		vec3 v = viewDir;\n		v.z += 0.42;\n		vec2 offset = h * (v.xy / v.z);\n		return v_Texcoord0 + offset;\n	#else\n		return v_Texcoord0;\n	#endif\n}\n\nvec3 ReflectCubeMap(in vec3 viewDir, in vec3 normal){\n	#ifdef REFLECTMAP\n		vec3 incident = -viewDir;\n		vec3 reflectionVector = reflect(incident, normal);\n		vec3 reflectionColor = textureCube(u_ReflectTexture, vec3(-reflectionVector.x, reflectionVector.yz)).rgb;\n		return reflectionColor * u_ReflectIntensity;\n	#else\n		return vec3(0.0);\n	#endif\n}\n\n"),Shader3D.addInclude("PBRStandardLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRStandardLight(in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n	float oneMinusReflectivity;\n	vec3 specularColor;\n	diffuseColor = DiffuseAndSpecularFromMetallic (diffuseColor, metallic, specularColor, oneMinusReflectivity);\n	\n	vec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n	return color;\n}\n\nvec4 PBRStandardDiectionLight (in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in LayaGI gi)\n{\n	vec3 lightVec = normalize(light.Direction);\n	return PBRStandardLight(diffuseColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec2 MetallicGloss(in float diffuseTextureAlpha, in vec2 uv0)\n{\n	vec2 mg;\n	\n	#ifdef METALLICGLOSSTEXTURE\n		vec4 metallicGlossTextureColor = texture2D(u_MetallicGlossTexture, uv0);\n		#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n			mg.r = metallicGlossTextureColor.r;\n			mg.g = diffuseTextureAlpha;\n		#else\n		    mg = metallicGlossTextureColor.ra;\n		#endif\n		mg.g *= u_smoothnessScale;\n	#else\n		mg.r = u_metallic;\n		#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n			mg.g = diffuseTextureAlpha * u_smoothnessScale;\n		#else\n			mg.g = u_smoothness;\n		#endif\n	#endif\n	\n	return mg;\n}\n\n'),Shader3D.addInclude("PBRSpecularLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRSpecularLight(in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n	float oneMinusReflectivity;\n	diffuseColor = EnergyConservationBetweenDiffuseAndSpecular (diffuseColor, specularColor, oneMinusReflectivity);\n	\n	vec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n	return color;\n}\n\nvec4 PBRSpecularDiectionLight (in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in LayaGI gi)\n{\n	vec3 lightVec = normalize(light.Direction);\n	return PBRSpecularLight(diffuseColor, specularColor, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec4 SpecularGloss(float diffuseTextureAlpha, in vec2 uv0)\n{\n    vec4 sg;\n	\n	#ifdef SPECULARTEXTURE\n		vec4 specularTextureColor = texture2D(u_SpecularTexture, uv0);\n		#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n			sg.rgb = specularTextureColor.rgb;\n			sg.a = diffuseTextureAlpha;\n		#else\n			sg = specularTextureColor;\n		#endif\n		sg.a *= u_smoothnessScale;\n	#else\n		sg.rgb = u_SpecularColor.rgb;\n		#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n			sg.a = diffuseTextureAlpha * u_smoothnessScale;\n		#else\n			sg.a = u_smoothness;\n		#endif\n	#endif\n	\n    return sg;\n}\n\n'),Shader3D.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n	vec3 normalT = 2.0*normalMapSample - 1.0;\n\n	// Build orthonormal basis.\n	vec3 N = normalize(unitNormal);\n	vec3 T = normalize(tangent- dot(tangent, N)*N);\n	vec3 B = cross(T, N);\n\n	mat3 TBN = mat3(T, B, N);\n\n	// Transform from tangent space to world space.\n	vec3 bumpedNormal = TBN*normalT;\n\n	return bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n	dif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n	amb=vec3(0.0);\n	spec=vec3(0.0);\n	vec3 lightVec=-normalize(dirLight.Direction);\n	\n	amb=matAmb*ambinentColor;\n	\n	float  diffuseFactor=dot(lightVec, normal);\n	\n	if(diffuseFactor>0.0)\n	{\n	   vec3 v = reflect(-lightVec, normal);\n	   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n	   \n	   dif = diffuseFactor * matDif * dirLight.Diffuse;\n	   spec = specFactor * matSpe.rgb;\n	}\n	\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n	dif=vec3(0.0);\n	amb=vec3(0.0);\n	spec=vec3(0.0);\n	vec3 lightVec = poiLight.Position - pos;\n		\n	float d = length(lightVec);\n	\n	if( d > poiLight.Range )\n		return;\n		\n	lightVec /= d; \n	\n	amb = matAmb*ambinentColor;	\n\n	float diffuseFactor = dot(lightVec, normal);\n\n	if( diffuseFactor > 0.0 )\n	{\n		vec3 v= reflect(-lightVec, normal);\n		float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n					\n		dif = diffuseFactor * matDif * poiLight.Diffuse;\n		spec = specFactor * matSpe.rgb;\n	}\n\n	float attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n	dif *= attenuate;\n	spec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n	amb = vec3(0.0);\n	dif =vec3(0.0);\n	spec= vec3(0.0);\n	vec3 lightVec = spoLight.Position - pos;\n		\n	float d = length(lightVec);\n	\n	if( d > spoLight.Range)\n		return;\n		\n	lightVec /= d; \n	\n	amb = matAmb*ambinentColor;	\n\n	float diffuseFactor = dot(lightVec, normal);\n\n	if(diffuseFactor > 0.0)\n	{\n		vec3 v= reflect(-lightVec, normal);\n		float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n					\n		dif = diffuseFactor * matDif * spoLight.Diffuse;\n		spec = specFactor * matSpe.rgb;\n	}\n	\n	float spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n	float attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n	amb *= spot;\n	dif *= attenuate;\n	spec*= attenuate;\n}\n\n");
var t,e,i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_BoneWeights:7,a_BoneIndices:6,a_Texcoord3d:38,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AlphaTestValue:[0,1],u_DiffuseColor:[5,1],u_MaterialSpecular:[6,1],u_Shininess:[7,1],u_TilingOffset:[8,1],u_ReflectColor:[9,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_ReflectTexture:[22,4],u_ReflectIntensity:[23,4],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Color":[4,4],"u_DirectionLight.Direction":[3,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Color":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Color":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};t='attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n	attribute vec2 a_Texcoord0;\n	varying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n	attribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n	uniform vec4 u_LightmapScaleOffset;\n	varying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n	attribute vec4 a_Color;\n	varying vec4 v_Color;\n#endif\n\n#ifdef BONE\n	const int c_MaxBoneCount = 24;\n	attribute vec4 a_BoneIndices;\n	attribute vec4 a_BoneWeights;\n	uniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n	attribute vec3 a_Normal;\n	varying vec3 v_Normal; \n	uniform vec3 u_CameraPos;\n	varying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n	attribute vec4 a_Tangent0;\n	varying vec3 v_Tangent;\n	varying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n	uniform mat4 u_WorldMat;\n	varying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n	uniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n	#ifdef BONE\n		mat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n		skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n		skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n		skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n		vec4 position=skinTransform*a_Position;\n		gl_Position = u_MvpMatrix * position;\n	#else\n		gl_Position = u_MvpMatrix * a_Position;\n	#endif\n	 \n	//TODO没考虑UV动画呢\n	#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n		v_Texcoord0=a_Texcoord0;\n	#endif\n		v_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n	#ifdef BONE\n		mat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n		skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n		skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n		skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n		vec4 position=skinTransform*a_Position;\n		gl_Position = u_MvpMatrix * position;\n	#else\n		gl_Position = u_MvpMatrix * a_Position;\n	#endif\n\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n		mat3 worldMat;\n		#ifdef BONE\n			worldMat=mat3(u_WorldMat*skinTransform);\n		#else\n			worldMat=mat3(u_WorldMat);\n		#endif  \n		v_Normal=worldMat*a_Normal;//TODO:法线可以用"魔法"矩阵\n		#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n			v_Tangent=worldMat*a_Tangent0.xyz;\n			v_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n		#endif\n	#endif\n\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n		#ifdef BONE\n			v_PositionWorld=(u_WorldMat*position).xyz;\n		#else\n			v_PositionWorld=(u_WorldMat*a_Position).xyz;\n		#endif\n	#endif\n	\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n		v_ViewDir=u_CameraPos-v_PositionWorld;\n	#endif\n\n	#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n		v_Texcoord0=a_Texcoord0;\n		#ifdef TILINGOFFSET\n			v_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n			v_Texcoord0=vec2(v_Texcoord0.x,1.0+v_Texcoord0.y);\n		#endif\n	#endif\n\n	#ifdef LIGHTMAP\n		#ifdef SCALEOFFSETLIGHTINGMAPUV\n			#ifdef UV1\n				v_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n			#else\n				v_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n			#endif \n		#else\n			#ifdef UV1\n				v_LightMapUV=a_Texcoord1;\n			#else\n				v_LightMapUV=a_Texcoord0;\n			#endif \n		#endif \n	#endif\n\n	#ifdef COLOR\n		v_Color=a_Color;\n	#endif\n\n	#ifdef RECEIVESHADOW\n		v_posViewZ = gl_Position.w;\n		#ifdef SHADOWMAP_PSSM1 \n			v_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n		#endif\n	#endif\n}\n\nvoid main()\n{\n	#ifdef CASTSHADOW\n		main_castShadow();\n	#else\n		main_normal();\n	#endif\n}',e='#ifdef HIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#ifdef COLOR\n	varying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n	varying vec3 v_ViewDir; \n	#ifdef REFLECTMAP\n		uniform samplerCube u_ReflectTexture;\n		uniform float u_ReflectIntensity;\n		uniform vec3 u_ReflectColor;\n	#endif\n#endif\n\n#ifdef ALPHATEST\n	uniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n	uniform sampler2D u_DiffuseTexture;\n#endif\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n	varying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n	varying vec2 v_LightMapUV;\n	uniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n	uniform vec3 u_MaterialSpecular;\n	uniform float u_Shininess;\n	#ifdef SPECULARMAP \n		uniform sampler2D u_SpecularTexture;\n	#endif\n#endif\n\n#ifdef FOG\n	uniform float u_FogStart;\n	uniform float u_FogRange;\n	#ifdef ADDTIVEFOG\n	#else\n		uniform vec3 u_FogColor;\n	#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n	varying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n	uniform sampler2D u_NormalTexture;\n	varying vec3 v_Tangent;\n	varying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n	uniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n	uniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n	uniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n	varying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n	#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n		uniform mat4 u_lightShadowVP[4];\n	#endif\n	#ifdef SHADOWMAP_PSSM1 \n		varying vec4 v_lightMVPPos;\n	#endif\n#endif\n\nvoid main_castShadow()\n{\n	//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n	gl_FragColor=packDepth(v_posViewZ);\n	#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n		float alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n		if( alpha < u_AlphaTestValue )\n		{\n			discard;\n		}\n	#endif\n}\nvoid main_normal()\n{\n	vec3 globalDiffuse=u_AmbientColor;\n	vec3 globalSpecular=vec3(0.0);\n	\n	#ifdef LIGHTMAP\n		globalDiffuse+=texture2D(u_LightMap, v_LightMapUV).rgb*2.0;\n	#endif\n	\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n		vec3 normal;\n		#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n			vec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n			normal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n		#else\n			normal = normalize(v_Normal);\n		#endif\n		vec3 viewDir= normalize(v_ViewDir);\n	#endif\n	\n	#ifdef REFLECTMAP\n		vec3 incident =-viewDir;\n		vec3 reflectionVector = reflect(incident,normal);\n		vec3 reflectionColor  = textureCube(u_ReflectTexture,vec3(-reflectionVector.x,reflectionVector.yz)).rgb;//转换坐标系\n		globalSpecular= u_ReflectColor*reflectionColor*u_ReflectIntensity;\n	#endif\n	\n	vec4 mainColor=u_DiffuseColor;\n	#ifdef DIFFUSEMAP\n		vec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n		mainColor=mainColor*difTexColor;\n	#endif \n	#ifdef COLOR\n		mainColor=mainColor*v_Color;\n	#endif \n    \n	#ifdef ALPHATEST\n		if(mainColor.a<u_AlphaTestValue)\n			discard;\n	#endif\n  \n	\n	vec3 diffuse = vec3(0.0);\n	vec3 specular= vec3(0.0);\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n		vec3 dif,spe;\n		#ifdef SPECULARMAP\n			vec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n		#else\n			#ifdef DIFFUSEMAP\n				vec3 gloss=vec3(difTexColor.a);\n			#else\n				vec3 gloss=vec3(1.0);\n			#endif\n		#endif\n	#endif\n\n	\n	#ifdef DIRECTIONLIGHT\n		LayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n		diffuse+=dif;\n		specular+=spe;\n	#endif\n \n	#ifdef POINTLIGHT\n		LayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n		diffuse+=dif;\n		specular+=spe;\n	#endif\n\n	#ifdef SPOTLIGHT\n		LayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n		diffuse+=dif;\n		specular+=spe;\n	#endif\n\n	#ifdef RECEIVESHADOW\n		float shadowValue = 1.0;\n		#ifdef SHADOWMAP_PSSM3\n			shadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n		#endif\n		#ifdef SHADOWMAP_PSSM2\n			shadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n		#endif \n		#ifdef SHADOWMAP_PSSM1\n			shadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n		#endif\n		gl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse)*shadowValue,mainColor.a);\n	#else\n		gl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\n	#endif\n\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n		#ifdef RECEIVESHADOW\n			gl_FragColor.rgb+=(globalSpecular+specular)*shadowValue;\n		#else\n			gl_FragColor.rgb+=(globalSpecular+specular);\n		#endif\n	#endif\n	  \n	#ifdef FOG\n		float lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n		#ifdef ADDTIVEFOG\n			gl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n		#else\n			gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n		#endif\n	#endif\n}\n\nvoid main()\n{\n	#ifdef CASTSHADOW		\n		main_castShadow();\n	#else\n	  main_normal();\n	#endif  \n}\n\n';var r=Shader3D.add("BLINNPHONG",i,n,SkinnedMeshSprite3D.shaderDefines,BlinnPhongMaterial.shaderDefines);r._addShaderPass(t,e),i={a_Position:0,a_Color:1},n={u_MvpMatrix:[1,2]},t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  v_Color=a_Color;\n}",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n  gl_FragColor=v_Color; \n}\n\n",r=Shader3D.add("LINE",i,n),r._addShaderPass(t,e),i={a_position:0,a_normal:3,tangent:5,binormal:4,uv:2,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_lodRect:[9,3],irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],u_aoObjPos:[14,1],texBaseColor:[1,1],texNormal:[2,1],texPbrInfo:[3,1],texPrefilterdEnv:[8,3],texHSNoise:[15,1],texPrefilterDiff:[7,3],u_AlphaTestValue:[0,1],texBRDFLUT:[4,1],u_UVAniAge:[5,1],u_roughness:[6,1],u_metaless:[7,1],u_UVMatrix:[8,1],u_UVAge:[9,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},t="\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n#ifdef HAS_TANGENT\nattribute vec3 tangent;\nattribute vec3 binormal;\n#endif\nattribute vec2 uv;\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\n\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\nvoid main() {\n#ifdef BONE\n	mat4 skinTransform=mat4(0.0);\n	skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n	skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n	skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n	skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n	gl_Position = mvp*skinTransform*vec4(a_position,1.);\n	mat4 modelMat = modelMatrix*skinTransform;\n#else\n	gl_Position = mvp*vec4(a_position,1.);\n	mat4 modelMat = modelMatrix;\n#endif	\n	vWorldPos = modelMat*vec4(a_position,1.);\n\n#ifdef CASTSHADOW \n	#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n		vUv = uv;\n	#endif	\n#else\n    vUv = uv;\n	vWorldNorm = normalize((modelMat*vec4(a_normal,0.0)).xyz);\n	#ifdef HAS_TANGENT\n	vWorldTangent = normalize((modelMat*vec4(tangent,0.0)).xyz);\n	vWorldBinormal = normalize((modelMat*vec4(binormal,0.0)).xyz);\n	#endif\n    \n    vViewDir = (vWorldPos.xyz-cameraPosition);//这个不能normalize。否则无法线性差值了\n#ifdef RECEIVESHADOW\n	v_posViewZ = gl_Position.z;\n	#ifdef SHADOWMAP_PSSM1 \n		v_lightMVPPos = u_lightShadowVP[0] * vWorldPos;\n	#endif\n#endif	\n#endif\n}\n",e='//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\nvarying vec3 vViewDir;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n//预计算的贴图\nuniform sampler2D texPrefilterdEnv;\nuniform sampler2D texBRDFLUT;\nuniform sampler2D texPrefilterDiff;\n#ifdef HAS_PBRINFO\nuniform sampler2D texPbrInfo;   //Ao, Roughness, Metallic\n#endif\nuniform float u_hdrexposure;\nuniform float u_AlphaTestValue;\n\nuniform float u_roughness;\nuniform float u_metaless;\nconst float maxlv = 7.;	//现在只支持512分辨率的环境贴图\nconst int nmaxlv = 9;//\n							\nuniform mat4 irrad_mat_red;\nuniform mat4 irrad_mat_green;\nuniform mat4 irrad_mat_blue;							\n\nvec3 speccontrib = vec3(0.);\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\nvec4 tex2dLod(sampler2D tex, float u, float v, float lod){\n	vec2 uv = vec2(u,v);\n	uv+=mod(gl_FragCoord.xy-vec2(0.5),2.0)*vec2(128.,0.);\n	return texture2D(tex,uv,lod-16.);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n	float envu = atan(dir.z,dir.x)/_2PI+0.5; 	\n	float envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n	return texture2D(tex,vec2(envu,envv));\n}\n\nvec4 texPanoramaLod(sampler2D tex, const in vec3 dir, float lod){\n	float envu = atan(dir.z,dir.x)/_2PI+0.5; 	\n	float envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n	return tex2dLod(tex,envu,envv,lod);\n}\n\n/*\n    计算sh光照。\n    使用level=2，所以需要9个系数。\n    https://cseweb.ucsd.edu/~ravir/papers/envmap/envmap.pdf\n*/\nfloat environment_exposure = 1.0;\nvec3 diff_sh9(vec3 dir){\n	vec4 shDir = vec4(dir.x,-dir.z,dir.y,1.0);\n  return max(vec3(0.0), vec3(\n	dot(shDir, irrad_mat_red * shDir),\n	dot(shDir, irrad_mat_green * shDir),\n	dot(shDir, irrad_mat_blue * shDir)\n	)) * environment_exposure;	\n}\n\n#ifdef HAS_TANGENT\nvec3 applyNormalTex( vec3 norm, vec3 surf_norm ) {\n    vec3 mapN = norm * 2.0 - 1.0;\n    //mapN.xy = normalScale * mapN.xy;\n    mat3 tsn = mat3( vWorldTangent, vWorldBinormal, surf_norm );\n    return normalize( tsn * mapN );\n}\n#endif\n\nvec4 pbrlight(vec3 normal, float rough, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n	basecolor.rgb = pow(basecolor.rgb,vec3(2.2));\n	float metaless = 1.0; 	\n	const float ismetalinfov = (128./255.);\n	if(basecolor.a>=ismetalinfov){//这时候表示金属度\n		metaless = (basecolor.a-ismetalinfov)*2.;\n		basecolor.a = 1.0;\n	}else{\n		metaless = 0.;\n		basecolor.a = basecolor.a*2.0;\n	}\n	#ifdef FIX_METALESS\n	metaless = u_metaless;\n	#endif\n	#ifdef HAS_PBRINFO	\n	vec4 pbrinfo = texture2D(texPbrInfo, vUv);\n	metaless = pbrinfo.b;\n	rough = pbrinfo.g;\n	#endif\n    const vec3 nonmetalF0 =vec3(0.02);\n    vec3 F0 =  mix(nonmetalF0, basecolor.rgb, metaless);\n	\n    vec4 PrefilteredColor = texPanoramaLod(texPrefilterdEnv, R, rough*maxlv);\n    PrefilteredColor.rgb = _RGBEToRGB(PrefilteredColor);\n    vec4 EnvBRDF = texture2D(texBRDFLUT,vec2(rough , NoV));//TODO lod\n    vec2 rg = _RGBAToU16(EnvBRDF);    \n    speccontrib = (F0* rg.x + saturate( 50.0 * PrefilteredColor.g ) * rg.y);\n	vec3 color_spec = PrefilteredColor.rgb*speccontrib;\n	\n	vec3 color_diff=diff_sh9(normal);\n	vec3 outc =  color_diff*mix(basecolor.rgb,vec3(0.),metaless)*(vec3(1.0)-speccontrib)+color_spec;\n	#ifdef HAS_PBRINFO\n	outc*=pbrinfo.r;\n	#endif\n	return vec4(outc, basecolor.a);\n}\n\nvec3 oldlight(vec4 normal, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n	const vec3 lightdir=normalize(vec3(1.,1.,0.));\n	const vec3 spcecol = vec3(1.,0.8,0.8);\n	const vec3 amb = vec3(0.5);\n	vec3 diffv =  (vec3(saturate(dot(lightdir,normal.xyz)))+amb);\n	//vec3 spec = spcecol* pow(saturate(dot(R,lightdir)),(1.-pbrinfo.g)*5.);\n	return diffv*basecolor.rgb;//+spec;\n}\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n	#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n	uniform mat4 u_lightShadowVP[4];\n	#endif\n	#ifdef SHADOWMAP_PSSM1 \n	varying vec4 v_lightMVPPos;\n	#endif\n#endif\n\nvoid main() {\n#ifdef CASTSHADOW\n	gl_FragColor=packDepth(gl_FragCoord.w);\n	#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n		float alpha = texture2D(texBaseColor,vUv).w;\n		if( alpha < u_AlphaTestValue ){\n			discard;\n		}\n	#endif\n#else\n\n	#ifdef RECEIVESHADOW\n		float shadowValue = 1.0;\n		#ifdef SHADOWMAP_PSSM3\n			shadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n		#endif\n		#ifdef SHADOWMAP_PSSM2\n			shadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n		#endif \n		#ifdef SHADOWMAP_PSSM1\n			shadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.0001);\n		#endif\n	#endif	\n	\n    vec3 normal =  normalize(vWorldNorm);\n	vec4 normtex = texture2D( texNormal, vUv );\n	#ifdef HAS_TANGENT	\n	normal = applyNormalTex(normtex.xyz, normal);\n	#endif\n    vec3 view   = -normalize(vViewDir);\n    float NoV = saturate(dot( view, normal ));\n    vec3 R = 2. * NoV * normal - view;\n	float roughness = normtex.a;\n	#ifdef FIX_ROUGHNESS\n	roughness = u_roughness;\n	#endif\n	\n	vec4 pbrl = pbrlight(normal,roughness,NoV,R)*u_hdrexposure;\n    gl_FragColor.rgb =  pow(pbrl.rgb,vec3(0.45455));\n	//gl_FragColor.rgb = oldlight(normtex,NoV,R);\n	#ifdef RECEIVESHADOW\n	gl_FragColor.rgb *= max(shadowValue,0.7);\n	#endif\n	\n    gl_FragColor.a = pbrl.a;\n\n#endif\n}\n',r=Shader3D.add("PBR",i,n,SkinnedMeshSprite3D.shaderDefines,PBRMaterial.shaderDefines),r._addShaderPass(t,e),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_EmissionColor:[8,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_MetallicGlossTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_metallic:[9,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[18,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_ReflectTexture:[22,4],u_ReflectIntensity:[23,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n	uniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n	  varying vec4 v_lightMVPPos;\n	  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n	const int c_MaxBoneCount = 24;\n	attribute vec4 a_BoneIndices;\n	attribute vec4 a_BoneWeights;\n	uniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n	#ifdef BONE\n		mat4 skinTransform=mat4(0.0);\n		skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n		skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n		skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n		skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n		vec4 position = skinTransform * a_Position;\n		gl_Position = u_MvpMatrix * position;\n	#else\n		gl_Position = u_MvpMatrix * a_Position;\n	#endif\n	 \n	//TODO没考虑UV动画呢\n	#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n		v_Texcoord0 = a_Texcoord0;\n	#endif\n		v_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n	mat3 worldMat;\n	#ifdef BONE\n		mat4 skinTransform = mat4(0.0);\n		skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n		skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n		skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n		skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n		vec4 position = skinTransform * a_Position;\n		gl_Position = u_MvpMatrix * position;\n		worldMat=mat3(u_WorldMat*skinTransform);\n		v_PositionWorld = (u_WorldMat * position).xyz;\n	#else\n		gl_Position = u_MvpMatrix * a_Position;\n		worldMat = mat3(u_WorldMat);\n		v_PositionWorld = (u_WorldMat * a_Position).xyz;\n	#endif\n	\n	v_Normal = worldMat * a_Normal;\n	v_Tangent = worldMat * a_Tangent0.xyz;\n	v_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n	v_Texcoord0 = a_Texcoord0;\n	#ifdef TILINGOFFSET\n		v_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n	#endif\n		v_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n	v_ViewDir = u_CameraPos - v_PositionWorld;\n  \n	#ifdef RECEIVESHADOW\n		v_posViewZ = gl_Position.w;\n		#ifdef SHADOWMAP_PSSM1 \n			v_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n		#endif\n	#endif\n}\n\nvoid main()\n{\n	#ifdef CASTSHADOW\n		main_castShadow();\n	#else\n		main_normal();\n	#endif\n}",e='#ifdef FSHIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\n\n#ifdef DIFFUSETEXTURE\n	uniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef METALLICGLOSSTEXTURE\n	uniform sampler2D u_MetallicGlossTexture;\n#endif\n#ifdef NORMALTEXTURE\n	uniform sampler2D u_NormalTexture;\n	uniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n	uniform sampler2D u_ParallaxTexture;\n	uniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n	uniform sampler2D u_OcclusionTexture;\n	uniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n	#ifdef EMISSIONTEXTURE\n		uniform sampler2D u_EmissionTexture;\n	#endif\n	uniform vec4 u_EmissionColor;\n#endif\n#ifdef REFLECTMAP\n	uniform samplerCube u_ReflectTexture;\n	uniform float u_ReflectIntensity;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRStandardLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n	#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n		uniform mat4 u_lightShadowVP[4];\n	#endif\n	#ifdef SHADOWMAP_PSSM1 \n		varying vec4 v_lightMVPPos;\n	#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n	gl_FragColor=packDepth(v_posViewZ);\n	#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n		float alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n		if( alpha < u_AlphaTestValue )\n		{\n			discard;\n		}\n	#endif\n}\n\nvoid main_normal()\n{	\n	vec3 viewDir = normalize(v_ViewDir);\n	\n	vec2 uv0 = ParallaxOffset(viewDir);\n	\n	vec2 mg;\n	#ifdef DIFFUSETEXTURE\n		vec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n		vec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n		mg = MetallicGloss(diffuseTextureColor.a, uv0);\n	#else\n		vec4 diffuseColor = u_DiffuseColor;\n		mg = MetallicGloss(1.0, uv0);\n	#endif\n	\n	#ifdef ALPHATEST\n		if(diffuseColor.a < u_AlphaTestValue)\n			discard;\n	#endif\n	\n	gl_FragColor = diffuseColor;\n	\n	vec3 normal = UnpackScaleNormal(uv0);\n  \n	LayaGI gi;\n	gi.diffuse = (u_AmbientColor * Occlusion(uv0)).rgb;\n	gi.specular = ReflectCubeMap(viewDir, normal);\n  \n	vec4 color = PBRStandardDiectionLight(diffuseColor.rgb, mg.r, mg.g, normal, viewDir, u_DirectionLight, gi);\n	\n	color.a = diffuseColor.a;\n	\n	#ifdef EMISSION\n		vec4 emissionColor = u_EmissionColor;\n		#ifdef EMISSIONTEXTURE\n			emissionColor *=  texture2D(u_EmissionTexture, uv0);\n		#endif\n		color.rgb += emissionColor.rgb;\n	#endif\n	\n	#ifdef RECEIVESHADOW\n		float shadowValue = 1.0;\n		#ifdef SHADOWMAP_PSSM3\n			shadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n		#endif\n		#ifdef SHADOWMAP_PSSM2\n			shadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n		#endif \n		#ifdef SHADOWMAP_PSSM1\n			shadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n		#endif\n		gl_FragColor = vec4(color.rgb * shadowValue, color.a);\n	#else\n		gl_FragColor = color;\n	#endif\n}\n\nvoid main()\n{\n	#ifdef CASTSHADOW		\n		main_castShadow();\n	#else\n		main_normal();\n	#endif  \n}\n\n',r=Shader3D.add("PBRStandard",i,n,SkinnedMeshSprite3D.shaderDefines,PBRStandardMaterial.shaderDefines),r._addShaderPass(t,e),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_SpecularColor:[8,1],u_EmissionColor:[9,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_SpecularTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[18,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_ReflectTexture:[22,4],u_ReflectIntensity:[23,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n	uniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n	  varying vec4 v_lightMVPPos;\n	  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n	const int c_MaxBoneCount = 24;\n	attribute vec4 a_BoneIndices;\n	attribute vec4 a_BoneWeights;\n	uniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n	#ifdef BONE\n		mat4 skinTransform=mat4(0.0);\n		skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n		skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n		skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n		skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n		vec4 position = skinTransform * a_Position;\n		gl_Position = u_MvpMatrix * position;\n	#else\n		gl_Position = u_MvpMatrix * a_Position;\n	#endif\n	 \n	//TODO没考虑UV动画呢\n	#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n		v_Texcoord0 = a_Texcoord0;\n	#endif\n		v_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n	mat3 worldMat;\n	#ifdef BONE\n		mat4 skinTransform = mat4(0.0);\n		skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n		skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n		skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n		skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n		vec4 position = skinTransform * a_Position;\n		gl_Position = u_MvpMatrix * position;\n		worldMat=mat3(u_WorldMat*skinTransform);\n		v_PositionWorld = (u_WorldMat * position).xyz;\n	#else\n		gl_Position = u_MvpMatrix * a_Position;\n		worldMat = mat3(u_WorldMat);\n		v_PositionWorld = (u_WorldMat * a_Position).xyz;\n	#endif\n	\n	v_Normal = worldMat * a_Normal;\n	v_Tangent = worldMat * a_Tangent0.xyz;\n	v_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n	v_Texcoord0 = a_Texcoord0;\n	#ifdef TILINGOFFSET\n		v_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n	#endif\n		v_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n	v_ViewDir = u_CameraPos - v_PositionWorld;\n  \n	#ifdef RECEIVESHADOW\n		v_posViewZ = gl_Position.w;\n		#ifdef SHADOWMAP_PSSM1 \n			v_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n		#endif\n	#endif\n}\n\nvoid main()\n{\n	#ifdef CASTSHADOW\n		main_castShadow();\n	#else\n		main_normal();\n	#endif\n}",e='#ifdef FSHIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\nuniform vec4 u_SpecularColor;\n\n#ifdef DIFFUSETEXTURE\n	uniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef SPECULARTEXTURE\n	uniform sampler2D u_SpecularTexture;\n#endif\n#ifdef NORMALTEXTURE\n	uniform sampler2D u_NormalTexture;\n	uniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n	uniform sampler2D u_ParallaxTexture;\n	uniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n	uniform sampler2D u_OcclusionTexture;\n	uniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n	#ifdef EMISSIONTEXTURE\n		uniform sampler2D u_EmissionTexture;\n	#endif\n	uniform vec4 u_EmissionColor;\n#endif\n#ifdef REFLECTMAP\n	uniform samplerCube u_ReflectTexture;\n	uniform float u_ReflectIntensity;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRSpecularLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n	#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n		uniform mat4 u_lightShadowVP[4];\n	#endif\n	#ifdef SHADOWMAP_PSSM1 \n		varying vec4 v_lightMVPPos;\n	#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n	gl_FragColor=packDepth(v_posViewZ);\n	#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n		float alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n		if( alpha < u_AlphaTestValue )\n		{\n			discard;\n		}\n	#endif\n}\n\nvoid main_normal()\n{	\n	vec3 viewDir = normalize(v_ViewDir);\n	\n	vec2 uv0 = ParallaxOffset(viewDir);\n	\n	vec4 sg;\n	#ifdef DIFFUSETEXTURE\n		vec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n		vec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n		sg = SpecularGloss(diffuseTextureColor.a, uv0);\n	#else\n		vec4 diffuseColor = u_DiffuseColor;\n		sg = SpecularGloss(1.0, uv0);\n	#endif\n	\n	#ifdef ALPHATEST\n		if(diffuseColor.a < u_AlphaTestValue)\n			discard;\n	#endif\n  \n	vec3 normal = UnpackScaleNormal(uv0);\n	\n	LayaGI gi;\n	gi.diffuse = (u_AmbientColor * Occlusion(uv0)).rgb;\n	gi.specular = ReflectCubeMap(viewDir, normal);\n	\n	//float a = (sg.r+sg.g+sg.b) / 3.0;\n  \n	vec4 color = PBRSpecularDiectionLight(diffuseColor.rgb, sg.rgb, sg.a, normal,viewDir, u_DirectionLight, gi);\n	\n	color.a = diffuseColor.a;\n	\n	#ifdef EMISSION\n		vec4 emissionColor = u_EmissionColor;\n		#ifdef EMISSIONTEXTURE\n			emissionColor *=  texture2D(u_EmissionTexture, uv0);\n		#endif\n		color.rgb += emissionColor.rgb;\n	#endif\n	\n	#ifdef RECEIVESHADOW\n		float shadowValue = 1.0;\n		#ifdef SHADOWMAP_PSSM3\n			shadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n		#endif\n		#ifdef SHADOWMAP_PSSM2\n			shadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n		#endif \n		#ifdef SHADOWMAP_PSSM1\n			shadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n		#endif\n		gl_FragColor = vec4(color.rgb * shadowValue, color.a);\n	#else\n		gl_FragColor = color;\n	#endif\n}\n\nvoid main()\n{\n	#ifdef CASTSHADOW		\n		main_castShadow();\n	#else\n		main_normal();\n	#endif  \n}\n\n',r=Shader3D.add("PBRSpecular",i,n,SkinnedMeshSprite3D.shaderDefines,PBRSpecularMaterial.shaderDefines),r._addShaderPass(t,e),i={a_Position:0,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_AlbedoTexture:[1,1],u_AlbedoColor:[2,1],u_TilingOffset:[3,1],u_AlphaTestValue:[0,1],u_MvpMatrix:[1,2],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4]},t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#ifdef TILINGOFFSET\n	uniform vec4 u_TilingOffset;\n#endif\n\n#ifdef BONE\n	const int c_MaxBoneCount = 24;\n	attribute vec4 a_BoneIndices;\n	attribute vec4 a_BoneWeights;\n	uniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main()\n{\n	#ifdef BONE\n		mat4 skinTransform = mat4(0.0);\n		skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n		skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n		skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n		skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n		vec4 position = skinTransform * a_Position;\n		gl_Position = u_MvpMatrix * position;\n	#else\n		gl_Position = u_MvpMatrix * a_Position;\n	#endif\n	\n	v_Texcoord0 = a_Texcoord0;\n	#ifdef TILINGOFFSET\n		v_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n	#endif\n		v_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n}",e="#ifdef FSHIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\n\n#ifdef ALBEDOTEXTURE\n	uniform sampler2D u_AlbedoTexture;\n#endif\n\nuniform vec4 u_AlbedoColor;\n\n#ifdef ALPHATEST\n	uniform float u_AlphaTestValue;\n#endif\n\nvoid main()\n{\n	vec4 color =  u_AlbedoColor;\n	#ifdef ALBEDOTEXTURE\n		color *= texture2D(u_AlbedoTexture, v_Texcoord0);\n	#endif\n	\n	#ifdef ALPHATEST\n		if(color.a < u_AlphaTestValue)\n			discard;\n	#endif\n	\n	gl_FragColor = color;\n}\n\n",r=Shader3D.add("Unlit",i,n,SkinnedMeshSprite3D.shaderDefines,UnlitMaterial.shaderDefines),r._addShaderPass(t,e),i={a_CornerTextureCoordinate:17,a_MeshPosition:0,a_MeshColor:1,a_MeshTextureCoordinate:2,a_ShapePositionStartLifeTime:30,a_DirectionTime:32,a_StartColor:19,a_EndColor:23,a_StartSize:20,a_StartRotation0:22,a_StartSpeed:31,a_Random0:34,a_Random1:35,a_SimulationWorldPostion:36,a_SimulationWorldRotation:37},n={u_Tintcolor:[2,1],u_TilingOffset:[3,1],u_texture:[1,1],u_WorldPosition:[0,2],u_WorldRotation:[1,2],u_PositionScale:[4,2],u_SizeScale:[5,2],u_ScalingMode:[6,2],u_Gravity:[7,2],u_ThreeDStartRotation:[8,2],u_StretchedBillboardLengthScale:[9,2],u_StretchedBillboardSpeedScale:[10,2],u_SimulationSpace:[11,2],u_CurrentTime:[12,2],u_ColorOverLifeGradientAlphas:[22,2],u_ColorOverLifeGradientColors:[23,2],u_MaxColorOverLifeGradientAlphas:[24,2],u_MaxColorOverLifeGradientColors:[25,2],u_VOLVelocityConst:[13,2],u_VOLVelocityGradientX:[14,2],u_VOLVelocityGradientY:[15,2],u_VOLVelocityGradientZ:[16,2],u_VOLVelocityConstMax:[17,2],u_VOLVelocityGradientMaxX:[18,2],u_VOLVelocityGradientMaxY:[19,2],u_VOLVelocityGradientMaxZ:[20,2],u_VOLSpaceType:[21,2],u_SOLSizeGradient:[26,2],u_SOLSizeGradientX:[27,2],u_SOLSizeGradientY:[28,2],u_SOLSizeGradientZ:[29,2],u_SOLSizeGradientMax:[30,2],u_SOLSizeGradientMaxX:[31,2],u_SOLSizeGradientMaxY:[32,2],u_SOLSizeGradientMaxZ:[33,2],u_ROLAngularVelocityConst:[34,2],u_ROLAngularVelocityConstSeprarate:[35,2],u_ROLAngularVelocityGradient:[36,2],u_ROLAngularVelocityGradientX:[37,2],u_ROLAngularVelocityGradientY:[38,2],u_ROLAngularVelocityGradientZ:[39,2],u_ROLAngularVelocityGradientW:[40,2],u_ROLAngularVelocityConstMax:[41,2],u_ROLAngularVelocityConstMaxSeprarate:[42,2],u_ROLAngularVelocityGradientMax:[43,2],u_ROLAngularVelocityGradientMaxX:[44,2],u_ROLAngularVelocityGradientMaxY:[45,2],u_ROLAngularVelocityGradientMaxZ:[46,2],u_ROLAngularVelocityGradientMaxW:[47,2],u_TSACycles:[48,2],u_TSASubUVLength:[49,2],u_TSAGradientUVs:[50,2],u_TSAMaxGradientUVs:[51,2],u_CameraPosition:[0,3],u_CameraDirection:[5,3],u_CameraUp:[6,3],u_View:[1,3],u_Projection:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4]},t="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n	attribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n	attribute vec3 a_MeshPosition;\n	attribute vec4 a_MeshColor;\n	attribute vec2 a_MeshTextureCoordinate;\n	varying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying float v_Discard;\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n	varying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n	uniform vec3 u_CameraPosition;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n	uniform  vec2 u_ROLAngularVelocityGradientW[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n	uniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef FOG\n	varying vec3 v_PositionWorld;\n#endif\n\n#ifdef TILINGOFFSET\n	uniform vec4 u_TilingOffset;\n#endif\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n	float halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n	float halfYaw = rot.y * 0.5;\n\n	float sinRoll = sin(halfRoll);\n	float cosRoll = cos(halfRoll);\n	float sinPitch = sin(halfPitch);\n	float cosPitch = cos(halfPitch);\n	float sinYaw = sin(halfYaw);\n	float cosYaw = cos(halfYaw);\n\n	float quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n	float quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n	float quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n	float quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n	\n	//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n	//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n	//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n	\n	float x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n	float xx = quaX * x;\n    float xy = quaX * y;\n	float xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n	\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n	float halfAngle = angle * 0.5;\n	float sin = sin(halfAngle);\n	\n	float quaX = axis.x * sin;\n	float quaY = axis.y * sin;\n	float quaZ = axis.z * sin;\n	float quaW = cos(halfAngle);\n	\n	//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n	//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n	//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n	\n	float x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n	float xx = quaX * x;\n    float xy = quaX * y;\n	float xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n	\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n	return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n	float curValue;\n	for(int i=1;i<4;i++)\n	{\n		vec2 gradientNumber=gradientNumbers[i];\n		float key=gradientNumber.x;\n		if(key>=normalizedAge)\n		{\n			vec2 lastGradientNumber=gradientNumbers[i-1];\n			float lastKey=lastGradientNumber.x;\n			float age=(normalizedAge-lastKey)/(key-lastKey);\n			curValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n			break;\n		}\n	}\n	return curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n	float totalValue=0.0;\n	for(int i=1;i<4;i++)\n	{\n		vec2 gradientNumber=gradientNumbers[i];\n		float key=gradientNumber.x;\n		vec2 lastGradientNumber=gradientNumbers[i-1];\n		float lastValue=lastGradientNumber.y;\n		\n		if(key>=normalizedAge){\n			float lastKey=lastGradientNumber.x;\n			float age=(normalizedAge-lastKey)/(key-lastKey);\n			totalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n			break;\n		}\n		else{\n			totalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n		}\n	}\n	return totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n	vec4 overTimeColor;\n	for(int i=1;i<4;i++)\n	{\n		vec2 gradientAlpha=gradientAlphas[i];\n		float alphaKey=gradientAlpha.x;\n		if(alphaKey>=normalizedAge)\n		{\n			vec2 lastGradientAlpha=gradientAlphas[i-1];\n			float lastAlphaKey=lastGradientAlpha.x;\n			float age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n			overTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n			break;\n		}\n	}\n	\n	for(int i=1;i<4;i++)\n	{\n		vec4 gradientColor=gradientColors[i];\n		float colorKey=gradientColor.x;\n		if(colorKey>=normalizedAge)\n		{\n			vec4 lastGradientColor=gradientColors[i-1];\n			float lastColorKey=lastGradientColor.x;\n			float age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n			overTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n			break;\n		}\n	}\n	return overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n	float overTimeFrame;\n	for(int i=1;i<4;i++)\n	{\n		vec2 gradientFrame=gradientFrames[i];\n		float key=gradientFrame.x;\n		if(key>=normalizedAge)\n		{\n			vec2 lastGradientFrame=gradientFrames[i-1];\n			float lastKey=lastGradientFrame.x;\n			float age=(normalizedAge-lastKey)/(key-lastKey);\n			overTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n			break;\n		}\n	}\n	return floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n	 outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n	 outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n	                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n					 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n					\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n	#ifdef VELOCITYOVERLIFETIMECONSTANT\n		  startPosition=startVelocity*age;\n		  lifePosition=lifeVelocity*age;\n	#endif\n	#ifdef VELOCITYOVERLIFETIMECURVE\n		  startPosition=startVelocity*age;\n		  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n	#endif\n	#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n		  startPosition=startVelocity*age;\n		  lifePosition=lifeVelocity*age;\n	#endif\n	#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n		  startPosition=startVelocity*age;\n		  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n	      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n	      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n	#endif\n	\n	vec3 finalPosition;\n	if(u_VOLSpaceType==0){\n	  if(u_ScalingMode!=2)\n	   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n	  else\n	   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n	}\n	else{\n	  if(u_ScalingMode!=2)\n	    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n	  else\n	    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n	}\n  #else\n	 startPosition=startVelocity*age;\n	 vec3 finalPosition;\n	 if(u_ScalingMode!=2)\n	   finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n	 else\n	   finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n	#ifdef COLOROVERLIFETIME\n	  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n	#endif\n	\n	#ifdef RANDOMCOLOROVERLIFETIME\n	  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n	#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n	#ifdef SIZEOVERLIFETIMECURVE\n		size*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n	#endif\n	#ifdef SIZEOVERLIFETIMERANDOMCURVES\n	    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n	#endif\n	#ifdef SIZEOVERLIFETIMECURVESEPERATE\n		size*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n	#endif\n	#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n	    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n	    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n	#endif\n	return size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n	#ifdef SIZEOVERLIFETIMECURVE\n		size*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n	#endif\n	#ifdef SIZEOVERLIFETIMERANDOMCURVES\n	    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n	#endif\n	#ifdef SIZEOVERLIFETIMECURVESEPERATE\n		size*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n	#endif\n	#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n	    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n	    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n		,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n	#endif\n	return size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n	#ifdef ROTATIONOVERLIFETIME\n		#ifdef ROTATIONOVERLIFETIMECONSTANT\n			float ageRot=u_ROLAngularVelocityConst*age;\n	        rotation+=ageRot;\n		#endif\n		#ifdef ROTATIONOVERLIFETIMECURVE\n			rotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n		#endif\n		#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n			float ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n	        rotation+=ageRot;\n	    #endif\n		#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n			rotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n		#endif\n	#endif\n	#ifdef ROTATIONOVERLIFETIMESEPERATE\n		#ifdef ROTATIONOVERLIFETIMECONSTANT\n			float ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n	        rotation+=ageRot;\n		#endif\n		#ifdef ROTATIONOVERLIFETIMECURVE\n			rotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n		#endif\n		#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n			float ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n	        rotation+=ageRot;\n	    #endif\n		#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n			rotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n		#endif\n	#endif\n	return rotation;\n}\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n	#ifdef ROTATIONOVERLIFETIME\n	#ifdef ROTATIONOVERLIFETIMECONSTANT\n			float ageRot=u_ROLAngularVelocityConst*age;\n	        rotation+=ageRot;\n		#endif\n		#ifdef ROTATIONOVERLIFETIMECURVE\n			rotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n		#endif\n		#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n			float ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n	        rotation+=ageRot;\n	    #endif\n		#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n			rotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n		#endif\n	#endif\n	#ifdef ROTATIONOVERLIFETIMESEPERATE\n	#ifdef ROTATIONOVERLIFETIMECONSTANT\n			vec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n	        rotation+=ageRot;\n		#endif\n		#ifdef ROTATIONOVERLIFETIMECURVE\n			rotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n		#endif\n		#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n			vec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n	        rotation+=ageRot;\n	    #endif\n		#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n			rotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n	        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n	        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n		#endif\n	#endif\n	return rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n	#ifdef TEXTURESHEETANIMATIONCURVE\n		float cycleNormalizedAge=normalizedAge*u_TSACycles;\n		float frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n		float totalULength=frame*u_TSASubUVLength.x;\n		float floorTotalULength=floor(totalULength);\n	    uv.x+=totalULength-floorTotalULength;\n		uv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n	#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n		float cycleNormalizedAge=normalizedAge*u_TSACycles;\n		float uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n	    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n		float totalULength=frame*u_TSASubUVLength.x;\n		float floorTotalULength=floor(totalULength);\n	    uv.x+=totalULength-floorTotalULength;\n		uv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n	return uv;\n}\n\nvoid main()\n{\n	float age = u_CurrentTime - a_DirectionTime.w;\n	float normalizedAge = age/a_ShapePositionStartLifeTime.w;\n	vec3 lifeVelocity;\n	if(normalizedAge<1.0){ \n	vec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n	#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n		lifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n	#endif \n	vec3 gravityVelocity=u_Gravity*age;\n	\n	vec4 worldRotation;\n	if(u_SimulationSpace==0)\n		worldRotation=a_SimulationWorldRotation;\n	else\n		worldRotation=u_WorldRotation;\n	\n	vec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n   \n   \n   #ifdef SPHERHBILLBOARD\n		vec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        vec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n        vec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n	    corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n		#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n			if(u_ThreeDStartRotation){\n				vec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n				center += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n			}\n			else{\n				float rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n				float c = cos(rot);\n				float s = sin(rot);\n				mat2 rotation= mat2(c, -s, s, c);\n				corner=rotation*corner;\n				center += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n			}\n		#else\n			if(u_ThreeDStartRotation){\n				center += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n			}\n			else{\n				float c = cos(a_StartRotation0.x);\n				float s = sin(a_StartRotation0.x);\n				mat2 rotation= mat2(c, -s, s, c);\n				corner=rotation*corner;\n				center += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n			}\n		#endif\n   #endif\n   \n   #ifdef STRETCHEDBILLBOARD\n	vec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n	vec3 velocity;\n	#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n	    if(u_VOLSpaceType==0)\n		  velocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n	    else\n		  velocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n    #else\n	    velocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n    #endif	\n		vec3 cameraUpVector = normalize(velocity);\n		vec3 direction = normalize(center-u_CameraPosition);\n        vec3 sideVector = normalize(cross(direction,normalize(velocity)));\n		\n		sideVector=u_SizeScale.xzy*sideVector;\n		cameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n		\n	    vec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n		\n	    const mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n	    corner=rotaionZHalfPI*corner;\n	    corner.y=corner.y-abs(corner.y);\n		\n	    float speed=length(velocity);//TODO:\n	    center +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef HORIZONTALBILLBOARD\n		vec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n	    const vec3 sideVector = vec3(-1.0,0.0,0.0);\n		\n		float rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n	    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n		corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef VERTICALBILLBOARD\n		vec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n		\n		float rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n	    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n		corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef RENDERMODE_MESH\n	    vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n		#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n			if(u_ThreeDStartRotation){\n				vec3 rotation=vec3(a_StartRotation0.xy,-computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n				center+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n			}\n			else{\n				#ifdef ROTATIONOVERLIFETIME\n					float angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n					if(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n						center+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n					}\n					else{\n						#ifdef SHAPE\n							center+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n						#else\n							if(u_SimulationSpace==0)\n								center+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n							else if(u_SimulationSpace==1)\n								center+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n						#endif\n					}\n				#endif\n				#ifdef ROTATIONOVERLIFETIMESEPERATE\n					//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n					vec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,a_StartRotation0.z), age,normalizedAge);\n					center+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n				#endif		\n			}\n		#else\n			if(u_ThreeDStartRotation){\n				center+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n			}\n			else{\n				if(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n					if(u_SimulationSpace==0)\n						center+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n					else if(u_SimulationSpace==1)\n						center+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n				}\n				else{\n					#ifdef SHAPE\n						if(u_SimulationSpace==0)\n							center+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n						else if(u_SimulationSpace==1)\n							center+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);	\n					#else\n						if(u_SimulationSpace==0)\n							center+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n						else if(u_SimulationSpace==1)\n							center+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n					#endif\n				}\n			}\n		#endif\n		v_MeshColor=a_MeshColor;\n   #endif\n   \n    gl_Position=u_Projection*u_View*vec4(center,1.0);\n    v_Color = computeParticleColor(a_StartColor, normalizedAge);\n	#ifdef DIFFUSEMAP\n		#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n			v_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n		#endif\n		#ifdef RENDERMODE_MESH\n			v_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n		#endif\n		\n		#ifdef TILINGOFFSET\n			v_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y)*u_TilingOffset.xy+vec2(u_TilingOffset.z,-u_TilingOffset.w);//需要特殊处理\n			v_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y);//需要特殊处理\n		#endif\n	#endif\n    v_Discard=0.0;\n	  \n	#ifdef FOG\n		v_PositionWorld=center;\n	#endif\n   }\n   else\n	{\n		v_Discard=1.0;\n	}\n}\n\n",e="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying float v_Discard;\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n	varying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n	varying vec3 v_PositionWorld;\n	uniform vec3 u_CameraPosition;\n	uniform float u_FogStart;\n	uniform float u_FogRange;\n	#ifdef ADDTIVEFOG\n	#else\n		uniform vec3 u_FogColor;\n	#endif\n#endif\n\n\nvoid main()\n{	\n	#ifdef RENDERMODE_MESH\n		gl_FragColor=v_MeshColor;\n	#else\n		gl_FragColor=vec4(1.0);	\n	#endif\n		\n	#ifdef DIFFUSEMAP\n		if(v_Discard!=0.0)\n			discard;\n		#ifdef TINTCOLOR\n			gl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n		#else\n			gl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n		#endif\n	#else\n		#ifdef TINTCOLOR\n			gl_FragColor*=u_Tintcolor*2.0*v_Color;\n		#else\n			gl_FragColor*=v_Color;\n		#endif\n	#endif\n	\n	#ifdef FOG\n		vec3 toEye=u_CameraPosition-v_PositionWorld;\n		float toEyeLength=length(toEye);\n		toEye/=toEyeLength;\n		\n		float lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n		#ifdef ADDTIVEFOG\n			gl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n		#else\n			gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n		#endif\n	#endif\n}",r=Shader3D.add("PARTICLESHURIKEN",i,n,ShuriKenParticle3D.shaderDefines,ShurikenParticleMaterial.shaderDefines),r._addShaderPass(t,e),i={a_Position:0},n={u_TintColor:[1,1],u_Exposure:[2,1],u_Rotation:[3,1],u_CubeTexture:[4,1],u_MvpMatrix:[4,3]},t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nuniform float u_Rotation;\nvarying vec3 v_Texcoord;\n\n\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\n{\n	float angle = degrees * 3.141593 / 180.0;\n	float sina=sin(angle);\n	float cosa=cos(angle);\n	mat2 m = mat2(cosa, -sina, sina, cosa);\n	return vec4(m*vertex.xz, vertex.yw).xzyw;\n}\n		\nvoid main()\n{\n	vec4 position=rotateAroundYInDegrees(a_Position,u_Rotation);\n	gl_Position = (u_MvpMatrix*position).xyww;\n	v_Texcoord=vec3(-a_Position.x,a_Position.yz);//转换坐标系\n}\n",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec3 v_Texcoord;\n\nuniform samplerCube u_CubeTexture;\nuniform float u_Exposure;\nuniform vec4 u_TintColor;\n\n\nvoid main()\n{	\n	vec3 color=textureCube(u_CubeTexture, v_Texcoord).rgb*u_TintColor.rgb*u_Exposure*2.0;\n	gl_FragColor=vec4(color,1.0);\n}\n\n",r=Shader3D.add("SkyBox",i,n),r._addShaderPass(t,e),i={a_Position:0,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_NormalTexture:[1,1],u_DiffuseTexture1:[2,1],u_DiffuseTexture2:[3,1],u_DiffuseTexture3:[4,1],u_DiffuseTexture4:[5,1],u_DiffuseScale1:[6,1],u_DiffuseScale2:[7,1],u_DiffuseScale3:[8,1],u_DiffuseScale4:[9,1],u_MaterialDiffuse:[11,1],u_MaterialAmbient:[10,1],u_MaterialSpecular:[12,1],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},t="attribute vec4 a_Position;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n	attribute vec3 a_Normal;\n	varying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n	uniform mat4 u_WorldMat;\n	varying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef LIGHTMAP\n	uniform vec4 u_LightmapScaleOffset;\n	varying vec2 v_LightMapUV;\n#endif\n\nattribute vec2 a_Texcoord0;\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\nuniform mat4 u_MvpMatrix;\n\nvoid main()\n{\n	gl_Position = u_MvpMatrix * a_Position;\n	v_Texcoord0=a_Texcoord0;\n	v_Texcoord1=a_Texcoord1;\n	\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n	v_Normal=a_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n	v_PositionWorld=(u_WorldMat*a_Position).xyz;\n#endif\n\n#ifdef LIGHTMAP\n	//这个地方使用a_Normal 并不是真的代表normal，其实凑巧法线图的uv正好是符合 light_Map的UV\n	v_LightMapUV=vec2(a_Normal.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Normal.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n#endif\n\n#ifdef RECEIVESHADOW\n	v_posViewZ = gl_Position.w;\n	#ifdef SHADOWMAP_PSSM1\n		v_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n	#endif\n#endif\n\n}",e='#ifdef HIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n	uniform vec3 u_MaterialDiffuse;\n	uniform vec4 u_MaterialSpecular;\n	uniform vec3 u_CameraPos;\n	varying vec3 v_Normal;\n	varying vec3 v_PositionWorld;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n	uniform vec3 u_MaterialAmbient;\n#endif\n\n#ifdef FOG\n	uniform float u_FogStart;\n	uniform float u_FogRange;\n	uniform vec3 u_FogColor;\n#endif\n\n#ifdef DIRECTIONLIGHT\n	uniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n	uniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n	uniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n	#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n	uniform mat4 u_lightShadowVP[4];\n	#endif\n	#ifdef SHADOWMAP_PSSM1 \n	varying vec4 v_lightMVPPos;\n	#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\nuniform sampler2D u_NormalTexture;\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform vec2 u_DiffuseScale1;\nuniform vec2 u_DiffuseScale2;\nuniform vec2 u_DiffuseScale3;\nuniform vec2 u_DiffuseScale4;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n#ifdef LIGHTMAP\n	uniform sampler2D u_LightMap;\n	varying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n	#ifdef DETAIL_NUM1\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n		vec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		gl_FragColor.xyz = color1.xyz;\n		gl_FragColor.w = splatAlpha.a;\n	#endif\n	#ifdef DETAIL_NUM2\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n		vec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n		vec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		gl_FragColor.xyz = color1.xyz * (1.0-splatAlpha.r) + color2.xyz * splatAlpha.r;\n		gl_FragColor.w = splatAlpha.a;\n	#endif\n	#ifdef DETAIL_NUM3\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n		vec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n		vec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n		vec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		gl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g)) + color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g;\n		gl_FragColor.w = splatAlpha.a;\n	#endif\n	#ifdef DETAIL_NUM4\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n		vec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n		vec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n		vec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord1/u_DiffuseScale4);\n		vec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		gl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g+splatAlpha.b))+ color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g + color4.xyz * splatAlpha.b;\n		gl_FragColor.w = splatAlpha.a;\n	#endif\n	\n		\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = texture2D(u_NormalTexture,v_Normal.xy).xyz;\n	normal = normal*2.0 - vec3(1.0);\n	vec3 diffuse = vec3(0.0);\n	vec3 ambient = vec3(0.0);\n	vec3 specular= vec3(0.0);\n	vec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n	vec3 toEye;\n	#ifdef FOG\n		toEye=u_CameraPos-v_PositionWorld;\n		float toEyeLength=length(toEye);\n		toEye/=toEyeLength;\n	#else\n		toEye=normalize(u_CameraPos-v_PositionWorld);\n	#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n	computeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n	diffuse+=dif;\n	ambient+=amb;\n	specular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n	computePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n	diffuse+=dif;\n	ambient+=amb;\n	specular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n	ComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n	diffuse+=dif;\n	ambient+=amb;\n	specular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n	float shadowValue = 1.0;\n	#ifdef SHADOWMAP_PSSM3\n		shadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n	#endif\n	#ifdef SHADOWMAP_PSSM2\n		shadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n	#endif \n	#ifdef SHADOWMAP_PSSM1\n		shadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n	#endif\n#endif\n\n#ifdef LIGHTMAP\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n		gl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n	#else\n		#if defined(RECEIVESHADOW)\n			gl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n		#else\n			gl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n		#endif\n	#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n	#ifdef RECEIVESHADOW\n		gl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n	#else\n		gl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n	#endif\n#endif\n\n\n	#ifdef FOG\n		float lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n		#ifdef ADDTIVEFOG\n			gl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n		#else\n			gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n		#endif\n	#endif\n}\n\n',r=Shader3D.add("Terrain",i,n,RenderableSprite3D.shaderDefines,TerrainMaterial.shaderDefines),r._addShaderPass(t,e),i={a_Position:0,a_Normal:3,a_Texcoord0:2},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_DiffuseTexture1:[1,1],u_DiffuseTexture2:[2,1],u_DiffuseTexture3:[3,1],u_DiffuseTexture4:[4,1],u_DiffuseTexture5:[5,1],u_DiffuseScaleOffset1:[6,1],u_DiffuseScaleOffset2:[7,1],u_DiffuseScaleOffset3:[8,1],u_DiffuseScaleOffset4:[9,1],u_DiffuseScaleOffset5:[10,1],u_MaterialAlbedo:[14,1],u_MaterialDiffuse:[12,1],u_MaterialAmbient:[11,1],u_MaterialSpecular:[13,1],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n	attribute vec3 a_Normal;\n	varying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n	uniform mat4 u_WorldMat;\n	varying vec3 v_PositionWorld;\n#endif\n\n#ifdef LIGHTMAP\n	varying vec2 v_LightMapUV;\n	uniform vec4 u_LightmapScaleOffset;\n#endif\n\n#ifdef RECEIVESHADOW\n	varying float v_posViewZ;\n	#ifdef SHADOWMAP_PSSM1 \n		varying vec4 v_lightMVPPos;\n		uniform mat4 u_lightShadowVP[4];\n	#endif\n#endif\n\nvoid main()\n{\n	gl_Position = u_MvpMatrix * a_Position;\n  \n	v_Texcoord0 = a_Texcoord0;\n  \n	#ifdef LIGHTMAP\n		v_LightMapUV = vec2(a_Texcoord0.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Texcoord0.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n	#endif\n  \n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n		v_Normal = a_Normal;\n	#endif\n\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n		v_PositionWorld=(u_WorldMat*a_Position).xyz;\n	#endif\n\n	#ifdef RECEIVESHADOW\n		v_posViewZ = gl_Position.w;\n		#ifdef SHADOWMAP_PSSM1\n			v_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n		#endif\n	#endif\n}",e='#ifdef HIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n	uniform vec3 u_MaterialDiffuse;\n	uniform vec4 u_MaterialSpecular;\n	uniform vec3 u_CameraPos;\n	varying vec3 v_Normal;\n	varying vec3 v_PositionWorld;\n#endif\n\n#ifdef FOG\n	uniform float u_FogStart;\n	uniform float u_FogRange;\n	uniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n	uniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n	uniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n	uniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n	#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n	uniform mat4 u_lightShadowVP[4];\n	#endif\n	#ifdef SHADOWMAP_PSSM1 \n	varying vec4 v_lightMVPPos;\n	#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\n\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform sampler2D u_DiffuseTexture5;\n\nuniform vec4 u_DiffuseScaleOffset1;\nuniform vec4 u_DiffuseScaleOffset2;\nuniform vec4 u_DiffuseScaleOffset3;\nuniform vec4 u_DiffuseScaleOffset4;\nuniform vec4 u_DiffuseScaleOffset5;\n\nvarying vec2 v_Texcoord0;\n\nuniform vec3 u_MaterialAmbient;\nuniform vec4 u_MaterialAlbedo;\n\n#ifdef LIGHTMAP\n	uniform sampler2D u_LightMap;\n	varying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n	vec4 splatAlpha = vec4(1.0);\n	#ifdef ExtendTerrain_DETAIL_NUM1\n		splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n		gl_FragColor.xyz = color1.xyz * splatAlpha.r;\n	#endif\n	#ifdef ExtendTerrain_DETAIL_NUM2\n		splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n		vec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n		gl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\n	#endif\n	#ifdef ExtendTerrain_DETAIL_NUM3\n		splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n		vec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n		vec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n		gl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\n	#endif\n	#ifdef ExtendTerrain_DETAIL_NUM4\n		splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n		vec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n		vec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n		vec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n		gl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\n	#endif\n	#ifdef ExtendTerrain_DETAIL_NUM5\n		splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n		vec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n		vec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n		vec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n		vec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n		vec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\n		gl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\n	#endif\n		gl_FragColor.w = splatAlpha.a;\n		\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = v_Normal;\n	vec3 diffuse = vec3(0.0);\n	vec3 ambient = vec3(0.0);\n	vec3 specular= vec3(0.0);\n	vec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n	vec3 toEye;\n	#ifdef FOG\n		toEye=u_CameraPos-v_PositionWorld;\n		float toEyeLength=length(toEye);\n		toEye/=toEyeLength;\n	#else\n		toEye=normalize(u_CameraPos-v_PositionWorld);\n	#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n	computeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n	diffuse+=dif;\n	ambient+=amb;\n	specular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n	computePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n	diffuse+=dif;\n	ambient+=amb;\n	specular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n	ComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n	diffuse+=dif;\n	ambient+=amb;\n	specular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n	float shadowValue = 1.0;\n	#ifdef SHADOWMAP_PSSM3\n		shadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n	#endif\n	#ifdef SHADOWMAP_PSSM2\n		shadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n	#endif \n	#ifdef SHADOWMAP_PSSM1\n		shadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n	#endif\n#endif\n\n#ifdef LIGHTMAP\n	#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n		gl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n	#else\n		#if defined(RECEIVESHADOW)		\n			gl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n			//vec3 tColor= u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue + mix(vec3(0.15,0.15,0.15),vec3(0.0),shadowValue);\n			//gl_FragColor.rgb*=tColor;\n		#else\n			gl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n		#endif\n	#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_MaterialAlbedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n	#ifdef RECEIVESHADOW\n		gl_FragColor = vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n	#else\n		gl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n	#endif\n#endif\n\n#ifdef FOG\n	float lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n	gl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n\n\n\n\n',r=Shader3D.add("ExtendTerrain",i,n,RenderableSprite3D.shaderDefines,ExtendTerrainMaterial.shaderDefines),r._addShaderPass(t,e),i={a_Position:0,a_OffsetVector:42,a_Texcoord0X:39,a_Texcoord0Y:41,a_BirthTime:33},n={u_MvpMatrix:[1,2],u_VMatrix:[1,3],u_PMatrix:[2,3],u_TilingOffset:[3,1],u_MainTexture:[1,1],u_MainColor:[2,1],u_CurTime:[3,2],u_LifeTime:[4,2],u_WidthCurve:[5,2],u_WidthCurveKeyLength:[6,2],u_GradientColorkey:[7,2],u_GradientAlphakey:[8,2]},t="attribute vec3 a_Position;\nattribute vec3 a_OffsetVector;\nattribute vec4 a_Color;\nattribute float a_Texcoord0X;\nattribute float a_Texcoord0Y;\nattribute float a_BirthTime;\n\nuniform mat4 u_VMatrix;\nuniform mat4 u_PMatrix;\n\nuniform vec4 u_TilingOffset;\n\nuniform float u_CurTime;\nuniform float u_LifeTime;\nuniform vec4 u_WidthCurve[10];\nuniform int u_WidthCurveKeyLength;\n\nuniform vec4 u_GradientColorkey[10];\nuniform vec2 u_GradientAlphakey[10];\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\n{\n	float t2 = t * t;\n	float t3 = t2 * t;\n	float a = 2.0 * t3 - 3.0 * t2 + 1.0;\n	float b = t3 - 2.0 * t2 + t;\n	float c = t3 - t2;\n	float d = -2.0 * t3 + 3.0 * t2;\n	return a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\n}\n\nfloat getCurWidth(in float normalizeTime)\n{\n	float width;\n	if(normalizeTime == 0.0){\n		width=u_WidthCurve[0].w;\n	}\n	else if(normalizeTime >= 1.0){\n		width=u_WidthCurve[u_WidthCurveKeyLength - 1].w;\n	}\n	else{\n		for(int i = 0; i < 10; i ++ )\n		{\n			if(normalizeTime == u_WidthCurve[i].x){\n				width=u_WidthCurve[i].w;\n				break;\n			}\n			\n			vec4 lastFrame = u_WidthCurve[i];\n			vec4 nextFrame = u_WidthCurve[i + 1];\n			if(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\n			{\n				float duration = nextFrame.x - lastFrame.x;\n				float t = (normalizeTime - lastFrame.x) / duration;\n				float outTangent = lastFrame.z;\n				float inTangent = nextFrame.y;\n				float value1 = lastFrame.w;\n				float value2 = nextFrame.w;\n				width=hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\n				break;\n			}\n		}\n	}\n	return width;\n}	\n\nvec4 getColorFromGradientByBlend(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n	vec4 color;\n	for(int i = 1; i < 10; i++)\n	{\n		vec4 gradientColor = gradientColors[i];\n		float colorKey = gradientColor.w;\n		if(colorKey >= normalizeTime)\n		{\n			vec4 lastGradientColor = gradientColors[i-1];\n			float lastColorKey = lastGradientColor.w;\n			float age = (normalizeTime - lastColorKey) / (colorKey - lastColorKey);\n			color.rgb = mix(gradientColors[i-1].xyz, gradientColor.xyz, age);\n			break;\n		}\n	}\n	for(int i = 1; i < 10; i++)\n	{\n		vec2 gradientAlpha = gradientAlphas[i];\n		float alphaKey = gradientAlpha.y;\n		if(alphaKey >= normalizeTime)\n		{\n			vec2 lastGradientAlpha = gradientAlphas[i-1];\n			float lastAlphaKey = lastGradientAlpha.y;\n			float age = (normalizeTime - lastAlphaKey) / (alphaKey - lastAlphaKey);\n			color.a = mix(lastGradientAlpha.x, gradientAlpha.x, age);\n			break;\n		}\n	}\n	return color;\n}\n\nvec4 getColorFromGradientByFixed(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n	vec4 color;\n	for(int i = 1; i < 10; i++)\n	{\n		vec4 gradientColor = gradientColors[i];\n		if(gradientColor.w >= normalizeTime)\n		{\n			color.rgb = gradientColor.xyz;\n			break;\n		}\n	}\n	for(int i = 1; i < 10; i++)\n	{\n		vec2 gradientAlpha = gradientAlphas[i];\n		if(gradientAlpha.y >= normalizeTime)\n		{\n			color.a = gradientAlpha.x;\n			break;\n		}\n	}\n	return color;\n}\n\nvoid main()\n{\n	float normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\n	\n	#ifdef TILINGOFFSET\n		v_Texcoord0 = (vec2(a_Texcoord0X, a_Texcoord0Y) * u_TilingOffset.xy) + u_TilingOffset.zw;\n	#else\n		v_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\n	#endif\n	\n	#ifdef GRADIENTMODE_BLEND\n		v_Color = getColorFromGradientByBlend(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n	#else\n		v_Color = getColorFromGradientByFixed(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n	#endif\n	\n	gl_Position = u_PMatrix * u_VMatrix * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\n}\n\n\n\n",e="#ifdef HIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\nuniform sampler2D u_MainTexture;\nuniform vec4 u_MainColor;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nvoid main()\n{	\n	vec4 color = 2.0 * u_MainColor * v_Color;\n	#ifdef DIFFUSETEXTURE\n		vec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\n		color *= mainTextureColor;\n	#endif\n	gl_FragColor = color;\n}\n\n",r=Shader3D.add("Trail",i,n,TrailSprite3D.shaderDefines,TrailMaterial.shaderDefines),r._addShaderPass(t,e),i={a_Position:0,a_Normal:3,a_Tangent0:5},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_Time:[24,4],u_MainTexture:[1,1],u_NormalTexture:[2,1],u_HorizonColor:[0,1],u_WaveScale:[3,1],u_WaveSpeed:[4,1]},t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\nuniform float u_WaveScale;\nuniform vec4 u_WaveSpeed;\nuniform float u_Time;\n\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\nvoid main()\n{\n	vec4 positionWorld = u_WorldMat * a_Position;\n	vec4 position = u_MvpMatrix * a_Position;\n	\n	vec4 temp = vec4(positionWorld.x, positionWorld.z, positionWorld.x, positionWorld.z) * u_WaveScale + u_WaveSpeed * u_WaveScale * u_Time;\n	\n	v_Texcoord0 = temp.xy * vec2(0.4, 0.45);\n	v_Texcoord1 = temp.wz;\n	\n	mat3 worldMat = mat3(u_WorldMat);\n	v_Normal = worldMat * a_Normal;\n	v_Tangent = worldMat * a_Tangent0.xyz;\n	v_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n	\n	v_ViewDir = u_CameraPos - positionWorld.xyz;\n	gl_Position = position;\n}",e='#ifdef FSHIGHPRECISION\n	precision highp float;\n#else\n	precision mediump float;\n#endif\n\n#ifdef MAINTEXTURE\n	uniform sampler2D u_MainTexture;\n#endif\n\n#ifdef NORMALTEXTURE\n	uniform sampler2D u_NormalTexture;\n#endif\n\nuniform vec4 u_HorizonColor;\n\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n#include "Lighting.glsl"\n\nvoid main()\n{\n	vec4 bumpColor1 = texture2D(u_NormalTexture, v_Texcoord0);\n	vec4 bumpColor2 = texture2D(u_NormalTexture, v_Texcoord1);\n	\n	vec3 normal1 = NormalSampleToWorldSpace1(bumpColor1, v_Tangent, v_Binormal, v_Normal);\n	vec3 normal2 = NormalSampleToWorldSpace1(bumpColor2, v_Tangent, v_Binormal, v_Normal);\n	\n	vec3 normal = normalize((normal1 + normal2) * 0.5);\n	vec3 viewDir = normalize(v_ViewDir);\n	float fresnel = dot(viewDir, normal);\n	\n	vec4 waterColor = texture2D(u_MainTexture, vec2(fresnel, fresnel));\n	\n	vec4 color;\n	color.rgb = mix(waterColor.rgb, u_HorizonColor.rgb, vec3(waterColor.a));\n	color.a = u_HorizonColor.a;\n	\n	gl_FragColor = color;\n}\n\n',r=Shader3D.add("WaterPrimary",i,n,null,WaterPrimaryMaterial.shaderDefines),r._addShaderPass(t,e)
},t}(),ShaderVariable=function(){function t(){this.textureID=-1}return __class(t,"laya.d3.shader.ShaderVariable"),t}(),ParallelSplitShadowMap=function(){function t(){this._currentPSSM=-1,this._shadowMapCount=3,this._maxDistance=200,this._ratioOfDistance=1/this._shadowMapCount,this._statesDirty=!0,this._shadowMapTextureSize=1024,this._scene=null,this._PCFType=0,this._shaderValueLightVP=null,this._spiltDistance=new Array(4),this._globalParallelLightDir=new Vector3(0,-1,0),this._boundingSphere=new Array(4),this._boundingBox=new Array(4),this._frustumPos=new Array(16),this._uniformDistance=new Array(4),this._logDistance=new Array(4),this._dimension=new Array(4),this._tempLookAt3=new Vector3,this._tempLookAt4=new Vector4,this._tempValue=new Vector4,this._tempPos=new Vector3,this._tempLightUp=new Vector3,this._tempMin=new Vector4,this._tempMax=new Vector4,this._tempMatrix44=new Matrix4x4,this._splitFrustumCulling=new BoundFrustum(Matrix4x4.DEFAULT),this._tempScaleMatrix44=new Matrix4x4,this._shadowPCFOffset=new Vector2(1/1024,1/1024),this._shaderValueDistance=new Vector4,this.cameras=[],this._shaderValueVPs=[];var t=0;for(t=0;t<this._spiltDistance.length;t++)this._spiltDistance[t]=0;for(t=0;t<this._dimension.length;t++)this._dimension[t]=new Vector2;for(t=0;t<this._frustumPos.length;t++)this._frustumPos[t]=new Vector3;for(t=0;t<this._boundingBox.length;t++)this._boundingBox[t]=new BoundBox(new Vector3,new Vector3);for(t=0;t<this._boundingSphere.length;t++)this._boundingSphere[t]=new BoundSphere(new Vector3,0);Matrix4x4.createScaling(new Vector3(.5,.5,1),this._tempScaleMatrix44),this._tempScaleMatrix44.elements[12]=.5,this._tempScaleMatrix44.elements[13]=.5}__class(t,"laya.d3.shadowMap.ParallelSplitShadowMap");var e=t.prototype;return e.setInfo=function(t,e,i,n,r,a){r>3&&(this._shadowMapCount=3),this._scene=t,this._maxDistance=e,this.shadowMapCount=r,this._globalParallelLightDir=i,this._ratioOfDistance=1/this._shadowMapCount;for(var s=0;s<this._spiltDistance.length;s++)this._spiltDistance[s]=0;this._shadowMapTextureSize=n,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this.setPCFType(a),this._statesDirty=!0},e.setPCFType=function(t){this._PCFType=t;var e=this._scene._defineDatas;switch(this._PCFType){case 0:e.add(Scene3D.SHADERDEFINE_SHADOW_PCF_NO),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF1),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF2),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF3);break;case 1:e.add(Scene3D.SHADERDEFINE_SHADOW_PCF1),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF_NO),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF2),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF3);break;case 2:e.add(Scene3D.SHADERDEFINE_SHADOW_PCF2),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF_NO),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF1),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF3);break;case 3:e.add(Scene3D.SHADERDEFINE_SHADOW_PCF3),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF_NO),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF1),e.remove(Scene3D.SHADERDEFINE_SHADOW_PCF2)}},e.getPCFType=function(){return this._PCFType},e.setFarDistance=function(t){this._maxDistance!=t&&(this._maxDistance=t,this._statesDirty=!0)},e.getFarDistance=function(){return this._maxDistance},e._beginSampler=function(t,e){if(0>t||t>this._shadowMapCount)throw new Error("ParallelSplitShadowMap: beginSample invalid index");this._currentPSSM=t,this._update(e)},e.endSampler=function(){this._currentPSSM=-1},e._calcAllLightCameraInfo=function(t){if(1===this._shadowMapCount)this._beginSampler(0,t),this.endSampler(t);else for(var e=0,i=this._shadowMapCount+1;i>e;e++)this._beginSampler(e,t),this.endSampler(t)},e._recalculate=function(t,e,i){this._calcSplitDistance(t),this._calcBoundingBox(e,i),this._rebuildRenderInfo()},e._update=function(t){var e=t.nearPlane,i=t.fieldOfView,n=t.aspectRatio;(this._statesDirty||this.lastNearPlane!==e||this.lastFieldOfView!==i||this.lastAspectRatio!==n)&&(this._recalculate(e,i,n),this._uploadShaderValue(),this._statesDirty=!1,this.lastNearPlane=e,this.lastFieldOfView=i,this.lastAspectRatio=n),this._calcLightViewProject(t)},e._uploadShaderValue=function(){var t=this._scene._defineDatas;switch(this._shadowMapCount){case 1:t.add(Scene3D.SHADERDEFINE_SHADOW_PSSM1),t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM2),t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM3);break;case 2:t.add(Scene3D.SHADERDEFINE_SHADOW_PSSM2),t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM1),t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM3);break;case 3:t.add(Scene3D.SHADERDEFINE_SHADOW_PSSM3),t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM1),t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM2)}var e=this._scene._shaderValues;switch(e.setVector(15,this._shaderValueDistance),e.setBuffer(16,this._shaderValueLightVP),e.setVector(17,this._shadowPCFOffset),this._shadowMapCount){case 3:e.setTexture(18,this.cameras[1].renderTarget),e.setTexture(19,this.cameras[2].renderTarget),e.setTexture(20,this.cameras[3].renderTarget);break;case 2:e.setTexture(18,this.cameras[1].renderTarget),e.setTexture(19,this.cameras[2].renderTarget);break;case 1:e.setTexture(18,this.cameras[1].renderTarget)}},e._calcSplitDistance=function(t){var e=this._maxDistance,i=1/this._shadowMapCount,n=0;for(n=0;n<=this._shadowMapCount;n++)this._uniformDistance[n]=t+(e-t)*n*i;var r=e/t;for(n=0;n<=this._shadowMapCount;n++){var a=Math.pow(r,n*i);this._logDistance[n]=t*a}for(n=0;n<=this._shadowMapCount;n++)this._spiltDistance[n]=this._uniformDistance[n]*this._ratioOfDistance+this._logDistance[n]*(1-this._ratioOfDistance);this._shaderValueDistance.x=this._spiltDistance[1],this._shaderValueDistance.y=this._spiltDistance[2],this._shaderValueDistance.z=this._spiltDistance[3],this._shaderValueDistance.w=this._spiltDistance[4]},e._calcBoundingBox=function(t,e){var i=3.1415926*t/180,n=Math.tan(i/2),r=0/0,a=0/0,s=0/0,o=0;for(o=0;o<=this._shadowMapCount;o++){s=this._spiltDistance[o],r=s*n,a=r*e;var l=this._frustumPos[4*o+0].elements;l[0]=-a,l[1]=-r,l[2]=-s,l=this._frustumPos[4*o+1].elements,l[0]=a,l[1]=-r,l[2]=-s,l=this._frustumPos[4*o+2].elements,l[0]=-a,l[1]=r,l[2]=-s,l=this._frustumPos[4*o+3].elements,l[0]=a,l[1]=r,l[2]=-s,l=this._dimension[o].elements,l[0]=a,l[1]=r}var _,h,u,c;for(o=1;o<=this._shadowMapCount;o++)_=this._dimension[o].elements,h=this._boundingBox[o].min.elements,h[0]=-_[0],h[1]=-_[1],h[2]=-this._spiltDistance[o],u=this._boundingBox[o].max.elements,u[0]=_[0],u[1]=_[1],u[2]=-this._spiltDistance[o-1],c=this._boundingSphere[o].center.elements,c[0]=.5*(h[0]+u[0]),c[1]=.5*(h[1]+u[1]),c[2]=.5*(h[2]+u[2]),this._boundingSphere[o].radius=.5*Math.sqrt(Math.pow(u[0]-h[0],2)+Math.pow(u[1]-h[1],2)+Math.pow(u[2]-h[2],2));h=this._boundingBox[0].min.elements,_=this._dimension[this._shadowMapCount].elements,h[0]=-_[0],h[1]=-_[1],h[2]=-this._spiltDistance[this._shadowMapCount],u=this._boundingBox[0].max.elements,u[0]=_[0],u[1]=_[1],u[2]=-this._spiltDistance[0],c=this._boundingSphere[0].center.elements,c[0]=.5*(h[0]+u[0]),c[1]=.5*(h[1]+u[1]),c[2]=.5*(h[2]+u[2]),this._boundingSphere[0].radius=.5*Math.sqrt(Math.pow(u[0]-h[0],2)+Math.pow(u[1]-h[1],2)+Math.pow(u[2]-h[2],2))},e.calcSplitFrustum=function(t){this._currentPSSM>0?Matrix4x4.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[this._currentPSSM-1],this._spiltDistance[this._currentPSSM],this._tempMatrix44):Matrix4x4.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[0],this._spiltDistance[this._shadowMapCount],this._tempMatrix44),Matrix4x4.multiply(this._tempMatrix44,t.viewMatrix,this._tempMatrix44),this._splitFrustumCulling.matrix=this._tempMatrix44},e._rebuildRenderInfo=function(){var t=this._shadowMapCount+1,e=0;for(this.cameras.length=t,e=0;t>e;e++){if(!this.cameras[e]){var i=new Camera;i.name="lightCamera"+e,i.clearColor=new Vector4(1,1,1,1),this.cameras[e]=i}var n=this.cameras[e].renderTarget;(null==n||n.width!=this._shadowMapTextureSize||n.height!=this._shadowMapTextureSize)&&(n&&n.destroy(),n=new RenderTexture2D(this._shadowMapTextureSize,this._shadowMapTextureSize,1,0),n.mipmap=!1,n.filterMode=0,this.cameras[e].renderTarget=n)}},e._calcLightViewProject=function(e){{var i=this._boundingSphere[this._currentPSSM],n=e.transform.worldMatrix;i.radius}i.center.cloneTo(this._tempLookAt3),Vector3.transformV3ToV4(this._tempLookAt3,n,this._tempLookAt4);var r=this._tempLookAt3.elements,a=this._tempLookAt4.elements;r[0]=a[0],r[1]=a[1],r[2]=a[2];var s=this._tempLightUp.elements;e.transform.worldMatrix.getForward(t._tempVector30);var o=t._tempVector30.elements;s[0]=o[0],s[1]=1,s[2]=o[2],Vector3.normalize(this._tempLightUp,this._tempLightUp),Vector3.scale(this._globalParallelLightDir,4*i.radius,this._tempPos),Vector3.subtract(this._tempLookAt3,this._tempPos,this._tempPos);var l=this.cameras[this._currentPSSM];l.transform.position=this._tempPos,l.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1);var _=this._tempMax.elements,h=this._tempMin.elements;_[0]=_[1]=_[2]=-1e5,_[3]=1,h[0]=h[1]=h[2]=1e5,h[3]=1,Matrix4x4.multiply(l.viewMatrix,n,this._tempMatrix44);var u=this._tempValue.elements,c=[];c.length=8,this._boundingBox[this._currentPSSM].getCorners(c);for(var d=0;8>d;d++){var f=c[d].elements;u[0]=f[0],u[1]=f[1],u[2]=f[2],u[3]=1,Vector4.transformByM4x4(this._tempValue,this._tempMatrix44,this._tempValue),h[0]=u[0]<h[0]?u[0]:h[0],h[1]=u[1]<h[1]?u[1]:h[1],h[2]=u[2]<h[2]?u[2]:h[2],_[0]=u[0]>_[0]?u[0]:_[0],_[1]=u[1]>_[1]?u[1]:_[1],_[2]=u[2]>_[2]?u[2]:_[2]}Vector4.add(this._tempMax,this._tempMin,this._tempValue),u[0]*=.5,u[1]*=.5,u[2]*=.5,u[3]=1,Vector4.transformByM4x4(this._tempValue,l.transform.worldMatrix,this._tempValue);var m=Math.abs(-this._tempMax.z),p=m>this._maxDistance?m:this._maxDistance;Vector3.scale(this._globalParallelLightDir,p,this._tempPos);var g=this._tempPos.elements;g[0]=u[0]-g[0],g[1]=u[1]-g[1],g[2]=u[2]-g[2],l.transform.position=this._tempPos,l.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1),Matrix4x4.createOrthoOffCenterRH(h[0],_[0],h[1],_[1],1,p+.5*(_[2]-h[2]),l.projectionMatrix);var v=l.projectionViewMatrix;t.multiplyMatrixOutFloat32Array(this._tempScaleMatrix44,v,this._shaderValueVPs[this._currentPSSM])},e.setShadowMapTextureSize=function(t){t!==this._shadowMapTextureSize&&(this._shadowMapTextureSize=t,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this._statesDirty=!0)},e.disposeAllRenderTarget=function(){for(var t=0,e=this._shadowMapCount+1;e>t;t++)this.cameras[t].renderTarget&&(this.cameras[t].renderTarget.destroy(),this.cameras[t].renderTarget=null)},__getset(0,e,"shadowMapCount",function(){return this._shadowMapCount},function(t){if(t=t>0?t:1,t=3>=t?t:3,this._shadowMapCount!=t){this._shadowMapCount=t,this._ratioOfDistance=1/this._shadowMapCount,this._statesDirty=!0,this._shaderValueLightVP=new Float32Array(16*t),this._shaderValueVPs.length=t;for(var e=0;t>e;e++)this._shaderValueVPs[e]=new Float32Array(this._shaderValueLightVP.buffer,64*e)}}),t.multiplyMatrixOutFloat32Array=function(t,e,i){var n,r,a,s,o,l,_;for(r=t.elements,a=e.elements,n=0;4>n;n++)s=r[n],o=r[n+4],l=r[n+8],_=r[n+12],i[n]=s*a[0]+o*a[1]+l*a[2]+_*a[3],i[n+4]=s*a[4]+o*a[5]+l*a[6]+_*a[7],i[n+8]=s*a[8]+o*a[9]+l*a[10]+_*a[11],i[n+12]=s*a[12]+o*a[13]+l*a[14]+_*a[15]},t.MAX_PSSM_COUNT=3,__static(t,["_tempVector30",function(){return this._tempVector30=new Vector3}]),t}(),TerrainLeaf=function(){function t(){this._boundingSphere=null,this._boundingBox=null,this._sizeOfY=null,this._currentLODLevel=0,this._lastDistanceToEye=0/0,this._originalBoundingSphere=null,this._originalBoundingBox=null,this._originalBoundingBoxCorners=null,this._bUseStrip=!1,this._gridSize=0/0,this._beginGridX=0,this._beginGridZ=0,this._LODError=null,t.__init__(),this._currentLODLevel=0}__class(t,"laya.d3.terrain.TerrainLeaf");var e=t.prototype;return e.calcVertextNorml=function(e,i,n,r,a,s){var o=0,l=0;l=-1*t.getHeightFromTerrainHeightData(e-1,i-1,n,r,a),l+=-1*t.getHeightFromTerrainHeightData(e-1,i,n,r,a),l+=-1*t.getHeightFromTerrainHeightData(e-1,i+1,n,r,a),l+=1*t.getHeightFromTerrainHeightData(e+1,i-1,n,r,a),l+=1*t.getHeightFromTerrainHeightData(e+1,i,n,r,a),l+=1*t.getHeightFromTerrainHeightData(e+1,i+1,n,r,a),o=-1*t.getHeightFromTerrainHeightData(e-1,i-1,n,r,a),o+=-1*t.getHeightFromTerrainHeightData(e,i-1,n,r,a),o+=-1*t.getHeightFromTerrainHeightData(e+1,i-1,n,r,a),o+=1*t.getHeightFromTerrainHeightData(e-1,i+1,n,r,a),o+=1*t.getHeightFromTerrainHeightData(e,i+1,n,r,a),o+=1*t.getHeightFromTerrainHeightData(e+1,i+1,n,r,a),s.x=-l,s.y=6,s.z=-o,Vector3.normalize(s,s)},e.calcVertextNormlUV=function(t,e,i,n,r){r.x=t/i,r.y=e/n,r.z=e/n},e.calcVertextBuffer=function(e,i,n,r,a,s,o,l,_,h,u,c){if(1==c&&!t.__ADAPT_MATRIX__){t.__ADAPT_MATRIX__=new Matrix4x4;var d=new Matrix4x4;Matrix4x4.createRotationY(Math.PI,t.__ADAPT_MATRIX__),Matrix4x4.createTranslate(new Vector3(0,0,(u-1)*a),d),Matrix4x4.multiply(d,t.__ADAPT_MATRIX__,t.__ADAPT_MATRIX__),t.__ADAPT_MATRIX_INV__=new Matrix4x4,t.__ADAPT_MATRIX__.invert(t.__ADAPT_MATRIX_INV__)}this._gridSize=a,this._beginGridX=e*t.CHUNK_GRID_NUM+n,this._beginGridZ=i*t.CHUNK_GRID_NUM+r;for(var f=o*l,m=2147483647,p=-2147483648,g=new Vector3,v=0,x=t.LEAF_GRID_NUM+1;x>v;v++)for(var y=0,T=t.LEAF_GRID_NUM+1;T>y;y++)t.__VECTOR3__.x=(this._beginGridX+y)*this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+v)*this._gridSize,t.__VECTOR3__.y=_[(this._beginGridZ+v)*h+(this._beginGridX+y)],m=t.__VECTOR3__.y<m?t.__VECTOR3__.y:m,p=t.__VECTOR3__.y>p?t.__VECTOR3__.y:p,t.__ADAPT_MATRIX__&&Vector3.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[f]=t.__VECTOR3__.x,f++,s[f]=t.__VECTOR3__.y,f++,s[f]=t.__VECTOR3__.z,f++,this.calcVertextNormlUV(this._beginGridX+y,this._beginGridZ+v,h,u,g),s[f]=g.x,f++,s[f]=g.y,f++,s[f]=g.z,f++,s[f]=(n+y)/t.CHUNK_GRID_NUM,f++,s[f]=(r+v)/t.CHUNK_GRID_NUM,f++,s[f]=this._beginGridX+y,f++,s[f]=this._beginGridZ+v,f++;this._sizeOfY=new Vector2(m-1,p+1),this.calcLODErrors(_,h,u),this.calcOriginalBoudingBoxAndSphere()},e.calcSkirtVertextBuffer=function(e,i,n,r,a,s,o,l,_,h,u){this._gridSize=a,this._beginGridX=e*t.CHUNK_GRID_NUM+n,this._beginGridZ=i*t.CHUNK_GRID_NUM+r;var c=o*l,d=0,f=0,m=t.LEAF_GRID_NUM+1,p=new Vector3,g=0,v=0;for(d=0;2>d;d++)for(f=0;m>f;f++)t.__VECTOR3__.x=(this._beginGridX+f)*this._gridSize,t.__VECTOR3__.y=1==d?_[this._beginGridZ*h+(this._beginGridX+f)]:-this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+0)*this._gridSize,t.__ADAPT_MATRIX__&&Vector3.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[c]=t.__VECTOR3__.x,c++,s[c]=t.__VECTOR3__.y,c++,s[c]=t.__VECTOR3__.z,c++,g=0==d?this._beginGridZ-1:this._beginGridZ,this.calcVertextNormlUV(this._beginGridX+f,g,h,u,p),s[c]=p.x,c++,s[c]=p.y,c++,s[c]=p.z,c++,s[c]=(n+f)/t.CHUNK_GRID_NUM,c++,s[c]=(r+0)/t.CHUNK_GRID_NUM,c++,s[c]=this._beginGridX+f,c++,s[c]=g,c++;for(d=0;2>d;d++)for(f=0;m>f;f++)t.__VECTOR3__.x=(this._beginGridX+f)*this._gridSize,t.__VECTOR3__.y=0==d?_[(this._beginGridZ+t.LEAF_GRID_NUM)*h+(this._beginGridX+f)]:-this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+t.LEAF_GRID_NUM)*this._gridSize,t.__ADAPT_MATRIX__&&Vector3.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[c]=t.__VECTOR3__.x,c++,s[c]=t.__VECTOR3__.y,c++,s[c]=t.__VECTOR3__.z,c++,g=0==d?this._beginGridZ+t.LEAF_GRID_NUM:this._beginGridZ+t.LEAF_GRID_NUM+1,this.calcVertextNormlUV(this._beginGridX+f,g,h,u,p),s[c]=p.x,c++,s[c]=p.y,c++,s[c]=p.z,c++,s[c]=(n+f)/t.CHUNK_GRID_NUM,c++,s[c]=(r+t.LEAF_GRID_NUM)/t.CHUNK_GRID_NUM,c++,s[c]=this._beginGridX+f,c++,s[c]=g,c++;for(d=0;2>d;d++)for(f=0;m>f;f++)t.__VECTOR3__.x=(this._beginGridX+0)*this._gridSize,t.__VECTOR3__.y=0==d?_[(this._beginGridZ+f)*h+(this._beginGridX+0)]:-this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+f)*this._gridSize,t.__ADAPT_MATRIX__&&Vector3.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[c]=t.__VECTOR3__.x,c++,s[c]=t.__VECTOR3__.y,c++,s[c]=t.__VECTOR3__.z,c++,v=0==d?this._beginGridX:this._beginGridX-1,this.calcVertextNormlUV(v,this._beginGridZ+f,h,u,p),s[c]=p.x,c++,s[c]=p.y,c++,s[c]=p.z,c++,s[c]=(n+0)/t.CHUNK_GRID_NUM,c++,s[c]=(r+f)/t.CHUNK_GRID_NUM,c++,s[c]=v,c++,s[c]=this._beginGridZ+f,c++;for(d=0;2>d;d++)for(f=0;m>f;f++)t.__VECTOR3__.x=(this._beginGridX+t.LEAF_GRID_NUM)*this._gridSize,t.__VECTOR3__.y=1==d?_[(this._beginGridZ+f)*h+(this._beginGridX+t.LEAF_GRID_NUM)]:-this._gridSize,t.__VECTOR3__.z=(this._beginGridZ+f)*this._gridSize,t.__ADAPT_MATRIX__&&Vector3.transformV3ToV3(t.__VECTOR3__,t.__ADAPT_MATRIX__,t.__VECTOR3__),s[c]=t.__VECTOR3__.x,c++,s[c]=t.__VECTOR3__.y,c++,s[c]=t.__VECTOR3__.z,c++,v=0==d?this._beginGridX+t.LEAF_GRID_NUM+1:this._beginGridX+t.LEAF_GRID_NUM,this.calcVertextNormlUV(v,this._beginGridZ+f,h,u,p),s[c]=p.x,c++,s[c]=p.y,c++,s[c]=p.z,c++,s[c]=(n+t.LEAF_GRID_NUM)/t.CHUNK_GRID_NUM,c++,s[c]=(r+f)/t.CHUNK_GRID_NUM,c++,s[c]=v,c++,s[c]=this._beginGridZ+f,c++},e.calcOriginalBoudingBoxAndSphere=function(){var e=new Vector3(this._beginGridX*this._gridSize,this._sizeOfY.x,this._beginGridZ*this._gridSize),i=new Vector3((this._beginGridX+t.LEAF_GRID_NUM)*this._gridSize,this._sizeOfY.y,(this._beginGridZ+t.LEAF_GRID_NUM)*this._gridSize);t.__ADAPT_MATRIX__&&(Vector3.transformV3ToV3(e,t.__ADAPT_MATRIX__,e),Vector3.transformV3ToV3(i,t.__ADAPT_MATRIX__,i)),this._originalBoundingBox=new BoundBox(e,i);var n=new Vector3;Vector3.subtract(i,e,n),Vector3.scale(n,.5,n);var r=new Vector3;Vector3.add(e,n,r),this._originalBoundingSphere=new BoundSphere(r,Vector3.scalarLength(n)),this._originalBoundingBoxCorners=__newvec(8,null),this._originalBoundingBox.getCorners(this._originalBoundingBoxCorners),this._boundingBox=new BoundBox(new Vector3(-.5,-.5,-.5),new Vector3(.5,.5,.5)),this._boundingSphere=new BoundSphere(new Vector3(0,0,0),1)},e.calcLeafBoudingBox=function(t){for(var e=0;8>e;e++)Vector3.transformCoordinate(this._originalBoundingBoxCorners[e],t,BaseRender._tempBoundBoxCorners[e]);BoundBox.createfromPoints(BaseRender._tempBoundBoxCorners,this._boundingBox)},e.calcLeafBoudingSphere=function(t,e){Vector3.transformCoordinate(this._originalBoundingSphere.center,t,this._boundingSphere.center),this._boundingSphere.radius=this._originalBoundingSphere.radius*e},e.calcLODErrors=function(e,i){this._LODError=new Float32Array(t._maxLODLevel+1);for(var n=1,r=0,a=t._maxLODLevel+1;a>r;r++){for(var s=0,o=0,l=t.LEAF_GRID_NUM;l>o;o+=n)for(var _=0,h=t.LEAF_GRID_NUM;h>_;_+=n)for(var u=e[(this._beginGridZ+o)*i+(this._beginGridX+_)],c=e[(this._beginGridZ+o)*i+(this._beginGridX+_)+n],d=e[(this._beginGridZ+o+n)*i+(this._beginGridX+_)],f=e[(this._beginGridZ+o+n)*i+(this._beginGridX+_)+n],m=0;n>m;m++)for(var p=m/n,g=0;n>g;g++){var v=g/n,x=e[(this._beginGridZ+o+m)*i+(this._beginGridX+_)+g],y=1>=v+p?u+(c-u)*v+(d-u)*p:f+(d-f)*(1-v)+(c-f)*(1-p),T=Math.abs(y-x);s=Math.max(s,T)}n*=2,this._LODError[r]=s}},e.determineLod=function(e,i,n,r){var a=Vector3.distance(e,this._boundingSphere.center),s=t._maxLODLevel;if(!r){if(this._lastDistanceToEye==a)return this._currentLODLevel;this._lastDistanceToEye>a&&(s=this._currentLODLevel)}for(var o=s;o>=1;o--)if(Terrain.LOD_DISTANCE_FACTOR*this._LODError[o]/a*i<n){this._currentLODLevel=o;break}return this._lastDistanceToEye=a,this._currentLODLevel},t.__init__=function(){if(!t._bInit){var e=t.CHUNK_GRID_NUM/t.LEAF_GRID_NUM*(t.CHUNK_GRID_NUM/t.LEAF_GRID_NUM);t._planeLODIndex=__newvec(e);var i=0,n=0,r=0,a=0,s=0,o=0,l=null,_=null;for(i=0;e>i;i++)t._planeLODIndex[i]=new Array(t._maxLODLevel+1);for(i=0,a=t._maxLODLevel+1;a>i;i++)t._planeLODIndex[0][i]=t.calcPlaneLODIndex(i);for(i=1;e>i;i++)for(o=i*t.LEAF_PLANE_VERTEXT_COUNT,n=0,s=t._maxLODLevel+1;s>n;n++){for(l=t._planeLODIndex[0][n],_=new Uint16Array(l.length),r=0;r<l.length;r++)_[r]=l[r]+o;t._planeLODIndex[i][n]=_}for(t._skirtLODIndex=__newvec(e),i=0;e>i;i++)t._skirtLODIndex[i]=new Array(t._maxLODLevel+1);for(i=0,a=t._maxLODLevel+1;a>i;i++)t._skirtLODIndex[0][i]=t.calcSkirtLODIndex(i);for(i=1;e>i;i++)for(o=i*t.LEAF_SKIRT_VERTEXT_COUNT,n=0,s=t._maxLODLevel+1;s>n;n++){for(l=t._skirtLODIndex[0][n],_=new Uint16Array(l.length),r=0;r<l.length;r++)_[r]=l[r]+o;t._skirtLODIndex[i][n]=_}t._bInit=!0}},t.getPlaneLODIndex=function(e,i){return t._planeLODIndex[e][i]},t.getSkirtLODIndex=function(e,i){return t._skirtLODIndex[e][i]},t.calcPlaneLODIndex=function(e){e>t._maxLODLevel&&(e=t._maxLODLevel);var i=t.LEAF_GRID_NUM+1,n=0,r=null,a=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,e);r=new Uint16Array(a*a*6);for(var s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/a,o=0;o<t.LEAF_GRID_NUM;o+=s)for(var l=0;l<t.LEAF_GRID_NUM;l+=s)r[n]=(o+s)*i+l,n++,r[n]=o*i+l,n++,r[n]=o*i+l+s,n++,r[n]=o*i+l+s,n++,r[n]=(o+s)*i+l+s,n++,r[n]=(o+s)*i+l,n++;return r},t.calcSkirtLODIndex=function(e){e>t._maxLODLevel&&(e=t._maxLODLevel);var i=t.CHUNK_GRID_NUM/t.LEAF_GRID_NUM*(t.CHUNK_GRID_NUM/t.LEAF_GRID_NUM)*t.LEAF_PLANE_VERTEXT_COUNT,n=t.LEAF_GRID_NUM+1,r=0,a=null,s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,e);a=new Uint16Array(4*s*6);for(var o=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/s,l=0;4>l;l++){for(var _=0;_<t.LEAF_GRID_NUM;_+=o)a[r]=i+n+_,r++,a[r]=i+_,r++,a[r]=i+_+o,r++,a[r]=i+_+o,r++,a[r]=i+n+_+o,r++,a[r]=i+n+_,r++;i+=2*n}return a},t.getHeightFromTerrainHeightData=function(t,e,i,n,r){return t=0>t?0:t,t=t>=n?n-1:t,e=0>e?0:e,e=e>=r?r-1:e,i[e*n+t]},t.CHUNK_GRID_NUM=64,t.LEAF_GRID_NUM=32,t.__ADAPT_MATRIX__=null,t.__ADAPT_MATRIX_INV__=null,t._planeLODIndex=null,t._skirtLODIndex=null,t._bInit=!1,__static(t,["LEAF_PLANE_VERTEXT_COUNT",function(){return this.LEAF_PLANE_VERTEXT_COUNT=(t.LEAF_GRID_NUM+1)*(t.LEAF_GRID_NUM+1)},"LEAF_SKIRT_VERTEXT_COUNT",function(){return this.LEAF_SKIRT_VERTEXT_COUNT=2*(t.LEAF_GRID_NUM+1)*4},"LEAF_VERTEXT_COUNT",function(){return this.LEAF_VERTEXT_COUNT=t.LEAF_PLANE_VERTEXT_COUNT+t.LEAF_SKIRT_VERTEXT_COUNT},"LEAF_PLANE_MAX_INDEX_COUNT",function(){return this.LEAF_PLANE_MAX_INDEX_COUNT=t.LEAF_GRID_NUM*t.LEAF_GRID_NUM*6},"LEAF_SKIRT_MAX_INDEX_COUNT",function(){return this.LEAF_SKIRT_MAX_INDEX_COUNT=4*t.LEAF_GRID_NUM*6},"LEAF_MAX_INDEX_COUNT",function(){return this.LEAF_MAX_INDEX_COUNT=t.LEAF_PLANE_MAX_INDEX_COUNT+t.LEAF_SKIRT_MAX_INDEX_COUNT},"__VECTOR3__",function(){return this.__VECTOR3__=new Vector3},"_maxLODLevel",function(){return this._maxLODLevel=Math.log2(t.LEAF_GRID_NUM)}]),t}(),ChunkInfo=function(){function t(){this.alphaMap=null,this.detailID=null,this.normalMap=null}return __class(t,"laya.d3.terrain.unit.ChunkInfo"),t}(),DetailTextureInfo=function(){function t(){this.diffuseTexture=null,this.normalTexture=null,this.scale=null,this.offset=null}return __class(t,"laya.d3.terrain.unit.DetailTextureInfo"),t}(),MaterialInfo=function(){function t(){this.ambientColor=null,this.diffuseColor=null,this.specularColor=null}return __class(t,"laya.d3.terrain.unit.MaterialInfo"),t}(),Physics=function(){function t(){}return __class(t,"laya.d3.utils.Physics"),t.__init__=function(){var e=31;t._layerCollsionMatrix.length=e;for(var i=0;e>i;i++){var n=[],r=e-i;n.length=r;for(var a=0;r>a;a++)n[a]=a===r-1?!0:!1;t._layerCollsionMatrix[i]=n}},t.setLayerCollision=function(e,i,n){t._layerCollsionMatrix[e.number][30-i.number]=n},t.getLayerCollision=function(e,i){return t._layerCollsionMatrix[e.number][30-i.number]},t.setColliderCollision=function(t,e,i){i?(delete t._ignoreCollisonMap[e.id],delete e._ignoreCollisonMap[t.id]):(t._ignoreCollisonMap[e.id]=e,e._ignoreCollisonMap[t.id]=t)},t.getIColliderCollision=function(t,e){return t._ignoreCollisonMap[e.id]?!0:!1},t._layerCollsionMatrix=[],__static(t,["collisionManager",function(){return this.collisionManager=new CollisionManager},"gravity",function(){return this.gravity=new Vector3(0,-9.81,0)}]),t}(),Picker=function(){function t(){}return __class(t,"laya.d3.utils.Picker"),t.calculateCursorRay=function(e,i,n,r,a,s){var o=e.elements[0],l=e.elements[1],_=t._tempVector30,h=_.elements;h[0]=o,h[1]=l,h[2]=i.minDepth;var u=t._tempVector31,c=u.elements;c[0]=o,c[1]=l,c[2]=i.maxDepth;var d=s.origin,f=t._tempVector32;i.unprojectFromWVP(_,n,r,a,d),i.unprojectFromWVP(u,n,r,a,f);var m=s.direction.elements;m[0]=f.x-d.x,m[1]=f.y-d.y,m[2]=f.z-d.z,Vector3.normalize(s.direction,s.direction)},t.rayIntersectsPositionsAndIndices=function(e,i,n,r,a){for(var s=n.vertexStride/4,o=n.getVertexElementByUsage(0).offset/4,l=Number.MAX_VALUE,_=-1,h=-1,u=-1,c=0;c<r.length;c+=3){var d=t._tempVector35,f=d.elements,m=r[c]*s,p=m+o;f[0]=i[p],f[1]=i[p+1],f[2]=i[p+2];var g=t._tempVector36,v=g.elements,x=r[c+1]*s,y=x+o;v[0]=i[y],v[1]=i[y+1],v[2]=i[y+2];var T=t._tempVector37,D=T.elements,E=r[c+2]*s,S=E+o;D[0]=i[S],D[1]=i[S+1],D[2]=i[S+2];var M=laya.d3.utils.Picker.rayIntersectsTriangle(e,d,g,T);!isNaN(M)&&l>M&&(l=M,_=m,h=x,u=E)}if(l!==Number.MAX_VALUE){a.distance=l,Vector3.scale(e.direction,l,a.position),Vector3.add(e.origin,a.position,a.position);var R=a.trianglePositions,A=R[0],C=R[1],L=R[2],I=A.elements,w=C.elements,b=L.elements,P=_+o;I[0]=i[P],I[1]=i[P+1],I[2]=i[P+2];var V=h+o;w[0]=i[V],w[1]=i[V+1],w[2]=i[V+2];var O=u+o;b[0]=i[O],b[1]=i[O+1],b[2]=i[O+2];var N=n.getVertexElementByUsage(3);if(N){var B=N.offset/4,F=a.triangleNormals,U=F[0],G=F[1],H=F[2],W=U.elements,k=G.elements,z=H.elements,X=_+B;W[0]=i[X],W[1]=i[X+1],W[2]=i[X+2];var Y=h+B;k[0]=i[Y],k[1]=i[Y+1],k[2]=i[Y+2];var K=u+B;z[0]=i[K],z[1]=i[K+1],z[2]=i[K+2]}return!0}return a.position.toDefault(),a.distance=Number.MAX_VALUE,a.trianglePositions[0].toDefault(),a.trianglePositions[1].toDefault(),a.trianglePositions[2].toDefault(),a.triangleNormals[0].toDefault(),a.triangleNormals[1].toDefault(),a.triangleNormals[2].toDefault(),!1},t.rayIntersectsTriangle=function(e,i,n,r){var a,s=t._tempVector30,o=t._tempVector31;Vector3.subtract(n,i,s),Vector3.subtract(r,i,o);var l=t._tempVector32;Vector3.cross(e.direction,o,l);var _;if(_=Vector3.dot(s,l),_>-Number.MIN_VALUE&&_<Number.MIN_VALUE)return a=Number.NaN;var h=1/_,u=t._tempVector33;Vector3.subtract(e.origin,i,u);var c;if(c=Vector3.dot(u,l),c*=h,0>c||c>1)return a=Number.NaN;var d=t._tempVector34;Vector3.cross(u,s,d);var f;if(f=Vector3.dot(e.direction,d),f*=h,0>f||c+f>1)return a=Number.NaN;var m;return m=Vector3.dot(o,d),m*=h,a=0>m?Number.NaN:m},__static(t,["_tempVector30",function(){return this._tempVector30=new Vector3},"_tempVector31",function(){return this._tempVector31=new Vector3},"_tempVector32",function(){return this._tempVector32=new Vector3},"_tempVector33",function(){return this._tempVector33=new Vector3},"_tempVector34",function(){return this._tempVector34=new Vector3},"_tempVector35",function(){return this._tempVector35=new Vector3},"_tempVector36",function(){return this._tempVector36=new Vector3},"_tempVector37",function(){return this._tempVector37=new Vector3}]),t}(),RaycastHit=function(){function t(){this.distance=0/0,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new Vector3,new Vector3,new Vector3],this.trianglePositions.length=3,this.triangleNormals=[new Vector3,new Vector3,new Vector3],this.triangleNormals.length=3,this.position=new Vector3}__class(t,"laya.d3.utils.RaycastHit");var e=t.prototype;return e.cloneTo=function(t){t.distance=this.distance,this.trianglePositions[0].cloneTo(t.trianglePositions[0]),this.trianglePositions[1].cloneTo(t.trianglePositions[1]),this.trianglePositions[2].cloneTo(t.trianglePositions[2]),this.triangleNormals[0].cloneTo(t.triangleNormals[0]),this.triangleNormals[1].cloneTo(t.triangleNormals[1]),this.triangleNormals[2].cloneTo(t.triangleNormals[2]),this.position.cloneTo(t.position),t.sprite3D=this.sprite3D},t}(),Size=function(){function t(t,e){this._width=0,this._height=0,this._width=t,this._height=e}__class(t,"laya.d3.utils.Size");var e=t.prototype;return __getset(0,e,"width",function(){return-1===this._width?RenderContext3D.clientWidth:this._width}),__getset(0,e,"height",function(){return-1===this._height?RenderContext3D.clientHeight:this._height}),__getset(1,t,"fullScreen",function(){return new t(-1,-1)}),t}(),Utils3D=function(){function t(){}return __class(t,"laya.d3.utils.Utils3D"),t._rotationTransformScaleSkinAnimation=function(e,i,n,r,a,s,o,l,_,h,u,c){var d=t._tempArray16_0,f=t._tempArray16_1,m=t._tempArray16_2,p=r+r,g=a+a,v=s+s,x=r*p,y=a*p,T=a*g,D=s*p,E=s*g,S=s*v,M=o*p,R=o*g,A=o*v;d[15]=1,d[0]=1-T-S,d[1]=y+A,d[2]=D-R,d[4]=y-A,d[5]=1-x-S,d[6]=E+M,d[8]=D+R,d[9]=E-M,d[10]=1-x-T,f[15]=1,f[0]=l,f[5]=_,f[10]=h;var C,L,I,w,b;for(C=0;4>C;C++)L=d[C],I=d[C+4],w=d[C+8],b=d[C+12],m[C]=L,m[C+4]=I,m[C+8]=w,m[C+12]=L*e+I*i+w*n+b;for(C=0;4>C;C++)L=m[C],I=m[C+4],w=m[C+8],b=m[C+12],u[C+c]=L*f[0]+I*f[1]+w*f[2]+b*f[3],u[C+c+4]=L*f[4]+I*f[5]+w*f[6]+b*f[7],u[C+c+8]=L*f[8]+I*f[9]+w*f[10]+b*f[11],u[C+c+12]=L*f[12]+I*f[13]+w*f[14]+b*f[15]},t._createNodeByJson=function(e,i,n,r,a){if(!n)switch(i.type){case"Sprite3D":n=new Sprite3D;break;case"MeshSprite3D":n=new MeshSprite3D,a&&a.push(n);break;case"SkinnedMeshSprite3D":n=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":n=new ShuriKenParticle3D;break;case"Terrain":n=new Terrain;break;case"Camera":n=new Camera;break;case"DirectionLight":n=new DirectionLight;break;case"TrailSprite3D":n=new TrailSprite3D;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var s=i.child;if(s)for(var o=0,l=s.length;l>o;o++){var _=t._createNodeByJson(e,s[o],null,r,a);n.addChild(_)}var h=i.props;if(h)for(var u in h)n[u]=h[u];var c=i.components;if(c instanceof Array)for(var d=0,f=c.length;f>d;d++){var m=c[d],p=Browser.window.Laya[m.type];if(!p)throw"Unkown component type.";var g=n.addComponent(p);g._parse(m,r)}else for(var v in c){if(p=Browser.window.Laya[v],!p)throw"Unkown component type.";var x=n.addComponent(p);x._parse(c[v],r)}return n._parse(i.customProps,r),n},t._computeBoneAndAnimationDatasByBindPoseMatrxix=function(t,e,i,n,r,a){var s,o,l=0,_=0,h=t.length;for(s=0;h>s;l+=t[s].keyframeWidth,_+=16,s++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[l+0],e[l+1],e[l+2],e[l+3],e[l+4],e[l+5],e[l+6],e[l+7],e[l+8],e[l+9],n,_),0!=s&&(o=16*t[s].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,o,n,_,n,_));var u=i.length;for(s=0;u>s;s++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,16*a[s],i[s],r,16*s)},t._computeAnimationDatasByArrayAndMatrixFast=function(t,e,i,n){for(var r=0,a=t.length;a>r;r++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,16*n[r],t[r],i,16*r)},t._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(t,e,i,n,r){var a,s,o=0,l=0,_=t.length;for(a=0;_>a;o+=t[a].keyframeWidth,l+=16,a++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[o+7],e[o+8],e[o+9],e[o+3],e[o+4],e[o+5],e[o+6],e[o+0],e[o+1],e[o+2],n,l),0!=a&&(s=16*t[a].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,s,n,l,n,l));var h=i.length;for(a=0;h>a;a++){var u=16*a;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,u,i[a],r,u)}},t._computeAnimationDatasByArrayAndMatrixFastOld=function(t,e,i){for(var n=t.length,r=0;n>r;r++){var a=16*r;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,a,t[r],i,a)}},t._computeRootAnimationData=function(t,e,i){for(var n=0,r=0,a=0,s=t.length;s>n;r+=t[n].keyframeWidth,a+=16,n++)laya.d3.utils.Utils3D.createAffineTransformationArray(e[r+0],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],i,a)},t.transformVector3ArrayByQuat=function(t,e,i,n,r){var a=i.elements,s=t[e],o=t[e+1],l=t[e+2],_=a[0],h=a[1],u=a[2],c=a[3],d=c*s+h*l-u*o,f=c*o+u*s-_*l,m=c*l+_*o-h*s,p=-_*s-h*o-u*l;n[r]=d*c+p*-_+f*-u-m*-h,n[r+1]=f*c+p*-h+m*-_-d*-u,n[r+2]=m*c+p*-u+d*-h-f*-_},t.mulMatrixByArray=function(e,i,n,r,a,s){var o,l,_,h,u;if(a===n){for(n=t._tempArray16_3,o=0;16>o;++o)n[o]=a[s+o];r=0}for(o=0;4>o;o++)l=e[i+o],_=e[i+o+4],h=e[i+o+8],u=e[i+o+12],a[s+o]=l*n[r+0]+_*n[r+1]+h*n[r+2]+u*n[r+3],a[s+o+4]=l*n[r+4]+_*n[r+5]+h*n[r+6]+u*n[r+7],a[s+o+8]=l*n[r+8]+_*n[r+9]+h*n[r+10]+u*n[r+11],a[s+o+12]=l*n[r+12]+_*n[r+13]+h*n[r+14]+u*n[r+15]},t.mulMatrixByArrayFast=function(t,e,i,n,r,a){var s,o,l,_,h;for(s=0;4>s;s++)o=t[e+s],l=t[e+s+4],_=t[e+s+8],h=t[e+s+12],r[a+s]=o*i[n+0]+l*i[n+1]+_*i[n+2]+h*i[n+3],r[a+s+4]=o*i[n+4]+l*i[n+5]+_*i[n+6]+h*i[n+7],r[a+s+8]=o*i[n+8]+l*i[n+9]+_*i[n+10]+h*i[n+11],r[a+s+12]=o*i[n+12]+l*i[n+13]+_*i[n+14]+h*i[n+15]},t.mulMatrixByArrayAndMatrixFast=function(t,e,i,n,r){var a,s,o,l,_,h=i.elements,u=h[0],c=h[1],d=h[2],f=h[3],m=h[4],p=h[5],g=h[6],v=h[7],x=h[8],y=h[9],T=h[10],D=h[11],E=h[12],S=h[13],M=h[14],R=h[15],A=e,C=e+4,L=e+8,I=e+12,w=r,b=r+4,P=r+8,V=r+12;
for(a=0;4>a;a++)s=t[A+a],o=t[C+a],l=t[L+a],_=t[I+a],n[w+a]=s*u+o*c+l*d+_*f,n[b+a]=s*m+o*p+l*g+_*v,n[P+a]=s*x+o*y+l*T+_*D,n[V+a]=s*E+o*S+l*M+_*R},t.createAffineTransformationArray=function(t,e,i,n,r,a,s,o,l,_,h,u){var c=n+n,d=r+r,f=a+a,m=n*c,p=n*d,g=n*f,v=r*d,x=r*f,y=a*f,T=s*c,D=s*d,E=s*f;h[u+0]=(1-(v+y))*o,h[u+1]=(p+E)*o,h[u+2]=(g-D)*o,h[u+3]=0,h[u+4]=(p-E)*l,h[u+5]=(1-(m+y))*l,h[u+6]=(x+T)*l,h[u+7]=0,h[u+8]=(g+D)*_,h[u+9]=(x-T)*_,h[u+10]=(1-(m+v))*_,h[u+11]=0,h[u+12]=t,h[u+13]=e,h[u+14]=i,h[u+15]=1},t.transformVector3ArrayToVector3ArrayCoordinate=function(t,e,i,n,r){var a=t[e+0],s=t[e+1],o=t[e+2],l=i.elements,_=a*l[3]+s*l[7]+o*l[11]+l[15];n[r]=a*l[0]+s*l[4]+o*l[8]+l[12]/_,n[r+1]=a*l[1]+s*l[5]+o*l[9]+l[13]/_,n[r+2]=a*l[2]+s*l[6]+o*l[10]+l[14]/_},t.transformLightingMapTexcoordByUV0Array=function(t,e,i,n,r){var a=i.elements;n[r+0]=t[e+0]*a[0]+a[2],n[r+1]=(t[e+1]-1)*a[1]+a[3]},t.transformLightingMapTexcoordByUV1Array=function(t,e,i,n,r){var a=i.elements;n[r+0]=t[e+0]*a[0]+a[2],n[r+1]=1+t[e+1]*a[1]+a[3]},t.getURLVerion=function(t){var e=t.indexOf("?");return e>=0?t.substr(e):null},t._quaternionCreateFromYawPitchRollArray=function(t,e,i,n){var r=.5*i,a=.5*e,s=.5*t,o=Math.sin(r),l=Math.cos(r),_=Math.sin(a),h=Math.cos(a),u=Math.sin(s),c=Math.cos(s);n[0]=c*_*l+u*h*o,n[1]=u*h*l-c*_*o,n[2]=c*h*o-u*_*l,n[3]=c*h*l+u*_*o},t._createAffineTransformationArray=function(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=e[3],l=r+r,_=a+a,h=s+s,u=r*l,c=r*_,d=r*h,f=a*_,m=a*h,p=s*h,g=o*l,v=o*_,x=o*h,y=i[0],T=i[1],D=i[2];n[0]=(1-(f+p))*y,n[1]=(c+x)*y,n[2]=(d-v)*y,n[3]=0,n[4]=(c-x)*T,n[5]=(1-(u+p))*T,n[6]=(m+g)*T,n[7]=0,n[8]=(d+v)*D,n[9]=(m-g)*D,n[10]=(1-(u+f))*D,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1},t._mulMatrixArray=function(t,e,i,n){var r,a,s,o,l,_=e.elements,h=_[0],u=_[1],c=_[2],d=_[3],f=_[4],m=_[5],p=_[6],g=_[7],v=_[8],x=_[9],y=_[10],T=_[11],D=_[12],E=_[13],S=_[14],M=_[15],R=n,A=n+4,C=n+8,L=n+12;for(r=0;4>r;r++)a=t[r],s=t[r+4],o=t[r+8],l=t[r+12],i[R+r]=a*h+s*u+o*c+l*d,i[A+r]=a*f+s*m+o*p+l*g,i[C+r]=a*v+s*x+o*y+l*T,i[L+r]=a*D+s*E+o*S+l*M},t.getYawPitchRoll=function(e,i){t.transformQuat(Vector3.ForwardRH,e,Quaternion.TEMPVector31),t.transformQuat(Vector3.Up,e,Quaternion.TEMPVector32);var n=Quaternion.TEMPVector32.elements;t.angleTo(Vector3.ZERO,Quaternion.TEMPVector31,Quaternion.TEMPVector33);var r=Quaternion.TEMPVector33.elements;r[0]==Math.PI/2?(r[1]=t.arcTanAngle(n[2],n[0]),r[2]=0):r[0]==-Math.PI/2?(r[1]=t.arcTanAngle(-n[2],-n[0]),r[2]=0):(Matrix4x4.createRotationY(-r[1],Quaternion.TEMPMatrix0),Matrix4x4.createRotationX(-r[0],Quaternion.TEMPMatrix1),Vector3.transformCoordinate(Quaternion.TEMPVector32,Quaternion.TEMPMatrix0,Quaternion.TEMPVector32),Vector3.transformCoordinate(Quaternion.TEMPVector32,Quaternion.TEMPMatrix1,Quaternion.TEMPVector32),r[2]=t.arcTanAngle(n[1],-n[0])),r[1]<=-Math.PI&&(r[1]=Math.PI),r[2]<=-Math.PI&&(r[2]=Math.PI),r[1]>=Math.PI&&r[2]>=Math.PI&&(r[1]=0,r[2]=0,r[0]=Math.PI-r[0]),i[0]=r[1],i[1]=r[0],i[2]=r[2]},t.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:t>0?Math.atan(e/t):0>t?e>0?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},t.angleTo=function(e,i,n){Vector3.subtract(i,e,Quaternion.TEMPVector30),Vector3.normalize(Quaternion.TEMPVector30,Quaternion.TEMPVector30),n.elements[0]=Math.asin(Quaternion.TEMPVector30.y),n.elements[1]=t.arcTanAngle(-Quaternion.TEMPVector30.z,-Quaternion.TEMPVector30.x)},t.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,a=e,s=r[0],o=r[1],l=r[2],_=a[0],h=a[1],u=a[2],c=a[3],d=c*s+h*l-u*o,f=c*o+u*s-_*l,m=c*l+_*o-h*s,p=-_*s-h*o-u*l;n[0]=d*c+p*-_+f*-u-m*-h,n[1]=f*c+p*-h+m*-_-d*-u,n[2]=m*c+p*-u+d*-h-f*-_},t.quaterionNormalize=function(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=i*i+n*n+r*r+a*a;s>0&&(s=1/Math.sqrt(s),e[0]=i*s,e[1]=n*s,e[2]=r*s,e[3]=a*s)},t.quaterionSlerp=function(t,e,i,n){var r,a,s,o,l,_=t[0],h=t[1],u=t[2],c=t[3],d=e[0],f=e[1],m=e[2],p=e[3];a=_*d+h*f+u*m+c*p,0>a&&(a=-a,d=-d,f=-f,m=-m,p=-p),1-a>1e-6?(r=Math.acos(a),s=Math.sin(r),o=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(o=1-i,l=i),n[0]=o*_+l*d,n[1]=o*h+l*f,n[2]=o*u+l*m,n[3]=o*c+l*p},t.quaternionMultiply=function(t,e,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=e[0],l=e[1],_=e[2],h=e[3],u=r*_-a*l,c=a*o-n*_,d=n*l-r*o,f=n*o+r*l+a*_;i[0]=n*h+o*s+u,i[1]=r*h+l*s+c,i[2]=a*h+_*s+d,i[3]=s*h-f},t.matrix4x4MultiplyFFF=function(t,e,i){var n,i,t,e,r,a,s,o;if(i===e)for(e=new Float32Array(16),n=0;16>n;++n)e[n]=i[n];var l=e[0],_=e[1],h=e[2],u=e[3],c=e[4],d=e[5],f=e[6],m=e[7],p=e[8],g=e[9],v=e[10],x=e[11],y=e[12],T=e[13],D=e[14],E=e[15];for(n=0;4>n;n++)r=t[n],a=t[n+4],s=t[n+8],o=t[n+12],i[n]=r*l+a*_+s*h+o*u,i[n+4]=r*c+a*d+s*f+o*m,i[n+8]=r*p+a*g+s*v+o*x,i[n+12]=r*y+a*T+s*D+o*E},t.matrix4x4MultiplyFFFForNative=function(t,e,i){window.conch.matrix4x4Multiply(t,e,i)},t.matrix4x4MultiplyMFM=function(e,i,n){t.matrix4x4MultiplyFFF(e.elements,i,n.elements)},t._tempArray4_0=new Float32Array(4),t._tempArray16_0=new Float32Array(16),t._tempArray16_1=new Float32Array(16),t._tempArray16_2=new Float32Array(16),t._tempArray16_3=new Float32Array(16),__static(t,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new Vector3},"_tempVector3_1",function(){return this._tempVector3_1=new Vector3},"_tempVector3_2",function(){return this._tempVector3_2=new Vector3},"_tempVector3_3",function(){return this._tempVector3_3=new Vector3},"_tempVector3_4",function(){return this._tempVector3_4=new Vector3},"_tempVector3_5",function(){return this._tempVector3_5=new Vector3},"_tempVector3_6",function(){return this._tempVector3_6=new Vector3}]),t}(),Laya3D=function(){function t(){}return __class(t,"Laya3D"),t._cancelLoadByUrl=function(e){Laya.loader.cancelLoadByUrl(e),t._innerFirstLevelLoaderManager.cancelLoadByUrl(e),t._innerSecondLevelLoaderManager.cancelLoadByUrl(e),t._innerThirdLevelLoaderManager.cancelLoadByUrl(e),t._innerFourthLevelLoaderManager.cancelLoadByUrl(e)},t._changeWebGLSize=function(t,e){WebGL.onStageResize(t,e),RenderContext3D.clientWidth=t,RenderContext3D.clientHeight=e},t.__init__=function(){var e=LoaderManager.createMap;e.lh=[Sprite3D,"SPRITE3DHIERARCHY"],e.ls=[Scene3D,"SPRITE3DHIERARCHY"],e.lm=[Mesh,"MESH"],e.lmat=[laya.d3.core.material.StandardMaterial,"MATERIAL"],e.lpbr=[PBRMaterial,"MATERIAL"],e.ltc=[TextureCube,"TEXTURECUBE"],e.jpg=[Texture2D,"nativeimage"],e.jpeg=[Texture2D,"nativeimage"],e.png=[Texture2D,"nativeimage"],e.pkm=[Texture2D,"arraybuffer"],e.lsani=[AnimationTemplet,"arraybuffer"],e.lrani=[AnimationTemplet,"arraybuffer"],e.raw=[DataTexture2D,"arraybuffer"],e.mipmaps=[DataTexture2D,"arraybuffer"],e.ktx=[laya.d3.resource.VolumeTexture,"arraybuffer"],e.thdata=[TerrainHeightData,"arraybuffer"],e.lt=[TerrainRes,"TERRAIN"],e.lani=[AnimationClip,"arraybuffer"],e.lav=[Avatar,"json"],e.ani=[AnimationTemplet,"arraybuffer"],Loader.parserMap.SPRITE3DHIERARCHY=t._loadHierarchy,Loader.parserMap.MESH=t._loadMesh,Loader.parserMap.MATERIAL=t._loadMaterial,Loader.parserMap.TEXTURECUBE=t._loadTextureCube,Loader.parserMap.TERRAIN=t._loadTerrain,t._innerFirstLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerSecondLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerThirdLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerFourthLevelLoaderManager.on("error",null,t._eventLoadManagerError)},t.enableNative3D=function(){if(Render.isConchApp){var t=ShaderDatas,e=ShaderInstance,i=Avatar;t.prototype._initData=t.prototype._initDataForNative,t.prototype.setBool=t.prototype.setBoolForNative,t.prototype.getBool=t.prototype.getBoolForNative,t.prototype.setInt=t.prototype.setIntForNative,t.prototype.getInt=t.prototype.getIntForNative,t.prototype.setNumber=t.prototype.setNumberForNative,t.prototype.getNumber=t.prototype.getNumberForNative,t.prototype.setVector=t.prototype.setVectorForNative,t.prototype.getVector=t.prototype.getVectorForNative,t.prototype.setQuaternion=t.prototype.setQuaternionForNative,t.prototype.getQuaternion=t.prototype.getQuaternionForNative,t.prototype.setMatrix4x4=t.prototype.setMatrix4x4ForNative,t.prototype.getMatrix4x4=t.prototype.getMatrix4x4ForNative,t.prototype.setBuffer=t.prototype.setBufferForNative,t.prototype.getBuffer=t.prototype.getBufferForNative,t.prototype.setTexture=t.prototype.setTextureForNative,t.prototype.getTexture=t.prototype.getTextureForNative,t.prototype.setAttribute=t.prototype.setAttributeForNative,t.prototype.getAttribute=t.prototype.getAttributeForNative,e.prototype._uniformMatrix2fv=e.prototype._uniformMatrix2fvForNative,e.prototype._uniformMatrix3fv=e.prototype._uniformMatrix3fvForNative,e.prototype._uniformMatrix4fv=e.prototype._uniformMatrix4fvForNative,i.prototype._cloneDatasToAnimator=i.prototype._cloneDatasToAnimatorNative,FrustumCulling.renderObjectCulling=FrustumCulling.renderObjectCullingNative}},t.formatRelativePath=function(t,e){var i,n=e.charAt(0);if("."===n){for(var r=(t+e).split("/"),a=0,s=r.length;s>a;a++)if(".."==r[a]){var o=a-1;o>0&&".."!==r[o]&&(r.splice(o,2),a-=2)}i=r.join("/")}else i=t+e;return null!=URL.customFormat&&(i=URL.customFormat(i,null)),i},t._eventLoadManagerError=function(t){Laya.loader.event("error",t)},t._addHierarchyInnerUrls=function(e,i,n,r,a,s){var o=t.formatRelativePath(r,a);n&&(o+=n),e.push({url:o,clas:s}),i[a]=o},t._parseMaterial=function(e,i,n,r,a){var s=e.type.split("."),o=Browser.window;if(s.forEach(function(t){o=o[t]}),"function"!=typeof o)throw"_getSprite3DHierarchyInnerUrls 错误: "+e.type+" 不是类";t._addHierarchyInnerUrls(i,n,r,a,e.path,o)},t._getSprite3DHierarchyInnerUrls=function(e,i,n,r,a,s,o,l){var _=0,h=0,u=e.customProps;switch(e.type){case"Scene":var c=u.lightmaps;for(_=0,h=c.length;h>_;_++){var d=c[_].replace("exr","png");t._addHierarchyInnerUrls(a,s,o,l,d,Texture2D)}var f=u.reflectionTexture;f&&t._addHierarchyInnerUrls(r,s,o,l,f,TextureCube);var m=u.skyboxMaterial;m&&t._parseMaterial(m,n,s,o,l);break;case"Camera":var m=u.skyboxMaterial;m&&t._parseMaterial(m,n,s,o,l);break;case"TrailSprite3D":case"MeshSprite3D":case"SkinnedMeshSprite3D":var p=u.meshPath;p&&t._addHierarchyInnerUrls(i,s,o,l,p,Mesh);var g=u.materials;if(g)for(_=0,h=g.length;h>_;_++)t._parseMaterial(g[_],n,s,o,l);break;case"ShuriKenParticle3D":var v=u.meshPath;v&&t._addHierarchyInnerUrls(i,s,o,l,v,Mesh),t._parseMaterial(u.material,n,s,o,l);break;case"Terrain":t._addHierarchyInnerUrls(a,s,o,l,u.dataPath,TerrainRes)}var x=e.components;if(x)if(x instanceof Array)for(var y=0,T=x.length;T>y;y++){var D=x[y];switch(D.type){case"Animator":var E=D.avatarPath,S=D.avatar;S&&t._addHierarchyInnerUrls(a,s,o,l,S.path,Avatar);var M=D.clipPaths;if(M)for(_=0,h=M.length;h>_;_++)t._addHierarchyInnerUrls(a,s,o,l,M[_],AnimationClip);else for(var R=D.layers,_=0;_<R.length;_++)for(var A=R[_].states,C=0,L=A.length;L>C;C++){var I=A[C].clipPath;I&&t._addHierarchyInnerUrls(a,s,o,l,I,AnimationClip)}}}else for(y in x){var D=x[y];switch(y){case"Animator":if(E=D.avatarPath,S=D.avatar,S&&t._addHierarchyInnerUrls(a,s,o,l,S.path,Avatar),M=D.clipPaths)for(_=0,h=M.length;h>_;_++)t._addHierarchyInnerUrls(a,s,o,l,M[_],AnimationClip);else for(R=D.layers,_=0;_<R.length;_++)for(A=R[_].states,C=0,L=A.length;L>C;C++)I=A[C].clipPath,I&&t._addHierarchyInnerUrls(a,s,o,l,I,AnimationClip)}}var w=e.child;for(_=0,h=w.length;h>_;_++)t._getSprite3DHierarchyInnerUrls(w[_],i,n,r,a,s,o,l)},t._loadHierarchy=function(e){e.on("loaded",null,t._onHierarchylhLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onHierarchylhLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r=e.url,a=Utils3D.getURLVerion(r),s=URL.getPath(r),o=[],l=[],_=[],h=[],u={};t._getSprite3DHierarchyInnerUrls(n,o,l,_,h,u,a,s);var c=o.length+l.length+h.length,d=c+1,f=1/d;if(t._onProcessChange(e,0,f,1),h.length>0){var m=c/d,p=Handler.create(null,t._onProcessChange,[e,f,m],!1);t._innerFourthLevelLoaderManager.create(h,Handler.create(null,t._onHierarchyInnerForthLevResouLoaded,[e,i,p,n,u,o,l,_,f+m*h.length,m]),p,null,null,1,!0,i)}else t._onHierarchyInnerForthLevResouLoaded(e,i,null,n,u,o,l,_,f,m)}},t._onHierarchyInnerForthLevResouLoaded=function(e,i,n,r,a,s,o,l,_,h){if(e._class.destroyed)e.endLoad();else if(n&&n.recover(),l.length>0){var u=Handler.create(null,t._onProcessChange,[e,_,h],!1);t._innerThirdLevelLoaderManager.create(l,Handler.create(null,t._onHierarchyInnerThirdLevResouLoaded,[e,i,u,r,a,s,o,_+h*o.length,h]),n,null,null,1,!0,i)}else t._onHierarchyInnerThirdLevResouLoaded(e,i,null,r,a,s,o,_,h)},t._onHierarchyInnerThirdLevResouLoaded=function(e,i,n,r,a,s,o,l,_){if(e._class.destroyed)e.endLoad();else if(n&&n.recover(),o.length>0){var h=Handler.create(null,t._onProcessChange,[e,l,_],!1);t._innerSecondLevelLoaderManager.create(o,Handler.create(null,t._onHierarchyInnerSecondLevResouLoaded,[e,i,h,r,a,s,l+_*o.length,_]),n,null,null,1,!0,i)}else t._onHierarchyInnerSecondLevResouLoaded(e,i,null,r,a,s,l,_)},t._onHierarchyInnerSecondLevResouLoaded=function(e,i,n,r,a,s,o,l){if(e._class.destroyed)e.endLoad();else if(n&&n.recover(),s.length>0){var _=Handler.create(null,t._onProcessChange,[e,o,l],!1);t._innerFirstLevelLoaderManager.create(s,Handler.create(null,t._onHierarchyInnerFirstLevResouLoaded,[e,_,r,a]),n,null,null,1,!0,i)}else t._onHierarchyInnerFirstLevResouLoaded(e,null,r,a)},t._onHierarchyInnerFirstLevResouLoaded=function(t,e,i,n){e&&e.recover(),t.endLoad([i,n])},t._loadTerrain=function(e){e.on("loaded",null,t._onTerrainLtLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onTerrainLtLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,a,s=e.url,o=Utils3D.getURLVerion(s),l=URL.getPath(s),_=[],h={},u=0,c=0,d=n.heightData;r=d.url,a=t.formatRelativePath(l,r),o&&(a+=o),h[r]=a,r=a;var f=n.detailTexture;for(u=0,c=f.length;c>u;u++)_.push({url:f[u].diffuse});var m=n.normalMap;for(u=0,c=m.length;c>u;u++)_.push({url:m[u]});var p=n.alphaMap;for(u=0,c=p.length;c>u;u++)_.push({url:p[u],params:[1,!1]});for(u=0,c=_.length;c>u;u++){var g=_[u].url;a=t.formatRelativePath(l,g),o&&(a+=o),_[u].url=a,h[g]=a}var v=_.length,x=v+2,y=1/x;t._onProcessChange(e,0,y,1);var T={heightMapLoaded:!1,texturesLoaded:!1},D=Handler.create(null,t._onProcessChange,[e,y,y],!1);t._innerFourthLevelLoaderManager.create(r,Handler.create(null,t._onTerrainHeightMapLoaded,[e,D,n,h,T]),D,null,[d.numX,d.numZ,d.bitType,d.value],1,!0,i);var E=Handler.create(null,t._onProcessChange,[e,2*y,v/x],!1);t._innerFourthLevelLoaderManager.create(_,Handler.create(null,t._onTerrainTexturesLoaded,[e,E,n,h,T]),E,null,null,1,!0,i)}},t._onTerrainHeightMapLoaded=function(t,e,i,n,r){r.heightMapLoaded=!0,r.texturesLoaded&&(t.endLoad([i,n]),e.recover())},t._onTerrainTexturesLoaded=function(t,e,i,n,r){r.texturesLoaded=!0,r.heightMapLoaded&&(t.endLoad([i,n]),e.recover())},t._loadMesh=function(e){e.on("loaded",null,t._onMeshLmLoaded,[e,e._class._getGroup()]),e.load(e.url,"arraybuffer",!1,null,!0)},t._onMeshLmLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,a,s=e.url,o=Utils3D.getURLVerion(s),l=URL.getPath(s),_={},h=0,u=0,c=0,d=new Byte(n);d.pos=0;var f=d.readUTFString();switch(f){case"LAYAMODEL:03":case"LAYAMODEL:0301":case"LAYAMODEL:0400":var m=d.getUint32();d.pos=d.pos+4,c=d.getUint16(),d.pos=d.pos+8*c;var p=d.getUint32();for(c=d.getUint16(),d.pos=m+p,r=[],h=0;c>h;h++){var g=d.readUTFString();-1!==g.lastIndexOf(".lmat")&&r.push(g)}break;default:throw new Error("Laya3D:unknown mesh version.")}for(h=0,u=r.length;u>h;h++){var v=r[h];a=t.formatRelativePath(l,v),o&&(a+=o),r[h]=a,_[v]=a}if(r.length>0){var x=1,y=x+1,T=1/y;t._onProcessChange(e,0,T,1);var D=Handler.create(null,t._onProcessChange,[e,T,x/y],!1);t._innerSecondLevelLoaderManager.create(r,Handler.create(null,t._onMeshMateialLoaded,[e,D,n,_]),D,null,null,1,!0,i)}else e.endLoad([n,_])}},t._onMeshMateialLoaded=function(t,e,i,n){t.endLoad([i,n]),e.recover()},t._loadMaterial=function(e){e.on("loaded",null,t._onMaterilLmatLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onMaterilLmatLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,a=e.url,s=Utils3D.getURLVerion(a),o=URL.getPath(a),l=[],_={},h=(n.customProps,n.version);switch(h){case"LAYAMATERIAL:01":var u=0,c=0,d=n.props.textures;if(d)for(u=0,c=d.length;c>u;u++){var f=d[u],m=f.path;if(m){var p=m.length-4;(m.indexOf(".exr")==p||m.indexOf(".EXR")==p)&&(m=m.substr(0,p)+".png"),r=t.formatRelativePath(o,m),s&&(r+=s),l.push({url:r,params:f.params}),_[m]=r}}break;default:throw new Error("Laya3D:unkonwn version.")}var g=l.length,v=g+1,x=1/v;if(t._onProcessChange(e,0,x,1),g>0){var y=Handler.create(null,t._onProcessChange,[e,x,g/v],!1);t._innerFourthLevelLoaderManager.create(l,Handler.create(null,t._onMateialTexturesLoaded,[e,y,n,_]),y,null,null,1,!0,i)}else t._onMateialTexturesLoaded(e,null,n,null)}},t._onMateialTexturesLoaded=function(t,e,i,n){t.endLoad([i,n]),e&&e.recover()},t._loadTextureCube=function(e){e.on("loaded",null,t._onTextureCubeLtcLoaded,[e]),e.load(e.url,"json",!1,null,!0)},t._onTextureCubeLtcLoaded=function(e,i){if(e._class.destroyed)e.endLoad();else{var n=URL.getPath(e.url),r=[t.formatRelativePath(n,i.front),t.formatRelativePath(n,i.back),t.formatRelativePath(n,i.left),t.formatRelativePath(n,i.right),t.formatRelativePath(n,i.up),t.formatRelativePath(n,i.down)],a=1/7;t._onProcessChange(e,0,a,1);var s=Handler.create(null,t._onProcessChange,[e,a,6/7],!1);t._innerFourthLevelLoaderManager.load(r,Handler.create(null,t._onTextureCubeImagesLoaded,[e,r,s]),s,"nativeimage")}},t._onTextureCubeImagesLoaded=function(t,e,i){for(var n=new Array(6),r=0;6>r;r++)n[r]=Loader.getRes(e[r]);t.endLoad(n),i.recover();for(var r=0;6>r;r++)Loader.clearRes(e[r])},t._onProcessChange=function(t,e,i,n){n=e+n*i,1>n&&t.event("progress",n)},t.init=function(e,i,n,r,a,s){return void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=!0),void 0===s&&(s=!0),RunDriver.cancelLoadByUrl=function(e){t._cancelLoadByUrl(e)},Config.isAntialias=n,Config.isAlpha=r,Config.premultipliedAlpha=a,Config.isStencil=s,WebGL.enable()?(Render.isConchApp||(LayaGL.instance=WebGL.mainContext,LayaGL.instance.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new CommandEncoder(this,t,e,i)}),RunDriver.changeWebGLSize=t._changeWebGLSize,Render.is3DMode=!0,Laya.init(e,i),Render.isConchApp&&t.enableNative3D(),Physics.__init__(),RenderableSprite3D.__init__(),SkinnedMeshSprite3D.__init__(),ShuriKenParticle3D.__init__(),BaseMaterial.__init__(),BlinnPhongMaterial.__init__(),PBRMaterial.__init__(),PBRStandardMaterial.__init__(),PBRSpecularMaterial.__init__(),UnlitMaterial.__init__(),TrailSprite3D.__init__(),TrailMaterial.__init__(),WaterPrimaryMaterial.__init__(),ShurikenParticleMaterial.__init__(),TerrainMaterial.__init__(),ExtendTerrainMaterial.__init__(),ShaderInit3D.__init__(),MeshSprite3D.__init__(),AnimationNode.__init__(),Texture2D.__init__(),TextureCube.__init__(),SkyBox.__init__(),FrustumCulling.__init__(),t.__init__(),(t.debugMode||OctreeNode.debugMode)&&(t._debugPhasorSprite=new PhasorSpriter3D),void 0):(alert("Laya3D init error,must support webGL!"),void 0)},t.HIERARCHY="SPRITE3DHIERARCHY",t.MESH="MESH",t.MATERIAL="MATERIAL",t.PBRMATERIAL="PBRMTL",t.TEXTURECUBE="TEXTURECUBE",t.TERRAIN="TERRAIN",t._debugPhasorSprite=null,t.debugMode=!1,__static(t,["_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new LoaderManager},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new LoaderManager},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new LoaderManager},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new LoaderManager}]),t}(),LayoutStyle=function(){function t(){this.enable=!1,this.top=0/0,this.bottom=0/0,this.left=0/0,this.right=0/0,this.centerX=0/0,this.centerY=0/0,this.anchorX=0/0,this.anchorY=0/0}return __class(t,"laya.ui.LayoutStyle"),__static(t,["EMPTY",function(){return this.EMPTY=new t}]),t}(),UIUtils=function(){function t(){}return __class(t,"laya.ui.UIUtils"),t.fillArray=function(t,e,i){var n=t.concat();if(e)for(var r=e.split(","),a=0,s=Math.min(n.length,r.length);s>a;a++){var o=r[a];n[a]="true"==o?!0:"false"==o?!1:o,null!=i&&(n[a]=i(o))}return n},t.toColor=function(t){return Utils.toHexColor(t)},t.gray=function(e,i){void 0===i&&(i=!0),i?t.addFilter(e,t.grayFilter):t.clearFilter(e,ColorFilter)},t.addFilter=function(t,e){var i=t.filters||[];i.push(e),t.filters=i},t.clearFilter=function(t,e){var i=t.filters;if(null!=i&&i.length>0){for(var n=i.length-1;n>-1;n--){var r=i[n];Laya.__typeof(r,e)&&i.splice(n,1)}t.filters=i}},t._getReplaceStr=function(e){return t.escapeSequence[e]},t.adptString=function(e){return e.replace(/\\(\w)/g,t._getReplaceStr)},t.getBindFun=function(e){var i=t._funMap.get(e);if(null==i){var n='"'+e+'"';n=n.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"');var r="(function(data){if(data==null)return;with(data){try{\nreturn "+n+"\n}catch(e){}}})";i=Browser.window.eval(r),t._funMap.set(e,i)}return i},__static(t,["grayFilter",function(){return this.grayFilter=new ColorFilter([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"	"}},"_funMap",function(){return this._funMap=new WeakObject}]),t}(),MiniAdpter=function(){function t(){}return __class(t,"laya.wx.mini.MiniAdpter"),t.getJson=function(t){return JSON.parse(t)},t.init=function(e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),t._inited||(t._inited=!0,t.window=window,t.window.navigator.userAgent.indexOf("MiniGame")<0||(t.isZiYu=i,t.isPosMsgYu=e,t.EnvConfig={},t.isZiYu||(MiniFileMgr.setNativeFileDir("/layaairGame"),MiniFileMgr.existDir(MiniFileMgr.fileNativeDir,Handler.create(t,t.onMkdirCallBack))),t.systemInfo=wx.getSystemInfoSync(),t.window.focus=function(){},Laya.getUrlPath=function(){},t.window.logtime=function(){},t.window.alertTimeLog=function(){},t.window.resetShareInfo=function(){},t.window.CanvasRenderingContext2D=function(){},t.window.CanvasRenderingContext2D.prototype=t.window.wx.createCanvas().getContext("2d").__proto__,t.window.document.body.appendChild=function(){},t.EnvConfig.pixelRatioInt=0,RunDriver.getPixelRatio=t.pixelRatio,t._preCreateElement=Browser.createElement,Browser.createElement=t.createElement,RunDriver.createShaderCondition=t.createShaderCondition,Utils.parseXMLFromString=t.parseXMLFromString,Input._createInputElement=MiniInput._createInputElement,LocalStorage._baseClass=MiniLocalStorage,MiniLocalStorage.__init__()))},t.getUrlEncode=function(t,e){return-1!=t.indexOf(".fnt")?"utf8":"arraybuffer"==e?"":"ascii"},t.downLoadFile=function(t,e,i,n){void 0===e&&(e=""),void 0===n&&(n="ascii");var r=MiniFileMgr.getFileInfo(t);r?null!=i&&i.runWith([0]):MiniFileMgr.downLoadFile(t,e,i,n)},t.remove=function(t,e){MiniFileMgr.deleteFile("",t,e,"",0)},t.removeAll=function(){MiniFileMgr.deleteAll()},t.hasNativeFile=function(t){return MiniFileMgr.isLocalNativeFile(t)},t.getFileInfo=function(t){return MiniFileMgr.getFileInfo(t)},t.getFileList=function(){return MiniFileMgr.filesListObj},t.exitMiniProgram=function(){t.window.wx.exitMiniProgram()},t.onMkdirCallBack=function(t,e){t||(MiniFileMgr.filesListObj=JSON.parse(e.data))},t.pixelRatio=function(){if(!t.EnvConfig.pixelRatioInt)try{return t.EnvConfig.pixelRatioInt=t.systemInfo.pixelRatio,t.systemInfo.pixelRatio}catch(e){}return t.EnvConfig.pixelRatioInt},t.createElement=function(e){if("canvas"==e){var i;return 1==t.idx?t.isZiYu?(i=sharedCanvas,i.style={}):i=window.canvas:i=window.wx.createCanvas(),t.idx++,i}if("textarea"==e||"input"==e)return t.onCreateInput(e);if("div"==e){var n=t._preCreateElement(e);return n.contains=function(){return null},n.removeChild=function(){},n}return t._preCreateElement(e)},t.onCreateInput=function(e){var i=t._preCreateElement(e);return i.focus=MiniInput.wxinputFocus,i.blur=MiniInput.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(){},i.setType=function(){},i.setFontFace=function(){},i.addEventListener=function(){},i.contains=function(){return null},i.removeChild=function(){},i},t.createShaderCondition=function(t){var e=this,i=function(){return e[t.replace("this.","")]};return i},t.EnvConfig=null,t.window=null,t._preCreateElement=null,t._inited=!1,t.systemInfo=null,t.isZiYu=!1,t.isPosMsgYu=!1,t.autoCacheFile=!0,t.minClearSize=5242880,t.AutoCacheDownFile=!1,t.parseXMLFromString=function(t){var e;t=t.replace(/>\s+</g,"><");try{e=(new window.Parser.DOMParser).parseFromString(t,"text/xml")}catch(i){throw"需要引入xml解析库文件"}return e},t.idx=1,__static(t,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),t}(),MiniFileMgr=function(){function t(){}return __class(t,"laya.wx.mini.MiniFileMgr"),t.isLocalNativeFile=function(t){for(var e=0,i=MiniAdpter.nativefiles.length;i>e;e++)if(-1!=t.indexOf(MiniAdpter.nativefiles[e]))return!0;return!1},t.getFileInfo=function(e){var i=e.split("?")[0],n=t.filesListObj[i];return null==n?null:n},t.read=function(e,i,n,r,a,s){void 0===i&&(i="ascill"),void 0===r&&(r=""),void 0===a&&(a=!1),void 0===s&&(s="");var o;o=""==r||-1==r.indexOf("http://")&&-1==r.indexOf("https://")?e:t.getFileNativePath(e),t.fs.readFile({filePath:o,encoding:i,success:function(t){null!=n&&n.runWith([0,t])},fail:function(e){e&&""!=r?t.downFiles(r,i,n,r,a,s):null!=n&&n.runWith([1])}})},t.downFiles=function(e,i,n,r,a,s,o){void 0===i&&(i="ascii"),void 0===r&&(r=""),void 0===a&&(a=!1),void 0===s&&(s=""),void 0===o&&(o=!0);var l=t.wxdown({url:e,success:function(e){200===e.statusCode&&t.readFile(e.tempFilePath,i,n,r,a,s,o)},fail:function(t){null!=n&&n.runWith([1,t])}});l.onProgressUpdate(function(t){null!=n&&n.runWith([2,t.progress])})},t.readFile=function(e,i,n,r,a,s,o){void 0===i&&(i="ascill"),void 0===r&&(r=""),void 0===a&&(a=!1),void 0===s&&(s=""),void 0===o&&(o=!0),t.fs.readFile({filePath:e,encoding:i,success:function(s){-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?(MiniAdpter.autoCacheFile||a)&&t.copyFile(e,r,n,i,o):null!=n&&n.runWith([0,s])},fail:function(t){t&&null!=n&&n.runWith([1,t])}})},t.downOtherFiles=function(e,i,n,r,a){void 0===n&&(n=""),void 0===r&&(r=!1),void 0===a&&(a=!0),t.wxdown({url:e,success:function(e){200===e.statusCode&&((MiniAdpter.autoCacheFile||r)&&-1==n.indexOf("wx.qlogo.cn")&&-1==n.indexOf(".php")?t.copyFile(e.tempFilePath,n,i,"",a):null!=i&&i.runWith([0,e.tempFilePath]))},fail:function(t){null!=i&&i.runWith([1,t])}})},t.downLoadFile=function(e,i,n,r){void 0===i&&(i=""),void 0===r&&(r="ascii"),"image"==i||"sound"==i?t.downOtherFiles(e,n,e,!0,!1):t.downFiles(e,r,n,e,!0,i,!1)},t.copyFile=function(e,i,n,r,a){void 0===r&&(r=""),void 0===a&&(a=!0);var s=e.split("/"),o=s[s.length-1],l=(i.split("?")[0],t.getFileInfo(i)),_=t.getFileNativePath(o),h=52428800,u=4194304,c=t.getCacheUseSize();l?l.readyUrl!=i?t.fs.getFileInfo({filePath:e,success:function(e){a&&c+u+e.size>=h&&(e.size>MiniAdpter.minClearSize&&(MiniAdpter.minClearSize=e.size),t.onClearCacheRes()),t.deleteFile(o,i,n,r,e.size)},fail:function(t){null!=n&&n.runWith([1,t])}}):null!=n&&n.runWith([0]):t.fs.getFileInfo({filePath:e,success:function(s){a&&c+u+s.size>=h&&(s.size>MiniAdpter.minClearSize&&(MiniAdpter.minClearSize=s.size),t.onClearCacheRes()),t.fs.copyFile({srcPath:e,destPath:_,success:function(){t.onSaveFile(i,o,!0,r,n,s.size)},fail:function(t){null!=n&&n.runWith([1,t])}})},fail:function(t){null!=n&&n.runWith([1,t])}})},t.onClearCacheRes=function(){var e=MiniAdpter.minClearSize,i=[];for(var n in t.filesListObj)i.push(t.filesListObj[n]);t.sortOn(i,"time",16);for(var r=0,a=1,s=i.length;s>a;a++){var o=i[a];if(r>=e)break;r+=o.size,t.deleteFile("",o.readyUrl)}},t.sortOn=function(t,e,i){return void 0===i&&(i=0),16==i?t.sort(function(t,i){return t[e]-i[e]}):18==i?t.sort(function(t,i){return i[e]-t[e]}):t.sort(function(t,i){return t[e]-i[e]})},t.getFileNativePath=function(t){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+t},t.deleteFile=function(e,i,n,r,a){void 0===i&&(i=""),void 0===r&&(r=""),void 0===a&&(a=0);var s=t.getFileInfo(i),o=t.getFileNativePath(s.md5);t.fs.unlink({filePath:o,success:function(){var s=""!=e?!0:!1;if(""!=e){var o=t.getFileNativePath(e);t.fs.copyFile({srcPath:e,destPath:o,success:function(a){t.onSaveFile(i,e,s,r,n,a.size)},fail:function(t){null!=n&&n.runWith([1,t])}})}else t.onSaveFile(i,e,s,r,n,a)},fail:function(){}})},t.deleteAll=function(){var e=[];for(var i in t.filesListObj)e.push(t.filesListObj[i]);for(var n=1,r=e.length;r>n;n++){var a=e[n];t.deleteFile("",a.readyUrl)}},t.onSaveFile=function(e,i,n,r,a,s){void 0===n&&(n=!0),void 0===r&&(r=""),void 0===s&&(s=0);var o=e.split("?")[0];if(null==t.filesListObj.fileUsedSize&&(t.filesListObj.fileUsedSize=0),n){{t.getFileNativePath(i)}t.filesListObj[o]={md5:i,readyUrl:e,size:s,times:Browser.now(),encoding:r},t.filesListObj.fileUsedSize=parseInt(t.filesListObj.fileUsedSize)+s,t.writeFilesList(o,JSON.stringify(t.filesListObj),!0),null!=a&&a.runWith([0])}else if(t.filesListObj[o]){var l=parseInt(t.filesListObj[o].size);t.filesListObj.fileUsedSize=parseInt(t.filesListObj.fileUsedSize)-l,delete t.filesListObj[o],t.writeFilesList(o,JSON.stringify(t.filesListObj),!1),null!=a&&a.runWith([0])}},t.writeFilesList=function(e,i,n){var r=t.fileNativeDir+"/"+t.fileListName;t.fs.writeFile({filePath:r,encoding:"utf8",data:i,success:function(){},fail:function(){}}),!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu&&wx.postMessage({url:e,data:t.filesListObj[e],isLoad:"filenative",isAdd:n})},t.getCacheUseSize=function(){return t.filesListObj&&t.filesListObj.fileUsedSize?t.filesListObj.fileUsedSize:0},t.existDir=function(e,i){t.fs.mkdir({dirPath:e,success:function(){null!=i&&i.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?t.readSync(t.fileListName,"utf8",i):null!=i&&i.runWith([1,e])}})},t.readSync=function(e,i,n,r){void 0===i&&(i="ascill"),void 0===r&&(r="");var a,s=t.getFileNativePath(e);try{a=t.fs.readFileSync(s,i),null!=n&&n.runWith([0,{data:a}])}catch(o){null!=n&&n.runWith([1])}},t.setNativeFileDir=function(e){t.fileNativeDir=wx.env.USER_DATA_PATH+e},t.filesListObj={},t.fileNativeDir=null,t.fileListName="layaairfiles.txt",t.ziyuFileData={},t.loadPath="",t.DESCENDING=2,t.NUMERIC=16,__static(t,["fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),t}(),MiniInput=function(){function t(){}return __class(t,"laya.wx.mini.MiniInput"),t._createInputElement=function(){Input._initInput(Input.area=Browser.createElement("textarea")),Input._initInput(Input.input=Browser.createElement("input")),Input.inputContainer=Browser.createElement("div"),Input.inputContainer.style.position="absolute",Input.inputContainer.style.zIndex=1e5,Browser.container.appendChild(Input.inputContainer),Input.inputContainer.setPos=function(t,e){Input.inputContainer.style.left=t+"px",Input.inputContainer.style.top=e+"px"},Laya.stage.on("resize",null,t._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(){window.dispatchEvent&&window.dispatchEvent("resize")}),SoundManager._soundClass=MiniSound,SoundManager._musicClass=MiniSound;var e=MiniAdpter.systemInfo.model,i=MiniAdpter.systemInfo.system;-1!=e.indexOf("iPhone")&&(Browser.onIPhone=!0,Browser.onIOS=!0,Browser.onIPad=!0,Browser.onAndroid=!1),(-1!=i.indexOf("Android")||-1!=i.indexOf("Adr"))&&(Browser.onAndroid=!0,Browser.onIPhone=!1,Browser.onIOS=!1,Browser.onIPad=!1)},t._onStageResize=function(){var t=Laya.stage._canvasTransform.identity();t.scale(Browser.width/Render.canvas.width/RunDriver.getPixelRatio(),Browser.height/Render.canvas.height/RunDriver.getPixelRatio())},t.wxinputFocus=function(){var t=Input.inputElement.target;(!t||t.editable)&&(MiniAdpter.window.wx.offKeyboardConfirm(),MiniAdpter.window.wx.offKeyboardInput(),MiniAdpter.window.wx.showKeyboard({defaultValue:t.text,maxLength:t.maxChars,multiple:t.multiline,confirmHold:!0,confirmType:"done",success:function(){},fail:function(){}}),MiniAdpter.window.wx.onKeyboardConfirm(function(e){var i=e?e.value:"";
t.text=i,t.event("input"),laya.wx.mini.MiniInput.inputEnter()}),MiniAdpter.window.wx.onKeyboardInput(function(e){var i=e?e.value:"";return t.multiline||-1==i.indexOf("\n")?(t.text=i,t.event("input"),void 0):(laya.wx.mini.MiniInput.inputEnter(),void 0)}))},t.inputEnter=function(){Input.inputElement.target.focus=!1},t.wxinputblur=function(){t.hideKeyboard()},t.hideKeyboard=function(){MiniAdpter.window.wx.offKeyboardConfirm(),MiniAdpter.window.wx.offKeyboardInput(),MiniAdpter.window.wx.hideKeyboard({success:function(){console.log("隐藏键盘")},fail:function(t){console.log("隐藏键盘出错:"+(t?t.errMsg:""))}})},t}(),MiniLocalStorage=function(){function t(){}return __class(t,"laya.wx.mini.MiniLocalStorage"),t.__init__=function(){t.items=t},t.setItem=function(t,e){try{wx.setStorage({key:t,data:e})}catch(i){laya.utils.ErrorLog.I&&laya.utils.ErrorLog.I.reportError("SLocal:",i.stack,null)}},t.getItem=function(t){return wx.getStorageSync(t)},t.setJSON=function(e,i){t.setItem(e,i)},t.getJSON=function(e){return t.getItem(e)},t.removeItem=function(t){wx.removeStorageSync(t)},t.clear=function(){wx.clearStorageSync()},t.getStorageInfoSync=function(){try{var t=wx.getStorageInfoSync();return console.log(t.keys),console.log(t.currentSize),console.log(t.limitSize),t}catch(e){}return null},t.support=!0,t.items=null,t}(),Node=function(t){function e(){this._bits=0,this._parent=null,this.name="",this.destroyed=!1,this.data=null,this._components=null,this._scene=null,this._active=!0,this._activeInHierarchy=!1,e.__super.call(this),this._children=e.ARRAY_EMPTY,this.createGLBuffer()}__class(e,"laya.display.Node",t);var i=e.prototype;return i.createGLBuffer=function(){},i._setBit=function(t,e){if(1===t){var i=this._getBit(t);i!=e&&this._updateDisplayedInstage()}e?this._bits|=t:this._bits&=~t},i._getBit=function(t){return 0!=(this._bits&t)},i._setUpNoticeChain=function(){this._getBit(1)&&this._setBitUp(1)},i._setBitUp=function(t){var e=this;for(e._setBit(t,!0),e=e._parent;e;){if(e._getBit(t))return;e._setBit(t,!0),e=e._parent}},i.on=function(t,e,i,n){return("display"===t||"undisplay"===t)&&(this._getBit(1)||this._setBitUp(1)),this._createListener(t,e,i,n,!1)},i.once=function(t,e,i,n){return("display"===t||"undisplay"===t)&&(this._getBit(1)||this._setBitUp(1)),this._createListener(t,e,i,n,!0)},i.destroy=function(t){void 0===t&&(t=!0),this._destroyAllComponent(),this.destroyed=!0,this._parent&&this._parent.removeChild(this),this._children&&(t?this.destroyChildren():this.removeChildren()),this._children=null,this.offAll()},i.destroyChildren=function(){if(this._children)for(var t=this._children.length-1;t>-1;t--)this._children[t].destroy(!0)},i.addChild=function(t){if(!t||this.destroyed||t===this)return t;if(t._zOrder&&this._setBit(2,!0),t._parent===this){var i=this.getChildIndex(t);i!==this._children.length-1&&(this._children.splice(i,1),this._children.push(t),this._childChanged())}else t._parent&&t._parent.removeChild(t),this._children===e.ARRAY_EMPTY&&(this._children=[]),this._children.push(t),t._setParent(this),this._childChanged();return t},i.addChildren=function(){for(var t=arguments,e=0,i=t.length;i>e;)this.addChild(t[e++])},i.addChildAt=function(t,i){if(!t||this.destroyed||t===this)return t;if(t._zOrder&&this._setBit(2,!0),i>=0&&i<=this._children.length){if(t._parent===this){var n=this.getChildIndex(t);this._children.splice(n,1),this._children.splice(i,0,t),this._childChanged()}else t._parent&&t._parent.removeChild(t),this._children===e.ARRAY_EMPTY&&(this._children=[]),this._children.splice(i,0,t),t._setParent(this);return t}throw new Error("appendChildAt:The index is out of bounds")},i.getChildIndex=function(t){return this._children.indexOf(t)},i.getChildByName=function(t){var e=this._children;if(e)for(var i=0,n=e.length;n>i;i++){var r=e[i];if(r.name===t)return r}return null},i.getChildAt=function(t){return this._children[t]||null},i.setChildIndex=function(t,e){var i=this._children;if(0>e||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var n=this.getChildIndex(t);if(0>n)throw new Error("setChildIndex:node is must child of this object.");return i.splice(n,1),i.splice(e,0,t),this._childChanged(),t},i._childChanged=function(){},i.removeChild=function(t){if(!this._children)return t;var e=this._children.indexOf(t);return this.removeChildAt(e)},i.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},i.removeChildByName=function(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e},i.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._children.splice(t,1),e._setParent(null)),e},i.removeChildren=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=2147483647),this._children&&this._children.length>0){var n=this._children;if(0===t&&i>=n.length-1){var r=n;this._children=e.ARRAY_EMPTY}else r=n.splice(t,i-t);for(var a=0,s=r.length;s>a;a++)r[a]._setParent(null)}return this},i.replaceChild=function(t,e){var i=this._children.indexOf(e);return i>-1?(this._children.splice(i,1,t),e._setParent(null),t._setParent(this),t):null},i._setParent=function(t){this._parent!==t&&(t?(this._parent=t,this._onAdded(),this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),t.displayedInStage&&this._displayChild(this,!0)),t._childChanged(this)):(this._onRemoved(),this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=t))},i._updateDisplayedInstage=function(){var t;t=this;for(var e=Laya.stage,i=!1;t;){if(t._getBit(1)){i=t._getBit(8);break}if(t===e||t._getBit(8)){i=!0;break}t=t._parent}this._setBit(8,i)},i._setDisplay=function(t){this._getBit(8)!==t&&(this._setBit(8,t),t?this.event("display"):this.event("undisplay"))},i._displayChild=function(t,e){var i=t._children;if(i)for(var n=0,r=i.length;r>n;n++){var a=i[n];a._getBit(1)&&(a._children.length>0?this._displayChild(a,e):a._setDisplay(e))}t._setDisplay(e)},i.contains=function(t){if(t===this)return!0;for(;t;){if(t._parent===this)return!0;t=t._parent}return!1},i.timerLoop=function(t,e,i,n,r,a){void 0===r&&(r=!0),void 0===a&&(a=!1);var s=this.scene?this.scene.timer:Laya.renderTimer;s.loop(t,e,i,n,r,a)},i.timerOnce=function(t,e,i,n,r){void 0===r&&(r=!0);var a=this.scene?this.scene.timer:Laya.renderTimer;a._create(!1,!1,t,e,i,n,r)},i.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0);var a=this.scene?this.scene.timer:Laya.renderTimer;a._create(!0,!0,t,e,i,n,r)},i.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0);var a=this.scene?this.scene.timer:Laya.renderTimer;a._create(!0,!1,t,e,i,n,r)},i.clearTimer=function(t,e){var i=this.scene?this.scene.timer:Laya.renderTimer;i.clear(t,e)},i._onActive=function(){},i._onInActive=function(){},i._onActiveInScene=function(){},i._onInActiveInScene=function(){},i._parse=function(){},i._afterInited=function(){if(this._components)for(var t=0,e=this._components.length;e>t;t++)this._components[t]._doAwake()},i._setBelongScene=function(t){if(this._scene=t,this._components)for(var e=0,i=this._components.length;i>e;e++)this._components[e]._setActiveInScene(!0);this._onActiveInScene();for(var e=0,i=this._children.length;i>e;e++)this._children[e]._setBelongScene(t)},i._setUnBelongScene=function(){if(this._onInActiveInScene(),this._components)for(var t=0,e=this._components.length;e>t;t++)this._components[t]._setActiveInScene(!1);this._scene=null;for(var t=0,e=this._children.length;e>t;t++)this._children[t]._setUnBelongScene()},i._activeHierarchy=function(){if(this._activeInHierarchy=!0,this._components)for(var t=0,e=this._components.length;e>t;t++)this._components[t]._setActive(!0);for(this._onActive(),t=0,e=this._children.length;e>t;t++){var i=this._children[t];i._active&&i._activeHierarchy()}},i._inActiveHierarchy=function(){if(this._onInActive(),this._components)for(var t=0,e=this._components.length;e>t;t++)this._components[t]._setActive(!1);for(this._activeInHierarchy=!1,t=0,e=this._children.length;e>t;t++){var i=this._children[t];i._active&&i._inActiveHierarchy()}},i._onAdded=function(){var t=this._parent.scene;t&&this._setBelongScene(t),this._parent.activeInHierarchy&&this._active&&this._activeHierarchy()},i._onRemoved=function(){this._parent.activeInHierarchy&&this._active&&this._inActiveHierarchy(),this._parent.scene&&this._setUnBelongScene()},i._addComponentInstance=function(t,e){void 0===e&&(e=!0),this._components=this._components||[],this._components.push(t),t._owner=this,t._customAdded=e,t._added(),this.activeInHierarchy&&t._setActive(!0),this._scene&&t._setActiveInScene(!0)},i._destroyComponent=function(t){if(this._components)for(var e=0,i=this._components.length;i>e;e++){var n=this._components[e];if(n===t){n._destroy(),this._components.splice(e,1);break}}},i._destroyAllComponent=function(){if(this._components){for(var t=0,e=this._components.length;e>t;t++){var i=this._components[t];i._destroy()}this._components.length=0}},i._cloneTo=function(t){var e=t;if(this._components)for(var i=0,n=this._components.length;n>i;i++){var r=e.addComponent(this._components[i].constructor);this._components[i]._cloneTo(r)}},i.addComponent=function(t){var e=new t;if(e.isSingleton&&this.getComponent(t))throw"无法实例"+t+"组件，"+t+"组件已存在！";return this._addComponentInstance(e,!0),e},i.getComponent=function(t){if(this._components)for(var e=0,i=this._components.length;i>e;e++){var n=this._components[e];if(Laya.__typeof(n,t))return n}return null},i.getComponents=function(t){var e;if(this._components)for(var i=0,n=this._components.length;n>i;i++){var r=this._components[i];Laya.__typeof(r,t)&&(e=e||[],e.push(r))}return e},__getset(0,i,"numChildren",function(){return this._children.length}),__getset(0,i,"parent",function(){return this._parent}),__getset(0,i,"activeInHierarchy",function(){return this._activeInHierarchy}),__getset(0,i,"active",function(){return this._active},function(t){this._active!==t&&(this._active=t,this._parent&&this._parent.activeInHierarchy&&(t?this._activeHierarchy():this._inActiveHierarchy()))}),__getset(0,i,"displayedInStage",function(){return this._getBit(1)?this._getBit(8):(this._setBitUp(1),this._getBit(8))}),__getset(0,i,"scene",function(){return this._scene}),e.ARRAY_EMPTY=[],e.PROP_EMPTY={},e}(EventDispatcher),Script=function(t){function e(){e.__super.call(this)}__class(e,"laya.components.Script",t);var i=e.prototype;return i._awake=function(){this.awake(),Laya.startTimer.callLater(this,this.start)},i._onEnable=function(){var t=laya.components.Script.prototype,e=this.owner.getComponent(ClassUtils.getClass("laya.physics.RigidBody"));if(e){var i=Laya.Physics;i?(this.onTriggerEnter!==t.onTriggerEnter&&i.I._regTrigger(this,e,0),this.onTriggerStay!==t.onTriggerStay&&i.I._regTrigger(this,e,1),this.onTriggerExit!==t.onTriggerExit&&i.I._regTrigger(this,e,2)):console.warn("Can not find 2d physics,use physics.js first.")}this.onMouseDown!==t.onMouseDown&&this.owner.on("mousedown",this,this.onMouseDown),this.onMouseUp!==t.onMouseUp&&this.owner.on("mouseup",this,this.onMouseUp),this.onClick!==t.onClick&&this.owner.on("click",this,this.onClick),this.onDoubleClick!==t.onDoubleClick&&this.owner.on("doubleclick",this,this.onDoubleClick),this.onRightClick!==t.onRightClick&&this.owner.on("rightclick",this,this.onRightClick),this.onMouseMove!==t.onMouseMove&&this.owner.on("mousemove",this,this.onMouseMove),this.onMouseOver!==t.onMouseOver&&this.owner.on("mouseover",this,this.onMouseOver),this.onMouseOut!==t.onMouseOut&&this.owner.on("mouseout",this,this.onMouseOut),this.onKeyDown!==t.onKeyDown&&Laya.stage.on("keydown",this,this.onKeyDown),this.onKeyPress!==t.onKeyPress&&Laya.stage.on("keypress",this,this.onKeyUp),this.onKeyUp!==t.onKeyUp&&Laya.stage.on("keyup",this,this.onKeyUp),this.update!==t.update&&Laya.updateTimer.frameLoop(1,this,this.update),this.lateUpdate!==t.lateUpdate&&Laya.lateTimer.frameLoop(1,this,this.lateUpdate),this.onPreRender!==t.onPreRender&&Laya.lateTimer.frameLoop(1,this,this.lateUpdate),this.onEnable()},i._onDisable=function(){var t=Laya.Physics;t&&t.I._unRegTrigger(this),this.owner.offAllCaller(this),Laya.stage.offAllCaller(this),Laya.startTimer.clearAll(this),Laya.updateTimer.clearAll(this),Laya.lateTimer.clearAll(this),this.onDisable()},i._onDestroy=function(){this.onDestroy()},i.awake=function(){},i.onEnable=function(){},i.start=function(){},i.onTriggerEnter=function(){},i.onTriggerStay=function(){},i.onTriggerExit=function(){},i.onMouseDown=function(){},i.onMouseUp=function(){},i.onClick=function(){},i.onDoubleClick=function(){},i.onRightClick=function(){},i.onMouseMove=function(){},i.onMouseOver=function(){},i.onMouseOut=function(){},i.onKeyDown=function(){},i.onKeyPress=function(){},i.onKeyUp=function(){},i.update=function(){},i.lateUpdate=function(){},i.onPreRender=function(){},i.onPostRender=function(){},i.onDisable=function(){},i.onDestroy=function(){},__getset(0,i,"isSingleton",function(){return!1}),e}(Component),AudioSound=function(t){function e(){this.url=null,this.audio=null,this.loaded=!1,e.__super.call(this)}__class(e,"laya.media.h5audio.AudioSound",t);var i=e.prototype;return i.dispose=function(){var t=e._audioCache[this.url];t&&(t.src="",delete e._audioCache[this.url])},i.load=function(t){function i(){r(),s.loaded=!0,s.event("complete")}function n(){a.load=null,r(),s.event("error")}function r(){a.removeEventListener("canplaythrough",i),a.removeEventListener("error",n)}t=URL.formatURL(t),this.url=t;var a=e._audioCache[t];if(a&&a.readyState>=2)return this.event("complete"),void 0;a||(a=Browser.createElement("audio"),a.src=t,e._audioCache[t]=a),a.addEventListener("canplaythrough",i),a.addEventListener("error",n);var s=this;this.audio=a,a.load?a.load():n()},i.play=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),!this.url)return null;var n;if(n=e._audioCache[this.url],!n)return null;var r;r=Pool.getItem("audio:"+this.url),Render.isConchApp?r||(r=Browser.createElement("audio"),r.src=n.src):r=r?r:n.cloneNode(!0);var a=new AudioSoundChannel(r);return a.url=this.url,a.loops=i,a.startTime=t,a.play(),SoundManager.addChannel(a),a},__getset(0,i,"duration",function(){var t=e._audioCache[this.url];return t?t.duration:0}),e._audioCache={},e}(EventDispatcher),SoundChannel=function(t){function e(){this.url=null,this.loops=0,this.startTime=0/0,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}__class(e,"laya.media.SoundChannel",t);var i=e.prototype;return i.play=function(){},i.stop=function(){},i.pause=function(){},i.resume=function(){},i.__runComplete=function(t){t&&t.run()},__getset(0,i,"volume",function(){return 1},function(){}),__getset(0,i,"position",function(){return 0}),__getset(0,i,"duration",function(){return 0}),e}(EventDispatcher),Sound=function(t){function e(){e.__super.call(this)}__class(e,"laya.media.Sound",t);var i=e.prototype;return i.load=function(){},i.play=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),null},i.dispose=function(){},__getset(0,i,"duration",function(){return 0}),e}(EventDispatcher),WebAudioSound=function(t){function e(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,e.__super.call(this)}__class(e,"laya.media.webaudio.WebAudioSound",t);var i=e.prototype;return i.load=function(t){var i=this;if(t=URL.formatURL(t),this.url=t,this.audioBuffer=e._dataCache[t],this.audioBuffer)return this._loaded(this.audioBuffer),void 0;if(e.e.on("loaded:"+t,this,this._loaded),e.e.on("err:"+t,this,this._err),!e.__loadingSound[t]){e.__loadingSound[t]=!0;var n=new Browser.window.XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){i.data=n.response,e.buffs.push({buffer:i.data,url:i.url}),e.decode()},n.onerror=function(){i._err()},n.send()}},i._err=function(){this._removeLoadEvents(),e.__loadingSound[this.url]=!1,this.event("error")},i._loaded=function(t){this._removeLoadEvents(),this.audioBuffer=t,e._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete")},i._removeLoadEvents=function(){e.e.off("loaded:"+this.url,this,this._loaded),e.e.off("err:"+this.url,this,this._err)},i.__playAfterLoaded=function(){if(this.__toPlays){var t,e=0,i=0;t=this.__toPlays,i=t.length;var n;for(e=0;i>e;e++)n=t[e],n[2]&&!n[2].isStopped&&this.play(n[0],n[1],n[2]);this.__toPlays.length=0}},i.play=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),i=i?i:new WebAudioSoundChannel,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=e,i.audioBuffer=this.audioBuffer,i.startTime=t,i.play(),SoundManager.addChannel(i),i},i.dispose=function(){delete e._dataCache[this.url],delete e.__loadingSound[this.url]},__getset(0,i,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),e.decode=function(){e.buffs.length<=0||e.isDecoding||(e.isDecoding=!0,e.tInfo=e.buffs.shift(),e.ctx.decodeAudioData(e.tInfo.buffer,e._done,e._fail))},e._done=function(t){e.e.event("loaded:"+e.tInfo.url,t),e.isDecoding=!1,e.decode()},e._fail=function(){e.e.event("err:"+e.tInfo.url,null),e.isDecoding=!1,e.decode()},e._playEmptySound=function(){if(null!=e.ctx){var t=e.ctx.createBufferSource();t.buffer=e._miniBuffer,t.connect(e.ctx.destination),t.start(0,0,0)}},e._unlock=function(){e._unlocked||(e._playEmptySound(),"running"===e.ctx.state&&(Browser.document.removeEventListener("mousedown",e._unlock,!0),Browser.document.removeEventListener("touchend",e._unlock,!0),e._unlocked=!0))},e.initWebAudio=function(){"running"!==e.ctx.state&&(e._unlock(),Browser.document.addEventListener("mousedown",e._unlock,!0),Browser.document.addEventListener("touchend",e._unlock,!0))},e._dataCache={},e.buffs=[],e.isDecoding=!1,e._unlocked=!1,e.tInfo=null,e.__loadingSound={},__static(e,["window",function(){return this.window=Browser.window},"webAudioEnabled",function(){return this.webAudioEnabled=e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext},"ctx",function(){return this.ctx=e.webAudioEnabled?new(e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=e.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new EventDispatcher}]),e}(EventDispatcher),HttpRequest=function(t){function e(){this._responseType=null,this._data=null,e.__super.call(this),this._http=new Browser.window.XMLHttpRequest}__class(e,"laya.net.HttpRequest",t);var i=e.prototype;return i.send=function(t,e,i,n,r){void 0===i&&(i="get"),void 0===n&&(n="text"),this._responseType=n,this._data=null;var a=this,s=this._http;if(s.open(i,t,!0),r)for(var o=0;o<r.length;o++)s.setRequestHeader(r[o++],r[o]);else Render.isConchApp||(e&&"string"!=typeof e?s.setRequestHeader("Content-Type","application/json"):s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));s.responseType="arraybuffer"!==n?"text":"arraybuffer",s.onerror=function(t){a._onError(t)},s.onabort=function(t){a._onAbort(t)},s.onprogress=function(t){a._onProgress(t)},s.onload=function(t){a._onLoad(t)},s.send(e)},i._onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)},i._onAbort=function(){this.error("Request was aborted by user")},i._onError=function(){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},i._onLoad=function(){var t=this._http,e=void 0!==t.status?t.status:200;200===e||204===e||0===e?this.complete():this.error("["+t.status+"]"+t.statusText+":"+t.responseURL)},i.error=function(t){this.clear(),this.event("error",t)},i.complete=function(){this.clear();var t=!0;try{this._data="json"===this._responseType?JSON.parse(this._http.responseText):"xml"===this._responseType?Utils.parseXMLFromString(this._http.responseText):this._http.response||this._http.responseText}catch(e){t=!1,this.error(e.message)}t&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null},__getset(0,i,"url",function(){return this._http.responseURL}),__getset(0,i,"http",function(){return this._http}),__getset(0,i,"data",function(){return this._data}),e}(EventDispatcher),Loader=function(t){function e(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._useWorkerLoader=!1,this._customParse=!1,e.__super.call(this)}__class(e,"laya.net.Loader",t);var i=e.prototype;return i.load=function(t,i,n,r,a,s){if(void 0===n&&(n=!0),void 0===a&&(a=!1),void 0===s&&(s=!1),this._url=t,0===t.indexOf("data:image")?i="image":t=URL.formatURL(t),this._type=i||(i=this.getTypeFromUrl(t)),this._cache=n,this._useWorkerLoader=s,this._data=null,s&&WorkerLoader.enableWorkerLoader(),!a&&e.loadedMap[t])return this._data=e.loadedMap[t],this.event("progress",1),this.event("complete",this._data),void 0;if(r&&e.setGroup(t,r),null!=e.parserMap[i])return this._customParse=!0,e.parserMap[i]instanceof laya.utils.Handler?e.parserMap[i].runWith(this):e.parserMap[i].call(null,this),void 0;if("image"===i||"htmlimage"===i||"nativeimage"===i)return this._loadImage(t);if("sound"===i)return this._loadSound(t);var o;switch(i){case"atlas":case"prefab":o="json";break;case"font":o="xml";break;case"pkm":o="arraybuffer";break;default:o=i}e.preLoadedMap[t]?this.onLoaded(e.preLoadedMap[t]):(this._http||(this._http=new HttpRequest,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),this._http.send(t,null,"get",o))},i.getTypeFromUrl=function(t){var i=Utils.getFileExtension(t);return i?e.typeMap[i]:(console.warn("Not recognize the resources suffix",t),"text")},i._loadImage=function(t){function i(){r.onload=null,r.onerror=null,delete e._imgCache[t]}var n=this;t=URL.formatURL(t);var r,a=this,s=function(){"nativeimage"===n._type||r.setImageSource(l,!0),i(),a.onLoaded(r)},o=function(){i(),a.event("error","Load image failed")};if("nativeimage"===this._type)r=new Browser.window.Image,r.crossOrigin="",r.onload=s,r.onerror=o,r.src=t,e._imgCache[t]=r;else{r=HTMLImage.create(t);var l=new Browser.window.Image;l.crossOrigin="",l.onload=s,l.onerror=o,l.src=t,r._setUrl(t),e._imgCache[t]=r}},i._loadSound=function(t){function e(){n(),a.onLoaded(r)}function i(){n(),r.dispose(),a.event("error","Load sound failed")}function n(){r.offAll()}var r=new SoundManager._soundClass,a=this;r.on("complete",this,e),r.on("error",this,i),r.load(t)},i.onProgress=function(t){"atlas"===this._type?this.event("progress",.3*t):this.event("progress",t)},i.onError=function(t){this.event("error",t)},i.onLoaded=function(t){var i=this._type;if("image"===i){var n=new Texture(t);n.url=this._url,this.complete(n)}else if("sound"===i||"htmlimage"===i||"nativeimage"===i)this.complete(t);else if("atlas"===i){if(!t.url&&!t._setContext){if(!this._data){if(this._data=t,t.meta&&t.meta.image)for(var r=t.meta.image.split(","),a=this._url.indexOf("/")>=0?"/":"\\",s=this._url.lastIndexOf(a),o=s>=0?this._url.substr(0,s+1):"",l=0,_=r.length;_>l;l++)r[l]=o+r[l];else r=[this._url.replace(".json",".png")];r.reverse(),t.toLoads=r,t.pics=[]}return this.event("progress",.3+1/r.length*.6),this._loadImage(r.pop())}if(this._data.pics.push(t),this._data.toLoads.length>0)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var h=this._data.frames,u=this._url.split("?")[0],c=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:u.substring(0,u.lastIndexOf("."))+"/",d=this._data.pics,f=URL.formatURL(this._url),m=e.atlasMap[f]||(e.atlasMap[f]=[]);m.dir=c;for(var p in h){var g=h[p],v=d[g.frame.idx?g.frame.idx:0],x=URL.formatURL(c+p);e.cacheRes(x,Texture._create(v,g.frame.x,g.frame.y,g.frame.w,g.frame.h,g.spriteSourceSize.x,g.spriteSourceSize.y,g.sourceSize.w,g.sourceSize.h,laya.net.Loader.getRes(x))),e.loadedMap[x].url=x,m.push(x)}delete this._data.pics,this.complete(this._data)}else if("font"===i){if(!t.src)return this._data=t,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var y=new BitmapFont;y.parseFont(this._data,t);var T=this._url.split(".fnt")[0].split("/"),D=T[T.length-1];Text.registerBitmapFont(D,y),this._data=y,this.complete(this._data)}else if("pkm"===i){var E=HTMLImage.create(t,this._url),S=new Texture(E);S.url=this._url,this.complete(S)}else if("prefab"===i){var M=new Prefab;M.json=t,this.complete(M)}else this.complete(t)},i.complete=function(t){this._data=t,this._customParse?this.event("loaded",t instanceof Array?[t]:t):(e._loaders.push(this),e._isWorking||e.checkNext())},i.endLoad=function(t){t&&(this._data=t),this._cache&&e.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},__getset(0,i,"url",function(){return this._url}),__getset(0,i,"data",function(){return this._data}),__getset(0,i,"cache",function(){return this._cache}),__getset(0,i,"type",function(){return this._type}),e.checkNext=function(){e._isWorking=!0;for(var t=Browser.now(),i=t;e._startIndex<e._loaders.length;)if(i=Browser.now(),e._loaders[e._startIndex].endLoad(),e._startIndex++,Browser.now()-t>e.maxTimeOut)return console.warn("loader callback cost a long time:"+(Browser.now()-t)+" url="+e._loaders[e._startIndex-1].url),Laya.timer.frameOnce(1,null,e.checkNext),void 0;e._loaders.length=0,e._startIndex=0,e._isWorking=!1},e.clearRes=function(t,i){void 0===i&&(i=!1),t=URL.formatURL(t);var n=e.getAtlas(t);if(n){for(var r=0,a=n.length;a>r;r++){var s=n[r],o=e.getRes(s);o&&o.destroy(i),delete e.loadedMap[s]}n.length=0,delete e.atlasMap[t],delete e.loadedMap[t]}else{var l=e.loadedMap[t];l&&(l instanceof laya.resource.Texture&&l.bitmap&&l.destroy(i),delete e.loadedMap[t])}},e.getRes=function(t){return e.loadedMap[URL.formatURL(t)]},e.getAtlas=function(t){return e.atlasMap[URL.formatURL(t)]},e.cacheRes=function(t,i){t=URL.formatURL(t),null!=e.loadedMap[t]?console.warn("Resources already exist,is repeated loading:",t):e.loadedMap[t]=i},e.setGroup=function(t,i){e.groupMap[i]||(e.groupMap[i]=[]),e.groupMap[i].push(t)},e.clearResByGroup=function(t){if(e.groupMap[t]){var i=e.groupMap[t],n=0,r=i.length;for(n=0;r>n;n++)e.clearRes(i[n]);i.length=0}},e.clearResByTime=function(t,i,n){for(var r=e.getResListByTime(t,i),a=0,s=r.length;s>a;a++){var o=r[a];if(n){for(var l=!1,_=0,h=n.length;h>_;_++)if(o===n[_]){l=!0;break}if(l)continue}e.clearRes(o)}},e.getResListByTime=function(){return null},e.TEXT="text",e.JSON="json",e.PREFAB="prefab",e.XML="xml",e.BUFFER="arraybuffer",e.IMAGE="image",e.SOUND="sound",e.ATLAS="atlas",e.FONT="font",e.PKM="pkm",e.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",prefab:"prefab",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm"},e.parserMap={},e.maxTimeOut=100,e.groupMap={},e.loadedMap={},e.atlasMap={},e.preLoadedMap={},e._imgCache={},e._loaders=[],e._isWorking=!1,e._startIndex=0,e}(EventDispatcher),LoaderManager=function(t){function e(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},this._statInfo={count:1,loaded:1},e.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}var i;__class(e,"laya.net.LoaderManager",t);var n=e.prototype;return n.getProgress=function(){return this._statInfo.loaded/this._statInfo.count},n.resetProgress=function(){this._statInfo.count=this._statInfo.loaded=1},n.create=function(t,e,i,n,r,a,s,o){function l(t){c++,t.progress=1,c===u&&e&&e.run()}function _(t,e){t.progress=e;for(var i=0,n=0;u>n;n++){var r=h[n];i+=r.progress}var a=i/u;d.runWith(a)}if(void 0===a&&(a=1),void 0===s&&(s=!0),t instanceof Array){var h=t,u=h.length,c=0;if(i)var d=Handler.create(i.caller,i.method,i.args,!1);for(var f=0;u>f;f++){var m=h[f];"string"==typeof m&&(m=h[f]={url:m}),m.progress=0}for(f=0;u>f;f++){m=h[f];var p=i?Handler.create(null,_,[m],!1):null,g=i||e?Handler.create(null,l,[m]):null;this._create(m.url,g,p,m.clas||n,m.params||r,m.priority||a,s,m.group||o)}return!0}return this._create(t,e,i,n,r,a,s,o)},n._create=function(t,i,n,r,a,s,o,l){function _(e){u&&!u.destroyed&&e&&(u._onAsynLoaded.call(u,e,a),u._completeLoad()),i&&i.run(),Laya.loader.event(t)}void 0===s&&(s=1),void 0===o&&(o=!0);var h=URL.formatURL(t),u=this.getRes(h);if(u)!u.hasOwnProperty("loaded")||u.loaded?(n&&n.runWith(1),i&&i.run()):i&&Laya.loader._createListener(t,i.caller,i.method,i.args,!0,!1);else{var c=Utils.getFileExtension(t),d=e.createMap[c];if(!d)throw new Error("LoaderManager:unknown file("+t+") extension with: "+c+".");r||(r=d[0]);var f=d[1];if("atlas"==c)this.load(t,i,n,f,s,o);else{if(r===Texture&&(f="htmlimage"),r)if(a&&a instanceof Array){var m=r.prototype;u=Object.create(m),m.constructor.apply(u,a)}else u=new r;else u=null;u.hasOwnProperty("_loaded")&&u._setLoaded(!1),u._setUrl(t),l&&u._setGroup(l),this._createLoad(u,t,Handler.create(null,_),n,f,s,!1,l,!0),o&&this.cacheRes(h,u)}}return u},n.load=function(t,n,r,a,s,o,l,_,h){var u=this;if(void 0===s&&(s=1),void 0===o&&(o=!0),void 0===_&&(_=!1),void 0===h&&(h=!1),t instanceof Array)return this._loadAssets(t,n,r,a,s,o,l);var c=Loader.getRes(t);if(_||null==c){var d;d=t,t=AtlasInfoManager.getFileLoadPath(t),t!=d&&"nativeimage"!==a?a="atlas":d=null;var f=e._resMap[t];f?(n&&(d?n&&f._createListener("complete",this,this._resInfoLoaded,[d,n],!1,!1):n&&f._createListener("complete",n.caller,n.method,n.args,!1,!1)),r&&f._createListener("progress",r.caller,r.method,r.args,!1,!1)):(f=this._infoPool.length?this._infoPool.pop():new i,f.url=t,f.type=a,f.cache=o,f.group=l,f.ignoreCache=_,f.useWorkerLoader=h,f.originalUrl=d,n&&f.on("complete",n.caller,n.method,n.args),r&&f.on("progress",r.caller,r.method,r.args),e._resMap[t]=f,s=s<this._maxPriority?s:this._maxPriority-1,this._resInfos[s].push(f),this._statInfo.count++,this.event("progress",this.getProgress()),this._next())}else Laya.timer.frameOnce(1,null,function(){r&&r.runWith(1),n&&n.runWith(c),u._loaderCount||u.event("complete")});return this},n._resInfoLoaded=function(t,e){e.runWith(Loader.getRes(t))},n._createLoad=function(t,n,r,a,s,o,l,_,h){var u=this;if(void 0===o&&(o=1),void 0===l&&(l=!0),void 0===h&&(h=!1),n instanceof Array)return this._loadAssets(n,r,a,s,o,l,_);var c=Loader.getRes(n);if(null!=c)Laya.timer.frameOnce(1,null,function(){a&&a.runWith(1),r&&r.runWith(c),u._loaderCount||u.event("complete")});else{var d=e._resMap[n];d?(r&&d._createListener("complete",r.caller,r.method,r.args,!1,!1),a&&d._createListener("progress",a.caller,a.method,a.args,!1,!1)):(d=this._infoPool.length?this._infoPool.pop():new i,d.url=n,d.clas=t,d.type=s,d.cache=l,d.group=_,d.ignoreCache=h,r&&d.on("complete",r.caller,r.method,r.args),a&&d.on("progress",a.caller,a.method,a.args),e._resMap[n]=d,o=o<this._maxPriority?o:this._maxPriority-1,this._resInfos[o].push(d),this._statInfo.count++,this.event("progress",this.getProgress()),this._next())}return this},n._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++){var e=this._resInfos[t];if(e.length>0){var i=e.shift();if(i)return this._doLoad(i)}}this._loaderCount||this.event("complete")}},n._doLoad=function(t){function e(e){i.offAll(),i._data=null,i._customParse=!1,n._loaders.push(i),n._endLoad(t,e instanceof Array?[e]:e),n._loaderCount--,n._next()}this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new Loader;i.on("complete",null,e),i.on("progress",null,function(e){t.event("progress",e)}),i.on("error",null,function(){e(null)});var n=this;i._class=t.clas,i.load(t.url,t.type,t.cache,t.group,t.ignoreCache,t.useWorkerLoader)},n._endLoad=function(t,i){var n=t.url;if(null==i){var r=this._failRes[n]||0;if(r<this.retryNum)return console.warn("[warn]Retry to load:",n),this._failRes[n]=r+1,Laya.timer.once(this.retryDelay,this,this._addReTry,[t],!1),void 0;console.warn("[error]Failed to load:",n),this.event("error",n)}this._failRes[n]&&(this._failRes[n]=0),delete e._resMap[n],t.originalUrl&&(i=Loader.getRes(t.originalUrl)),t.event("complete",i),t.offAll(),this._infoPool.push(t),this._statInfo.loaded++,this.event("progress",this.getProgress())
},n._addReTry=function(t){this._resInfos[this._maxPriority-1].push(t),this._next()},n.clearRes=function(t,e){void 0===e&&(e=!1),Loader.clearRes(t,e)},n.getRes=function(t){return Loader.getRes(t)},n.cacheRes=function(t,e){Loader.cacheRes(t,e)},n.setGroup=function(t,e){Loader.setGroup(t,e)},n.clearResByGroup=function(t){Loader.clearResByGroup(t)},n.clearUnLoaded=function(){for(var t=0;t<this._maxPriority;t++){for(var i=this._resInfos[t],n=i.length-1;n>-1;n--){var r=i[n];r&&(r.offAll(),this._infoPool.push(r))}i.length=0}this._loaderCount=0,e._resMap={}},n.cancelLoadByUrls=function(t){if(t)for(var e=0,i=t.length;i>e;e++)this.cancelLoadByUrl(t[e])},n.cancelLoadByUrl=function(t){for(var i=0;i<this._maxPriority;i++)for(var n=this._resInfos[i],r=n.length-1;r>-1;r--){var a=n[r];a&&a.url===t&&(n[r]=null,a.offAll(),this._infoPool.push(a))}e._resMap[t]&&delete e._resMap[t]},n._loadAssets=function(t,e,i,n,r,a,s){function o(t,i){h++,t.progress=1,i||(d=!1),h===_&&e&&e.runWith(d)}function l(t,e){if(null!=i){t.progress=e;for(var n=0,r=0;r<c.length;r++){var a=c[r];n+=a.size*a.progress}var s=n/u;i.runWith(s)}}void 0===r&&(r=1),void 0===a&&(a=!0);for(var _=t.length,h=0,u=0,c=[],d=!0,f=0;_>f;f++){var m=t[f];"string"==typeof m&&(m={url:m,type:n,size:1,priority:r}),m.size||(m.size=1),m.progress=0,u+=m.size,c.push(m);var p=i?Handler.create(null,l,[m],!1):null,g=e||i?Handler.create(null,o,[m]):null;this.load(m.url,g,p,m.type,m.priority||1,a,m.group||s,!1,m.useWorkerLoader)}return this},n.decodeBitmaps=function(t){var e,i=0,n=t.length;for(e=Render._context,i=0;n>i;i++){var r;if(r=Loader.getAtlas(t[i]))this._decodeTexture(r[0],e);else{var a;a=this.getRes(t[i]),a&&a instanceof laya.resource.Texture&&this._decodeTexture(a,e)}}},n._decodeTexture=function(t,e){var i=t.bitmap;if(t&&i){var n=i.source||i.image;if(n&&Laya.__typeof(n,Browser.window.HTMLImageElement)){e.drawImage(n,0,0,1,1);{e.getImageData(0,0,1,1)}}}},e.cacheRes=function(t,e){Loader.cacheRes(t,e)},e._resMap={},__static(e,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),e.__init$=function(){i=function(t){function e(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.useWorkerLoader=!1,this.clas=null,this.originalUrl=null,e.__super.call(this)}return __class(e,"",t),e}(EventDispatcher)},e}(EventDispatcher),WorkerLoader=function(t){function e(){this.worker=null,this._useWorkerLoader=!1,e.__super.call(this);var t=this;this.worker=new Browser.window.Worker(e.workerPath),this.worker.onmessage=function(e){t.workerMessage(e.data)}}__class(e,"laya.net.WorkerLoader",t);var i=e.prototype;return i.workerMessage=function(t){if(t)switch(t.type){case"Image":this.imageLoaded(t);break;case"Disable":e.enable=!1}},i.imageLoaded=function(t){if(!t.dataType||"imageBitmap"!=t.dataType)return this.event(t.url,null),void 0;var e=new HTMLCanvas("2D"),i=e.source.getContext("2d");switch(t.dataType){case"imageBitmap":var n=t.imageBitmap;e.size(n.width,n.height),i.drawImage(n,0,0)}console.log("load:",t.url),Render.isWebGL&&(e._setGPUMemory(0),e=new laya.webgl.resource.WebGLImage(e,t.url)),this.event(t.url,e)},i.loadImage=function(t){this.worker.postMessage(t)},i._loadImage=function(t){function i(){laya.net.WorkerLoader.I.off(t,n,r)}var n=this;if(!this._useWorkerLoader||!e._enable)return e._preLoadFun.call(n,t),void 0;t=URL.formatURL(t);var r=function(r){i(),r?n.onLoaded(r):e._preLoadFun.call(n,t)};laya.net.WorkerLoader.I.on(t,n,r),laya.net.WorkerLoader.I.loadImage(t)},__getset(1,e,"enable",function(){return e._enable},function(t){e._enable!=t&&(e._enable=t,t&&null==e._preLoadFun&&(e._enable=e.__init__()))}),e.__init__=function(){return null!=e._preLoadFun?!1:Browser.window.Worker?(e._preLoadFun=Loader.prototype._loadImage,Loader.prototype._loadImage=e.prototype._loadImage,e.I||(e.I=new e),!0):!1},e.workerSupported=function(){return Browser.window.Worker?!0:!1},e.enableWorkerLoader=function(){e._tryEnabled||(e.enable=!0,e._tryEnabled=!0)},e.I=null,e.workerPath="libs/workerloader.js",e._preLoadFun=null,e._enable=!1,e._tryEnabled=!1,e}(EventDispatcher),Resource=function(t){function e(){e.__super.call(this),this._$1__id=++e._uniqueIDCounter,this._loaded=!0,this._destroyed=!1,this._referenceCount=0,e._idResourcesMap[this.id]=this,this._released=!0,this.lock=!1,this._gpuMemory=0,ResourceManager.currentResourceManager&&ResourceManager.currentResourceManager.addResource(this)}__class(e,"laya.resource.Resource",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.ICreateResource":!0,"laya.resource.IDestroy":!0}),i._setCPUMemory=function(t){t-this._cpuMemory;this._cpuMemory=t},i._setGPUMemory=function(t){var e=t-this._gpuMemory;this._gpuMemory=t,this.resourceManager&&this.resourceManager.addSize(e)},i._setLoaded=function(t){this._loaded=t},i._setUrl=function(t){if(this._url!==t){var i;this._url&&(i=e._urlResourcesMap[this._url],i.splice(i.indexOf(this),1),0===i.length&&delete e._urlResourcesMap[this._url]),t&&(i=e._urlResourcesMap[t],i||(e._urlResourcesMap[t]=i=[]),i.push(this)),this._url=t}},i._getGroup=function(){return this._group},i._setGroup=function(t){if(this._group!==t){var i;this._group&&(i=e._groupResourcesMap[this._group],i.splice(i.indexOf(this),1),0===i.length&&delete e._groupResourcesMap[this._group]),t&&(i=e._groupResourcesMap[t],i||(e._groupResourcesMap[t]=i=[]),i.push(this)),this._group=t}},i._addReference=function(){this._referenceCount++},i._removeReference=function(){this._referenceCount--},i._clearReference=function(){this._referenceCount=0},i._completeLoad=function(){this._loaded=!0,this._released=!1,this.event("loaded",this)},i._recoverResource=function(){},i._disposeResource=function(){},i._activeResource=function(){this._released=!1},i._onAsynLoaded=function(){throw new Error("Resource: must override this function!")},i.releaseResource=function(t){return void 0===t&&(t=!1),!t&&this.lock?!1:!this._released||t?(this._disposeResource(),this._released=!0,!0):!1},i.destroy=function(){if(!this._destroyed){null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete e._idResourcesMap[this.id];var t;this._url&&(t=e._urlResourcesMap[this._url],t&&(t.splice(t.indexOf(this),1),0===t.length&&delete e._urlResourcesMap[this.url]),Loader.clearRes(this._url),this._loaded||RunDriver.cancelLoadByUrl(this._url)),this._group&&(t=e._groupResourcesMap[this._group],t.splice(t.indexOf(this),1),0===t.length&&delete e._groupResourcesMap[this.url])}},__getset(0,i,"loaded",function(){return this._loaded}),__getset(0,i,"id",function(){return this._$1__id}),__getset(0,i,"released",function(){return this._released}),__getset(0,i,"url",function(){return this._url}),__getset(0,i,"gpuMemory",function(){return this._gpuMemory}),__getset(0,i,"group",function(){return this._getGroup()},function(t){this._setGroup(t)}),__getset(0,i,"destroyed",function(){return this._destroyed}),__getset(0,i,"resourceManager",function(){return this._resourceManager}),__getset(0,i,"cpuMemory",function(){return this._cpuMemory}),__getset(0,i,"referenceCount",function(){return this._referenceCount}),e.getResourceByID=function(t){return e._idResourcesMap[t]},e.getResourceByURL=function(t,i){return void 0===i&&(i=0),e._urlResourcesMap[t][i]},e.destroyUnusedResources=function(t){var i;if(t){var n=e._groupResourcesMap[t];if(n)for(var r=n.slice(),a=0,s=r.length;s>a;a++)i=r[a],i.lock||0!==i._referenceCount||i.destroy()}else for(var o in e._idResourcesMap)i=e._idResourcesMap[o],i.lock||0!==i._referenceCount||i.destroy()},e._uniqueIDCounter=0,e._idResourcesMap={},e._urlResourcesMap={},e._groupResourcesMap={},e}(EventDispatcher),TextStyle=function(t){function e(){this.italic=!1,e.__super.call(this)}__class(e,"laya.display.css.TextStyle",t);var i=e.prototype;return i.reset=function(){return t.prototype.reset.call(this),this.italic=!1,this.align="left",this.wordWrap=!1,this.leading=0,this.padding=[0,0,0,0],this.bgColor=null,this.borderColor=null,this.asPassword=!1,this.stroke=0,this.strokeColor="#000000",this.bold=!1,this.underline=!1,this.underlineColor=null,this.currBitmapFont=null,this},i.recover=function(){this!==e.EMPTY&&Pool.recover("TextStyle",this.reset())},i.render=function(t,e,i,n){(this.bgColor||this.borderColor)&&e.drawRect(i,n,t.width,t.height,this.bgColor,this.borderColor,1)},e.create=function(){return Pool.getItemByClass("TextStyle",e)},e.EMPTY=new e,e}(SpriteStyle),Texture=function(t){function e(t,i,n,r){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._saveRef=0,e.__super.call(this),void 0===n&&(n=0),void 0===r&&(r=0),this._id=++e._uniqueIDCounter,t&&t._addReference(),this.setTo(t,i,n,r)}__class(e,"laya.resource.Texture",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.ICreateResource":!0}),i._saveAddref=function(){this._saveRef++,e._pool[this._id]=this},i._saveRelease=function(){this._saveRef--,0===this._saveRef&&(e._pool[this._id]=null)},i.getID=function(){return this._id},i._getSource=function(){return this.bitmap?this.bitmap._getSource():null},i._setUV=function(){},i.setTo=function(t,i,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),this.bitmap=t,this.sourceWidth=n,this.sourceHeight=r,t){this._w=t.width,this._h=t.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=this._w>0}this.uv=i||e.DEF_UV},i.active=function(){this.bitmap&&this.bitmap.activeResource()},i.getEnabled=function(){return this._loaded&&this.bitmap?!0:!1},i.destroy=function(t){void 0===t&&(t=!1),this.bitmap&&this.bitmap.useNum>0&&(t?(this.bitmap.destroy(),this.bitmap.useNum=0):this.bitmap._removeReference(),this.bitmap=null,this.url&&this===Laya.loader.getRes(this.url)&&Laya.loader.clearRes(this.url,t),this._loaded=!1)},i.load=function(t){this._loaded=!1,Laya.loader.load(t,Handler.create(this,this._onLoaded),null,"htmlimage",1,!1,null,!0)},i._onLoaded=function(t){if(t==this);else if(t instanceof laya.resource.Texture){var i=t;e._create(t,0,0,i.width,i.height,0,0,i.sourceWidth,i.sourceHeight,this)}else this.bitmap=t,this.bitmap.useNum++,this._loaded=!0,this.sourceWidth=this._w=t.width,this.sourceHeight=this._h=t.height;this.event("loaded",this)},i.getPixels=function(t,e,i,n){if(Render.isWebGL)return RunDriver.getTexturePixels(this,t,e,i,n);Browser.canvas.size(i,n),Browser.canvas.clear(),Browser.context.drawImage(this,-t,-e,this.width,this.height,0,0);var r=Browser.context.getImageData(0,0,i,n);return r.data},i._onAsynLoaded=function(t){t&&t.useNum++,this.setTo(t,this.uv)},i._setUrl=function(t){this.url=t},i._completeLoad=function(){},__getset(0,i,"height",function(){return this.loaded?this._h?this._h:this.uv&&this.uv!==e.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height:0},function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}),__getset(0,i,"uv",function(){return this._uv},function(t){this._uv=t,this._setUV(t)}),__getset(0,i,"loaded",function(){return this._loaded}),__getset(0,i,"released",function(){return this.bitmap?this.bitmap.released:!0}),__getset(0,i,"width",function(){return this.loaded?this._w?this._w:this.uv&&this.uv!==e.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width:0},function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}),e.getTextureByID=function(t){return e._pool[t]},e.moveUV=function(t,e,i){for(var n=0;8>n;n+=2)i[n]+=t,i[n+1]+=e;return i},e.create=function(t,i,n,r,a,s,o,l,_){return void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===_&&(_=0),e._create(t,i,n,r,a,s,o,l,_)},e._create=function(t,i,n,r,a,s,o,l,_,h){void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===_&&(_=0);var u=t instanceof laya.resource.Texture,c=u?t.uv:e.DEF_UV,d=u?t.bitmap:t;d.width&&i+r>d.width&&(r=d.width-i),d.height&&n+a>d.height&&(a=d.height-n);var f;h?(f=h,d._addReference(),f.setTo(d,null,l||r,_||a)):f=new e(d,null,l||r,_||a),f.width=r,f.height=a,f.offsetX=s,f.offsetY=o;var m=1/d.width,p=1/d.height;i*=m,n*=p,r*=m,a*=p;var g=f.uv[0],v=f.uv[1],x=f.uv[4],y=f.uv[5],T=x-g,D=y-v,E=e.moveUV(c[0],c[1],[i,n,i+r,n,i+r,n+a,i,n+a]);return f.uv=[g+E[0]*T,v+E[1]*D,x-(1-E[2])*T,v+E[3]*D,x-(1-E[4])*T,y-(1-E[5])*D,g+E[6]*T,y-(1-E[7])*D],f},e.createFromTexture=function(t,i,n,r,a){var s=Rectangle.TEMP.setTo(i-t.offsetX,n-t.offsetY,r,a),o=s.intersection(e._rect1.setTo(0,0,t.width,t.height),e._rect2);if(!o)return null;var l=e.create(t,o.x,o.y,o.width,o.height,o.x-s.x,o.y-s.y,r,a);return l.bitmap.useNum--,l},e.DEF_UV=[0,0,1,0,1,1,0,1],e.NO_UV=[0,0,0,0,0,0,0,0],e.INV_UV=[0,1,1,1,1,0,0,0],e._rect1=new Rectangle,e._rect2=new Rectangle,e._uniqueIDCounter=0,e._pool=[],e}(EventDispatcher),ColorFilter=function(t){function e(t){e.__super.call(this),t||(t=this._copyMatrix(e.IDENTITY_MATRIX)),this._mat=new Float32Array(16),this._alpha=new Float32Array(4),this.setByMatrix(t),this._action=RunDriver.createFilterAction(32),this._action.data=this}__class(e,"laya.filters.ColorFilter",t);var i=e.prototype;return Laya.imps(i,{"laya.filters.IFilter":!0}),i.gray=function(){return this.setByMatrix(e.GRAY_MATRIX)},i.color=function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.setByMatrix([1,0,0,0,t,0,1,0,0,e,0,0,1,0,i,0,0,0,1,n])},i.setByMatrix=function(t){this._matrix!=t&&this._copyMatrix(t);for(var e=0,i=0,n=0;20>n;n++)n%5!=4?this._mat[e++]=t[n]:this._alpha[i++]=t[n];return this},i.adjustColor=function(t,e,i,n){return this.adjustHue(n),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i),this},i.adjustBrightness=function(t){return t=this._clampValue(t,100),0==t||isNaN(t)?this:this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1])},i.adjustContrast=function(t){if(t=this._clampValue(t,100),0==t||isNaN(t))return this;var i=0/0;0>t?i=127+t/100*127:(i=t%1,i=0==i?e.DELTA_INDEX[t]:e.DELTA_INDEX[t<<0]*(1-i)+e.DELTA_INDEX[(t<<0)+1]*i,i=127*i+127);var n=i/127,r=.5*(127-i);return this._multiplyMatrix([n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0,0,0,0,0,1])},i.adjustSaturation=function(t){if(t=this._clampValue(t,100),0==t||isNaN(t))return this;var e=1+(t>0?3*t/100:t/100),i=1-e,n=.3086*i,r=.6094*i,a=.082*i;return this._multiplyMatrix([n+e,r,a,0,0,n,r+e,a,0,0,n,r,a+e,0,0,0,0,0,1,0,0,0,0,0,1])},i.adjustHue=function(t){if(t=this._clampValue(t,180)/180*Math.PI,0==t||isNaN(t))return this;var e=Math.cos(t),i=Math.sin(t),n=.213,r=.715,a=.072;return this._multiplyMatrix([n+e*(1-n)+i*-n,r+e*-r+i*-r,a+e*-a+i*(1-a),0,0,n+e*-n+.143*i,r+e*(1-r)+.14*i,a+e*-a+i*-.283,0,0,n+e*-n+i*-(1-n),r+e*-r+i*r,a+e*(1-a)+i*a,0,0,0,0,0,1,0,0,0,0,0,1])},i.reset=function(){return this.setByMatrix(this._copyMatrix(e.IDENTITY_MATRIX))},i._multiplyMatrix=function(t){var e=[];this._matrix=this._fixMatrix(this._matrix);for(var i=0;5>i;i++){for(var n=0;5>n;n++)e[n]=this._matrix[n+5*i];for(n=0;5>n;n++){for(var r=0,a=0;5>a;a++)r+=t[n+5*a]*e[a];this._matrix[n+5*i]=r}}return this.setByMatrix(this._matrix)},i._clampValue=function(t,e){return Math.min(e,Math.max(-e,t))},i._fixMatrix=function(t){return null==t?e.IDENTITY_MATRIX:(t.length<25?t=t.slice(0,t.length).concat(e.IDENTITY_MATRIX.slice(t.length,25)):t.length>25&&(t=t.slice(0,25)),t)},i._copyMatrix=function(t){var e=25;this._matrix||(this._matrix=[]);for(var i=0;e>i;i++)this._matrix[i]=t[i];return this._matrix},__getset(0,i,"type",function(){return 32}),__getset(0,i,"action",function(){return this._action}),e.LENGTH=25,__static(e,["DELTA_INDEX",function(){return this.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10]},"GRAY_MATRIX",function(){return this.GRAY_MATRIX=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0]},"IDENTITY_MATRIX",function(){return this.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}]),e}(Filter),GraphicsGL=function(t){function e(){e.__super.call(this)}__class(e,"laya.webgl.display.GraphicsGL",t);var i=e.prototype;return i.setShader=function(){},i.setIBVB=function(){},i.drawParticle=function(){},e}(Graphics),AnimationPlayer=function(t){function e(){this._destroyed=!1,this._templet=null,this._currentTime=0/0,this._currentFrameTime=0/0,this._playStart=0/0,this._playEnd=0/0,this._playDuration=0/0,this._overallDuration=0/0,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0/0,this._startUpdateLoopCount=0/0,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=0/0,this._cachePlayRate=0/0,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,e.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}__class(e,"laya.ani.AnimationPlayer",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.IDestroy":!0}),i._onTempletLoadedComputeFullKeyframeIndices=function(t,e,i){this._templet===i&&this._cachePlayRate===t&&this._cacheFrameRate===e&&this._computeFullKeyframeIndices()},i._computeFullKeyframeIndices=function(){for(var t=this._fullFrames=[],e=this._templet,i=this._cacheFrameRateInterval*this._cachePlayRate,n=0,r=e.getAnimationCount();r>n;n++){var a=[];if(e.getAnimation(n).nodes){for(var s=0,o=e.getAnimation(n).nodes.length;o>s;s++){for(var l=e.getAnimation(n).nodes[s],_=Math.floor(l.playTime/i+.01),h=new Uint16Array(_+1),u=-1,c=0,d=l.keyFrame.length;d>c;c++){var f=l.keyFrame[c],m=f.startTime,p=m+f.duration+i;do{for(var g=Math.floor(m/i+.5),v=u+1;g>v;v++)h[v]=c;u=g,h[g]=c,m+=i}while(p>=m)}a.push(h)}t.push(a)}else t.push(a)}},i._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},i._calculatePlayDuration=function(){if(0!==this.state){var t=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=t),this._playEnd>t&&(this._playEnd=t),this._playDuration=this._playEnd-this._playStart}},i._setPlayParams=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.floor(this.currentPlayTime/e+.01),this._currentFrameTime=this._currentKeyframeIndex*e},i._setPlayParamsWhenStop=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.floor(t/e+.01),this._currentFrameTime=this._currentKeyframeIndex*e,this._currentAnimationClipIndex=-1},i._update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==Stat.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=n)return this._setPlayParamsWhenStop(n,e),this.event("stopped"),void 0;if(i+=this._currentTime,n>0)if(i>=n){do{if(i-=n,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,e),this._stopWhenCircleFinish=!1,this.event("stopped"),void 0;n>i&&(this._setPlayParams(i,e),this.event("complete"))}while(i>=n)}else this._setPlayParams(i,e);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,e),this._stopWhenCircleFinish=!1,this.event("stopped"),void 0;this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},i._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},i.play=function(t,e,i,n,r){if(void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===r&&(r=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(0>i||0>n||0>r)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==r&&n>r)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=e,this._overallDuration=i,this._playStart=n,this._playEnd=r,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=Stat.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},i.playByFrame=function(t,e,i,n,r,a){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=30);var s=1e3/a;this.play(t,e,i,n*s,r*s)},i.stop=function(t){void 0===t&&(t=!0),t?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},i.destroy=function(){},__getset(0,i,"playEnd",function(){return this._playEnd}),__getset(0,i,"templet",function(){return this._templet},function(t){0===!this.state&&this.stop(!0),this._templet!==t&&(this._templet=t,t.loaded?this._computeFullKeyframeIndices():t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),__getset(0,i,"playStart",function(){return this._playStart}),__getset(0,i,"playDuration",function(){return this._playDuration}),__getset(0,i,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),__getset(0,i,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),__getset(0,i,"overallDuration",function(){return this._overallDuration}),__getset(0,i,"currentFrameTime",function(){return this._currentFrameTime}),__getset(0,i,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),__getset(0,i,"currentPlayTime",function(){return this._currentTime+this._playStart}),__getset(0,i,"cachePlayRate",function(){return this._cachePlayRate},function(t){this._cachePlayRate!==t&&(this._cachePlayRate=t,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[t,this._cacheFrameRate])))}),__getset(0,i,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){this._cacheFrameRate!==t&&(this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,t])))}),__getset(0,i,"currentTime",null,function(t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=Stat.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentKeyframeIndex=Math.floor(this.currentPlayTime/e),this._currentFrameTime=this._currentKeyframeIndex*e}}),__getset(0,i,"paused",function(){return this._paused},function(t){this._paused=t,t&&this.event("paused")}),__getset(0,i,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),__getset(0,i,"destroyed",function(){return this._destroyed}),e}(EventDispatcher),AnimationTransform3D=function(t){function e(t,i,n,r,a){e.__super.call(this),this._owner=t,this._children=[],this._localMatrix=new Float32Array(16),Render.isConchApp?(this._localPosition=i,this._localRotation=n,this._localScale=r,this._worldMatrix=a):(this._localPosition=new Float32Array(3),this._localRotation=new Float32Array(4),this._localScale=new Float32Array(3),this._worldMatrix=new Float32Array(16)),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}__class(e,"laya.d3.animation.AnimationTransform3D",t);var i=e.prototype;return i._getlocalMatrix=function(){return this._localUpdate&&(Utils3D._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},i._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var t=0,e=this._children.length;e>t;t++)this._children[t]._onWorldTransform()}},i.getLocalPosition=function(){return this._localPosition},i.setLocalPosition=function(t,e,i){e?1===i?(this._localPosition[0]+=t[0],this._localPosition[1]+=t[1],this._localPosition[2]+=t[2]):(this._localPosition[0]+=t[0]*i,this._localPosition[1]+=t[1]*i,this._localPosition[2]+=t[2]*i):1===i?(this._localPosition[0]=t[0],this._localPosition[1]=t[1],this._localPosition[2]=t[2]):(this._localPosition[0]=t[0]*i,this._localPosition[1]=t[1]*i,this._localPosition[2]=t[2]*i),this._localUpdate=!0,this._onWorldTransform()},i.setCrossLocalPosition=function(t,e,i,n,r){var a=t[0],s=t[1],o=t[2];n?1===r?(this._localPosition[0]+=a+i*(e[0]-a),this._localPosition[1]+=s+i*(e[1]-s),this._localPosition[2]+=o+i*(e[2]-o)):(this._localPosition[0]+=(a+i*(e[0]-a))*r,this._localPosition[1]+=(s+i*(e[1]-s))*r,this._localPosition[2]+=(o+i*(e[2]-o))*r):1===r?(this._localPosition[0]=a+i*(e[0]-a),this._localPosition[1]=s+i*(e[1]-s),this._localPosition[2]=o+i*(e[2]-o)):(this._localPosition[0]=(a+i*(e[0]-a))*r,this._localPosition[1]=(s+i*(e[1]-s))*r,this._localPosition[2]=(o+i*(e[2]-o))*r),this._localUpdate=!0,this._onWorldTransform()},i.getLocalRotation=function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler;Utils3D._quaternionCreateFromYawPitchRollArray(t[1]/e._angleToRandin,t[0]/e._angleToRandin,t[2]/e._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},i.setLocalRotation=function(t,i,n){i?1===n?Utils3D.quaternionMultiply(this._localRotation,t,this._localRotation):(Utils3D.quaterionSlerp(e._defaultQuaternion,t,n,e._tempQuaternion),Utils3D.quaternionMultiply(this._localRotation,e._tempQuaternion,this._localRotation)):1===n?(this._localRotation[0]=t[0],this._localRotation[1]=t[1],this._localRotation[2]=t[2],this._localRotation[3]=t[3]):Utils3D.quaterionSlerp(e._defaultQuaternion,this._localRotation,n,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform()},i.setCrossLocalRotation=function(t,i,n,r,a){r?(Utils3D.quaterionSlerp(t,i,n,e._tempQuaternion),1!==a&&Utils3D.quaterionSlerp(e._defaultQuaternion,e._tempQuaternion,a,e._tempQuaternion),Utils3D.quaternionMultiply(this._localRotation,e._tempQuaternion,this._localRotation)):(Utils3D.quaterionSlerp(t,i,n,this._localRotation),1!==a&&Utils3D.quaterionSlerp(e._defaultQuaternion,this._localRotation,a,this._localRotation)),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform()},i.getLocalScale=function(){return this._localScale},i.setLocalScale=function(t,e,i){e?1===i?(this._localScale[0]+=t[0],this._localScale[1]+=t[1],this._localScale[2]+=t[2]):(this._localScale[0]+=t[0]*i,this._localScale[1]+=t[1]*i,this._localScale[2]+=t[2]*i):1===i?(this._localScale[0]=t[0],this._localScale[1]=t[1],this._localScale[2]=t[2]):(this._localScale[0]=t[0]*i,this._localScale[1]=t[1]*i,this._localScale[2]=t[2]*i),this._localUpdate=!0,this._onWorldTransform()},i.setCrossLocalScale=function(t,e,i,n,r){var a=t[0],s=t[1],o=t[2];n?1===r?(this._localScale[0]+=a+i*(e[0]-a),this._localScale[1]+=s+i*(e[1]-s),this._localScale[2]+=o+i*(e[2]-o)):(this._localScale[0]+=(a+i*(e[0]-a))*r,this._localScale[1]+=(s+i*(e[1]-s))*r,this._localScale[2]+=(o+i*(e[2]-o))*r):1===r?(this._localScale[0]=a+i*(e[0]-a),this._localScale[1]=s+i*(e[1]-s),this._localScale[2]=o+i*(e[2]-o)):(this._localScale[0]=(a+i*(e[0]-a))*r,this._localScale[1]=(s+i*(e[1]-s))*r,this._localScale[2]=(o+i*(e[2]-o))*r),this._localUpdate=!0,this._onWorldTransform()},i.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){Utils3D.getYawPitchRoll(this._localRotation,e._tempVector3);var t=e._tempVector3,i=this._localRotationEuler;i[0]=t[1]*e._angleToRandin,i[1]=t[0]*e._angleToRandin,i[2]=t[2]*e._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},i.setLocalRotationEuler=function(t,e,i){e?1===i?(this._localRotationEuler[0]+=t[0],this._localRotationEuler[1]+=t[1],this._localRotationEuler[2]+=t[2]):(this._localRotationEuler[0]+=t[0]*i,this._localRotationEuler[1]+=t[1]*i,this._localRotationEuler[2]+=t[2]*i):1===i?(this._localRotationEuler[0]=t[0],this._localRotationEuler[1]=t[1],this._localRotationEuler[2]=t[2]):(this._localRotationEuler[0]=t[0]*i,this._localRotationEuler[1]=t[1]*i,this._localRotationEuler[2]=t[2]*i),this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,this._onWorldTransform()},i.setCrossLocalRotationEuler=function(t,e,i,n,r){var a=t[0],s=t[1],o=t[2];n?1===r?(this._localRotationEuler[0]+=a+i*(e[0]-a),this._localRotationEuler[1]+=s+i*(e[1]-s),this._localRotationEuler[2]+=o+i*(e[2]-o)):(this._localRotationEuler[0]+=(a+i*(e[0]-a))*r,this._localRotationEuler[1]+=(s+i*(e[1]-s))*r,this._localRotationEuler[2]+=(o+i*(e[2]-o))*r):1===r?(this._localRotationEuler[0]=a+i*(e[0]-a),this._localRotationEuler[1]=s+i*(e[1]-s),this._localRotationEuler[2]=o+i*(e[2]-o)):(this._localRotationEuler[0]=(a+i*(e[0]-a))*r,this._localRotationEuler[1]=(s+i*(e[1]-s))*r,this._localRotationEuler[2]=(o+i*(e[2]-o))*r),this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,this._onWorldTransform()},i.getWorldMatrix=function(){if(!Render.isConchApp&&this._worldUpdate){if(null!=this._parent)Utils3D.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var t=this._getlocalMatrix(),e=0;16>e;++e)this._worldMatrix[e]=t[e];this._worldUpdate=!1}return this._worldMatrix},i.setParent=function(t){if(this._parent!==t){if(this._parent){var e=this._parent._children,i=e.indexOf(this);e.splice(i,1)}t&&(t._children.push(this),t&&this._onWorldTransform()),this._parent=t}},__static(e,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_tempQuaternion",function(){return this._tempQuaternion=new Float32Array(4)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI},"_defaultQuaternion",function(){return this._defaultQuaternion=new Float32Array([0,0,0,1])}]),e}(EventDispatcher),AnimatorControllerLayer=function(t){function e(t){this.playOnWake=!0,e.__super.call(this),this._playType=-1,this._crossMark=0,this._crossDuration=-1,this._crossNodesOwnersIndicesMap={},this._crossNodesOwnersCount=0,this._crossNodesOwners=[],this._defaultClipIndex=-1,this._currentPlayState=null,this._clipNames=[],this._clipStateInfos=[],this._playStateInfo=new AnimatorStateInfo,this._crossPlayStateInfo=new AnimatorStateInfo,this._srcCrossClipNodeIndices=[],this._destCrossClipNodeIndices=[],this.name=t,this.defaultWeight=1,this.blendingMode=laya.d3.component.AnimatorControllerLayer.BLENDINGMODE_OVERRIDE}__class(e,"laya.d3.component.AnimatorControllerLayer",t);var i=e.prototype;return i.getAnimatorState=function(t){var e=this._clipNames.indexOf(t);return-1===e?null:this._clipStateInfos[e]},i.destroy=function(){this._clipNames=null,this._clipStateInfos=null,this._playStateInfo=null,this._crossPlayStateInfo=null},e.BLENDINGMODE_OVERRIDE=0,e.BLENDINGMODE_ADDTIVE=1,e}(EventDispatcher),WebGLContext2D=function(t){function e(t){this._id=++e._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this.meshlist=[],this._transedClipInfo=[0,0,99999999,0,0,99999999],this._clipInfoID=0,this._nBlendType=0,this._saveMark=null,this._drawTextureUseColor=!1,this._italicDeg=0,this._lastTex=null,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,e.__super.call(this),this._width=99999999,this._height=99999999,this._submitKey=new SubmitKey,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=e.MAXCLIPRECT,this._shader2D=new Shader2D,this._charBook=new CharBook,this.mOutPoint,this._canvas=t,e._contextcount++,this.clear()
}var i;__class(e,"laya.webgl.canvas.WebGLContext2D",t);var n=e.prototype;return n.clearBG=function(t,e,i,n){var r=WebGL.mainContext;r.clearColor(t,e,i,n),r.clear(16384)},n._getSubmits=function(){return this._submits},n._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;e>t;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null;for(var t=0,i=this.meshlist.length;i>t;t++){var n=this.meshlist[t];n.destroy()}this.meshlist.length=0}},n.destroy=function(){--e._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas=null,this._mesh.destroy()},n.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=Matrix.create(),this._mesh=MeshQuadTexture.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=MeshVG.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=MeshTexture.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[SaveMark.Create(this)],this._save.length=10,this._shader2D=new Shader2D),this._submitKey.clear(),this._mesh.clearVB(),Config.smartCache&&this._renderCount++,this._drawCount=1,this._other=i.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=e.MAXCLIPRECT,this._curSubmit=Submit.RENDERBASE,Submit.RENDERBASE._ref=16777215,Submit.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=DrawStyle.DEFAULT;for(var t=0,n=this._submits._length;n>t;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},n.size=function(t,e){if(this._width!=t||this._height!=e)if(0==t||0==e){for(var i=0,n=this._submits._length;n>i;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas._setGPUMemory(0);0===t&&0===e&&this._releaseMem()},n._getTransformMatrix=function(){return this._curMat},n._reCalculateBlendShader=function(){this._submitKey.blendShader=this._nBlendType+(this._shader2D.shader?100*this._shader2D.shader._id:0),this._shader2D.filters&&(this._submitKey.blendShader+=this._shader2D.filters.key/1e4,this._submitKey.blendShader=-this._submitKey.blendShader)},n.translate=function(t,e){(0!==t||0!==e)&&(SaveTranslate.save(this),this._curMat._bTransform?(SaveTransform.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},n.save=function(){this._save[this._save._length++]=SaveMark.Create(this)},n.restore=function(){var t=this._save._length;if(!(1>t))for(var e=t-1;e>=0;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return this._save._length=e,void 0}},n.fillText=function(t,e,i,n,r){this._fillText(t,null,e,i,n,r,null)},n._fillText=function(t,e,i,n,r,a,s,o,l,_){void 0===_&&(_=0),this._charBook.filltext(this,t,i,n,r,a,s,o,l,_)},n.fillWords=function(t,e,i,n,r,a){this._fillText(null,t,e,i,n,r,null,-1,null,a)},n.fillBorderWords=function(t,e,i,n,r,a,s){this._fillBorderText(null,t,e,i,n,r,a,s,null)},n.drawText=function(t,e,i,n,r,a){this._fillText(t,null,e,i,n,Color.create(r).strColor,null,-1,a)},n.strokeWord=function(t,e,i,n,r,a,s){this._fillText(t,null,e,i,n,null,Color.create(r).strColor,a||1,s)},n.fillBorderText=function(t,e,i,n,r,a,s,o){this._fillBorderText(t,null,e,i,n,Color.create(r).strColor,Color.create(a).strColor,s,o)},n._fillBorderText=function(t,e,i,n,r,a,s,o,l){this._fillText(t,e,i,n,r,a,s,o||1,l)},n._fillRect=function(t,e,i,n,r){var a=this._curSubmit,s=a&&2===a._key.submitType&&a._key.blendShader===this._submitKey.blendShader;this._mesh.vertNum+4>65535&&(this._mesh=MeshQuadTexture.getAMesh(),this.meshlist.push(this._mesh),s=!1);var o=this.getTransedClipInfo();if(s&&(s=s&&this.isSameClipInfo(a,o)),this.transformQuad(t,e,i,n,0,this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){if(this._mesh.addQuad(this._transedPoints,Texture.NO_UV,r,this.getTransedClipInfo(),!1),!s){var a=this._curSubmit=SubmitTexture.create(this,this._mesh,Value2D.create(1,0));this._submits[this._submits._length++]=a,this.copyClipInfo(a,o),a.shaderValue.textureHost=this._lastTex,a._key.copyFrom2(this._submitKey,2,this._lastTex?this._lastTex.bitmap.id:-1),a._renderType=10016}this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}},n.fillRect=function(t,e,i,n,r){var a=r?DrawStyle.create(r):this._shader2D.fillStyle,s=this.mixRGBandAlpha(a.toInt());this._fillRect(t,e,i,n,s)},n.fillTexture=function(){},n.setShader=function(t){SaveBase.save(this,1048576,this._shader2D,!0),this._shader2D.shader=t,this._reCalculateBlendShader()},n.setFilters=function(t){SaveBase.save(this,2097152,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=Submit.RENDERBASE,this._drawCount++,this._reCalculateBlendShader()},n.drawTexture=function(t,e,i,n,r){this._drawTextureM(t,e,i,n,r,null,1)},n.drawTextures=function(t,e,i,n){if(!t.loaded||!t._getSource())return this.sprite&&Laya.timer.callLater(this,this._repaintSprite),void 0;for(var r=e.length/2,a=0,s=0;r>s;s++)this._inner_drawTexture(t,t.bitmap.id,e[a++]+i,e[a++]+n)},n._drawTextureAddSubmit=function(t,e){var i=null;i=SubmitTexture.create(this,this._mesh,Value2D.create(1,0)),this._submits[this._submits._length++]=i,i.shaderValue.textureHost=e,i._key.copyFrom2(this._submitKey,2,t),i._renderType=10016,this._curSubmit=i},n._drawTextureM=function(t,e,i,n,r,a,s,o){return t._loaded&&t._getSource()?(this._inner_drawTexture(t,t.bitmap.id,e,i,n,r,a,s,o),void 0):(this.sprite&&Laya.timer.callLater(this,this._repaintSprite),!1)},n._drawRenderTexture=function(t,e,i,n,r,a,s,o){this._inner_drawTexture(t,-1,e,i,n,r,a,s,o)},n.submitDebugger=function(){this._submits[this._submits._length++]=SubmitCMD.create([],function(){})},n.copyClipInfo=function(t,e){var i=t.shaderValue.clipDir;i[0]=e[2],i[1]=e[3],i[2]=e[4],i[3]=e[5];var n=t.shaderValue.clipRect;n[0]=e[0],n[1]=e[1],t.clipInfoID=this._clipInfoID},n.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},n._inner_drawTexture=function(t,e,i,n,r,a,s,o,l){this._drawCount++;var _=this._curSubmit._key,h=e>=0&&2===_.submitType&&_.other===e,u=this.getTransedClipInfo();h&&(h=h&&this.isSameClipInfo(this._curSubmit,u)),this._lastTex=t;var c=this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);return this._mesh.vertNum+4>65535&&(this._mesh=MeshQuadTexture.getAMesh(),this.meshlist.push(this._mesh),h=!1),this.transformQuad(i,n,r||t.width,a||t.height,this._italicDeg,s||this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)?!1:(this._mesh.addQuad(this._transedPoints,l||t.uv,c,u,!0),h||this._drawTextureAddSubmit(e,t),this.copyClipInfo(this._curSubmit,u),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},n.transform4Points=function(t,e,i){e._bTransform?(i[0]=t[0]*e.a+t[1]*e.c+e.tx,i[1]=t[0]*e.b+t[1]*e.d+e.ty,i[2]=t[2]*e.a+t[3]*e.c+e.tx,i[3]=t[2]*e.b+t[3]*e.d+e.ty,i[4]=t[4]*e.a+t[5]*e.c+e.tx,i[5]=t[4]*e.b+t[5]*e.d+e.ty,i[6]=t[6]*e.a+t[7]*e.c+e.tx,i[7]=t[6]*e.b+t[7]*e.d+e.ty):(i[0]=t[0]+e.tx,i[1]=t[1]+e.ty,i[2]=t[2]+e.tx,i[3]=t[3]+e.ty,i[4]=t[4]+e.tx,i[5]=t[5]+e.ty,i[6]=t[6]+e.tx,i[7]=t[7]+e.ty)},n.clipedOff=function(){return this._clipRect.width<=0||this._clipRect.height<=0?!0:!1},n.transformQuad=function(t,e,i,n,r,a,s){var o=0;0!=r&&(o=Math.tan(r*Math.PI/180)*n);var l=t+i,_=e+n;this._temp4Points[0]=t+o,this._temp4Points[1]=e,this._temp4Points[2]=l+o,this._temp4Points[3]=e,this._temp4Points[4]=l,this._temp4Points[5]=_,this._temp4Points[6]=t,this._temp4Points[7]=_,this.transform4Points(this._temp4Points,a,s)},n._inner_drawTextureVerts=function(){},n._drawTextureM2=function(){return!1},n.pushRT=function(){this.addRenderObject(SubmitCMD.create(null,RenderTexture2D.pushRT))},n.popRT=function(){this.addRenderObject(SubmitCMD.create(null,RenderTexture2D.popRT)),this.onChangeRT()},n.useRT=function(t){function e(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)}this.addRenderObject(SubmitCMD.create([t],e)),this.onChangeRT()},n.RTRestore=function(t){function e(t){t.restore()}this.addRenderObject(SubmitCMD.create([t],e)),this.onChangeRT()},n.onChangeRT=function(){this._curSubmit=Submit.RENDERBASE,this._shader2D.glTexture=null},n._repaintSprite=function(){this.sprite&&this.sprite.repaint()},n.drawTextureWithTransform=function(t,i,n,r,a,s,o,l,_){if(!s)return this._drawTextureM(t,i+o,n+l,r,a,null,_),void 0;var h=this._curMat;e._tmpMatrix.a=s.a,e._tmpMatrix.b=s.b,e._tmpMatrix.c=s.c,e._tmpMatrix.d=s.d,e._tmpMatrix.tx=s.tx+o,e._tmpMatrix.ty=s.ty+l,e._tmpMatrix._bTransform=s._bTransform,s&&h._bTransform?(Matrix.mul(e._tmpMatrix,h,e._tmpMatrix),s=e._tmpMatrix,s._bTransform=!0):s=e._tmpMatrix,this._drawTextureM(t,i,n,r,a,s,_)},n.drawTexture2Slow=function(){},n.drawTexture2=function(t,e,i,n,r,a,s,o){this._curMat._bTransform||r||1!==a||s?this.drawTexture2Slow(t,e,i,n,r,a,s,o):this._drawTextureM2(o[0],o[1]-i,o[2]-n,o[3],o[4],t,e)},n.flushRenderTarget=function(t,e){LayaGL.instance;e.start(),t.flush(),t.clear(),e.restore()},n._flushToTarget=function(t,e){RenderState2D.worldScissorTest=!1,WebGL.mainContext.disable(3089);{var i=RenderState2D.worldAlpha,n=RenderState2D.worldMatrix4,r=RenderState2D.worldMatrix;RenderState2D.worldShaderDefines}RenderState2D.worldMatrix=Matrix.EMPTY,RenderState2D.restoreTempArray(),RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY,RenderState2D.worldAlpha=1,BaseShader.activeShader=null,e.start(),Config.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t._curSubmit=Submit.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=Submit.RENDERBASE,BaseShader.activeShader=null,RenderState2D.worldAlpha=i,RenderState2D.worldMatrix4=n,RenderState2D.worldMatrix=r},n.drawCanvas=function(t,e,i,n,r){var a=t.context;if(a._targets){if(a._submits._length>0){var s=SubmitCMD.create([a,a._targets],this._flushToTarget,this);this._submits[this._submits._length++]=s}this._drawRenderTexture(a._targets,e,i,n,r,null,1,RenderTexture2D.flipyuv),this._curSubmit=Submit.RENDERBASE}else{a.touches&&a.touches.forEach(function(t){t.touch()}),s=SubmitCanvas.create(a,this._shader2D.ALPHA,this._shader2D.filters),this._submits[this._submits._length++]=s,s._key.clear();var o=n/t.width,l=r/t.height,_=s._matrix;this._curMat.copyTo(_),1!=o&&1!=l&&_.scale(o,l);var h=_.tx,u=_.ty;_.tx=_.ty=0,_.transformPoint(Point.TEMP.setTo(e,i)),_.translate(Point.TEMP.x+h,Point.TEMP.y+u),this._curSubmit=Submit.RENDERBASE}Config.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=a._targets?"yellow":"green",this.strokeRect(e-1,i-1,n+2,r+2,1),this.strokeRect(e,i,n,r,1),this.restore())},n.drawTarget=function(t,e,i,n,r,a,s,o,l,_){void 0===_&&(_=-1),this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);if(this._mesh.vertNum+4>65535&&(this._mesh=MeshQuadTexture.getAMesh(),this.meshlist.push(this._mesh)),this.transformQuad(e,i,n,r,0,a||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,l||Texture.DEF_UV,4294967295,this.getTransedClipInfo(),!0);var h=this._curSubmit=SubmitTarget.create(this,this._mesh,o,s);return h.blendType=-1==_?this._nBlendType:_,h.scope=t,this.copyClipInfo(h,this.getTransedClipInfo()),h._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._maxNumEle=Math.max(this._maxNumEle,h._numEle),this._submits[this._submits._length++]=h,!0}return!1},n.drawTriangles=function(t,i,n,r,a,s,o,l){if(!t._loaded||!t._getSource())return this.sprite&&Laya.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;var _=t.bitmap,h=this._curSubmit._key,u=4===h.submitType&&h.other===_.id,c=this._mixRGBandAlpha(4294967295,l),d=r.length/2,f=s.length;if(this._triangleMesh.vertNum+d>65535&&(this._triangleMesh=MeshTexture.getAMesh(),this.meshlist.push(this._triangleMesh),u=!1),!u){var m=this._curSubmit=SubmitTexture.create(this,this._triangleMesh,Value2D.create(1,0));m.shaderValue.textureHost=t,m._key.copyFrom2(this._submitKey,4,_.id),m._renderType=10016,this._submits[this._submits._length++]=m}return e._tmpMatrix.a=o.a,e._tmpMatrix.b=o.b,e._tmpMatrix.c=o.c,e._tmpMatrix.d=o.d,e._tmpMatrix.tx=o.tx+i,e._tmpMatrix.ty=o.ty+n,Matrix.mul(e._tmpMatrix,this._curMat,e._tmpMatrix),this._triangleMesh.addData(r,a,s,e._tmpMatrix,c,this),this._curSubmit._numEle+=f,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},n.transform=function(t,e,i,n,r,a){SaveTransform.save(this),Matrix.mul(Matrix.TEMP.setTo(t,e,i,n,r,a),this._curMat,this._curMat),this._curMat._checkTransform()},n._transformByMatrix=function(t,e,i){t.setTranslate(e,i),Matrix.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},n.setTransformByMatrix=function(t){t.copyTo(this._curMat)},n.rotate=function(t){SaveTransform.save(this),this._curMat.rotateEx(t)},n.scale=function(t,e){SaveTransform.save(this),this._curMat.scaleEx(t,e)},n.getTransedClipInfo=function(){return this._transedClipInfo},n.clipRect=function(t,i,n,r){SaveClipRect.save(this),this._clipRect==e.MAXCLIPRECT?this._clipRect=new Rectangle(t,i,n,r):(this._clipRect.width=n,this._clipRect.height=r,this._clipRect.x=t,this._clipRect.y=i),this._clipInfoID=++this._clipInfoID%1e4,this._clipRect.width>=99999999?(this._transedClipInfo[0]=0,this._transedClipInfo[1]=0,this._transedClipInfo[2]=99999999,this._transedClipInfo[3]=0,this._transedClipInfo[5]=99999999,this._transedClipInfo[4]=0):this._curMat._bTransform?(this._transedClipInfo[0]=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,this._transedClipInfo[1]=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,this._transedClipInfo[2]=this._clipRect.width*this._curMat.a,this._transedClipInfo[3]=this._clipRect.width*this._curMat.b,this._transedClipInfo[4]=this._clipRect.height*this._curMat.c,this._transedClipInfo[5]=this._clipRect.height*this._curMat.d):(this._transedClipInfo[0]=this._clipRect.x+this._curMat.tx,this._transedClipInfo[1]=this._clipRect.y+this._curMat.ty,this._transedClipInfo[2]=this._clipRect.width,this._transedClipInfo[3]=0,this._transedClipInfo[4]=0,this._transedClipInfo[5]=this._clipRect.height)},n.drawMesh=function(t,e,i,n,r,a,s,o,l){void 0===l&&(l=0)},n.addRenderObject=function(t){this._submits[this._submits._length++]=t},n.fillTrangles=function(){},n.submitElement=function(t,e){var i=this._submits;0>e&&(e=i._length);for(var n=Submit.RENDERBASE;e>t;)this._renderNextSubmitIndex=t+1,i[t]!==Submit.RENDERBASE?(Submit.preRender=n,n=i[t],t+=n.renderSubmit()):t++},n.submitNextElement=function(t){return this.submitElement(this._renderNextSubmitIndex,this._renderNextSubmitIndex+t)},n.flush=function(){this.submitElement(0,this._submits._length),this._path&&this._path.reset(),SkinMeshBuffer.instance&&SkinMeshBuffer.getInstance().reset(),Stat.mesh2DNum+=this.meshlist.length,this._curSubmit=Submit.RENDERBASE;for(var t=0,e=this.meshlist.length;e>t;t++){var i=this.meshlist[t];i.canReuse?i.releaseMesh():i.destroy()}this.meshlist.length=0,this._mesh=MeshQuadTexture.getAMesh(),this._pathMesh=MeshVG.getAMesh(),this._triangleMesh=MeshTexture.getAMesh(),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh);var n=CharBook.charbookInst;return n.GC(),this._submits._length},n.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=VectorGraphManager.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},n.beginPath=function(t){void 0===t&&(t=!1);var e=this._getPath();e.beginPath(t)},n.closePath=function(){this._path.closePath()},n.addPath=function(t,e,i,n,r){var a=0,s=this._curMat;if(this._curMat._bTransform)for(var o=0,l=t.length/2;l>o;o++){var _=t[a]+n,h=t[a+1]+r;t[a]=_*s.a+h*s.c+s.tx,t[a+1]=_*s.b+h*s.d+s.ty,a+=2}else if(0!=s.tx||0!=s.ty||n||r)for(var o=0,l=t.length/2;l>o;o++){var _=t[a]+n,h=t[a+1]+r;t[a]=_+s.tx,t[a+1]=h+s.ty,a+=2}else;this._getPath().push(t,i)},n.fill=function(){var t=this._getPath(),e=this._curSubmit,i=3===e._key.submitType&&e._key.blendShader===this._submitKey.blendShader;i&&(i=i&&this.isSameClipInfo(e,this.getTransedClipInfo())),i||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var n=this.mixRGBandAlpha(this.fillStyle.toInt()),r=0,a=0,s=t.paths.length;s>a;a++){var o=t.paths[a],l=o.path.length/2;this._pathMesh.vertNum+l>65535&&(this._curSubmit._numEle+=r,r=0,this._pathMesh=MeshVG.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));var _=this._pathMesh.vertNum;if(o.convex)for(var h=l-2,u=new Array(3*h),c=0,d=0;h>d;d++)u[c++]=_,u[c++]=d+1+_,u[c++]=d+2+_;else{var u=Earcut.earcut(o.path,null,2);if(_>0)for(var f=0;f<u.length;f++)u[f]+=_}this._pathMesh.addVertAndIBToMesh(this,o.path,n,u),r+=u.length}this._curSubmit._numEle+=r},n.addVGSubmit=function(t){var e=Submit.createShape(this,t,0,Value2D.create(4,0));return e._key.blendShader=this._submitKey.blendShader,e._key.submitType=3,this._submits[this._submits._length++]=e,this.copyClipInfo(e,this.getTransedClipInfo()),e},n.stroke=function(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,n=3===i._key.submitType&&i._key.blendShader===this._submitKey.blendShader;n&&(n=n&&this.isSameClipInfo(i,this.getTransedClipInfo())),n||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var r=0,a=0,s=e.paths.length;s>a;a++){var o=e.paths[a];if(!(o.path.length<=0)){var l=[],_=[],h=2*o.path.length;this._pathMesh.vertNum+h>65535&&(this._curSubmit._numEle+=r,r=0,this._pathMesh=MeshVG.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),BasePoly.createLine2(o.path,l,this.lineWidth,this._pathMesh.vertNum,_,o.loop),this._pathMesh.addVertAndIBToMesh(this,_,t,l),r+=l.length}}this._curSubmit._numEle+=r}},n.moveTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(n.newPath(),n._lastOriX=t,n._lastOriY=e,i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a+this._curMat.tx,e=this._curMat.b*r+this._curMat.d*a+this._curMat.ty}n.addPoint(t,e)},n.lineTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(!(Math.abs(t-n._lastOriX)<.001&&Math.abs(e-n._lastOriY)<.001)){if(n._lastOriX=t,n._lastOriY=e,i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a+this._curMat.tx,e=this._curMat.b*r+this._curMat.d*a+this._curMat.ty}n.addPoint(t,e)}},n.arcTo=function(t,i,n,r,a){var s=0,o=0,l=0,_=this._path._lastOriX-t,h=this._path._lastOriY-i,u=Math.sqrt(_*_+h*h);if(!(1e-6>=u)){var c=_/u,d=h/u,f=n-t,m=r-i,p=f*f+m*m,g=Math.sqrt(p);if(!(1e-6>=g)){var v=f/g,x=m/g,y=c+v,T=d+x,D=Math.sqrt(y*y+T*T);if(!(1e-6>=D)){var E=y/D,S=T/D,M=Math.acos(E*c+S*d),R=Math.PI/2-M;u=a/Math.tan(R);var A=u*c+t,C=u*d+i,L=Math.sqrt(u*u+a*a),I=t+E*L,w=i+S*L,b=c*x-d*v,P=0,V=0,O=0;if(b>=0){P=2*R;var N=P/e.SEGNUM;V=Math.sin(N),O=Math.cos(N)}else P=2*-R,N=P/e.SEGNUM,V=Math.sin(N),O=Math.cos(N);var B=this._path._lastOriX,F=this._path._lastOriY,U=A,G=C;(Math.abs(U-this._path._lastOriX)>.1||Math.abs(G-this._path._lastOriY)>.1)&&(o=this._curMat.a*U+this._curMat.c*G+this._curMat.tx,l=this._curMat.b*U+this._curMat.d*G+this._curMat.ty,B=U,F=G,this._path.addPoint(o,l));var H=A-I,W=C-w;for(s=0;s<e.SEGNUM;s++){var k=H*O+W*V,z=-H*V+W*O;if(o=k+I,l=z+w,Math.abs(B-o)>.1||Math.abs(F-l)>.1){var U=o,G=l;o=this._curMat.a*U+this._curMat.c*G+this._curMat.tx,l=this._curMat.b*U+this._curMat.d*G+this._curMat.ty,this._path.addPoint(o,l),B=o,F=l}H=k,W=z}}}}},n.arc=function(t,e,i,n,r,a,s){void 0===a&&(a=!1),void 0===s&&(s=!0);var o=0,l=0,_=0,h=0,u=0,c=0,d=0,f=0,m=0,p=0,g=0;if(l=r-n,a)if(Math.abs(l)>=2*Math.PI)l=2*-Math.PI;else for(;l>0;)l-=2*Math.PI;else if(Math.abs(l)>=2*Math.PI)l=2*Math.PI;else for(;0>l;)l+=2*Math.PI;p=101>i?Math.max(10,l*i/5):201>i?Math.max(10,l*i/20):Math.max(10,l*i/40),_=l/p/2,h=Math.abs(4/3*(1-Math.cos(_))/Math.sin(_)),a&&(h=-h),g=0;var v=this._getPath(),x=0/0,y=0/0;for(m=0;p>=m;m++)if(o=n+l*(m/p),u=Math.cos(o),c=Math.sin(o),d=t+u*i,f=e+c*i,d!=this._path._lastOriX||f!=this._path._lastOriY){var x=d,y=f;d=this._curMat.a*x+this._curMat.c*y+this._curMat.tx,f=this._curMat.b*x+this._curMat.d*y+this._curMat.ty,v.addPoint(d,f)}if(u=Math.cos(r),c=Math.sin(r),d=t+u*i,f=e+c*i,d!=this._path._lastOriX||f!=this._path._lastOriY){var x=d,y=f;d=this._curMat.a*x+this._curMat.c*y+this._curMat.tx,f=this._curMat.b*x+this._curMat.d*y+this._curMat.ty,v.addPoint(d,f)}},n.quadraticCurveTo=function(t,e,i,n){for(var r=Bezier.I,a=r.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,n],30,2),s=0,o=a.length/2;o>s;s++)this.lineTo(a[2*s],a[2*s+1]);this.lineTo(i,n)},n.rect=function(t,e,i,n){this._other=this._other.make(),this._other.path||(this._other.path=new Path),this._other.path.rect(t,e,i,n)},n.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},n._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},n.strokeRect=function(t,e,i,n,r){if(this.lineWidth>0){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor),s=this.lineWidth/2;this._fillRect(t-s,e-s,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-s,e-s+n,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-s,e+s,this.lineWidth,n-this.lineWidth,a),this._fillRect(t-s+i,e+s,this.lineWidth,n-this.lineWidth,a)}},n.clip=function(){},n.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},n._getPath=function(){return this._path||(this._path=new Path)},n.smartCacheStart=function(){},n.smartCacheEnd=function(){},n._moveCacheVBPos=function(t,e,i,n,r){if(i+=e,0===r)for(;i>e;e+=16)t[e]+=n,t[e+4]+=n,t[e+8]+=n,t[e+12]+=n;else if(0===n)for(;i>e;e+=16)t[e+1]+=r,t[e+5]+=r,t[e+9]+=r,t[e+13]+=r;else for(;i>e;e+=16)t[e]+=n,t[e+1]+=r,t[e+4]+=n,t[e+5]+=r,t[e+8]+=n,t[e+9]+=r,t[e+12]+=n,t[e+13]+=r},n.smartCacheCopy=function(){},__getset(0,n,"globalCompositeOperation",function(){return BlendMode.NAMES[this._nBlendType]},function(t){var e=BlendMode.TOINT[t];null==e||this._nBlendType===e||(SaveBase.save(this,65536,this,!0),this._curSubmit=Submit.RENDERBASE,this._nBlendType=e,this._reCalculateBlendShader())}),__getset(0,n,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(SaveBase.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=DrawStyle.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),__getset(0,n,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){t=Math.floor(1e3*t)/1e3,t!=this._shader2D.ALPHA&&(SaveBase.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=this._submitKey.alpha=t)}),__getset(0,n,"asBitmap",null,function(t){if(t&&(this._targets||(this._targets=new RenderTexture2D(this._width,this._height,1,-1)),this._targets.tex_fun=null,this._targets.tex_funThis=this,this._targets.tex_funargs=null,!this._width||!this._height))throw Error("asBitmap no size!")}),__getset(0,n,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(SaveBase.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=DrawStyle.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),__getset(0,n,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),SaveBase.save(this,32768,this._other,!1),this._other.textAlign=t)}),__getset(0,n,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),SaveBase.save(this,256,this._other,!1),this._other.lineWidth=t)}),__getset(0,n,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),SaveBase.save(this,16384,this._other,!1),this._other.textBaseline=t)}),__getset(0,n,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),SaveBase.save(this,8,this._other,!1),this._other.font===FontInContext.EMPTY?this._other.font=new FontInContext(t):this._other.font.setFont(t))}),e.__init__=function(){i.DEFAULT=new i},e._tempPoint=new Point,e._SUBMITVBSIZE=32e3,e._MAXSIZE=99999999,e._MAXVERTNUM=65535,e.MAXCLIPRECT=new Rectangle(0,0,99999999,99999999),e._COUNT=0,e._tmpMatrix=new Matrix,e.SEGNUM=32,e._contextcount=0,__static(e,["_fontTemp",function(){return this._fontTemp=new FontInContext},"_drawStyleTemp",function(){return this._drawStyleTemp=new DrawStyle(null)},"_keyMap",function(){return this._keyMap=new StringKey}]),e.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=FontInContext.EMPTY}__class(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=FontInContext.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},e}(Context),KeyframeAnimations=function(t){function e(){this._player=null,this._templet=null,e.__super.call(this),this._player=new AnimationPlayer}__class(e,"laya.d3.component.animation.KeyframeAnimations",t);var i=e.prototype;return i._added=function(){},i._onDestroy=function(){this._player._destroy(),this._player=null,this._templet=null},__getset(0,i,"url",null,function(t){console.log("Warning: discard property,please use templet property instead.");var e=Laya.loader.create(t,null,null,AnimationTemplet);this._templet!==e&&(0!==this._player.state&&this._player.stop(!0),this._templet=e,this._player.templet=e)}),__getset(0,i,"player",function(){return this._player}),__getset(0,i,"templet",function(){return this._templet},function(t){this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t)}),__getset(0,i,"currentFrameIndex",function(){return this._player.currentKeyframeIndex}),__getset(0,i,"currentAnimationClipIndex",function(){return this._player.currentAnimationClipIndex}),__getset(0,i,"nodeCount",function(){return this._templet.getNodeCount(this._player.currentAnimationClipIndex)}),e}(Component),Animator=function(t){function e(){this._linkAvatarSpritesData={},this._keyframeNodeOwners=[],this._linkAvatarSprites=[],this._renderableSprites=[],this.cullingMode=2,e.__super.call(this),this._controllerLayers=[],this._linkSprites={},this._cacheSpeed=1,this.isCache=!0,this.cacheFrameRate=60,this._speed=1,this._keyframeNodeOwnerMap={},this._updateMark=0}__class(e,"laya.d3.component.Animator",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.IDestroy":!0}),i._linkToSprites=function(t){for(var e in t){for(var i=this._owner,n=t[e],r=0,a=n.length;a>r;r++){var s=n[r];if(""===s)break;if(i=i.getChildByName(s),!i)break}i&&this.linkSprite3DToAvatarNode(e,i)}},i._addKeyframeNodeOwner=function(t,e,i){var n=e._indexInList,r=e.fullPath,a=this._keyframeNodeOwnerMap[r];if(a)a.referenceCount++,t[n]=a;else{var s=this._keyframeNodeOwners.length;a=this._keyframeNodeOwnerMap[r]=new KeyFrameNodeOwner,a.fullPath=r,a.indexInList=s,a.referenceCount=1,a.propertyID=e.propertyNameID;var o;if(this._avatar?(a.avatarOwner=i,o=AnimationNode._propertyGetFuncs[e.propertyNameID](i,null)):(a.spritOwner=i,o=AnimationNode._propertyGetFuncs[e.propertyNameID](null,i)),o)for(var l=new Float32Array(e.keyFrameWidth),_=0,h=o.length;h>_;_++)l[_]=o[_];a.defaultValue=l,this._keyframeNodeOwners.push(a),t[n]=a}},i._removeKeyframeNodeOwner=function(t,e){var i=e.fullPath,n=this._keyframeNodeOwnerMap[i];n.referenceCount--,0===n.referenceCount&&(delete this._keyframeNodeOwnerMap[i],this._keyframeNodeOwners.splice(this._keyframeNodeOwners.indexOf(n),1)),t[e._indexInList]=null},i._getOwnersByClip=function(t){var e=t._clip._nodes,i=e.length,n=t._nodeOwners;n.length=i;for(var r=0;i>r;r++){for(var a=this._avatar?this._avatarNodeMap[this._avatar._rootNode.name]:this._owner,s=e[r],o=s.path,l=0,_=o.length;_>l;l++){var h=o[l];if(""===h)break;if(a=a.getChildByName(h),!a)break}a&&this._addKeyframeNodeOwner(n,s,a)}},i._getOwnersByClipAsync=function(t){var e=t._clip;e.loaded?this._getOwnersByClip(t):e.once("loaded",this,this._getOwnersByClip,[t])},i._getAvatarOwnersAndInitDatasAsync=function(){for(var t=0,e=this._controllerLayers.length;e>t;t++)for(var i=this._controllerLayers[t]._clipStateInfos,n=0,r=i.length;r>n;n++)this._getOwnersByClipAsync(i[n]);this._avatar._cloneDatasToAnimator(this);for(var a in this._linkAvatarSpritesData){var s=this._linkAvatarSpritesData[a];if(s)for(var o=0,l=s.length;l>o;o++)this._isLinkSpriteToAnimationNode(s[o],a,!0)}},i._computeCacheFullKeyframeIndices=function(t){var e=t._clip,i=e._nodes,n=i.length,r=this._cacheSpeed/this._cacheFrameRate,a=e._getFullKeyframeIndicesWithCache(r);if(a)return t._cacheFullFrames=a,void 0;a=t._cacheFullFrames=[],a.length=n;for(var s=Math.ceil(e._duration/r-1e-5)+1,o=0;n>o;o++){var l=i[o],_=new Int32Array(s);_.fill(-1);for(var h=l.keyFrames,u=0,c=h.length;c>u;u++)for(var d=h[u],f=d.startTime,m=f+d.duration;m>=f;){var p=Math.ceil(f/r-1e-5);_[p]=u,f+=r}a[o]=_}e._cacheFullKeyframeIndices(r,a)},i._eventScript=function(t,e,i,n,r){for(var a=e._clip._events,s=i._playEventIndex,o=a.length;o>s;s++){var l=a[s],_=l.time;if(!(_>=n&&r>_))break;for(var h=0,u=t.length;u>h;h++){var c=t[h],d=c[l.eventName];d&&d.apply(c,l.params)}}i._playEventIndex=s},i._setPlayParams=function(t,e,i){t._clip._duration;e._frameIndex=Math.max(Math.floor(this.getCurrentPlayTime(t,e)/i-1e-5),0),e._frameTime=e._frameIndex*i},i._setPlayParamsWhenStop=function(t,e,i,n){e._elapsedTime=i,e._frameIndex=Math.max(Math.floor(i/n-1e-5),0),e._frameTime=e._frameIndex*n,e._lastFrameIndex=-1},i.getCurrentPlayTime=function(t,e){return e._elapsedTime%t._clip._duration},i._updatePlayer=function(t,e,i,n){var r=t._clip,a=this._cacheSpeed/this._cacheFrameRate,s=e._elapsedTime,o=s+i;e._lastElapsedTime=s,e._elapsedTime=o;var l=r._duration;if(!n&&o>=l)return e._finish=!0,this._setPlayParamsWhenStop(t,e,l,a),void 0;if(l>0)if(o>=l){do o-=l,l>o&&this._setPlayParams(t,e,a),e._playEventIndex=0;while(o>=l)}else this._setPlayParams(t,e,a);else e._resetPlayState(0)},i._updateEventScript=function(t,e,i){var n=this._owner._scripts;if(n){var r=t._clip._duration,a=e._lastElapsedTime,s=e._elapsedTime,o=Math.floor(a/r),l=Math.floor(s/r),_=a%r,h=s%r,u=l-o;if(i)if(u>0){this._eventScript(n,t,e,_,r);for(var c=0,d=u-1;d>c;c++)this._eventScript(n,t,e,0,r);this._eventScript(n,t,e,0,h)}else this._eventScript(n,t,e,_,h);else u>0?this._eventScript(n,t,e,_,r):this._eventScript(n,t,e,_,h)}},i._updateClipDatas=function(t,e,i){var n,r=t._clip,a=this._cacheSpeed,s=this.isCache&&i>=a,o=-1;if(s){if(o=e._frameIndex,t._lastFrameIndex===o)return;n=r._getAnimationDataWithCache(a,o);var l=r._nodes,_=l.length;this._avatar?n||(n=__newvec(_),r._evaluateAnimationlDatasCacheMode(t._cacheFullFrames,t,n,e),r._cacheAnimationData(a,o,n)):n||(n=__newvec(_),r._evaluateAnimationlDatasCacheMode(t._cacheFullFrames,t,n,e),r._cacheAnimationData(a,o,n))}else n=r._publicClipDatas,this._avatar?r._evaluateAnimationlDatasRealTime(this.getCurrentPlayTime(t,e),n,!0):r._evaluateAnimationlDatasRealTime(this.getCurrentPlayTime(t,e),n,null);t._lastFrameIndex=o,t._clipDatas=n},i._setClipDatasToNode=function(t,e,i){for(var n=t._clip,r=n._nodes,a=t._clipDatas,s=t._nodeOwners,o=0,l=r.length;l>o;o++){var _=s[o];if(_){_.updateMark===this._updateMark&&(e=!1);var h=a[o];if(h){var u=r[o];this._avatar?AnimationNode._propertySetFuncs[u.propertyNameID](_.avatarOwner,null,h,e,i):AnimationNode._propertySetFuncs[u.propertyNameID](null,_.spritOwner,h,e,i)}}}},i._setCrossClipDatasToNode=function(t,e,i,n,r,a){for(var s=t._crossNodesOwners,o=t._crossNodesOwnersCount,l=t.blendingMode!==AnimatorControllerLayer.BLENDINGMODE_OVERRIDE,_=t.defaultWeight,h=t._destCrossClipNodeIndices,u=r._clipDatas,c=r._nodeOwners,d=t._srcCrossClipNodeIndices,f=n._nodeOwners,m=n._clipDatas,p=0;o>p;p++){var g=s[p];
if(g){g.updateMark===this._updateMark&&(l=!1);var v=d[p],x=h[p];this._avatar?AnimationNode._propertySetCrossFuncs[g.propertyID](g.avatarOwner,null,-1!==v?m[v]:c[x].defaultValue,-1!==x?u[x]:f[v].defaultValue,a,l,_):AnimationNode._propertySetCrossFuncs[g.propertyID](null,g.spritOwner,-1!==v?m[v]:c[x].defaultValue,-1!==x?u[x]:f[v].defaultValue,a,l,_)}}},i._setFixedCrossClipDatasToNode=function(t,e,i){for(var n=t._crossNodesOwners,r=t._crossNodesOwnersCount,a=t.blendingMode!==AnimatorControllerLayer.BLENDINGMODE_OVERRIDE,s=t.defaultWeight,o=t._destCrossClipNodeIndices,l=e._clipDatas,_=0;r>_;_++){var h=n[_];if(h){h.updateMark===this._updateMark&&(a=!1);var u=o[_];this._avatar?AnimationNode._propertySetCrossFuncs[h.propertyID](h.avatarOwner,null,h.crossFixedValue,-1!==u?l[u]:h.defaultValue,i,a,s):AnimationNode._propertySetCrossFuncs[h.propertyID](null,h.spritOwner,h.crossFixedValue,-1!==u?l[u]:h.defaultValue,i,a,s)}}},i._revertDefaultKeyframeNodes=function(t){var e=t._nodeOwners,i=t._clip._nodes;if(this._avatar)for(var n=0,r=i.length;r>n;n++){var a=i[n],s=e[n];if(s){var o=s.avatarOwner;o&&AnimationNode._propertySetFuncs[a.propertyNameID](o,null,s.defaultValue,!1,1)}}else for(var n=0,r=i.length;r>n;n++)if(a=i[n],s=e[n]){var l=s.spritOwner;l&&AnimationNode._propertySetFuncs[a.propertyNameID](null,l,s.defaultValue,!1,1)}},i._removeClip=function(t,e,i,n){n.loaded||(n.off("loaded",this,this._getOwnersByClip),n.off("loaded",this,this._computeCacheFullKeyframeIndices)),n._removeReference(),t.splice(i,1),e.splice(i,1);for(var r=t[i],a=n._nodes,s=r._nodeOwners,o=0,l=a.length;l>o;o++)this._removeKeyframeNodeOwner(s,a[o])},i._isLinkSpriteToAnimationNodeData=function(t,e,i){var n=this._linkAvatarSpritesData[e];i?(n||(this._linkAvatarSpritesData[e]=n=[]),n.push(t)):n.splice(t,1)},i._isLinkSpriteToAnimationNode=function(t,e,i){if(this._avatar){var n=this._avatarNodeMap[e];if(n)if(i){t._transform.dummy=n.transform,this._linkAvatarSprites.push(t);var r=n.transform,a=t.transform;if(!a.owner.isStatic&&r){var s=a.worldMatrix,o=this._owner._transform.parent;if(o)Utils3D.matrix4x4MultiplyMFM(o.worldMatrix,r.getWorldMatrix(),s);else for(var l=s.elements,_=r.getWorldMatrix(),h=0;16>h;h++)l[h]=_[h];a.worldMatrix=s}}else t._transform.dummy=null,this._linkAvatarSprites.splice(this._linkAvatarSprites.indexOf(t),1)}},i._added=function(){var t=this._owner._parent;this._owner._setHierarchyAnimator(this,t?t._hierarchyAnimator:null),this._owner._changeAnimatorToLinkSprite3DNoAvatar(this,!0,[])},i._onDestroy=function(){var t=this._owner._parent;this._owner._clearHierarchyAnimator(this,t?t._hierarchyAnimator:null),this._owner._changeAnimatorToLinkSprite3DNoAvatar(this,!1,[])},i._onEnableInScene=function(){this._owner._scene._animatorPool.add(this);for(var t=0,e=this._controllerLayers.length;e>t;t++)if(this._controllerLayers[t].playOnWake){var i=this.getDefaultClip(t);i&&this.play(null,t)}},i._onDisableInScene=function(){this._owner._scene._animatorPool.remove(this)},i._handleSpriteOwnersBySprite=function(t,e,i){for(var n=0,r=this._controllerLayers.length;r>n;n++)for(var a=this._controllerLayers[n]._clipStateInfos,s=0,o=a.length;o>s;s++){var l=a[s],_=l._clip,h=e.join("/"),u=_._nodesMap[h];if(u)for(var c=(_._nodes,l._nodeOwners),d=0,f=u.length;f>d;d++)t?this._addKeyframeNodeOwner(c,u[d],i):this._removeKeyframeNodeOwner(c,u[d])}},i._updateAvatarNodesToSprite=function(){for(var t=0,e=this._linkAvatarSprites.length;e>t;t++){var i=this._linkAvatarSprites[t],n=i.transform.dummy,r=i.transform;if(!r.owner.isStatic&&n){var a=r.worldMatrix,s=this._owner._transform.parent;if(s)Utils3D.matrix4x4MultiplyMFM(s.worldMatrix,n.getWorldMatrix(),a);else for(var o=a.elements,l=n.getWorldMatrix(),t=0;16>t;t++)o[t]=l[t];r.worldMatrix=a}}},i._parse=function(t,e){var i=t.avatar;if(i){this.avatar=Loader.getRes(e[i.path]);var n=i.linkSprites;this._linkSprites=n,this._linkToSprites(n)}var r=t.clipPaths,a=t.playOnWake;if(r){u=new AnimatorControllerLayer("BaseLayer"),this.addControllerLayer(u);var s=r.length;for(_=0;s>_;_++){var o=Loader.getRes(e[r[_]]);this.addClip(o),0===_&&this.setDefaultClip(o.name,0)}void 0!==a&&(u.playOnWake=a)}else for(var l=t.layers,_=0;_<l.length;_++){var h=l[_],u=new AnimatorControllerLayer(h.name);u.defaultWeight=0===_?1:h.weight;var c=h.blendingMode;c&&(u.blendingMode=c),this.addControllerLayer(u);for(var d=h.states,f=0,m=d.length;m>f;f++){var p=d[f],g=p.clipPath;if(g){var v=p.name;this.addClip(Loader.getRes(e[g]),v,_),0===f&&this.setDefaultClip(v,_)}}void 0!==a&&(u.playOnWake=a)}var x=t.cullingMode;void 0!==x&&(this.cullingMode=x)},i._update=function(){if(0!==this._speed){var t=!1;if(2===this.cullingMode){t=!1;for(var e=0,i=this._renderableSprites.length;i>e;e++)if(this._renderableSprites[e]._render._visible){t=!0;break}}else t=!0;this._updateMark++;for(var n=this._owner._scene.timer,e=0,i=this._controllerLayers.length;i>e;e++){var r=this._controllerLayers[e],a=(r._clipStateInfos,r._playStateInfo),s=r._crossPlayStateInfo,o=n._delta/1e3,l=n.scale;switch(r._playType){case 0:var _=r._currentPlayState,h=_._clip;if(h.loaded&&!a._finish){var u=this._speed*_.speed;this._updatePlayer(_,a,o*u,h.islooping),t&&(this._updateClipDatas(_,a,l*u),this._setClipDatasToNode(_,r.blendingMode!==AnimatorControllerLayer.BLENDINGMODE_OVERRIDE,r.defaultWeight),this._updateEventScript(_,a,h.islooping))}break;case 1:_=r._currentPlayState,h=_._clip;var c=r._crossPlayState,d=c._clip,f=r._crossDuration;if(h.loaded&&d.loaded){var m=s._startPlayTime,p=d._duration-m,g=f>p?p/f:1,v=this._speed*c.speed;this._updatePlayer(c,s,o*g*v,d.islooping);var x=(s._elapsedTime-m)/g/f;x>=1?t&&(this._updateClipDatas(c,s,l*v),this._setClipDatasToNode(c,r.blendingMode!==AnimatorControllerLayer.BLENDINGMODE_OVERRIDE,r.defaultWeight),r._playType=0,r._currentPlayState=c,s._cloneTo(a)):(a._finish||(u=this._speed*_.speed,this._updatePlayer(_,a,o*u,!1),t&&this._updateClipDatas(_,a,l*u)),t&&(this._updateClipDatas(c,s,l*g*v),this._setCrossClipDatasToNode(r,h._nodes,d._nodes,_,c,x)))}t&&(this._updateEventScript(_,a,!1),this._updateEventScript(c,s,d.islooping));break;case 2:c=r._crossPlayState,d=c._clip,f=r._crossDuration,d.loaded&&(m=s._startPlayTime,p=d._duration-m,g=f>p?p/f:1,v=this._speed*c.speed,this._updatePlayer(c,s,o*g*v,d.islooping),t&&(x=(s._elapsedTime-m)/g/f,x>=1?(this._updateClipDatas(c,s,l*v),this._setClipDatasToNode(c,!1,1),r._playType=0,r._currentPlayState=c,s._cloneTo(a)):(this._updateClipDatas(c,s,l*g*v),this._setFixedCrossClipDatasToNode(r,c,x)),this._updateEventScript(c,s,d.islooping)))}}t&&this._avatar&&(Render.isConchApp&&this._updateAnimationNodeWorldMatix(this._animationNodeLocalPositions,this._animationNodeLocalRotations,this._animationNodeLocalScales,this._animationNodeWorldMatrixs,this._animationNodeParentIndices),this._updateAvatarNodesToSprite())}},i._cloneTo=function(t){var e=t;e.avatar=this.avatar;for(var i=0,n=this._controllerLayers.length;n>i;i++){var r=this._controllerLayers[i];e.addControllerLayer(new AnimatorControllerLayer(r.name));for(var a=r._clipStateInfos,s=0,o=a.length;o>s;s++){var l=a[s];e.addClip(l._clip,l._name,i),e._controllerLayers[i]._defaultClipIndex=r._defaultClipIndex}}e._linkSprites=this._linkSprites,e._linkToSprites(this._linkSprites)},i.getDefaultClip=function(t){void 0===t&&(t=0);var e=this._controllerLayers[t],i=e._defaultClipIndex;return-1!==i?e._clipStateInfos[i]._clip:null},i.setDefaultClip=function(t,e){void 0===e&&(e=0);var i=this._controllerLayers[e],n=i._clipNames.indexOf(t);i._defaultClipIndex=n},i.addClip=function(t,e,i){void 0===i&&(i=0),e=e||t.name;var n=this._controllerLayers[i],r=n._clipNames,a=n._clipStateInfos,s=r.indexOf(e);if(-1!==s)throw new Error("Animator:this playName has exist.");r.push(e);var o=new ClipStateInfo;o._name=e,o._clip=t,a.push(o),t._addReference(),this._avatar?this._avatar.loaded?this._getOwnersByClipAsync(o):this._avatar.once("loaded",this,this._getOwnersByClipAsync,[o]):this._getOwnersByClipAsync(o),t.loaded?this._computeCacheFullKeyframeIndices(o):t.once("loaded",this,this._computeCacheFullKeyframeIndices,[o])},i.removeClip=function(t,e){void 0===e&&(e=0);for(var i=this._controllerLayers[e],n=i._clipStateInfos,r=i._clipNames,a=-1,s=0,o=n.length;o>s;s++)if(n[s]._clip===t){a=s;break}-1!==a&&this._removeClip(n,r,a,t)},i.removeClipByName=function(t,e){void 0===e&&(e=0);var i=this._controllerLayers[e],n=i._clipNames,r=n.indexOf(t);if(-1!==r){var a=i._clipStateInfos,s=a[r]._clip;this._removeClip(a,n,r,s)}},i.addControllerLayer=function(t){this._controllerLayers.push(t)},i.getControllerLayer=function(t){return void 0===t&&(t=0),this._controllerLayers[t]},i.play=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-Number.MAX_VALUE);var n=this._controllerLayers[e],r=n._defaultClipIndex;if(!t&&-1==r)throw new Error("Animator:must have  default clip value,please set clip property.");var a=n._currentPlayState,s=n._playStateInfo,o=t?n._clipNames.indexOf(t):r,l=n._clipStateInfos[o],_=l._clip._duration;a!==l?(i!==-Number.MAX_VALUE?s._resetPlayState(_*i):s._resetPlayState(0),null!==a&&a!==l&&this._revertDefaultKeyframeNodes(a),n._playType=0,n._currentPlayState=l):i!==-Number.MAX_VALUE&&(s._resetPlayState(_*i),n._playType=0)},i.crossFade=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=-Number.MAX_VALUE);var r=this._controllerLayers[i]._clipNames.indexOf(t);if(-1!==r){var a=this._controllerLayers[i],s=a._playType;if(-1===s)return this.play(t,i,n),void 0;var o=a._clipStateInfos,l=a._crossPlayStateInfo,_=a._crossNodesOwners,h=a._crossNodesOwnersIndicesMap,u=a._currentPlayState,c=o[r],d=c._nodeOwners,f=a._destCrossClipNodeIndices,m=c._clip,p=m._nodes,g=m._nodesDic;switch(s){case 0:var v=u._nodeOwners,x=a._srcCrossClipNodeIndices,y=u._clip,T=y._nodes,D=y._nodesDic;a._playType=1;for(var E=++a._crossMark,S=a._crossNodesOwnersCount=0,M=0,R=T.length;R>M;M++){var A=T[M],C=A._indexInList,L=v[C];if(L){var I=A.fullPath;x[S]=C;var w=g[I];f[S]=w?w._indexInList:-1,h[I]=E,_[S]=L,S++}}for(var M=0,R=p.length;R>M;M++){var w=p[M],b=w._indexInList,P=d[b];if(P){var V=w.fullPath;D[V]||(x[S]=-1,f[S]=b,h[V]=E,_[S]=P,S++)}}break;case 1:case 2:a._playType=2;for(var M=0,R=_.length;R>M;M++){var O=_[M];O.saveCrossFixedValue(this._avatar);var w=g[O.fullPath];f[M]=w?w._indexInList:-1}for(S=a._crossNodesOwnersCount,E=a._crossMark,M=0,R=p.length;R>M;M++)w=p[M],b=w._indexInList,P=d[b],P&&(V=w.fullPath,h[V]!==E&&(f[S]=b,h[V]=E,O=d[b],_[S]=O,O.saveCrossFixedValue(this._avatar),S++))}a._crossNodesOwnersCount=S,a._crossPlayState=c,a._crossDuration=u._clip._duration*e,n!==-Number.MAX_VALUE?l._resetPlayState(m._duration*n):l._resetPlayState(0)}},i.linkSprite3DToAvatarNode=function(t,e){if(e._hierarchyAnimator===this)return this._isLinkSpriteToAnimationNodeData(e,t,!0),this._isLinkSpriteToAnimationNode(e,t,!0),!0;throw"Animator:sprite3D must belong to this Animator"},i.unLinkSprite3DToAvatarNode=function(t){if(t._hierarchyAnimator!==this)throw"Animator:sprite3D must belong to this Animator";var e=t.transform.dummy;if(!e)return!1;var i=e._owner.name;this._isLinkSpriteToAnimationNodeData(t,i,!1),this._isLinkSpriteToAnimationNode(t,i,!1)},i.destroy=function(){t.prototype.destroy.call(this);for(var e=0,i=this._controllerLayers.length;i>e;e++)for(var n=this._controllerLayers[e]._clipStateInfos,r=0,a=n.length;a>r;r++)n[r]._clip._removeReference()},i._updateAnimationNodeWorldMatix=function(t,e,i,n,r){LayaGL.instance.updateAnimationNodeWorldMatix(t,e,i,r,n)},__getset(0,i,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){if(this._cacheFrameRate!==t){this._cacheFrameRate=t;for(var e=0,i=this._controllerLayers.length;i>e;e++)for(var n=this._controllerLayers[e]._clipStateInfos,r=0,a=n.length;a>r;r++){var s=n[r];s._clip.loaded&&this._computeCacheFullKeyframeIndices(s)}}}),__getset(0,i,"avatar",function(){return this._avatar},function(t){if(this._avatar!==t){var e=this._avatar;if(this._avatar=t,e)if(e.loaded)for(var i=0,n=this._controllerLayers.length;n>i;i++)for(var r=this._controllerLayers[i]._clipStateInfos,a=0,s=r.length;s>a;a++){var o=r[a]._clip;o.loaded||o.off("loaded",this,this._getOwnersByClip)}else e.off("loaded",this,this._getAvatarOwnersAndInitDatasAsync);if(t&&(t.loaded?this._getAvatarOwnersAndInitDatasAsync():t.once("loaded",this,this._getAvatarOwnersAndInitDatasAsync)),t)this._owner._changeHierarchyAnimatorAvatar(this,t);else{var l=this._owner._parent;this._owner._changeHierarchyAnimatorAvatar(this,l?l._hierarchyAnimator._avatar:null)}}}),__getset(0,i,"speed",function(){return this._speed},function(t){this._speed=t}),__getset(0,i,"cacheSpeed",function(){return this._cacheSpeed},function(t){if(this._cacheSpeed!==t){this._cacheSpeed=t;for(var e=0,i=this._controllerLayers.length;i>e;e++)for(var n=this._controllerLayers[e],r=0,a=n.length;a>r;r++){var s=n[r];s._clip.loaded&&this._computeCacheFullKeyframeIndices(s)}}}),e._update=function(t){for(var e=t._animatorPool,i=e.elements,n=0,r=e.length;r>n;n++){var a=i[n];a&&a.enabled&&a._update()}},e.CULLINGMODE_ALWAYSANIMATE=0,e.CULLINGMODE_CULLCOMPLETELY=2,e}(Component),Collider=function(t){function e(){e.__super.call(this),this._isRigidbody=!1,this._runtimeCollisonMap={},this._runtimeCollisonTestMap={},this._ignoreCollisonMap={},this.isTrigger=!0}__class(e,"laya.d3.component.physics.Collider",t);var i=e.prototype;return i._added=function(){var t=this._owner.getComponent(Rigidbody);t&&(this._isRigidbody=!0);var e=this._owner._colliders;e=e||[],e.push(this)},i._onDestroy=function(){var t=this._owner._colliders;t.splice(t.indexOf(this),1);for(var e in this._runtimeCollisonMap){var i=this._runtimeCollisonMap[e];delete i._runtimeCollisonMap[this.id],i._isRigidbody&&delete i._runtimeCollisonTestMap[this.id],delete this._ignoreCollisonMap[e]._ignoreCollisonMap[this.id]}},i._awake=function(){this.owner.scene._enablePhysics&&!this.owner.compoundShape&&(this.owner.compoundShape=new Ammo.btCompoundShape)},i._onEnableInScene=function(){var t=this._owner;t._scene._layerList[t.layer]._addCollider(this)},i._onDisableInScene=function(){this._clearCollsionMap();var t=this._owner;t._scene._layerList[t.layer]._removeCollider(this)},i._clearCollsionMap=function(){for(var t in this._runtimeCollisonMap){var e=this._runtimeCollisonMap[t];delete e._runtimeCollisonMap[this.id],e._isRigidbody&&delete e._runtimeCollisonTestMap[this.id];var i=e.id;delete this._runtimeCollisonMap[i],this._isRigidbody&&delete this._runtimeCollisonTestMap[i]}},i._setIsRigidbody=function(t){if(this._isRigidbody!==t){this._isRigidbody=t;var e=this._owner;if(e.displayedInStage){var i=e.layer;i._removeCollider(this),i._addCollider(this)}}},i._getType=function(){return-1},i._collisonTo=function(){return!1},i.raycast=function(t,e,i){throw void 0===i&&(i=1.79e308),new Error("Collider:Must override it.")},__getset(0,i,"enabled",t.prototype._$get_enabled,function(t){if(this._enabled!==t){var e=this._owner;e.displayedInStage&&(t||this._clearCollsionMap()),this._enabled=t}}),__getset(0,i,"isSingleton",function(){return!1}),e._physicsObjects=[],e._physicsObjectIndex=0,e}(Component),Rigidbody=function(t){function e(){this._mass=0/0,this._friction=0/0,this._restitution=0/0,this._isKinematic=!1,e.__super.call(this),this._mass=0,this._friction=.5,this._restitution=.5,this._isKinematic=!1}__class(e,"laya.d3.component.Rigidbody",t);var i=e.prototype;return i._parse=function(t){this._mass=t.mass,this._isKinematic=t.isKinematic},i._added=function(){var t=this._owner._colliders;if(t)for(var e=0,i=t.length;i>e;e++)t[e]._setIsRigidbody(!0)},i._onDestroy=function(){var t=this._owner._colliders;if(t)for(var e=0,i=t.length;i>e;e++){var n=t[e];n._setIsRigidbody(!1);var r=n._runtimeCollisonMap,a=n._runtimeCollisonTestMap;for(var s in r)delete a[s]}},__getset(0,i,"mass",function(){return this._mass},function(t){this._mass=Math.max(0,t)}),__getset(0,i,"friction",function(){return this._friction},function(t){this._friction=t}),__getset(0,i,"restitution",function(){return this._restitution},function(t){this._restitution=t}),__getset(0,i,"enabled",t.prototype._$get_enabled,function(t){if(this._enabled!==t){var e=this._owner._colliders;if(e)for(var i=0,n=e.length;n>i;i++){var r=e[i];r._setIsRigidbody(t);var a=r._runtimeCollisonMap,s=r._runtimeCollisonTestMap;if(!t)for(var o in a)delete s[o]}this._enabled=t}}),__getset(0,i,"isKinematic",function(){return this._isKinematic},function(t){this._isKinematic=t}),e}(Component),Script3D=function(t){function e(){e.__super.call(this)}__class(e,"laya.d3.component.Script3D",t);var i=e.prototype;return i._awake=function(){this.awake()},i._onEnable=function(){var t=laya.d3.component.Script3D.prototype;this.onMouseDown!==t.onMouseDown&&this.owner.on("mousedown",this,this.onMouseDown),this.onMouseUp!==t.onMouseUp&&this.owner.on("mouseup",this,this.onMouseUp),this.onClick!==t.onClick&&this.owner.on("click",this,this.onClick),this.onDoubleClick!==t.onDoubleClick&&this.owner.on("doubleclick",this,this.onDoubleClick),this.onRightClick!==t.onRightClick&&this.owner.on("rightclick",this,this.onRightClick),this.onMouseMove!==t.onMouseMove&&this.owner.on("mousemove",this,this.onMouseMove),this.onMouseOver!==t.onMouseOver&&this.owner.on("mouseover",this,this.onMouseOver),this.onMouseOut!==t.onMouseOut&&this.owner.on("mouseout",this,this.onMouseOut),this.onKeyDown!==t.onKeyDown&&Laya.stage.on("keydown",this,this.onKeyDown),this.onKeyPress!==t.onKeyPress&&Laya.stage.on("keypress",this,this.onKeyUp),this.onKeyUp!==t.onKeyUp&&Laya.stage.on("keyup",this,this.onKeyUp),this.onEnable()},i._onDisable=function(){this.owner.offAllCaller(this),Laya.stage.offAllCaller(this),this.onDisable()},i._onEnableInScene=function(){this._owner._scene._scriptPool.add(this)},i._onDisableInScene=function(){this._owner._scene._scriptPool.remove(this)},i._added=function(){var t=this._owner,e=t._scripts;e||(t._scripts=e=[]),e.push(this)},i._onDestroy=function(){var t=this._owner._scripts;t.splice(t.indexOf(this),1),this.onDestroy()},i.awake=function(){},i.onEnable=function(){},i.start=function(){},i.onTriggerEnter=function(){},i.onTriggerStay=function(){},i.onTriggerExit=function(){},i.onMouseDown=function(){},i.onMouseUp=function(){},i.onClick=function(){},i.onDoubleClick=function(){},i.onRightClick=function(){},i.onMouseMove=function(){},i.onMouseOver=function(){},i.onMouseOut=function(){},i.onKeyDown=function(){},i.onKeyPress=function(){},i.onKeyUp=function(){},i.update=function(){},i.lateUpdate=function(){},i.onPreRender=function(){},i.onPostRender=function(){},i.onDisable=function(){},i.onDestroy=function(){},__getset(0,i,"isSingleton",function(){return!1}),e}(Component),MeshFilter=function(t){function e(t){this._owner=null,this._sharedMesh=null,e.__super.call(this),this._owner=t}__class(e,"laya.d3.core.MeshFilter",t);var i=e.prototype;return i._changeRenderObjectByMesh=function(t){var e=this._owner._render,i=e._renderElements,n=i[t];if(n)n.setGeometry(this._sharedMesh._getSubMesh(t));else{var r=e.sharedMaterials[t];r||(r=BlinnPhongMaterial.defaultMaterial),n=i[t]=new SubMeshRenderElement,n.setTransform(this._owner._transform),n.render=e,n.material=r,n.setGeometry(this._sharedMesh._getSubMesh(t))}},i._changeRenderObjectsByMesh=function(){var t=this._sharedMesh.subMeshCount;this._owner._render._renderElements.length=t;for(var e=0;t>e;e++)this._changeRenderObjectByMesh(e)},i.destroy=function(){this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},__getset(0,i,"sharedMesh",function(){return this._sharedMesh},function(t){if(this._sharedMesh!==t){var e=this._sharedMesh;e&&(e._removeReference(),e.loaded||e.off("loaded",this,this._changeRenderObjectsByMesh)),t._addReference(),this._sharedMesh=t,t.loaded?this._changeRenderObjectsByMesh():t.once("loaded",this,this._changeRenderObjectsByMesh)}this.event("meshchanged",[this,e,t])}),e}(EventDispatcher),BaseRender=function(t){function e(t,i){if(this._indexInList=-1,this._visible=!1,this._isPartOfStaticBatch=!1,this._staticBatch=null,e.__super.call(this),this._id=++e._uniqueIDCounter,this._indexInCastShadowList=-1,this._boundingBox=new BoundBox(new Vector3,new Vector3),this._boundingBoxCenter=new Vector3,this._boundingSphere=new BoundSphere(new Vector3,0),Render.isConchApp){var n=FrustumCulling._cullingBufferLength;this._cullingBufferIndex=n;var r=FrustumCulling._cullingBuffer,a=n+5;if(a>=r.length){var s=r;r=FrustumCulling._cullingBuffer=new Float32Array(r.length+4096),r.set(s,0)}r[n]=1,FrustumCulling._cullingBufferLength=a}this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._destroyed=!1,this._owner=t,this._enable=!0,this._materialsInstance=[],this._shaderValues=new ShaderDatas(this,i),this._defineDatas=new DefineDatas,this.lightmapIndex=-1,this._castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,t&&this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}__class(e,"laya.d3.core.render.BaseRender",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.IListPool":!0,"laya.resource.IDestroy":!0}),i._changeMaterialReference=function(t,e){t&&t._removeReference(),e._addReference()},i._getInstanceMaterial=function(t,e){var i=new t.constructor;return t.cloneTo(i),i.name=i.name+"(Instance)",this._materialsInstance[e]=!0,this._changeMaterialReference(this._materials[e],i),this._materials[e]=i,i},i._applyLightMapParams=function(){if(this._scene&&this._lightmapIndex>=0){var t=this._scene.getlightmaps();this._lightmapIndex<t.length?(this._defineDatas.add(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),this._shaderValues.setTexture(3,t[this._lightmapIndex])):this._defineDatas.remove(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP)}else this._defineDatas.remove(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP)},i._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},i._renderRenderableBoundBox=function(){var t=Laya3D._debugPhasorSprite,i=this.boundingBox,n=e._tempBoundBoxCorners;i.getCorners(n),t.line(n[0],e._greenColor,n[1],e._greenColor),t.line(n[2],e._greenColor,n[3],e._greenColor),t.line(n[4],e._greenColor,n[5],e._greenColor),t.line(n[6],e._greenColor,n[7],e._greenColor),t.line(n[0],e._greenColor,n[3],e._greenColor),t.line(n[1],e._greenColor,n[2],e._greenColor),t.line(n[2],e._greenColor,n[6],e._greenColor),t.line(n[3],e._greenColor,n[7],e._greenColor),t.line(n[0],e._greenColor,n[4],e._greenColor),t.line(n[1],e._greenColor,n[5],e._greenColor),t.line(n[4],e._greenColor,n[7],e._greenColor),t.line(n[5],e._greenColor,n[6],e._greenColor)},i._calculateBoundingSphere=function(){throw"BaseRender: must override it."},i._calculateBoundingBox=function(){throw"BaseRender: must override it."},i._getIndexInList=function(){return this._indexInList},i._setIndexInList=function(t){this._indexInList=t},i._setBelongScene=function(t){this._scene!==t&&(this._scene=t,this._applyLightMapParams())},i._needRender=function(){return!0},i._renderUpdate=function(){},i._renderUpdateWithCamera=function(){},i._updateOctreeNode=function(){var t=this._treeNode;t&&this._octreeNodeNeedChange&&(t.updateObject(this),this._octreeNodeNeedChange=!1)},i._destroy=function(){this.offAll();var t=0,e=0;for(t=0,e=this._renderElements.length;e>t;t++)this._renderElements[t].destroy();for(t=0,e=this._materials.length;e>t;t++)this._materials[t]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},__getset(0,i,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),__getset(0,i,"id",function(){return this._id}),__getset(0,i,"material",function(){var t=this._materials[0];if(t&&!this._materialsInstance[0]){var e=this._getInstanceMaterial(t,0),i=this._renderElements[0];i&&(i.material=e)}return this._materials[0]},function(t){this.sharedMaterial=t}),__getset(0,i,"isPartOfStaticBatch",function(){return this._isPartOfStaticBatch}),__getset(0,i,"sharedMaterial",function(){return this._materials[0]},function(t){var e=this._materials[0];if(e!==t){this._materials[0]=t,this._materialsInstance[0]=!1,this._changeMaterialReference(e,t);var i=this._renderElements[0];i&&(i.material=t)}}),__getset(0,i,"lightmapIndex",function(){return this._lightmapIndex},function(t){this._lightmapIndex!==t&&(this._lightmapIndex=t,this._applyLightMapParams())}),__getset(0,i,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(t){this._lightmapScaleOffset=t,this._shaderValues.setVector(2,t),this._defineDatas.add(RenderableSprite3D.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),__getset(0,i,"castShadow",function(){return this._castShadow},function(t){this._castShadow!==t&&(this._owner.activeInHierarchy&&(t?this._scene._addShadowCastRenderObject(this):this._scene._removeShadowCastRenderObject(this)),this._castShadow=t)}),__getset(0,i,"enable",function(){return this._enable},function(t){this._enable=t}),__getset(0,i,"materials",function(){for(var t=0,e=this._materials.length;e>t;t++)if(!this._materialsInstance[t]){var i=this._getInstanceMaterial(this._materials[t],t),n=this._renderElements[t];n&&(n.material=i)}return this._materials.slice()},function(t){this.sharedMaterials=t}),__getset(0,i,"sharedMaterials",function(){var t=this._materials.slice();return t},function(t){if(!t)throw new Error("MeshRender: shadredMaterials value can't be null.");var e=t.length;this._materialsInstance.length=e;for(var i=0;e>i;i++){var n=this._materials[i];if(n!==t[i]){this._materialsInstance[i]=!1,this._changeMaterialReference(n,t[i]);var r=this._renderElements[i];r&&(r.material=t[i])}}this._materials=t}),__getset(0,i,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),__getset(0,i,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var t=this.boundingBox;Vector3.add(t.min,t.max,this._boundingBoxCenter),Vector3.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),__getset(0,i,"receiveShadow",function(){return this._receiveShadow},function(t){this._receiveShadow!==t&&(this._receiveShadow=t,t?this._defineDatas.add(RenderableSprite3D.SHADERDEFINE_RECEIVE_SHADOW):this._defineDatas.remove(RenderableSprite3D.SHADERDEFINE_RECEIVE_SHADOW))}),__getset(0,i,"destroyed",function(){return this._destroyed}),e._uniqueIDCounter=0,__static(e,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3]},"_greenColor",function(){return this._greenColor=new Vector4(0,1,0,1)}]),e}(EventDispatcher),ColorFilterActionGL=function(t){function e(){this.data=null,e.__super.call(this)}__class(e,"laya.filters.webgl.ColorFilterActionGL",t);var i=e.prototype;return Laya.imps(i,{"laya.filters.IFilterActionGL":!0}),i.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},i.apply3d=function(t,e,i){var n=t.getValue("bounds"),r=Value2D.create(1,0);r.setFilters([this.data]);var a=Matrix.TEMP;a.identity(),i.drawTarget(t,0,0,n.width,n.height,a,"src",r)},e}(FilterActionGL),RenderSprite3D=function(t){function e(t,i){e.__super.call(this,t,i)}__class(e,"laya.webgl.utils.RenderSprite3D",t);var i=e.prototype;return i.onCreate=function(t){switch(t){case 4:return this._fun=this._blend,void 0;case 2:return this._fun=this._transform,void 0}},i._mask=function(t,i,n,r){var a,s=this._next,o=t.mask;if(o){i.save();var l=i.globalCompositeOperation,_=new Rectangle;if(_.copyFrom(o.getBounds()),_.width=Math.round(_.width),_.height=Math.round(_.height),_.x=Math.round(_.x),_.y=Math.round(_.y),_.width>0&&_.height>0){var h=SubmitCMDScope.create();h.addValue("bounds",_),i.onChangeRT(),i.pushRT(),i.addRenderObject(SubmitCMD.create([h,i],laya.webgl.utils.RenderSprite3D.tmpTarget)),o.render(i,-_.x,-_.y),i.onChangeRT(),i.popRT(),i.save(),i.clipRect(n+_.x,r+_.y,_.width,_.height),s._fun.call(s,t,i,n,r),i.restore(),a=SubmitStencil.create(6),l=i.globalCompositeOperation,a.blendMode="mask",i.addRenderObject(a),Matrix.TEMP.identity();var u=Value2D.create(1,0),c=Texture.INV_UV,d=_.width,f=_.height,m=32;(_.width<m||_.height<m)&&(c=e.tempUV,c[0]=0,c[1]=0,c[2]=_.width>=32?1:_.width/m,c[3]=0,c[4]=_.width>=32?1:_.width/m,c[5]=_.height>=32?1:_.height/m,c[6]=0,c[7]=_.height>=32?1:_.height/m,_.width=_.width>=32?_.width:m,_.height=_.height>=32?_.height:m,c[1]*=-1,c[3]*=-1,c[5]*=-1,c[7]*=-1,c[1]+=1,c[3]+=1,c[5]+=1,c[7]+=1),i.drawTarget(h,n+_.x,r+_.y,d,f,Matrix.TEMP,"tmpTarget",u,c,6),i.addRenderObject(SubmitCMD.create([h],laya.webgl.utils.RenderSprite3D.recycleTarget)),a=SubmitStencil.create(6),a.blendMode=l,i.addRenderObject(a)}i.restore()}else s._fun.call(s,t,i,n,r)},i._blend=function(t,e,i,n){var r=t._style,a=this._next;r.blendMode?(e.save(),e.globalCompositeOperation=r.blendMode,a._fun.call(a,t,e,i,n),e.restore()):a._fun.call(a,t,e,i,n)},e.tmpTarget=function(t){var e=t.getValue("bounds"),i=WebGLRTMgr.getRT(e.width,e.height);window.rt_1=i,i.start(),i.clear(0,0,0,0),t.addValue("tmpTarget",i)},e.recycleTarget=function(t){var e=t.getValue("tmpTarget");WebGLRTMgr.releaseRT(e),t.recycle()},__static(e,["tempUV",function(){return this.tempUV=new Array(8)}]),e}(RenderSprite),TrailFilter=function(t){function e(t){this._owner=null,this._trailRenderElements=null,this._minVertexDistance=0/0,this._widthMultiplier=0/0,this._time=0/0,this._widthCurve=null,this._colorGradient=null,this._textureMode=0,this._curtime=0,this._curSubTrailFinishCurTime=0,this._curSubTrailFinished=!1,this._hasLifeSubTrail=!1,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0,this._isStart=!1,this._trailRenderElementIndex=0,e.__super.call(this),this._curSubTrailFinishPosition=new Vector3,this._curSubTrailFinishDirection=new Vector3,this._owner=t,this._trailRenderElements=[],this.addRenderElement()}__class(e,"laya.d3.core.trail.TrailFilter",t);var i=e.prototype;return i._changeRenderElement=function(t){var e=this._owner._render,i=e._renderElements,n=i[t];if(n)n.setGeometry(this._trailRenderElements[t]);else{var r=e.sharedMaterials[0];r||(r=TrailMaterial.defaultMaterial),n=i[t]=new RenderElement,n.setTransform(this._owner._transform),n.render=e,n.material=r,n.setGeometry(this._trailRenderElements[t])}},i.getRenderElementsCount=function(){return this._trailRenderElements.length},i.addRenderElement=function(){for(var t=0;t<this._trailRenderElements.length;t++)if(1==this._trailRenderElements[t]._isDead)return this._trailRenderElements[t].reActivate(),this._changeRenderElement(t),t;var e=new TrailRenderElement(this);return this._trailRenderElements.push(e),this._changeRenderElement(this._trailRenderElements.length-1),this._trailRenderElements.length-1},i.getRenderElement=function(t){return this._trailRenderElements[t]},i._update=function(t){this._curtime+=t.scene.timer._delta/1e3,this._owner._render._shaderValues.setNumber(3,this._curtime),this._curSubTrailFinished&&(this._curSubTrailFinished=!1,this.addRenderElement())},i.reset=function(){for(var t=0;t<this._trailRenderElements.length;t++)this._trailRenderElements[t].reActivate();this._isStart=!1,this._hasLifeSubTrail=!1,this._curSubTrailFinished=!1,this._curSubTrailFinishCurTime=0,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0},i.destroy=function(){for(var t=0;t<this._trailRenderElements.length;t++)this._trailRenderElements[t]._destroy();this._trailRenderElements=null,this._widthCurve=null,this._colorGradient=null,this._curSubTrailFinishPosition=null,this._curSubTrailFinishDirection=null},__getset(0,i,"widthMultiplier",function(){return this._widthMultiplier},function(t){this._widthMultiplier=t}),__getset(0,i,"time",function(){return this._time},function(t){this._time=t,this._owner._render._shaderValues.setNumber(4,t)
}),__getset(0,i,"widthCurve",function(){return this._widthCurve},function(t){this._widthCurve=t;var e=new Float32Array(4*t.length),i=0,n=0,r=0;for(i=0,n=t.length;n>i;i++)e[r++]=t[i].time,e[r++]=t[i].inTangent,e[r++]=t[i].outTangent,e[r++]=t[i].value;this._owner._render._shaderValues.setBuffer(5,e),this._owner._render._shaderValues.setInt(6,t.length)}),__getset(0,i,"minVertexDistance",function(){return this._minVertexDistance},function(t){this._minVertexDistance=t}),__getset(0,i,"colorGradient",function(){return this._colorGradient},function(t){this._colorGradient=t,this._owner._render._shaderValues.setBuffer(7,t._colorKeyData),this._owner._render._shaderValues.setBuffer(8,t._alphaKeyData),0==t.mode?this._owner._render._defineDatas.add(TrailSprite3D.SHADERDEFINE_GRADIENTMODE_BLEND):this._owner._render._defineDatas.remove(TrailSprite3D.SHADERDEFINE_GRADIENTMODE_BLEND)}),__getset(0,i,"textureMode",function(){return this._textureMode},function(t){this._textureMode=t}),e}(EventDispatcher),Transform3D=function(t){function e(t){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._children=null,this._dummy=null,this._id=0,this.pivot=null,e.__super.call(this),this._localPosition=new Vector3,this._localRotation=new Quaternion(0,0,0,1),this._localScale=new Vector3(1,1,1),this._localRotationEuler=new Vector3,this._localMatrix=new Matrix4x4,this._position=new Vector3,this._rotation=new Quaternion(0,0,0,1),this._scale=new Vector3(1,1,1),this._worldMatrix=new Matrix4x4,this._forward=new Vector3,this._up=new Vector3,this._right=new Vector3,this._id=++e._uniqueIDCounter,this._owner=t,this._children=[]}__class(e,"laya.d3.core.Transform3D",t);var i=e.prototype;return i._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)Matrix4x4.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var t=e._tempVector30;Vector3.multiply(this.pivot,this._localScale,t);var i=e._tempVector31;Vector3.subtract(t,this.pivot,i);var n=e._tempVector32,r=this.localRotation;Vector3.transformQuat(t,r,n),Vector3.subtract(n,t,n);var a=e._tempVector33;Vector3.subtract(this._localPosition,i,a),Vector3.subtract(a,n,a),Matrix4x4.createAffineTransformation(a,r,this._localScale,this._localMatrix)}},i._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._children.length;e>t;t++)this._children[t]._onWorldPositionRotationTransform()}},i._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._children.length;e>t;t++)this._children[t]._onWorldPositionScaleTransform()}},i._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._children.length;e>t;t++)this._children[t]._onWorldPositionTransform()}},i._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._children.length;e>t;t++)this._children[t]._onWorldPositionRotationTransform()}},i._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._children.length;e>t;t++)this._children[t]._onWorldPositionScaleTransform()}},i._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._children.length;e>t;t++)this._children[t]._onWorldTransform()}},i.translate=function(t,i){void 0===i&&(i=!0),i?(Matrix4x4.createFromQuaternion(this.localRotation,e._tempMatrix0),Vector3.transformCoordinate(t,e._tempMatrix0,e._tempVector30),Vector3.add(this.localPosition,e._tempVector30,this._localPosition),this.localPosition=this._localPosition):(Vector3.add(this.position,t,this._position),this.position=this._position)},i.rotate=function(t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0);var r;n?r=t:(Vector3.scale(t,Math.PI/180,e._tempVector30),r=e._tempVector30),Quaternion.createFromYawPitchRoll(r.y,r.x,r.z,e._tempQuaternion0),i?(Quaternion.multiply(this._localRotation,e._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(Quaternion.multiply(e._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},i.lookAt=function(t,e,i){void 0===i&&(i=!1);var n,r=t.elements;if(i){if(n=this._localPosition.elements,Math.abs(n[0]-r[0])<MathUtils3D.zeroTolerance&&Math.abs(n[1]-r[1])<MathUtils3D.zeroTolerance&&Math.abs(n[2]-r[2])<MathUtils3D.zeroTolerance)return;Quaternion.lookAt(this._localPosition,t,e,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var a=this.position;if(n=a.elements,Math.abs(n[0]-r[0])<MathUtils3D.zeroTolerance&&Math.abs(n[1]-r[1])<MathUtils3D.zeroTolerance&&Math.abs(n[2]-r[2])<MathUtils3D.zeroTolerance)return;Quaternion.lookAt(a,t,e,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},__getset(0,i,"_isFrontFaceInvert",function(){var t=this.scale,e=t.x<0;return t.y<0&&(e=!e),t.z<0&&(e=!e),e}),__getset(0,i,"owner",function(){return this._owner}),__getset(0,i,"localRotation",function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler.elements;Quaternion.createFromYawPitchRoll(t[1]/e._angleToRandin,t[0]/e._angleToRandin,t[2]/e._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},function(t){this._localRotation=t,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),__getset(0,i,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?Matrix4x4.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(t){null===this._parent?t.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),Matrix4x4.multiply(this._localMatrix,t,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=t,this._worldUpdate=!1}),__getset(0,i,"worldNeedUpdate",function(){return this._worldUpdate}),__getset(0,i,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(t){this._localMatrix=t,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),__getset(0,i,"dummy",function(){return this._dummy},function(t){this._dummy!==t&&(this._dummy&&(this._dummy._entity=null),t&&(t._entity=this),this._dummy=t)}),__getset(0,i,"localPosition",function(){return this._localPosition},function(t){this._localPosition=t,this._localUpdate=!0,this._onWorldPositionTransform()}),__getset(0,i,"position",function(){if(this._positionUpdate){if(null!=this._parent){var t=this._parent.position;Vector3.multiply(this._localPosition,this._parent.scale,e._tempVector30),Vector3.transformQuat(e._tempVector30,this._parent.rotation,e._tempVector30),Vector3.add(t,e._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(t){if(null!=this._parent){Vector3.subtract(t,this._parent.position,this._localPosition);var i=this._parent.scale.elements,n=i[0],r=i[1],a=i[2];if(1!==n||1!==r||1!==a){var s=e._tempVector30,o=s.elements;o[0]=1/n,o[1]=1/r,o[2]=1/a,Vector3.multiply(this._localPosition,s,this._localPosition)}var l=this._parent.rotation;l.invert(e._tempQuaternion0),Vector3.transformQuat(this._localPosition,e._tempQuaternion0,this._localPosition)}else t.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=t,this._positionUpdate=!1}),__getset(0,i,"localScale",function(){return this._localScale},function(t){this._localScale=t,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),__getset(0,i,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(e._tempVector30);var t=e._tempVector30.elements,i=this._localRotationEuler.elements;i[0]=t[1]*e._angleToRandin,i[1]=t[0]*e._angleToRandin,i[2]=t[2]*e._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},function(t){this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),__getset(0,i,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?Quaternion.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(t){null!=this._parent?(this._parent.rotation.invert(e._tempQuaternion0),Quaternion.multiply(e._tempQuaternion0,t,this._localRotation)):t.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=t,this._rotationUpdate=!1}),__getset(0,i,"scale",function(){return this._scaleUpdate?(null!==this._parent?Vector3.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1,this._scale):this._scale},function(t){if(null!==this._parent){var i=this._parent.scale.elements,n=e._tempVector30.elements;n[0]=1/i[0],n[1]=1/i[1],n[2]=1/i[2],Vector3.multiply(t,e._tempVector30,this._localScale)}else t.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=t,this._scaleUpdate=!1}),__getset(0,i,"rotationEuler",null,function(t){Quaternion.createFromYawPitchRoll(t.y,t.x,t.z,this._rotation),this.rotation=this._rotation}),__getset(0,i,"forward",function(){var t=this.worldMatrix.elements;return this._forward.elements[0]=-t[8],this._forward.elements[1]=-t[9],this._forward.elements[2]=-t[10],this._forward}),__getset(0,i,"up",function(){var t=this.worldMatrix.elements;return this._up.elements[0]=t[4],this._up.elements[1]=t[5],this._up.elements[2]=t[6],this._up}),__getset(0,i,"right",function(){var t=this.worldMatrix.elements;return this._right.elements[0]=t[0],this._right.elements[1]=t[1],this._right.elements[2]=t[2],this._right}),__getset(0,i,"parent",function(){return this._parent},function(t){if(this._parent!==t){if(this._parent){var e=this._parent._children,i=e.indexOf(this);e.splice(i,1)}t&&(t._children.push(this),t&&this._onWorldTransform()),this._parent=t}}),e._uniqueIDCounter=0,__static(e,["_tempVector30",function(){return this._tempVector30=new Vector3},"_tempVector31",function(){return this._tempVector31=new Vector3},"_tempVector32",function(){return this._tempVector32=new Vector3},"_tempVector33",function(){return this._tempVector33=new Vector3},"_tempQuaternion0",function(){return this._tempQuaternion0=new Quaternion},"_tempMatrix0",function(){return this._tempMatrix0=new Matrix4x4},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),e}(EventDispatcher),TransformUV=function(t){function e(){this._rotation=0,this._matNeedUpdte=!1,e.__super.call(this),this._matrix=new Matrix4x4,this._offset=new Vector2,this._tiling=new Vector2(1,1)}__class(e,"laya.d3.core.TransformUV",t);var i=e.prototype;return Laya.imps(i,{"laya.d3.core.IClone":!0}),i._updateMatrix=function(){e._tempOffsetV3.elements[0]=this._offset.x,e._tempOffsetV3.elements[1]=this._offset.y,Quaternion.createFromYawPitchRoll(0,0,this._rotation,e._tempRotationQua),e._tempTitlingV3.elements[0]=this._tiling.x,e._tempTitlingV3.elements[1]=this._tiling.y,Matrix4x4.createAffineTransformation(e._tempOffsetV3,e._tempRotationQua,e._tempTitlingV3,this._matrix)},i.cloneTo=function(t){t._matrix=this._matrix.clone(),t._offset=this._offset.clone(),t._rotation=this._rotation,t._tiling=this._tiling.clone()},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,i,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),__getset(0,i,"tiling",function(){return this._tiling},function(t){this._tiling=t,this._matNeedUpdte=!0}),__getset(0,i,"offset",function(){return this._offset},function(t){this._offset=t,this._matNeedUpdte=!0}),__getset(0,i,"rotation",function(){return this._rotation},function(t){this._rotation=t,this._matNeedUpdte=!0}),__static(e,["_tempOffsetV3",function(){return this._tempOffsetV3=new Vector3(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new Quaternion},"_tempTitlingV3",function(){return this._tempTitlingV3=new Vector3(1,1,1)}]),e}(EventDispatcher),ShaderDefines2D=function(t){function e(){e.__super.call(this,e.__name2int,e.__int2name,e.__int2nameMap)}return __class(e,"laya.webgl.shader.d2.ShaderDefines2D",t),e.__init__=function(){e.reg("TEXTURE2D",1),e.reg("PRIMITIVE",4),e.reg("GLOW_FILTER",8),e.reg("BLUR_FILTER",16),e.reg("COLOR_FILTER",32),e.reg("COLOR_ADD",64),e.reg("WORLDMAT",128),e.reg("FILLTEXTURE",256),e.reg("FSHIGHPRECISION",1024)},e.reg=function(t,i){ShaderDefines._reg(t,i,e.__name2int,e.__int2name)},e.toText=function(t,e,i){return ShaderDefines._toText(t,e,i)},e.toInt=function(t){return ShaderDefines._toInt(t,e.__name2int)},e.TEXTURE2D=1,e.PRIMITIVE=4,e.FILTERGLOW=8,e.FILTERBLUR=16,e.FILTERCOLOR=32,e.COLORADD=64,e.WORLDMAT=128,e.FILLTEXTURE=256,e.SKINMESH=512,e.SHADERDEFINE_FSHIGHPRECISION=1024,e.__name2int={},e.__int2name=[],e.__int2nameMap=[],e}(ShaderDefines),SkinSV=function(t){function e(){this.texcoord=null,this.offsetX=300,this.offsetY=0,e.__super.call(this,512,0);var t=8*CONST3D2D.BYTES_PE;this.position=[2,5126,!1,t,0],this.texcoord=[2,5126,!1,t,2*CONST3D2D.BYTES_PE],this.color=[4,5126,!1,t,4*CONST3D2D.BYTES_PE]}return __class(e,"laya.webgl.shader.d2.skinAnishader.SkinSV",t),e}(Value2D),FillTextureSV=function(t){function e(){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],e.__super.call(this,256,0)}__class(e,"laya.webgl.shader.d2.value.FillTextureSV",t);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(Value2D),TextureSV=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),e.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}__class(e,"laya.webgl.shader.d2.value.TextureSV",t);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(WebGL.shaderHighPrecision?1024:0)},e}(Value2D),PrimitiveSV=function(t){function e(){e.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return __class(e,"laya.webgl.shader.d2.value.PrimitiveSV",t),e}(Value2D),Polygon=function(t){function e(t,i,n,r,a,s){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=Matrix.create(),this._points=n.slice(0,n.length),e.__super.call(this,t,i,0,0,this._points.length/2,r,a,s)}__class(e,"laya.webgl.shapes.Polygon",t);var i=e.prototype;return i.rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},i.setMatrix=function(t){t.copyTo(this._mat)},i.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},i.getData=function(t,e,i){var n,r=0,a=this._points,s=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,n=[],s=this.earcutTriangles.length,r=0;s>r;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n)}}else{this._start=i,n=[];var o=[],l=[],_=this.color,h=(_>>16&255)/255,u=(_>>8&255)/255,c=(255&_)/255;for(s=Math.floor(a.length/2),r=0;s>r;r++)o.push(this.x+a[2*r],this.y+a[2*r+1],h,u,c),l.push(this.x+a[2*r],this.y+a[2*r+1]);for(this.earcutTriangles=Earcut.earcut(l,null,2),s=this.earcutTriangles.length,r=0;s>r;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n),this.mFloat32Array=new Float32Array(o)}t.append(this.mUint16Array),e.append(this.mFloat32Array)},e}(BasePoly),SubmitCanvas=function(t){function e(){this._matrix=new Matrix,this._matrix4=CONST3D2D.defaultMatrix4.concat(),e.__super.call(this,1e4),this.shaderValue=new Value2D(0,0)}__class(e,"laya.webgl.submit.SubmitCanvas",t);var i=e.prototype;return i.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=RenderState2D.worldAlpha,e=RenderState2D.worldMatrix4,i=RenderState2D.worldMatrix,n=RenderState2D.worldFilters,r=RenderState2D.worldShaderDefines,a=this.shaderValue,s=this._matrix,o=this._matrix4,l=Matrix.TEMP;return Matrix.mul(s,i,l),o[0]=l.a,o[1]=l.b,o[4]=l.c,o[5]=l.d,o[12]=l.tx,o[13]=l.ty,RenderState2D.worldMatrix=l.clone(),RenderState2D.worldMatrix4=o,RenderState2D.worldAlpha=RenderState2D.worldAlpha*a.alpha,a.filters&&a.filters.length&&(RenderState2D.worldFilters=a.filters,RenderState2D.worldShaderDefines=a.defines),this._ctx_src.flush(),RenderState2D.worldAlpha=t,RenderState2D.worldMatrix4=e,RenderState2D.worldMatrix.destroy(),RenderState2D.worldMatrix=i,RenderState2D.worldFilters=n,RenderState2D.worldShaderDefines=r,1},i.releaseRender=function(){if(--this._ref<1){var t=e.POOL;this._ctx_src=null,this._mesh=null,t[t._length++]=this}},i.clone=function(){return null},i.getRenderType=function(){return 10003},e.create=function(t,i,n){var r=e.POOL._length?e.POOL[--e.POOL._length]:new e;r._ctx_src=t,r._ref=1,r._numEle=0;var a=r.shaderValue;return a.alpha=i,a.defines.setValue(0),n&&n.length&&a.setFilters(n),r},e.POOL=(e.POOL=[],e.POOL._length=0,e.POOL),e}(Submit),SubmitTexture=function(t){function e(t){void 0===t&&(t=1e4),e.__super.call(this,t)}__class(e,"laya.webgl.submit.SubmitTexture",t);var i=e.prototype;return i.clone=function(t,i,n){var r=e._poolSize?e.POOL[--e._poolSize]:new e;return this._cloneInit(r,t,i,n),r},i.releaseRender=function(){--this._ref<1&&(e.POOL[e._poolSize++]=this,this.shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},i.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=WebGL.mainContext;this._mesh.useMesh(i);var n=Submit.preRender._key;return 0===this._key.blendShader&&this._key.submitType===n.submitType&&this._key.blendShader===n.blendShader&&BaseShader.activeShader&&Submit.preRender.clipInfoID==this.clipInfoID?BaseShader.activeShader.uploadTexture2D(e):(BlendMode.activeBlendFunction!==this._blendFn&&(WebGLContext.setBlend(i,!0),this._blendFn(i),BlendMode.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),i.drawElements(4,this._numEle,5123,this._startIdx),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,1},e.create=function(t,i,n){var r=e._poolSize?e.POOL[--e._poolSize]:new e;r._mesh=i,r._key.clear(),r._ref=1,r._startIdx=i.indexNum*CONST3D2D.BYTES_PIDX,r._numEle=0;var a=t._nBlendType;return r._blendFn=t._targets?BlendMode.targetFns[a]:BlendMode.fns[a],r.shaderValue=n,n.setValue(t._shader2D),r},e._poolSize=0,e.POOL=[],e}(Submit),MeshQuadTexture=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshQuadTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=e._maxIB):(this.createQuadIB(e._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}__class(e,"laya.webgl.utils.MeshQuadTexture",t);var i=e.prototype;return i.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},i.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},i.addQuad=function(t,e,i,n,r){var a=this._vb,s=a._byteLength>>2;a.setByteLength((s<<2)+4*laya.webgl.utils.MeshQuadTexture.const_stride);var o=a._floatArray32||a.getFloat32Array(),l=a._uint32Array,_=s,h=r?255:0;o[_++]=t[0],o[_++]=t[1],o[_++]=e[0],o[_++]=e[1],l[_++]=i,l[_++]=h,o[_++]=t[2],o[_++]=t[3],o[_++]=e[2],o[_++]=e[3],l[_++]=i,l[_++]=h,o[_++]=t[4],o[_++]=t[5],o[_++]=e[4],o[_++]=e[5],l[_++]=i,l[_++]=h,o[_++]=t[6],o[_++]=t[7],o[_++]=e[6],o[_++]=e[7],l[_++]=i,l[_++]=h,a._upload=!0},e.getAMesh=function(){return laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new e},e.const_stride=24,e._fixib=null,e._maxIB=16384,e._POOL=[],__static(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),e}(Mesh2D),MeshTexture=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}__class(e,"laya.webgl.utils.MeshTexture",t);var i=e.prototype;return i.addData=function(t,i,n,r,a,s){for(var o=t.length/2,l=this._vb.needSize(o*e.const_stride),_=l>>2,h=this._vb._floatArray32||this._vb.getFloat32Array(),u=this._vb._uint32Array,c=0,d=(s.getTransedClipInfo(),0);o>d;d++){var f=t[c],m=t[c+1],p=f*r.a+m*r.c+r.tx,g=f*r.b+m*r.d+r.ty;h[_++]=p,h[_++]=g,h[_++]=i[c],h[_++]=i[c+1],c+=2,u[_++]=a,u[_++]=255}this._vb.setNeedUpload();var v=this.vertNum;if(v>0){var o=n.length;o>e.tmpIdx.length&&(e.tmpIdx=new Uint16Array(o));for(var x=0;o>x;x++)e.tmpIdx[x]=n[x]+v;this._ib.appendU16Array(e.tmpIdx,n.length)}else this._ib.append(n);this._ib.setNeedUpload(),this.vertNum+=o,this.indexNum+=n.length},i.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},i.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib._disposeResource(),this._vb.deleteBuffer()},e.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new e},e.const_stride=24,e._POOL=[],__static(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),e}(Mesh2D),MeshVG=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshVG.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}__class(e,"laya.webgl.utils.MeshVG",t);var i=e.prototype;return i.addVertAndIBToMesh=function(t,i,n,r){for(var a=this._vb.needSize(i.length/2*e.const_stride),s=a>>2,o=this._vb._floatArray32||this._vb.getFloat32Array(),l=this._vb._uint32Array,_=0,h=(t.getTransedClipInfo(),i.length/2),u=0;h>u;u++)o[s++]=i[_],o[s++]=i[_+1],_+=2,l[s++]=n;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(r)),this._ib.setNeedUpload(),this.vertNum+=h,this.indexNum+=r.length},i.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},i.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib._disposeResource(),this._vb.deleteBuffer()},e.getAMesh=function(){return laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new e},e.const_stride=12,e._POOL=[],__static(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),e}(Mesh2D),CollisionManager=function(t){function e(){e.__super.call(this)}return __class(e,"laya.d3.utils.CollisionManager",t),e._onTrigger=function(t,e,i,n,r){var a=0,s=0,o=t.id,l=e.id;if(!t._ignoreCollisonMap[l]){var _=(Physics.collisionManager,t._runtimeCollisonTestMap[l]);if(null!=_)if(_)if(t._collisonTo(e))if(t._runtimeCollisonMap[l]){for(a=0,s=i.length;s>a;a++)i[a].onTriggerStay(e);for(a=0,s=n.length;s>a;a++)n[a].onTriggerStay(t)}else{for(t._runtimeCollisonMap[l]=e,t._runtimeCollisonTestMap[l]=!1,e._runtimeCollisonMap[o]=t,r&&(e._runtimeCollisonTestMap[o]=!1),a=0,s=i.length;s>a;a++)i[a].onTriggerEnter(e);for(a=0,s=n.length;s>a;a++)n[a].onTriggerEnter(t)}else{var h=t._runtimeCollisonMap;if(h[l]){for(delete h[l],delete t._runtimeCollisonTestMap[l],delete e._runtimeCollisonMap[o],r&&delete e._runtimeCollisonTestMap[o],a=0,s=i.length;s>a;a++)i[a].onTriggerExit(e);for(a=0,s=n.length;s>a;a++)n[a].onTriggerExit(t)}}else{for(a=0,s=i.length;s>a;a++)i[a].onTriggerStay(e);for(a=0,s=n.length;s>a;a++)n[a].onTriggerStay(t)}else if(t._collisonTo(e)){for(t._runtimeCollisonMap[l]=e,t._runtimeCollisonTestMap[l]=!1,e._runtimeCollisonMap[o]=t,r&&(e._runtimeCollisonTestMap[o]=!1),a=0,s=i.length;s>a;a++)i[a].onTriggerEnter(e);for(a=0,s=n.length;s>a;a++)n[a].onTriggerEnter(t)}}},e._triggerCollision=function(t){for(var i=t._layerList,n=t._collsionTestList,r=n.length,a=Physics._layerCollsionMatrix,s=0;r>s;s++)for(var o=n[s],l=i[o],_=l._colliders,h=l._nonRigidbodyOffset,u=r-1;u>=s;u--){var c=n[u],d=a[o][30-c];if(d){var f,m,p,g=0,v=0,x=0,y=0,T=i[c],D=T._colliders,E=T._nonRigidbodyOffset;if(l!==T){for(g=0;h>g;g++)if(f=_[g],f.enable){for(p=f.owner._scripts,x=0,y=E;y>x;x++)m=D[x],m.enable&&e._onTrigger(f,m,p,m.owner._scripts,!0);for(x=E,y=D.length;y>x;x++)m=D[x],m.enable&&e._onTrigger(f,m,p,m.owner._scripts,!1)}for(g=h,v=_.length;v>g;g++)if(f=_[g],f.enable)for(p=f.owner._scripts,x=0,y=T._nonRigidbodyOffset;y>x;x++)m=D[x],m.enable&&e._onTrigger(m,f,p,m.owner._scripts,!1)}else for(g=0;h>g;g++)if(f=_[g],f.enable){for(p=f.owner._scripts,x=g+1,y=h;y>x;x++)m=D[x],m.enable&&e._onTrigger(f,m,p,m.owner._scripts,!0);for(x=h,y=_.length;y>x;x++)m=D[x],m.enable&&e._onTrigger(f,m,p,m.owner._scripts,!1)}}}},e}(EventDispatcher),MiniSound=function(t){function e(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,e.__super.call(this)}__class(e,"laya.wx.mini.MiniSound",t);var i=e.prototype;return i.load=function(t){return t=URL.formatURL(t),this.url=t,this.readyUrl=t,e._audioCache[this.readyUrl]?(this.event("complete"),void 0):(MiniAdpter.autoCacheFile&&MiniFileMgr.getFileInfo(t)?this.onDownLoadCallBack(t,0):MiniAdpter.autoCacheFile?MiniFileMgr.downOtherFiles(t,Handler.create(this,this.onDownLoadCallBack,[t]),t):this.onDownLoadCallBack(t,0),void 0)},i.onDownLoadCallBack=function(t,i){if(i)this.event("error");else{var n;if(MiniAdpter.autoCacheFile){var r=MiniFileMgr.getFileInfo(t),a=r.md5;n=MiniFileMgr.getFileNativePath(a),this._sound=e._createSound(),this._sound.src=this.url=n}else this._sound=e._createSound(),this._sound.src=t;this._sound.onCanplay(e.bindToThis(this.onCanPlay,this)),this._sound.onError(e.bindToThis(this.onError,this))}},i.onError=function(t){try{console.log("-----1---------------minisound-----id:"+e._id),console.log(t)}catch(t){console.log("-----2---------------minisound-----id:"+e._id),console.log(t)}this.event("error"),this._sound.offError(null)},i.onCanPlay=function(){this.loaded=!0,this.event("complete"),e._audioCache[this.readyUrl]=this,this._sound.offCanplay(null)},i.play=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0);var n;if(this.url==SoundManager._tMusic?(e._musicAudio||(e._musicAudio=e._createSound()),n=e._musicAudio):n=e._audioCache[this.readyUrl]?e._audioCache[this.readyUrl]._sound:e._createSound(),MiniAdpter.autoCacheFile&&MiniFileMgr.getFileInfo(this.url)){var r=MiniFileMgr.getFileInfo(this.url),a=r.md5;n.src=this.url=MiniFileMgr.getFileNativePath(a)}else n.src=this.url;var s=new MiniSoundChannel(n,this);return s.url=this.url,s.loops=i,s.loop=0===i?!0:!1,s.startTime=t,s.play(),SoundManager.addChannel(s),s},i.dispose=function(){var t=e._audioCache[this.readyUrl];t&&(t.src="",t._sound&&(t._sound.destroy(),t._sound=null,t=null),delete e._audioCache[this.readyUrl])},__getset(0,i,"duration",function(){return this._sound.duration}),e._createSound=function(){return e._id++,MiniAdpter.window.wx.createInnerAudioContext()},e.bindToThis=function(t,e){var i=t;return i=t.bind(e)},e._musicAudio=null,e._id=0,e._audioCache={},e}(EventDispatcher),ShurikenParticleSystem=function(t){function e(t){e.__super.call(this),this._tempRotationMatrix=new Matrix4x4,this._uvLength=new Vector2,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._owner=t,this._ownerRender=t.particleRender,this._boundingBoxCorners=__newvec(8,null),this._boundingSphere=new BoundSphere(new Vector3,Number.MAX_VALUE),this._boundingBox=new BoundBox(new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this._currentTime=0,this._isEmitting=!1,this._isPlaying=!1,this._isPaused=!1,this._burstsIndex=0,this._frameRateTime=0,this._emissionTime=0,this._totalDelayTime=0,this._simulateUpdate=!1,this._bufferMaxParticles=1,this.duration=5,this.looping=!0,this.prewarm=!1,this.startDelayType=0,this.startDelay=0,this.startDelayMin=0,this.startDelayMax=0,this._startLifetimeType=0,this._startLifetimeConstant=5,this._startLifeTimeGradient=new GradientDataNumber,this._startLifetimeConstantMin=0,this._startLifetimeConstantMax=5,this._startLifeTimeGradientMin=new GradientDataNumber,this._startLifeTimeGradientMax=new GradientDataNumber,this._maxStartLifetime=5,this.startSpeedType=0,this.startSpeedConstant=5,this.startSpeedConstantMin=0,this.startSpeedConstantMax=5,this.threeDStartSize=!1,this.startSizeType=0,this.startSizeConstant=1,this.startSizeConstantSeparate=new Vector3(1,1,1),this.startSizeConstantMin=0,this.startSizeConstantMax=1,this.startSizeConstantMinSeparate=new Vector3(0,0,0),this.startSizeConstantMaxSeparate=new Vector3(1,1,1),this.threeDStartRotation=!1,this.startRotationType=0,this.startRotationConstant=0,this.startRotationConstantSeparate=new Vector3(0,0,0),this.startRotationConstantMin=0,this.startRotationConstantMax=0,this.startRotationConstantMinSeparate=new Vector3(0,0,0),this.startRotationConstantMaxSeparate=new Vector3(0,0,0),this.randomizeRotationDirection=0,this.startColorType=0,this.startColorConstant=new Vector4(1,1,1,1),this.startColorConstantMin=new Vector4(1,1,1,1),this.startColorConstantMax=new Vector4(1,1,1,1),this.gravityModifier=0,this.simulationSpace=1,this.scaleMode=0,this.playOnAwake=!0,this._rand=new Rand(0),this.autoRandomSeed=!0,this.randomSeed=new Uint32Array(1),this._randomSeeds=new Uint32Array(e._RANDOMOFFSET.length),this.isPerformanceMode=!0,this._emission=new Emission,this._emission.enbale=!0}__class(e,"laya.d3.core.particleShuriKen.ShurikenParticleSystem",t);var i=e.prototype;return Laya.imps(i,{"laya.d3.core.IClone":!0}),i._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},i._getIndexBuffer=function(){return this._indexBuffer},i._generateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},i._generateBoundingBox=function(){var t=this._owner,i=t.particleRender,n=this._boundingBox.min,r=this._boundingBox.max,a=0,s=0,o=0/0;switch(this.startLifetimeType){case 0:o=this.startLifetimeConstant;break;case 1:o=-Number.MAX_VALUE;var l=l;for(a=0,s=l.gradientCount;s>a;a++)o=Math.max(o,l.getValueByIndex(a));break;case 2:o=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:o=-Number.MAX_VALUE;var _=_;for(a=0,s=_.gradientCount;s>a;a++)o=Math.max(o,_.getValueByIndex(a));
var h=h;for(a=0,s=h.gradientCount;s>a;a++)o=Math.max(o,h.getValueByIndex(a))}var u=0/0,c=0/0;switch(this.startSpeedType){case 0:u=c=this.startSpeedConstant;break;case 1:break;case 2:u=this.startLifetimeConstantMin,c=this.startLifetimeConstantMax;break;case 3:}var d,f,m,p;this._shape&&this._shape.enable||(d=f=Vector3.ZERO,m=Vector3.ZERO,p=Vector3.UnitZ);var g=new Vector3(m.x*u,m.y*u,m.z*u),v=new Vector3(p.x*c,p.y*c,p.z*c);if(this._velocityOverLifetime&&this._velocityOverLifetime.enbale){var x,y,T=this._velocityOverLifetime.velocity;switch(T.type){case 0:x=y=T.constant;break;case 1:x=y=new Vector3(T.gradientX.getAverageValue(),T.gradientY.getAverageValue(),T.gradientZ.getAverageValue());break;case 2:x=T.constantMin,y=T.constantMax;break;case 3:x=new Vector3(T.gradientXMin.getAverageValue(),T.gradientYMin.getAverageValue(),T.gradientZMin.getAverageValue()),y=new Vector3(T.gradientXMax.getAverageValue(),T.gradientYMax.getAverageValue(),T.gradientZMax.getAverageValue())}}var D,E,S=this._owner.transform,M=S.position,R=e._tempVector39,A=R.elements,C=i.renderMode;switch(this.scaleMode){case 0:var L=S.scale;D=L,A[0]=L.x,A[1]=L.z,A[2]=L.y,1===C&&(E=L);break;case 1:var I=S.localScale;D=I,A[0]=I.x,A[1]=I.z,A[2]=I.y,1===C&&(E=I);break;case 2:D=S.scale,A[0]=A[1]=A[2]=1,1===C&&(E=Vector3.ONE)}var w,b;switch(this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(w=new Vector3(g.x*o,g.y*o,g.z*o),b=new Vector3(v.x*o,v.y*o,v.z*o),2!=this.scaleMode?(Vector3.add(d,w,n),Vector3.multiply(D,n,n),Vector3.add(f,b,r),Vector3.multiply(D,r,r)):(Vector3.multiply(D,d,n),Vector3.add(n,w,n),Vector3.multiply(D,f,r),Vector3.add(r,b,r))),this.simulationSpace){case 0:break;case 1:Vector3.add(n,M,n),Vector3.add(r,M,r)}var P=0/0,V=0/0;switch(this.startSizeType){case 0:if(this.threeDStartSize){var O=O;P=Math.max(O.x,O.y),1===C&&(V=O.y)}else P=this.startSizeConstant,1===C&&(V=this.startSizeConstant);break;case 1:break;case 2:if(this.threeDStartSize){var N=N;P=Math.max(N.x,N.y),1===C&&(V=N.y)}else P=this.startSizeConstantMax,1===C&&(V=this.startSizeConstantMax);break;case 3:}if(this._sizeOverLifetime&&this._sizeOverLifetime.enbale){{this._sizeOverLifetime.size}P*=this._sizeOverLifetime.size.getMaxSizeInGradient()}var B=e._tempVector30,F=B.elements,U=0/0,G=0/0;switch(C){case 0:U=P*e.halfKSqrtOf2,Vector3.scale(R,P,B),Vector3.subtract(n,B,n),Vector3.add(r,B,r);break;case 1:var H=e._tempVector31,W=e._tempVector32,k=e._tempVector33,z=e._tempVector34;this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(Vector3.multiply(E,v,W),Vector3.multiply(E,g,k));var X=V*i.stretchedBillboardLengthScale,Y=Vector3.scalarLength(W)*i.stretchedBillboardSpeedScale+X,K=Vector3.scalarLength(k)*i.stretchedBillboardSpeedScale+X,Z=e._tempVector35,j=e._tempVector36;Vector3.normalize(W,Z),Vector3.scale(Z,Y,z),Vector3.subtract(b,z,z),Vector3.normalize(k,j),Vector3.scale(j,K,H),Vector3.add(w,H,H),U=P*e.halfKSqrtOf2,Vector3.scale(R,U,B);var q=e._tempVector37,Q=e._tempVector38;Vector3.scale(Z,.5,q),Vector3.scale(j,.5,Q),Vector3.multiply(q,R,q),Vector3.multiply(Q,R,Q),Vector3.add(n,Q,n),Vector3.min(n,z,n),Vector3.subtract(n,B,n),Vector3.subtract(r,q,r),Vector3.max(r,H,r),Vector3.add(r,B,r);break;case 2:P*=Math.cos(.7853981633974483),G=.5*P,F[0]=R.x*G,F[1]=R.z*G,Vector3.subtract(n,B,n),Vector3.add(r,B,r);break;case 3:P*=Math.cos(.7853981633974483),G=.5*P,Vector3.scale(R,G,B),Vector3.subtract(n,B,n),Vector3.add(r,B,r)}this._boundingBox.getCorners(this._boundingBoxCorners)},i._updateEmission=function(){if(this.isAlive)if(this._simulateUpdate)this._simulateUpdate=!1;else{var t=this._startUpdateLoopCount===Stat.loopCount||this._isPaused?0:this._owner._scene.timer._delta/1e3;t=Math.min(e._maxElapsedTime,t),this._updateParticles(t)}},i._updateParticles=function(t){(4!==this._ownerRender.renderMode||this._ownerRender.mesh)&&(this._currentTime+=t,this._retireActiveParticles(),this._freeRetiredParticles(),this._totalDelayTime+=t,this._totalDelayTime<this._playStartDelay||this._emission.enbale&&this._isEmitting&&!this._isPaused&&this._advanceTime(t,this._currentTime))},i._updateParticlesSimulationRestart=function(t){this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._burstsIndex=0,this._frameRateTime=t,this._emissionTime=0,this._totalDelayTime=0,this._currentTime=t;var e=t;return e<this._playStartDelay?(this._totalDelayTime=e,void 0):(this._emission.enbale&&this._advanceTime(t,t),void 0)},i._retireActiveParticles=function(){for(var t=1e-4;this._firstActiveElement!=this._firstNewElement;){var e=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride,i=e+this._timeIndex,n=this._currentTime-this._vertices[i];if(n+t<this._vertices[e+this._startLifeTimeIndex])break;this._vertices[i]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this._bufferMaxParticles&&(this._firstActiveElement=0)}},i._freeRetiredParticles=function(){for(;this._firstRetiredElement!=this._firstActiveElement;){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];if(this.isPerformanceMode&&3>t)break;this._firstRetiredElement++,this._firstRetiredElement>=this._bufferMaxParticles&&(this._firstRetiredElement=0)}},i._burst=function(t,e){for(var i=0,n=this._emission._bursts,r=n.length;this._burstsIndex<r;this._burstsIndex++){var a=n[this._burstsIndex],s=a.time;if(!(s>=t&&e>s))break;var o=0;this.autoRandomSeed?o=MathUtil.lerp(a.minCount,a.maxCount,Math.random()):(this._rand.seed=this._randomSeeds[0],o=MathUtil.lerp(a.minCount,a.maxCount,this._rand.getFloat()),this._randomSeeds[0]=this._rand.seed),i+=o}return i},i._advanceTime=function(t,e){var i=0,n=this._emissionTime;this._emissionTime+=t;var r=0;if(this._emissionTime>this.duration){if(!this.looping){for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;r>i;i++)this.emit(e);return this._isPlaying=!1,this.stop(),void 0}r+=this._burst(n,this._emissionTime),this._emissionTime-=this.duration,this._burstsIndex=0,r+=this._burst(0,this._emissionTime)}else r+=this._burst(n,this._emissionTime);for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;r>i;i++)this.emit(e);var a=this.emission.emissionRate;if(a>0){var s=1/a;for(this._frameRateTime+=s,this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;this._frameRateTime<=e&&this.emit(this._frameRateTime);)this._frameRateTime+=s;this._frameRateTime=Math.floor(e/s)*s}},i._initBufferDatas=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy());var t=this._ownerRender,e=t.renderMode;if(-1!==e&&this.maxParticles>0){var i,n,r=0,a=0,s=0,o=0,l=0,_=t.mesh;if(4===e){if(_){var h=_._vertexBuffers.length;if(h>1)throw new Error("ShurikenParticleSystem: submesh Count mesh be One or all subMeshes have the same vertexDeclaration.");n=VertexShurikenParticleMesh.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=12,this._timeIndex=16,this._vertexStride=_._vertexBuffers[0].vertexCount;var u=this._bufferMaxParticles*this._vertexStride,c=Math.floor(u/65535)+1,d=u%65535;if(c>1)throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.");this._vertexBuffer=new VertexBuffer3D(n.vertexStride*d,35048),this._vertexBuffer.vertexDeclaration=n,this._vertices=new Float32Array(this._floatCountPerVertex*d),this._setVertexBuffer(this._vertexBuffer),this._indexStride=_._indexBuffer.indexCount;var f=_._indexBuffer.getData(),m=this._bufferMaxParticles*this._indexStride;for(this._indexBuffer=IndexBuffer3D.create("ushort",m,35044),i=new Uint16Array(m),o=0,r=0;r<this._bufferMaxParticles;r++){var p=r*this._vertexStride;for(a=0,s=f.length;s>a;a++)i[o++]=p+f[a]}this._indexBuffer.setData(i)}}else{for(n=VertexShurikenParticleBillboard.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=7,this._timeIndex=11,this._vertexStride=4,this._vertexBuffer=new VertexBuffer3D(n.vertexStride*this._bufferMaxParticles*this._vertexStride,35048),this._vertexBuffer.vertexDeclaration=n,this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride),this._setVertexBuffer(this._vertexBuffer),r=0;r<this._bufferMaxParticles;r++)l=r*this._floatCountPerVertex*this._vertexStride,this._vertices[l]=-.5,this._vertices[l+1]=-.5,this._vertices[l+2]=0,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=-.5,this._vertices[l+2]=1,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=.5,this._vertices[l+2]=1,this._vertices[l+3]=0,l+=this._floatCountPerVertex,this._vertices[l]=-.5,this._vertices[l+1]=.5,this._vertices[l+2]=0,this._vertices[l+3]=0;for(this._indexStride=6,this._indexBuffer=IndexBuffer3D.create("ushort",6*this._bufferMaxParticles,35044),i=new Uint16Array(6*this._bufferMaxParticles),r=0;r<this._bufferMaxParticles;r++){o=6*r;var g=r*this._vertexStride,v=g+2;i[o++]=g,i[o++]=v,i[o++]=g+1,i[o++]=g,i[o++]=g+3,i[o++]=v}this._indexBuffer.setData(i)}}},i.destroy=function(){t.prototype.destroy.call(this),this._indexBuffer.destroy(),this._emission.destroy(),this._owner=null,this._vertices=null,this._indexBuffer=null,this._emission=null,this._shape=null,this.startLifeTimeGradient=null,this.startLifeTimeGradientMin=null,this.startLifeTimeGradientMax=null,this.startSizeConstantSeparate=null,this.startSizeConstantMinSeparate=null,this.startSizeConstantMaxSeparate=null,this.startRotationConstantSeparate=null,this.startRotationConstantMinSeparate=null,this.startRotationConstantMaxSeparate=null,this.startColorConstant=null,this.startColorConstantMin=null,this.startColorConstantMax=null,this._velocityOverLifetime=null,this._colorOverLifetime=null,this._sizeOverLifetime=null,this._rotationOverLifetime=null,this._textureSheetAnimation=null},i.emit=function(t){var i=e._tempPosition,n=e._tempDirection;if(this._shape&&this._shape.enable)this.autoRandomSeed?this._shape.generatePositionAndDirection(i,n):this._shape.generatePositionAndDirection(i,n,this._rand,this._randomSeeds);else{var r=i.elements,a=n.elements;r[0]=r[1]=r[2]=0,a[0]=a[1]=0,a[2]=1}return this.addParticle(i,n,t)},i.addParticle=function(t,e,i){Vector3.normalize(e,e);var n=this._firstFreeElement+1;if(n>=this._bufferMaxParticles&&(n=0),n===this._firstRetiredElement)return!1;ShurikenParticleData.create(this,this._ownerRender,this._owner.transform);var r=this._currentTime-i;if(r>=ShurikenParticleData.startLifeTime)return!0;var a=0/0,s=0/0,o=0/0,l=0/0,_=0/0,h=0/0,u=0/0,c=this._velocityOverLifetime&&this._velocityOverLifetime.enbale;if(c){var d=this._velocityOverLifetime.velocity.type;2===d||3===d?this.autoRandomSeed?(a=Math.random(),s=Math.random(),o=Math.random()):(this._rand.seed=this._randomSeeds[9],a=this._rand.getFloat(),s=this._rand.getFloat(),o=this._rand.getFloat(),this._randomSeeds[9]=this._rand.seed):c=!1}else c=!1;var f=this._colorOverLifetime&&this._colorOverLifetime.enbale;if(f){var m=this._colorOverLifetime.color.type;3===m?this.autoRandomSeed?l=Math.random():(this._rand.seed=this._randomSeeds[10],l=this._rand.getFloat(),this._randomSeeds[10]=this._rand.seed):f=!1}else f=!1;var p=this._sizeOverLifetime&&this._sizeOverLifetime.enbale;if(p){var g=this._sizeOverLifetime.size.type;3===g?this.autoRandomSeed?_=Math.random():(this._rand.seed=this._randomSeeds[11],_=this._rand.getFloat(),this._randomSeeds[11]=this._rand.seed):p=!1}else p=!1;var v=this._rotationOverLifetime&&this._rotationOverLifetime.enbale;if(v){var x=this._rotationOverLifetime.angularVelocity.type;2===x||3===x?this.autoRandomSeed?h=Math.random():(this._rand.seed=this._randomSeeds[12],h=this._rand.getFloat(),this._randomSeeds[12]=this._rand.seed):v=!1}else v=!1;var y=this._textureSheetAnimation&&this._textureSheetAnimation.enable;if(y){var T=this._textureSheetAnimation.frame.type;3===T?this.autoRandomSeed?u=Math.random():(this._rand.seed=this._randomSeeds[15],u=this._rand.getFloat(),this._randomSeeds[15]=this._rand.seed):y=!1}else y=!1;var D,E=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride,S=ShurikenParticleData.startUVInfo[0],M=ShurikenParticleData.startUVInfo[1],R=ShurikenParticleData.startUVInfo[2],A=ShurikenParticleData.startUVInfo[3],C=t.elements,L=e.elements,I=0,w=0,b=0,P=0,V=0,O=this._ownerRender;if(4===O.renderMode){var N=O.mesh._vertexBuffers[0];D=N.getData();var B=N.vertexDeclaration;w=B.getVertexElementByUsage(0).offset/4;var F=B.getVertexElementByUsage(1);b=F?F.offset/4:-1;var U=B.getVertexElementByUsage(2);P=U?U.offset/4:-1,I=B.vertexStride/4,V=0}else{this._vertices[E+2]=R,this._vertices[E+3]=A+M;var G=E+this._floatCountPerVertex;this._vertices[G+2]=R+S,this._vertices[G+3]=A+M;var H=G+this._floatCountPerVertex;this._vertices[H+2]=R+S,this._vertices[H+3]=A;var W=H+this._floatCountPerVertex;this._vertices[W+2]=R,this._vertices[W+3]=A}for(var k=E,z=E+this._floatCountPerVertex*this._vertexStride;z>k;k+=this._floatCountPerVertex){var X=0;if(4===O.renderMode){X=k;var Y=I*V++,K=Y+w;this._vertices[X++]=D[K++],this._vertices[X++]=D[K++],this._vertices[X++]=D[K],-1===b?(this._vertices[X++]=1,this._vertices[X++]=1,this._vertices[X++]=1,this._vertices[X++]=1):(K=Y+b,this._vertices[X++]=D[K++],this._vertices[X++]=D[K++],this._vertices[X++]=D[K++],this._vertices[X++]=D[K]),-1===P?(this._vertices[X++]=0,this._vertices[X++]=0):(K=Y+P,this._vertices[X++]=R+D[K++]*S,this._vertices[X++]=A+D[K]*M)}else X=k+4;switch(this._vertices[X++]=C[0],this._vertices[X++]=C[1],this._vertices[X++]=C[2],this._vertices[X++]=ShurikenParticleData.startLifeTime,this._vertices[X++]=L[0],this._vertices[X++]=L[1],this._vertices[X++]=L[2],this._vertices[X++]=i,this._vertices[X++]=ShurikenParticleData.startColor[0],this._vertices[X++]=ShurikenParticleData.startColor[1],this._vertices[X++]=ShurikenParticleData.startColor[2],this._vertices[X++]=ShurikenParticleData.startColor[3],this._vertices[X++]=ShurikenParticleData.startSize[0],this._vertices[X++]=ShurikenParticleData.startSize[1],this._vertices[X++]=ShurikenParticleData.startSize[2],this._vertices[X++]=ShurikenParticleData.startRotation[0],this._vertices[X++]=ShurikenParticleData.startRotation[1],this._vertices[X++]=ShurikenParticleData.startRotation[2],this._vertices[X++]=ShurikenParticleData.startSpeed,f&&(this._vertices[X+1]=l),p&&(this._vertices[X+2]=_),v&&(this._vertices[X+3]=h),y&&(this._vertices[X+4]=u),c&&(this._vertices[X+5]=a,this._vertices[X+6]=s,this._vertices[X+7]=o),this.simulationSpace){case 0:X+=8,this._vertices[X++]=ShurikenParticleData.simulationWorldPostion[0],this._vertices[X++]=ShurikenParticleData.simulationWorldPostion[1],this._vertices[X++]=ShurikenParticleData.simulationWorldPostion[2],this._vertices[X++]=ShurikenParticleData.simulationWorldRotation[0],this._vertices[X++]=ShurikenParticleData.simulationWorldRotation[1],this._vertices[X++]=ShurikenParticleData.simulationWorldRotation[2],this._vertices[X++]=ShurikenParticleData.simulationWorldRotation[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}}return this._firstFreeElement=n,!0},i.addNewParticlesToVertexBuffer=function(){var t=0;this._firstNewElement<this._firstFreeElement?(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._firstFreeElement-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex)):(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._bufferMaxParticles-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex),this._firstFreeElement>0&&this._vertexBuffer.setData(this._vertices,0,0,this._firstFreeElement*this._vertexStride*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},i._prepareRender=function(){return this._updateEmission(),this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement?!0:!1},i._render=function(){this._indexBuffer.bind();var t=0,e=LayaGL.instance;this._firstActiveElement<this._firstFreeElement?(t=(this._firstFreeElement-this._firstActiveElement)*this._indexStride,e.drawElements(4,t,5123,2*this._firstActiveElement*this._indexStride),Stat.trianglesFaces+=t/3,Stat.drawCall++):(t=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride,e.drawElements(4,t,5123,2*this._firstActiveElement*this._indexStride),Stat.trianglesFaces+=t/3,Stat.drawCall++,this._firstFreeElement>0&&(t=this._firstFreeElement*this._indexStride,e.drawElements(4,t,5123,0),Stat.trianglesFaces+=t/3,Stat.drawCall++))},i.play=function(){if(this._burstsIndex=0,this._isEmitting=!0,this._isPlaying=!0,this._isPaused=!1,this._emissionTime=0,this._totalDelayTime=0,!this.autoRandomSeed)for(var t=0,i=this._randomSeeds.length;i>t;t++)this._randomSeeds[t]=this.randomSeed[0]+e._RANDOMOFFSET[t];switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:this.autoRandomSeed?this._playStartDelay=MathUtil.lerp(this.startDelayMin,this.startDelayMax,Math.random()):(this._rand.seed=this._randomSeeds[2],this._playStartDelay=MathUtil.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat()),this._randomSeeds[2]=this._rand.seed);break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay,this._startUpdateLoopCount=Stat.loopCount},i.pause=function(){this._isPaused=!0},i.simulate=function(t,e){void 0===e&&(e=!0),this._simulateUpdate=!0,e?this._updateParticlesSimulationRestart(t):(this._isPaused=!1,this._updateParticles(t)),this.pause()},i.stop=function(){this._burstsIndex=0,this._isEmitting=!1,this._emissionTime=0},i.cloneTo=function(t){var e=t;e.duration=this.duration,e.looping=this.looping,e.prewarm=this.prewarm,e.startDelayType=this.startDelayType,e.startDelay=this.startDelay,e.startDelayMin=this.startDelayMin,e.startDelayMax=this.startDelayMax,e._maxStartLifetime=this._maxStartLifetime,e.startLifetimeType=this.startLifetimeType,e.startLifetimeConstant=this.startLifetimeConstant,this.startLifeTimeGradient.cloneTo(e.startLifeTimeGradient),e.startLifetimeConstantMin=this.startLifetimeConstantMin,e.startLifetimeConstantMax=this.startLifetimeConstantMax,this.startLifeTimeGradientMin.cloneTo(e.startLifeTimeGradientMin),this.startLifeTimeGradientMax.cloneTo(e.startLifeTimeGradientMax),e.startSpeedType=this.startSpeedType,e.startSpeedConstant=this.startSpeedConstant,e.startSpeedConstantMin=this.startSpeedConstantMin,e.startSpeedConstantMax=this.startSpeedConstantMax,e.threeDStartSize=this.threeDStartSize,e.startSizeType=this.startSizeType,e.startSizeConstant=this.startSizeConstant,this.startSizeConstantSeparate.cloneTo(e.startSizeConstantSeparate),e.startSizeConstantMin=this.startSizeConstantMin,e.startSizeConstantMax=this.startSizeConstantMax,this.startSizeConstantMinSeparate.cloneTo(e.startSizeConstantMinSeparate),this.startSizeConstantMaxSeparate.cloneTo(e.startSizeConstantMaxSeparate),e.threeDStartRotation=this.threeDStartRotation,e.startRotationType=this.startRotationType,e.startRotationConstant=this.startRotationConstant,this.startRotationConstantSeparate.cloneTo(e.startRotationConstantSeparate),e.startRotationConstantMin=this.startRotationConstantMin,e.startRotationConstantMax=this.startRotationConstantMax,this.startRotationConstantMinSeparate.cloneTo(e.startRotationConstantMinSeparate),this.startRotationConstantMaxSeparate.cloneTo(e.startRotationConstantMaxSeparate),e.randomizeRotationDirection=this.randomizeRotationDirection,e.startColorType=this.startColorType,this.startColorConstant.cloneTo(e.startColorConstant),this.startColorConstantMin.cloneTo(e.startColorConstantMin),this.startColorConstantMax.cloneTo(e.startColorConstantMax),e.gravityModifier=this.gravityModifier,e.simulationSpace=this.simulationSpace,e.scaleMode=this.scaleMode,e.playOnAwake=this.playOnAwake,e.maxParticles=this.maxParticles,this._emission&&(e._emission=this._emission.clone()),this.shape&&(e.shape=this.shape.clone()),this.velocityOverLifetime&&(e.velocityOverLifetime=this.velocityOverLifetime.clone()),this.colorOverLifetime&&(e.colorOverLifetime=this.colorOverLifetime.clone()),this.sizeOverLifetime&&(e.sizeOverLifetime=this.sizeOverLifetime.clone()),this.rotationOverLifetime&&(e.rotationOverLifetime=this.rotationOverLifetime.clone()),this.textureSheetAnimation&&(e.textureSheetAnimation=this.textureSheetAnimation.clone()),e.isPerformanceMode=this.isPerformanceMode,e._isEmitting=this._isEmitting,e._isPlaying=this._isPlaying,e._isPaused=this._isPaused,e._playStartDelay=this._playStartDelay,e._frameRateTime=this._frameRateTime,e._emissionTime=this._emissionTime,e._totalDelayTime=this._totalDelayTime,e._burstsIndex=this._burstsIndex},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,i,"maxParticles",function(){return this._bufferMaxParticles-1},function(t){var e=t+1;e!==this._bufferMaxParticles&&(this._bufferMaxParticles=e,this._initBufferDatas())}),__getset(0,i,"isEmitting",function(){return this._isEmitting}),__getset(0,i,"isAlive",function(){return this._isPlaying||this.aliveParticleCount>0?!0:!1}),__getset(0,i,"shape",function(){return this._shape},function(t){this._shape!==t&&(t&&t.enable?this._owner._render._defineDatas.add(ShuriKenParticle3D.SHADERDEFINE_SHAPE):this._owner._render._defineDatas.remove(ShuriKenParticle3D.SHADERDEFINE_SHAPE),this._shape=t)}),__getset(0,i,"rotationOverLifetime",function(){return this._rotationOverLifetime},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.angularVelocity;if(!n)return;var r=n.separateAxes,a=n.type;if(t.enbale)switch(r?e.add(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE):e.add(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIME),a){case 0:e.add(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:e.add(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:e.add(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:e.add(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}else e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIME),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);switch(a){case 0:r?i.setVector(35,n.constantSeparate):i.setNumber(34,n.constant);break;case 1:r?(i.setBuffer(37,n.gradientX._elements),i.setBuffer(38,n.gradientY._elements),i.setBuffer(39,n.gradientZ._elements),i.setBuffer(40,n.gradientW._elements)):i.setBuffer(36,n.gradient._elements);break;case 2:r?(i.setVector(35,n.constantMinSeparate),i.setVector(42,n.constantMaxSeparate)):(i.setNumber(34,n.constantMin),i.setNumber(41,n.constantMax));break;case 3:r?(i.setBuffer(37,n.gradientXMin._elements),i.setBuffer(44,n.gradientXMax._elements),i.setBuffer(38,n.gradientYMin._elements),i.setBuffer(45,n.gradientYMax._elements),i.setBuffer(39,n.gradientZMin._elements),i.setBuffer(46,n.gradientZMax._elements),i.setBuffer(40,n.gradientWMin._elements),i.setBuffer(47,n.gradientWMax._elements)):(i.setBuffer(36,n.gradientMin._elements),i.setBuffer(43,n.gradientMax._elements))}}else e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIME),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e.remove(ShuriKenParticle3D.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES),i.setVector(35,null),i.setVector(42,null),i.setNumber(34,void 0),i.setNumber(41,void 0),i.setBuffer(37,null),i.setBuffer(44,null),i.setBuffer(38,null),i.setBuffer(45,null),i.setBuffer(39,null),i.setBuffer(46,null),i.setBuffer(40,null),i.setBuffer(47,null),i.setBuffer(36,null),i.setBuffer(43,null);this._rotationOverLifetime=t}),__getset(0,i,"emission",function(){return this._emission}),__getset(0,i,"emissionTime",function(){return this._emissionTime>this.duration?this.duration:this._emissionTime}),__getset(0,i,"aliveParticleCount",function(){return this._firstNewElement>=this._firstRetiredElement?this._firstNewElement-this._firstRetiredElement:this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}),__getset(0,i,"isPlaying",function(){return this._isPlaying}),__getset(0,i,"isPaused",function(){return this._isPaused}),__getset(0,i,"startLifetimeType",function(){return this._startLifetimeType},function(t){var e=0,i=0;switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;var n=n;for(e=0,i=n.gradientCount;i>e;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,n.getValueByIndex(e));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var r=r;for(e=0,i=r.gradientCount;i>e;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(e));var a=a;for(e=0,i=a.gradientCount;i>e;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,a.getValueByIndex(e))}this._startLifetimeType=t}),__getset(0,i,"startLifetimeConstant",function(){return this._startLifetimeConstant},function(t){0===this._startLifetimeType&&(this._maxStartLifetime=t),this._startLifetimeConstant=t}),__getset(0,i,"startLifetimeConstantMin",function(){return this._startLifetimeConstantMin},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(t,this._startLifetimeConstantMax)),this._startLifetimeConstantMin=t}),__getset(0,i,"startLifeTimeGradient",function(){return this._startLifeTimeGradient},function(t){if(1===this._startLifetimeType){this._maxStartLifetime=-Number.MAX_VALUE;for(var e=0,i=t.gradientCount;i>e;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradient=t}),__getset(0,i,"startLifetimeConstantMax",function(){return this._startLifetimeConstantMax},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,t)),this._startLifetimeConstantMax=t}),__getset(0,i,"startLifeTimeGradientMin",function(){return this._startLifeTimeGradientMin},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=t.gradientCount;i>e;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e));for(e=0,i=this._startLifeTimeGradientMax.gradientCount;i>e;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(e))}this._startLifeTimeGradientMin=t}),__getset(0,i,"startLifeTimeGradientMax",function(){return this._startLifeTimeGradientMax},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=this._startLifeTimeGradientMin.gradientCount;i>e;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(e));for(e=0,i=t.gradientCount;i>e;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradientMax=t}),__getset(0,i,"velocityOverLifetime",function(){return this._velocityOverLifetime},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.velocity,r=n.type;if(t.enbale)switch(r){case 0:e.add(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:e.add(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:e.add(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:e.add(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}else e.remove(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e.remove(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e.remove(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e.remove(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);switch(r){case 0:i.setVector(13,n.constant);break;case 1:i.setBuffer(14,n.gradientX._elements),i.setBuffer(15,n.gradientY._elements),i.setBuffer(16,n.gradientZ._elements);break;case 2:i.setVector(13,n.constantMin),i.setVector(17,n.constantMax);break;case 3:i.setBuffer(14,n.gradientXMin._elements),i.setBuffer(18,n.gradientXMax._elements),i.setBuffer(15,n.gradientYMin._elements),i.setBuffer(19,n.gradientYMax._elements),i.setBuffer(16,n.gradientZMin._elements),i.setBuffer(20,n.gradientZMax._elements)}i.setInt(21,t.space)}else e.remove(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e.remove(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e.remove(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e.remove(ShuriKenParticle3D.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE),i.setVector(13,null),i.setBuffer(14,null),i.setBuffer(15,null),i.setBuffer(16,null),i.setVector(13,null),i.setVector(17,null),i.setBuffer(14,null),i.setBuffer(18,null),i.setBuffer(15,null),i.setBuffer(19,null),i.setBuffer(16,null),i.setBuffer(20,null),i.setInt(21,void 0);this._velocityOverLifetime=t}),__getset(0,i,"colorOverLifetime",function(){return this._colorOverLifetime},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.color;if(t.enbale)switch(n.type){case 1:e.add(ShuriKenParticle3D.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:e.add(ShuriKenParticle3D.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}else e.remove(ShuriKenParticle3D.SHADERDEFINE_COLOROVERLIFETIME),e.remove(ShuriKenParticle3D.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);switch(n.type){case 1:var r=n.gradient;i.setBuffer(22,r._alphaElements),i.setBuffer(23,r._rgbElements);break;case 3:var a=n.gradientMin,s=n.gradientMax;i.setBuffer(22,a._alphaElements),i.setBuffer(23,a._rgbElements),i.setBuffer(24,s._alphaElements),i.setBuffer(25,s._rgbElements)}}else e.remove(ShuriKenParticle3D.SHADERDEFINE_COLOROVERLIFETIME),e.remove(ShuriKenParticle3D.SHADERDEFINE_RANDOMCOLOROVERLIFETIME),i.setBuffer(22,r._alphaElements),i.setBuffer(23,r._rgbElements),i.setBuffer(22,a._alphaElements),i.setBuffer(23,a._rgbElements),i.setBuffer(24,s._alphaElements),i.setBuffer(25,s._rgbElements);this._colorOverLifetime=t}),__getset(0,i,"sizeOverLifetime",function(){return this._sizeOverLifetime},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.size,r=n.separateAxes,a=n.type;if(t.enbale)switch(a){case 0:r?e.add(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE):e.add(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:r?e.add(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE):e.add(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES)}else e.remove(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e.remove(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e.remove(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e.remove(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);switch(a){case 0:r?(i.setBuffer(27,n.gradientX._elements),i.setBuffer(28,n.gradientY._elements),i.setBuffer(29,n.gradientZ._elements)):i.setBuffer(26,n.gradient._elements);break;case 2:r?(i.setBuffer(27,n.gradientXMin._elements),i.setBuffer(31,n.gradientXMax._elements),i.setBuffer(28,n.gradientYMin._elements),i.setBuffer(32,n.gradientYMax._elements),i.setBuffer(29,n.gradientZMin._elements),i.setBuffer(33,n.gradientZMax._elements)):(i.setBuffer(26,n.gradientMin._elements),i.setBuffer(30,n.gradientMax._elements))
}}else e.remove(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e.remove(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e.remove(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e.remove(ShuriKenParticle3D.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE),i.setBuffer(27,null),i.setBuffer(31,null),i.setBuffer(28,null),i.setBuffer(32,null),i.setBuffer(29,null),i.setBuffer(33,null),i.setBuffer(26,null),i.setBuffer(30,null);this._sizeOverLifetime=t}),__getset(0,i,"textureSheetAnimation",function(){return this._textureSheetAnimation},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.frame,r=n.type;if(t.enable)switch(r){case 1:e.add(ShuriKenParticle3D.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:e.add(ShuriKenParticle3D.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}else e.remove(ShuriKenParticle3D.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e.remove(ShuriKenParticle3D.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);if(1===r||3===r){i.setInt(48,t.cycles);var a=t.tiles,s=this._uvLength.elements;s[0]=1/a.x,s[1]=1/a.y,i.setVector(49,this._uvLength)}switch(r){case 1:i.setBuffer(50,n.frameOverTimeData._elements);break;case 3:i.setBuffer(50,n.frameOverTimeDataMin._elements),i.setBuffer(51,n.frameOverTimeDataMax._elements)}}else e.remove(ShuriKenParticle3D.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e.remove(ShuriKenParticle3D.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE),i.setInt(48,void 0),i.setVector(49,null),i.setBuffer(50,null),i.setBuffer(51,null);this._textureSheetAnimation=t}),__getset(0,i,"_vertexBufferCount",function(){return 1}),__getset(0,i,"triangleCount",function(){return this._indexBuffer?this._indexBuffer.indexCount/3:0}),e.halfKSqrtOf2=.71,__static(e,["_RANDOMOFFSET",function(){return this._RANDOMOFFSET=new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447])},"_maxElapsedTime",function(){return this._maxElapsedTime=1/3},"_tempVector30",function(){return this._tempVector30=new Vector3},"_tempVector31",function(){return this._tempVector31=new Vector3},"_tempVector32",function(){return this._tempVector32=new Vector3},"_tempVector33",function(){return this._tempVector33=new Vector3},"_tempVector34",function(){return this._tempVector34=new Vector3},"_tempVector35",function(){return this._tempVector35=new Vector3},"_tempVector36",function(){return this._tempVector36=new Vector3},"_tempVector37",function(){return this._tempVector37=new Vector3},"_tempVector38",function(){return this._tempVector38=new Vector3},"_tempVector39",function(){return this._tempVector39=new Vector3},"_tempPosition",function(){return this._tempPosition=new Vector3},"_tempDirection",function(){return this._tempDirection=new Vector3}]),e}(GeometryElement),UIEvent=function(t){function e(){e.__super.call(this)}return __class(e,"laya.ui.UIEvent",t),e.SHOW_TIP="showtip",e.HIDE_TIP="hidetip",e}(Event),TrailRenderElement=function(t){function e(t){this._id=0,this._owner=null,this._camera=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=0/0,this._curDisappearIndex=0,e.__super.call(this),this._lastPosition=new Vector3,this._curPosition=new Vector3,this._delVector3=new Vector3,this._lastFixedVertexPosition=new Vector3,this._pointAtoBVector3=new Vector3,this._pointA=new Vector3,this._pointB=new Vector3,this._owner=t,this._id=e.renderElementCount++,0==this._id?t._owner.transform.position.cloneTo(this._lastPosition):t._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2);var i=VertexTrail.vertexDeclaration1;this._vertexBuffer1=new VertexBuffer3D(this._maxVerticesCount*i.vertexStride,35044,!0),this._vertexBuffer1.vertexDeclaration=i;var n=VertexTrail.vertexDeclaration2;this._vertexBuffer2=new VertexBuffer3D(this._maxVerticesCount*n.vertexStride,35044,!0),this._vertexBuffer2.vertexDeclaration=n,this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2),this._setVertexBuffers(this._vertexBuffers)}__class(e,"laya.d3.core.trail.TrailRenderElement",t);var i=e.prototype;return i._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},i._addTrailByFirstPosition=function(t,e){Vector3.subtract(e,t,this._delVector3),Vector3.cross(this._delVector3,this._camera.transform.forward,this._pointAtoBVector3),Vector3.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Vector3.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},i._addTrailByNextPosition=function(t){Vector3.subtract(t,this._lastFixedVertexPosition,this._delVector3),Vector3.cross(this._delVector3,this._camera.transform.forward,this._pointAtoBVector3),Vector3.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Vector3.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=Vector3.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=MathUtils3D.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(t),this._virtualVerticesCount=2)},i._updateVerticesByPosition=function(t){this._pointe=t.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,this._everyVertexToPreVertexDistance[this._verticesCount/2]=0==this._owner._trailSupplementLength?this._delLength:this._isStart?this._owner._trailSupplementLength:0},i._updateVertexBuffer2=function(){var t=0,e=0,i=0,n=0;for(i=0,n=(this._verticesCount+this._virtualVerticesCount)/2;n>i;i++)e=0==this._owner.textureMode?(this._VerticesToTailLength[i]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[i],this._vertices2[t++]=1-e,this._vertices2[t++]=1-e;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},i._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},i._updateDisappear=function(){var t=0,e=0;for(t=this._curDisappearIndex,e=(this._verticesCount+this._virtualVerticesCount)/2;e>t;t++)this._owner._curtime-this._everyGroupVertexBirthTime[t]>=this._owner.time+MathUtils3D.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},i._prepareRender=function(t){return this._camera=t.camera,null==this._camera?!1:(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),Vector3.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),this._verticesCount>0)?(this._updateVertexBuffer2(),this._updateDisappear(),!0):!1)},i._render=function(){this._isDead||(WebGL.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),Stat.drawCall++,Stat.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},i._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer1:1===t?this._vertexBuffer2:null},i._getVertexBuffers=function(){return this._vertexBuffers},i._getIndexBuffer=function(){return null},i.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},i._destroy=function(){this._vertexBuffer1.destroy(),this._vertexBuffer2.destroy(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},__getset(0,i,"_vertexBufferCount",function(){return this._vertexBuffers.length}),__getset(0,i,"triangleCount",function(){return 0}),e.renderElementCount=0,e}(GeometryElement),BoxShape=function(t){function e(){this.x=0/0,this.y=0/0,this.z=0/0,e.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}__class(e,"laya.d3.core.particleShuriKen.module.shape.BoxShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=.5*-this.x,e[1]=.5*-this.y,e[2]=.5*-this.z;var i=t.max.elements;i[0]=.5*this.x,i[1]=.5*this.y,i[2]=.5*this.z},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=0,e[1]=0,e[2]=0;var i=t.max.elements;i[0]=0,i[1]=1,i[2]=0},i.generatePositionAndDirection=function(t,e,i,n){var r=t.elements,a=e.elements;i?(i.seed=n[16],ShapeUtils._randomPointInsideHalfUnitBox(t,i),n[16]=i.seed):ShapeUtils._randomPointInsideHalfUnitBox(t),r[0]=this.x*r[0],r[1]=this.y*r[1],r[2]=this.z*r[2],this.randomDirection?i?(i.seed=n[17],ShapeUtils._randomPointUnitSphere(e,i),n[17]=i.seed):ShapeUtils._randomPointUnitSphere(e):(a[0]=0,a[1]=0,a[2]=1)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.x=this.x,i.y=this.y,i.z=this.z,i.randomDirection=this.randomDirection},e}(BaseShape),CircleShape=function(t){function e(){this.radius=0/0,this.arc=0/0,this.emitFromEdge=!1,e.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}__class(e,"laya.d3.core.particleShuriKen.module.shape.CircleShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[2]=-this.radius,e[1]=0;var i=t.max.elements;i[0]=i[2]=this.radius,i[1]=0},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=1,i[2]=0},i.generatePositionAndDirection=function(t,i,n,r){var a=t.elements,s=e._tempPositionPoint.elements;n?(n.seed=r[16],this.emitFromEdge?ShapeUtils._randomPointUnitArcCircle(this.arc,e._tempPositionPoint,n):ShapeUtils._randomPointInsideUnitArcCircle(this.arc,e._tempPositionPoint,n),r[16]=n.seed):this.emitFromEdge?ShapeUtils._randomPointUnitArcCircle(this.arc,e._tempPositionPoint):ShapeUtils._randomPointInsideUnitArcCircle(this.arc,e._tempPositionPoint),a[0]=-s[0],a[1]=s[1],a[2]=0,Vector3.scale(t,this.radius,t),this.randomDirection?n?(n.seed=r[17],ShapeUtils._randomPointUnitSphere(i,n),r[17]=n.seed):ShapeUtils._randomPointUnitSphere(i):t.cloneTo(i)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.arc=this.arc,i.emitFromEdge=this.emitFromEdge,i.randomDirection=this.randomDirection},__static(e,["_tempPositionPoint",function(){return this._tempPositionPoint=new Vector2}]),e}(BaseShape),ConeShape=function(t){function e(){this.angle=0/0,this.radius=0/0,this.length=0/0,this.emitType=0,e.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}__class(e,"laya.d3.core.particleShuriKen.module.shape.ConeShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=this.radius+this.length*Math.sin(this.angle),i=this.length*Math.cos(this.angle),n=t.min.elements;n[0]=n[1]=-e,n[2]=0;var r=t.max.elements;r[0]=r[1]=e,r[2]=i},i._getSpeedBoundBox=function(t){var e=Math.sin(this.angle),i=t.min.elements;i[0]=i[1]=-e,i[2]=0;var n=t.max.elements;n[0]=i[1]=e,n[2]=1},i.generatePositionAndDirection=function(t,i,n,r){var a,s=t.elements,o=i.elements,l=e._tempPositionPoint.elements,_=0/0,h=0/0,u=Math.cos(this.angle),c=Math.sin(this.angle);switch(this.emitType){case 0:n?(n.seed=r[16],ShapeUtils._randomPointInsideUnitCircle(e._tempPositionPoint,n),r[16]=n.seed):ShapeUtils._randomPointInsideUnitCircle(e._tempPositionPoint),_=l[0],h=l[1],s[0]=_*this.radius,s[1]=h*this.radius,s[2]=0,this.randomDirection?(n?(n.seed=r[17],ShapeUtils._randomPointInsideUnitCircle(e._tempDirectionPoint,n),r[17]=n.seed):ShapeUtils._randomPointInsideUnitCircle(e._tempDirectionPoint),a=e._tempDirectionPoint.elements,o[0]=a[0]*c,o[1]=a[1]*c):(o[0]=_*c,o[1]=h*c),o[2]=u;break;case 1:n?(n.seed=r[16],ShapeUtils._randomPointUnitCircle(e._tempPositionPoint,n),r[16]=n.seed):ShapeUtils._randomPointUnitCircle(e._tempPositionPoint),_=l[0],h=l[1],s[0]=_*this.radius,s[1]=h*this.radius,s[2]=0,this.randomDirection?(n?(n.seed=r[17],ShapeUtils._randomPointInsideUnitCircle(e._tempDirectionPoint,n),r[17]=n.seed):ShapeUtils._randomPointInsideUnitCircle(e._tempDirectionPoint),a=e._tempDirectionPoint.elements,o[0]=a[0]*c,o[1]=a[1]*c):(o[0]=_*c,o[1]=h*c),o[2]=u;break;case 2:n?(n.seed=r[16],ShapeUtils._randomPointInsideUnitCircle(e._tempPositionPoint,n)):ShapeUtils._randomPointInsideUnitCircle(e._tempPositionPoint),_=l[0],h=l[1],s[0]=_*this.radius,s[1]=h*this.radius,s[2]=0,o[0]=_*c,o[1]=h*c,o[2]=u,Vector3.normalize(i,i),n?(Vector3.scale(i,this.length*n.getFloat(),i),r[16]=n.seed):Vector3.scale(i,this.length*Math.random(),i),Vector3.add(t,i,t),this.randomDirection&&(n?(n.seed=r[17],ShapeUtils._randomPointUnitSphere(i,n),r[17]=n.seed):ShapeUtils._randomPointUnitSphere(i));break;case 3:n?(n.seed=r[16],ShapeUtils._randomPointUnitCircle(e._tempPositionPoint,n)):ShapeUtils._randomPointUnitCircle(e._tempPositionPoint),_=l[0],h=l[1],s[0]=_*this.radius,s[1]=h*this.radius,s[2]=0,o[0]=_*c,o[1]=h*c,o[2]=u,Vector3.normalize(i,i),n?(Vector3.scale(i,this.length*n.getFloat(),i),r[16]=n.seed):Vector3.scale(i,this.length*Math.random(),i),Vector3.add(t,i,t),this.randomDirection&&(n?(n.seed=r[17],ShapeUtils._randomPointUnitSphere(i,n),r[17]=n.seed):ShapeUtils._randomPointUnitSphere(i));break;default:throw new Error("ConeShape:emitType is invalid.")}},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.angle=this.angle,i.radius=this.radius,i.length=this.length,i.emitType=this.emitType,i.randomDirection=this.randomDirection},__static(e,["_tempPositionPoint",function(){return this._tempPositionPoint=new Vector2},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new Vector2}]),e}(BaseShape),HemisphereShape=function(t){function e(){this.radius=0/0,this.emitFromShell=!1,e.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}__class(e,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=this.radius,i[2]=0},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=i[2]=1},i.generatePositionAndDirection=function(t,e,i,n){var r=t.elements;i?(i.seed=n[16],this.emitFromShell?ShapeUtils._randomPointUnitSphere(t,i):ShapeUtils._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?ShapeUtils._randomPointUnitSphere(t):ShapeUtils._randomPointInsideUnitSphere(t),Vector3.scale(t,this.radius,t);var a=r[2];0>a&&(r[2]=-1*a),this.randomDirection?i?(i.seed=n[17],ShapeUtils._randomPointUnitSphere(e,i),n[17]=i.seed):ShapeUtils._randomPointUnitSphere(e):t.cloneTo(e)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.emitFromShell=this.emitFromShell,i.randomDirection=this.randomDirection},e}(BaseShape),SphereShape=function(t){function e(){this.radius=0/0,this.emitFromShell=!1,e.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}__class(e,"laya.d3.core.particleShuriKen.module.shape.SphereShape",t);var i=e.prototype;return i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=i[2]=this.radius},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-1;var i=t.max.elements;i[0]=i[1]=i[2]=1},i.generatePositionAndDirection=function(t,e,i,n){i?(i.seed=n[16],this.emitFromShell?ShapeUtils._randomPointUnitSphere(t,i):ShapeUtils._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?ShapeUtils._randomPointUnitSphere(t):ShapeUtils._randomPointInsideUnitSphere(t),Vector3.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],ShapeUtils._randomPointUnitSphere(e,i),n[17]=i.seed):ShapeUtils._randomPointUnitSphere(e):t.cloneTo(e)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.emitFromShell=this.emitFromShell,i.randomDirection=this.randomDirection},e}(BaseShape),SubMeshDynamicBatch=function(t){function e(){this._vertices=null,this._indexBuffer=null,this._indices=null,this._positionOffset=0,this._normalOffset=0,this._colorOffset=0,this._uv0Offset=0,this._uv1Offset=0,this._sTangentOffset=0,e.__super.call(this);var t=VertexPositionNormalColorTexture0Texture1STangent.vertexDeclaration,i=32e3*t.vertexStride;this._vertices=new Float32Array(i/4),this._vertexBuffer=new VertexBuffer3D(i,35048),this._vertexBuffer.lock=!0,this._indices=new Int16Array(32e3),this._indexBuffer=new IndexBuffer3D("ushort",this._indices.length,35048),this._indexBuffer.lock=!0}__class(e,"laya.d3.graphics.SubMeshDynamicBatch",t);var i=e.prototype;return i._getBatchVertices=function(t,e,i,n,r,a){var s=t.vertexStride/4,o=a._vertexBuffer.getData(),l=(r.render.lightmapScaleOffset,r._dynamicMultiSubMesh),_=r._dynamicVertexCount;r._computeWorldPositionsAndNormals(this._positionOffset,this._normalOffset,l,_);for(var h=r._dynamicWorldPositions,u=r._dynamicWorldNormals,c=a._indices,d=0;_>d;d++){var f=l?c[d]:d,m=f*s,p=(d+i)*s,g=3*d,v=p+this._positionOffset;e[v]=h[g],e[v+1]=h[g+1],e[v+2]=h[g+2],-1!==this._normalOffset&&(v=p+this._normalOffset,e[v]=u[g],e[v+1]=u[g+1],e[v+2]=u[g+2]),-1!==this._colorOffset&&(v=p+this._colorOffset,g=m+this._colorOffset,e[v]=o[g],e[v+1]=o[g+1],e[v+2]=o[g+2],e[v+3]=o[g+3]),-1!==this._uv0Offset&&(v=p+this._uv0Offset,g=m+this._uv0Offset,e[v]=o[g],e[v+1]=o[g+1]),-1!==this._sTangentOffset&&(v=p+this._sTangentOffset,g=m+this._sTangentOffset,e[v]=o[g],e[v+1]=o[g+1],e[v+2]=o[g+2],e[v+3]=o[g+3],v=p+this._sTangentOffset,g=m+this._sTangentOffset,e[v]=o[g],e[v+1]=o[g+1],e[v+2]=o[g+2],e[v+3]=o[g+3])}},i._getBatchIndices=function(t,e,i,n,r,a){var s=r._indices,o=0,l=0,_=0,h=n._isFrontFaceInvert;if(a)if(h)for(o=0,l=s.length;l>o;o+=3){_=e+o;var u=i+o;t[_]=u,t[_+1]=u+2,t[_+2]=u+1}else for(o=l,l=s.length;l>o;o+=3)_=e+o,u=i+o,t[_]=u,t[_+1]=u+1,t[_+2]=u+2;else if(h)for(o=0,l=s.length;l>o;o+=3)_=e+o,t[_]=i+s[o],t[_+1]=i+s[o+2],t[_+2]=i+s[o+1];else for(o=l,l=s.length;l>o;o+=3)_=e+o,t[_]=i+s[o],t[_+1]=i+s[o+1],t[_+2]=i+s[o+2]},i._flush=function(t,e){this._vertexBuffer.setData(this._vertices,0,0,t*(this._vertexBuffer.vertexDeclaration.vertexStride/4)),this._indexBuffer.setData(this._indices,0,0,e),LayaGL.instance.drawElements(4,e,5123,0),Stat.drawCall++,Stat.trianglesFaces+=e/3},i._prepareRender=function(t){var e=t.renderElement,i=e.dynamicVertexDeclaration;this._vertexBuffer.vertexDeclaration=i,this._setVertexBuffer(this._vertexBuffer),this._positionOffset=i.getVertexElementByUsage(0).offset/4;var n=i.getVertexElementByUsage(3);this._normalOffset=n?n.offset/4:-1;var r=i.getVertexElementByUsage(1);this._colorOffset=r?r.offset/4:-1;var a=i.getVertexElementByUsage(2);this._uv0Offset=a?a.offset/4:-1;var s=i.getVertexElementByUsage(15);this._uv1Offset=s?s.offset/4:-1;var o=i.getVertexElementByUsage(5);return this._sTangentOffset=o?o.offset/4:-1,!0},i._render=function(t){for(var e=t.renderElement,i=e.dynamicVertexDeclaration,n=e.dynamicBatchElementList,r=0,a=0,s=(i.vertexStride/4,0),o=n.length;o>s;s++){var e=n[s],l=e._geometry,_=l._indexCount;a+_>32e3&&(this._flush(r,a),r=a=0);var h=e._transform;this._getBatchVertices(i,this._vertices,r,h,e,l),this._getBatchIndices(this._indices,a,r,h,l,e._dynamicMultiSubMesh),r+=e._dynamicVertexCount,a+=_}this._flush(r,a)},e.maxAllowVertexCount=10,e.maxAllowAttribueCount=900,e.maxIndicesCount=32e3,e.instance=null,e}(GeometryElement),SubMeshStaticBatch=function(t){function e(t,i,n){e.__super.call(this),this._batchID=e._batchIDCounter++,this._batchElements=[],this._currentBatchVertexCount=0,this._currentBatchIndexCount=0,this._vertexDeclaration=n,this.batchOwner=t,this.number=i}__class(e,"laya.d3.graphics.SubMeshStaticBatch",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.IDispose":!0}),i._getStaticBatchBakedVertexs=function(t,i,n,r,a,s){var o,l=s._vertexBuffers[0],_=l.vertexDeclaration,h=_.getVertexElementByUsage(0).offset/4,u=_.getVertexElementByUsage(3),c=u?u.offset/4:-1,d=_.getVertexElementByUsage(1),f=d?d.offset/4:-1,m=_.getVertexElementByUsage(2),p=m?m.offset/4:-1,g=_.getVertexElementByUsage(15),v=g?g.offset/4:-1,x=_.getVertexElementByUsage(5),y=x?x.offset/4:-1,T=18,D=_.vertexStride/4,E=l.getData();if(n){var S=n.worldMatrix;S.invert(e._tempMatrix4x40),o=e._tempMatrix4x41,Matrix4x4.multiply(e._tempMatrix4x40,r.worldMatrix,o)}else o=r.worldMatrix;var M=e._tempQuaternion0;o.decomposeTransRotScale(e._tempVector30,M,e._tempVector31);for(var R=a.lightmapScaleOffset,A=s.vertexCount,C=0;A>C;C++){var L=C*D,I=(C+i)*T;Utils3D.transformVector3ArrayToVector3ArrayCoordinate(E,L+h,o,t,I+0),-1!==c&&Utils3D.transformVector3ArrayByQuat(E,L+c,M,t,I+3);var w=0,b=0,P=I+6;if(-1!==f){var V=L+f;for(w=0,b=4;b>w;w++)t[P+w]=E[V+w]}else for(w=0,b=4;b>w;w++)t[P+w]=1;if(-1!==p){var O=L+p;t[I+10]=E[O],t[I+11]=E[O+1]}if(R&&(-1!==v?Utils3D.transformLightingMapTexcoordByUV1Array(E,L+v,R,t,I+12):Utils3D.transformLightingMapTexcoordByUV0Array(E,L+p,R,t,I+12)),-1!==y){var N=L+y;t[I+14]=E[N],t[I+15]=E[N+1],t[I+16]=E[N+2],t[I+17]=E[N+3]}}return A},i.addTest=function(t){var e=0,i=t.meshFilter.sharedMesh.vertexCount;return e=this._currentBatchVertexCount+i,e>65535?!1:!0},i.add=function(t){var e=t.staticBatch;e&&(e.remove(),console.log("移除"));var i=t.meshFilter.sharedMesh,n=i.vertexCount;this._batchElements.push(t);var r=t._render;r._isPartOfStaticBatch=!0,r._staticBatch=this;for(var a=r._renderElements,s=0,o=a.length;o>s;s++)a[s].staticBatch=this;this._currentBatchIndexCount+=i._indexBuffer.indexCount,this._currentBatchVertexCount+=n},i.remove=function(t){var e=t.meshFilter.sharedMesh,i=this._batchElements.indexOf(t);if(-1!==i){this._batchElements.splice(i,1);for(var n=(t._render,t._render._renderElements),r=0,a=n.length;a>r;r++)n[r].staticBatch=null;var s=e.vertexCount;this._currentBatchIndexCount=this._currentBatchIndexCount-e._indexBuffer.indexCount,this._currentBatchVertexCount=this._currentBatchVertexCount-s,t._render._isPartOfStaticBatch=!1}},i.finishInit=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy());var t=0,e=0,i=this.batchOwner._owner,n=this._vertexDeclaration.vertexStride/4,r=new Float32Array(n*this._currentBatchVertexCount),a=new Uint16Array(this._currentBatchIndexCount);this._vertexBuffer=new VertexBuffer3D(this._vertexDeclaration.vertexStride*this._currentBatchVertexCount,35044),this._vertexBuffer.vertexDeclaration=this._vertexDeclaration,this._indexBuffer=IndexBuffer3D.create("ushort",this._currentBatchIndexCount,35044);for(var s=0,o=this._batchElements.length;o>s;s++){for(var l=this._batchElements[s],_=l.meshFilter.sharedMesh,h=this._getStaticBatchBakedVertexs(r,t,i?i._transform:null,l._transform,l._render,_),u=_._indexBuffer.getData(),c=t,d=e+u.length,f=l._render._renderElements,m=0,p=_.subMeshCount;p>m;m++){var g=_._subMeshes[m],v=e+g._indexStart,x=f[m];x.staticBatchIndexStart=v,x.staticBatchIndexEnd=v+g._indexCount}a.set(u,e);var y=0,T=i?l._transform._isFrontFaceInvert!==i.transform._isFrontFaceInvert:l._transform._isFrontFaceInvert;if(T)for(y=e;d>y;y+=3){a[y]=c+a[y];var D=a[y+1],E=a[y+2];a[y+1]=c+E,a[y+2]=c+D}else for(y=e;d>y;y+=3)a[y]=c+a[y],a[y+1]=c+a[y+1],a[y+2]=c+a[y+2];e+=u.length,t+=h}this._vertexBuffer.setData(r),this._indexBuffer.setData(a),this._setVertexBuffer(this._vertexBuffer)},i._render=function(t){this._indexBuffer.bind();for(var e=t.renderElement,i=e.staticBatchElementList,n=0,r=0,a=1,s=i.length;s>a;a++){var o=i[a-1];if(o.staticBatchIndexEnd!==i[a].staticBatchIndexStart){var l=i[n].staticBatchIndexStart,_=i[r].staticBatchIndexEnd-l;LayaGL.instance.drawElements(4,_,5123,2*l),n=++r,Stat.drawCall++,Stat.trianglesFaces+=_/3}else r++}var l=i[n].staticBatchIndexStart,_=i[r].staticBatchIndexEnd-l;LayaGL.instance.drawElements(4,_,5123,2*l),Stat.drawCall++,Stat.trianglesFaces+=_/3},i.dispose=function(){this._batchElements=null,this.batchOwner=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},e.maxBatchVertexCount=65535,e._batchIDCounter=0,__static(e,["_tempVector30",function(){return this._tempVector30=new Vector3},"_tempVector31",function(){return this._tempVector31=new Vector3},"_tempQuaternion0",function(){return this._tempQuaternion0=new Quaternion},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new Matrix4x4},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new Matrix4x4}]),e}(GeometryElement),SubMeshRenderElement=function(t){function e(){e.__super.call(this),this._dynamicWorldPositionNormalNeedUpdate=!0}__class(e,"laya.d3.core.render.SubMeshRenderElement",t);var i=e.prototype;return i._onWorldMatrixChanged=function(){this._dynamicWorldPositionNormalNeedUpdate=!0},i._computeWorldPositionsAndNormals=function(t,e,i,n){if(this._dynamicWorldPositionNormalNeedUpdate){for(var r=this._geometry,a=r._vertexBuffer,s=a.vertexDeclaration.vertexStride/4,o=a.getData(),l=this._transform.worldMatrix,_=this._transform.rotation,h=r._indices,u=0;n>u;u++){var c=i?h[u]:u,d=c*s,f=3*u;Utils3D.transformVector3ArrayToVector3ArrayCoordinate(o,d+t,l,this._dynamicWorldPositions,f),-1!==e&&Utils3D.transformVector3ArrayByQuat(o,d+e,_,this._dynamicWorldNormals,f)}this._dynamicWorldPositionNormalNeedUpdate=!1}},i.setTransform=function(t){this._transform!==t&&(this._transform&&this._transform.off("worldmatrixneedchanged",this,this._onWorldMatrixChanged),t&&t.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._dynamicWorldPositionNormalNeedUpdate=!0,this._transform=t)},i.setGeometry=function(t){if(this._geometry!==t){var e=t,i=e._mesh;if(i){var n=i._subMeshCount>1,r=n?e._indexCount:i._vertexCount;if(10>=r){var a=3*r;this._dynamicBatch=!0,this._dynamicWorldPositions=new Float32Array(a),this._dynamicWorldNormals=new Float32Array(a),this._dynamicVertexCount=r,this._dynamicMultiSubMesh=n}else this._dynamicBatch=!1}this._geometry=t}},i.addToOpaqueRenderQueue=function(t,e){var i=this.staticBatch,n=e.elements;if(i){var r=MeshRenderStaticBatchManager.instance,a=this.render.lightmapIndex+1,s=r._opaqueBatchMarks[a]||(r._opaqueBatchMarks[a]=[]),o=s[this.render.receiveShadow?0:1]||(s[this.render.receiveShadow?0:1]=[]),l=o[this.material.id]||(o[this.material.id]=[]),_=l[i._batchID]||(l[i._batchID]=new Array(3));if(r._updateCountMark===_[0]){var h=_[1];if(_[2])n[h].staticBatchElementList.push(this);else{var u=n[h],c=u.render,d=r._getBatchRenderElementFromPool();d.setGeometry(i),d.material=u.material;var f=i.batchOwner._owner,m=f?f._transform:null;d.setTransform(m);var p=i.batchOwner._getBatchRender(t,c.lightmapIndex,c.receiveShadow);p._setBelongScene(t.scene),p._distanceForSort=c._distanceForSort,d.render=p;var g=d.staticBatchElementList;g.length=0,g.push(u),g.push(this),n[h]=d,_[2]=!0}}else _[0]=r._updateCountMark,_[1]=n.length,_[2]=!1,n.push(this)}else if(this._dynamicBatch){var v=this._geometry._vertexBuffer.vertexDeclaration,x=MeshRenderDynamicBatchManager.instance,y=this.render.lightmapIndex+1,T=x._opaqueBatchMarks[y]||(x._opaqueBatchMarks[y]=[]),D=T[this.render.receiveShadow?0:1]||(T[this.render.receiveShadow?0:1]=[]),E=D[this.material.id]||(D[this.material.id]=[]),S=E[v.id]||(E[v.id]=new Array(3));if(x._updateCountMark===S[0]){var M=S[1];if(S[2])n[M].dynamicBatchElementList.push(this);else{var R=n[M],A=R.render,C=x._getBatchRenderElementFromPool();C.setGeometry(SubMeshDynamicBatch.instance),C.material=R.material,C.setTransform(null);var L=x._getBatchRender(t,A.lightmapIndex,A.receiveShadow);
L._setBelongScene(t.scene),L._distanceForSort=A._distanceForSort,C.render=L,C.dynamicVertexDeclaration=v;var I=C.dynamicBatchElementList;I.length=0,I.push(R),I.push(this),n[M]=C,S[2]=!0}}else S[0]=x._updateCountMark,S[1]=n.length,S[2]=!1,n.push(this)}else n.push(this)},i.addToTransparentRenderQueue=function(t,e){var i=this.staticBatch,n=e.elements;if(i){var r=MeshRenderStaticBatchManager.instance,a=e.lastTransparentRenderElement;if(a){var s=a.render;if(a.staticBatch!==i||a.material!==this.material||s.receiveShadow!==this.render.receiveShadow||s.lightmapIndex!==this.render.lightmapIndex)n.push(this),e.lastTransparentBatched=!1;else{if(e.lastTransparentBatched)n[n.length-1].staticBatchElementList.push(this);else{var o=r._getBatchRenderElementFromPool();o.setGeometry(i),o.material=a.material;var l=i.batchOwner._owner,_=l?l._transform:null;o.setTransform(_);var h=i.batchOwner._getBatchRender(t,s.lightmapIndex,s.receiveShadow);h._setBelongScene(t.scene),h._distanceForSort=s._distanceForSort,o.render=h;var u=o.staticBatchElementList;u.length=0,u.push(a),u.push(this),n[n.length-1]=o}e.lastTransparentBatched=!0}}else n.push(this),e.lastTransparentBatched=!1;e.lastTransparentRenderElement=this}else if(this._dynamicBatch){var c=this._geometry._vertexBuffer.vertexDeclaration,d=MeshRenderDynamicBatchManager.instance,f=e.lastTransparentRenderElement;if(f){var m=f.render;if(f._geometry._vertexBuffer._vertexDeclaration!==c||f.material!==this.material||m.receiveShadow!==this.render.receiveShadow||m.lightmapIndex!==this.render.lightmapIndex)n.push(this),e.lastTransparentBatched=!1;else{if(e.lastTransparentBatched)n[n.length-1].dynamicBatchElementList.push(this);else{var p=d._getBatchRenderElementFromPool();p.setGeometry(SubMeshDynamicBatch.instance),p.material=f.material,p.setTransform(null);var g=d._getBatchRender(t,m.lightmapIndex,m.receiveShadow);g._setBelongScene(t.scene),g._distanceForSort=m._distanceForSort,p.render=g,p.dynamicVertexDeclaration=c;var v=p.dynamicBatchElementList;v.length=0,v.push(f),v.push(this),n[n.length-1]=p}e.lastTransparentBatched=!0}}else n.push(this),e.lastTransparentBatched=!1;e.lastTransparentRenderElement=this}else n.push(this),e.lastTransparentRenderElement=this},i.destroy=function(){t.prototype.destroy.call(this),this._dynamicWorldPositions=null,this._dynamicWorldNormals=null,this.skinnedDatas=null,this.staticBatch=null,this.staticBatchElementList=null,this.dynamicBatchElementList=null,this.dynamicVertexDeclaration=null},e}(RenderElement),ShaderPass=function(t){function e(t,i,n){this._owner=t,this._cacheSharders=[],this._publicValidDefine=0,this._spriteValidDefine=0,this._materialValidDefine=0,this._validDefineMap={},e.__super.call(this,i,n,null,this._validDefineMap);var r=t._publicDefinesMap,a=t._spriteDefinesMap,s=t._materialDefinesMap;for(var o in this._validDefineMap)null!=r[o]?this._publicValidDefine|=r[o]:null!=a[o]?this._spriteValidDefine|=a[o]:null!=s[o]&&(this._materialValidDefine|=s[o])}__class(e,"laya.d3.shader.ShaderPass",t);var i=e.prototype;return i._definesToNameDic=function(t,e){for(var i={},n=1,r=0;32>r&&(n=1<<r,!(n>t));r++)if(t&n){var a=e[n];i[a]=""}return i},i.withCompile=function(t,e,i){t&=this._publicValidDefine,e&=this._spriteValidDefine,i&=this._materialValidDefine;var n,r,a;if(r=this._cacheSharders[t])if(a=r[e]){if(n=a[i])return n}else a=r[e]=[];else r=this._cacheSharders[t]=[],a=r[e]=[];var s,o=this._definesToNameDic(t,this._owner._publicDefines),l=this._definesToNameDic(e,this._owner._spriteDefines),_=this._definesToNameDic(i,this._owner._materialDefines);if(Shader3D.debugMode){var h="";for(s in o)h+=s+" ";var u="";for(s in l)u+=s+" ";var c="";for(s in _)c+=s+" ";WebGL.shaderHighPrecision||(t+=Shader3D.SHADERDEFINE_HIGHPRECISION),console.log("Shader3DDebugMode---(Name:"+this._owner._name+" PassIndex:"+this._owner._passes.indexOf(this)+" PublicDefine:"+t+" SpriteDefine:"+e+" MaterialDefine:"+i+" PublicDefineGroup:"+h+" SpriteDefineGroup:"+u+"MaterialDefineGroup: "+c+")---ShaderCompile3DDebugMode")}var d={},f="";if(o)for(s in o)f+="#define "+s+"\n",d[s]=!0;if(l)for(s in l)f+="#define "+s+"\n",d[s]=!0;if(_)for(s in _)f+="#define "+s+"\n",d[s]=!0;var m=this._VS.toscript(d,[]),p="";0==m[0].indexOf("#version")&&(p=m[0]+"\n",m.shift());var g=this._PS.toscript(d,[]),v="";return 0==g[0].indexOf("#version")&&(v=g[0]+"\n",g.shift()),n=new ShaderInstance(p+f+m.join("\n"),v+f+g.join("\n"),this._owner._attributeMap,this._owner._uniformMap),a[i]=n,n},e}(ShaderCompile),MeshRenderDynamicBatchManager=function(t){function e(){this._opaqueBatchMarks=[],e.__super.call(this),SubMeshDynamicBatch.instance=new SubMeshDynamicBatch,this._cacheBatchOwner=[],this._updateCountMark=0}__class(e,"laya.d3.graphics.MeshRenderDynamicBatchManager",t);var i=e.prototype;return i._getBatchRender=function(t,e,i){var n=this._cacheBatchOwner[e];n||(n=this._cacheBatchOwner[e]=__newvec(2,null));var r=n[i?1:0];return r||(r=new MeshRender(null,4),r.lightmapIndex=e,r.receiveShadow=i,n[i?1:0]=r),r},i._getBatchRenderElementFromPool=function(){var t=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];return t||(t=new SubMeshRenderElement,this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=t,t.dynamicBatchElementList=[]),t},i._clear=function(){t.prototype._clear.call(this),this._updateCountMark++},__static(e,["instance",function(){return this.instance=new e}]),e}(DynamicBatchManager),primitiveGeometry=function(t){function e(){e.__super.call(this)}__class(e,"laya.d3.resource.models.primitiveGeometry",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.IDispose":!0}),i._render=function(){this._indexBuffer.bind();var t=this._indexBuffer.indexCount;WebGL.mainContext.drawElements(4,t,5123,0),Stat.drawCall++,Stat.trianglesFaces+=t/3},__getset(0,i,"_vertexBufferCount",function(){return 1}),__getset(0,i,"triangleCount",function(){return this._indexBuffer.indexCount/3}),e}(GeometryElement),SubMesh=function(t){function e(t){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._indexInMesh=0,this._vertexStart=0,this._indexStart=0,this._indexCount=0,this._indices=null,this._indexBuffer=null,e.__super.call(this),this._mesh=t,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}__class(e,"laya.d3.resource.models.SubMesh",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.IDispose":!0}),i._render=function(t){this._indexBuffer.bind();for(var e=t.renderElement.skinnedDatas,i=this._boneIndicesList.length,n=t.shader,r=0;i>r;r++)e&&n.uploadCustomUniform(0,e[r]),LayaGL.instance.drawElements(4,this._subIndexBufferCount[r],5123,2*this._subIndexBufferStart[r]);Stat.drawCall+=i,Stat.trianglesFaces+=this._indexCount/3},i.getIndices=function(){return this._indices},i.dispose=function(){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._indexBuffer.destroy(),this._indexBuffer=null},__getset(0,i,"_vertexBufferCount",function(){return 1}),__getset(0,i,"triangleCount",function(){return this._indexBuffer.indexCount/3}),e}(GeometryElement),MeshRenderStaticBatchManager=function(t){function e(){this._opaqueBatchMarks=[],e.__super.call(this),this._updateCountMark=0}__class(e,"laya.d3.graphics.MeshRenderStaticBatchManager",t);var i=e.prototype;return i._compare=function(t,e){var i=t._render,n=e._render,r=t.meshFilter.sharedMesh,a=e.meshFilter.sharedMesh,s=i.lightmapIndex-n.lightmapIndex;if(0===s){var o=(i.receiveShadow?1:0)-(n.receiveShadow?1:0);if(0===o){var l=i.sharedMaterial.id-n.sharedMaterial.id;if(0===l){var _=r._vertexBuffers[0].vertexDeclaration.id-a._vertexBuffers[0].vertexDeclaration.id;return 0===_?a._indexBuffer.indexCount-r._indexBuffer.indexCount:_}return l}return o}return s},i._getBatchRenderElementFromPool=function(){var t=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];return t||(t=new SubMeshRenderElement,this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=t,t.staticBatchElementList=[]),t},i._getStaticBatch=function(t,e){var i=t?t.id:0,n=this._staticBatches[i];n||(n=this._staticBatches[i]=new MeshRenderStaticBatchOwner(t));var r=n._batches;return r[e]||(r[e]=new SubMeshStaticBatch(n,e,VertexPositionNormalColorTexture0Texture1STangent.vertexDeclaration))},i._initStaticBatchs=function(t){this._quickSort(this._initBatchSprites,0,this._initBatchSprites.length-1);for(var e,i=!1,n=0,r=0,a=this._initBatchSprites.length;a>r;r++){var s=this._initBatchSprites[r];if(i)e.addTest(s)?e.add(s):(i=!1,n++);else{var o=a-1;r!==o&&(e=this._getStaticBatch(t,n),e.add(s),i=!0)}}for(var l in this._staticBatches){var _=this._staticBatches[l]._batches;for(r=0,a=_.length;a>r;r++)_[r].finishInit()}this._initBatchSprites.length=0},i._destroyRenderSprite=function(t){var e=t._render._staticBatch;if(e.remove(t),0===e._batchElements.length){var i=e.batchOwner._owner,n=i?i.id:0,r=this._staticBatches[n]._batches;r.splice(e.number,1),0===r.length&&delete this._staticBatches[n],e.dispose()}},i._clear=function(){t.prototype._clear.call(this),this._updateCountMark++},i._garbageCollection=function(){for(var t in this._staticBatches)for(var e=this._staticBatches[t]._batches,i=0,n=e.length;n>i;i++){var r=e[i];0===r._batchElements.length&&(r.dispose(),e.splice(i,1),i--,n--,0===n&&delete this._staticBatches[t])}},__static(e,["instance",function(){return this.instance=new e}]),e}(StaticBatchManager),TerrainFilter=function(t){function e(t,i,n,r,a,s,o,l){this._owner=null,this._gridSize=0/0,this.memorySize=0,this._numberVertices=0,this._maxNumberIndices=0,this._currentNumberIndices=0,this._numberTriangle=0,this._indexBuffer=null,this._indexArrayBuffer=null,this._boundingBoxCorners=null,this._leafs=null,this._leafNum=0,this._terrainHeightData=null,this._terrainHeightDataWidth=0,this._terrainHeightDataHeight=0,this._chunkOffsetX=0,this._chunkOffsetZ=0,this._cameraCoordinateInverse=!1,this._cameraPos=null,this._currentLOD=0,this._perspectiveFactor=0/0,this._LODTolerance=0,this._boundingSphere=null,this._boundingBox=null,e.__super.call(this),this._owner=t,this._cameraPos=new Vector3,this._chunkOffsetX=i,this._chunkOffsetZ=n,this._gridSize=r,this._terrainHeightData=a,this._terrainHeightDataWidth=s,this._terrainHeightDataHeight=o,this._leafNum=TerrainLeaf.CHUNK_GRID_NUM/TerrainLeaf.LEAF_GRID_NUM*(TerrainLeaf.CHUNK_GRID_NUM/TerrainLeaf.LEAF_GRID_NUM),this._leafs=__newvec(this._leafNum),this._cameraCoordinateInverse=l;for(var _=0;_<this._leafNum;_++)this._leafs[_]=new TerrainLeaf;this.recreateResource()}__class(e,"laya.d3.terrain.TerrainFilter",t);var i=e.prototype;return i.recreateResource=function(){this._currentNumberIndices=0,this._numberTriangle=0;var t=TerrainLeaf.LEAF_VERTEXT_COUNT,e=TerrainLeaf.LEAF_MAX_INDEX_COUNT;this._numberVertices=t*this._leafNum,this._maxNumberIndices=e*this._leafNum,this._indexArrayBuffer=new Uint16Array(this._maxNumberIndices);var i=VertexPositionTerrain.vertexDeclaration,n=i.vertexStride/4,r=new Float32Array(this._numberVertices*n),a=TerrainLeaf.CHUNK_GRID_NUM/TerrainLeaf.LEAF_GRID_NUM,s=0,o=0,l=0;for(s=0;s<this._leafNum;s++)o=s%a,l=Math.floor(s/a),this._leafs[s].calcVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*TerrainLeaf.LEAF_GRID_NUM,l*TerrainLeaf.LEAF_GRID_NUM,this._gridSize,r,s*TerrainLeaf.LEAF_PLANE_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight,this._cameraCoordinateInverse);for(s=0;s<this._leafNum;s++)o=s%a,l=Math.floor(s/a),this._leafs[s].calcSkirtVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*TerrainLeaf.LEAF_GRID_NUM,l*TerrainLeaf.LEAF_GRID_NUM,this._gridSize,r,this._leafNum*TerrainLeaf.LEAF_PLANE_VERTEXT_COUNT+s*TerrainLeaf.LEAF_SKIRT_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight);this.assembleIndexInit(),this._vertexBuffer=new VertexBuffer3D(i.vertexStride*this._numberVertices,35044,!1),this._vertexBuffer.vertexDeclaration=i,this._indexBuffer=new IndexBuffer3D("ushort",this._maxNumberIndices,35044,!1),this._vertexBuffer.setData(r),this._indexBuffer.setData(this._indexArrayBuffer),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.calcOriginalBoudingBoxAndSphere(),this._setVertexBuffer(this._vertexBuffer)},i.setLODLevel=function(t){if(4!=t.length)return!0;var e=(t[0]+1<<24)+(t[1]+1<<16)+(t[2]+1<<8)+(t[3]+1);return this._currentLOD==e?!1:(this._currentLOD=e,!0)},i.assembleIndexInit=function(){this._currentNumberIndices=0,this._numberTriangle=0;for(var t=0,e=0;e<this._leafNum;e++){var i=TerrainLeaf.getPlaneLODIndex(e,0);this._indexArrayBuffer.set(i,t),t+=i.length;var n=TerrainLeaf.getSkirtLODIndex(e,0);this._indexArrayBuffer.set(n,t),t+=n.length,this._currentNumberIndices+=i.length+n.length}this._numberTriangle=this._currentNumberIndices/3},i.isNeedAssemble=function(t,e){var i=Math.min(t.viewport.width,t.viewport.height)/(2*Math.tan(Math.PI*t.fieldOfView/180));return this._perspectiveFactor!=i?(this._perspectiveFactor=i,1):this._LODTolerance!=Terrain.LOD_TOLERANCE_VALUE?(this._LODTolerance=Terrain.LOD_TOLERANCE_VALUE,1):0==Vector3.equals(e,this._cameraPos)?(this._cameraPos.x=e.x,this._cameraPos.y=e.y,this._cameraPos.z=e.z,2):0},i.assembleIndex=function(t,i){var n=this.isNeedAssemble(t,i);if(n>0){for(var r=0;r<this._leafNum;r++)e._TEMP_ARRAY_BUFFER[r]=this._leafs[r].determineLod(i,this._perspectiveFactor,Terrain.LOD_TOLERANCE_VALUE,1==n);if(this.setLODLevel(e._TEMP_ARRAY_BUFFER)){this._currentNumberIndices=0,this._numberTriangle=0;var a=0;for(r=0;r<this._leafNum;r++){var s=e._TEMP_ARRAY_BUFFER[r],o=TerrainLeaf.getPlaneLODIndex(r,s);this._indexArrayBuffer.set(o,a),a+=o.length;var l=TerrainLeaf.getSkirtLODIndex(r,s);this._indexArrayBuffer.set(l,a),a+=l.length,this._currentNumberIndices+=o.length+l.length}return this._numberTriangle=this._currentNumberIndices/3,!0}}return!1},i.calcOriginalBoudingBoxAndSphere=function(){for(var t=new Vector2(2147483647,-2147483647),e=0;e<this._leafNum;e++)t.x=this._leafs[e]._sizeOfY.x<t.x?this._leafs[e]._sizeOfY.x:t.x,t.y=this._leafs[e]._sizeOfY.y>t.y?this._leafs[e]._sizeOfY.y:t.y;var i=new Vector3(this._chunkOffsetX*TerrainLeaf.CHUNK_GRID_NUM*this._gridSize,t.x,this._chunkOffsetZ*TerrainLeaf.CHUNK_GRID_NUM*this._gridSize),n=new Vector3((this._chunkOffsetX+1)*TerrainLeaf.CHUNK_GRID_NUM*this._gridSize,t.y,(this._chunkOffsetZ+1)*TerrainLeaf.CHUNK_GRID_NUM*this._gridSize);TerrainLeaf.__ADAPT_MATRIX__&&(Vector3.transformV3ToV3(i,TerrainLeaf.__ADAPT_MATRIX__,i),Vector3.transformV3ToV3(n,TerrainLeaf.__ADAPT_MATRIX__,n)),this._boundingBox=new BoundBox(i,n);var r=new Vector3;Vector3.subtract(n,i,r),Vector3.scale(r,.5,r);var a=new Vector3;Vector3.add(i,r,a),this._boundingSphere=new BoundSphere(a,Vector3.scalarLength(r)),this._boundingBoxCorners=__newvec(8,null),this._boundingBox.getCorners(this._boundingBoxCorners)},i.calcLeafBoudingBox=function(t){for(var e=0;e<this._leafNum;e++)this._leafs[e].calcLeafBoudingBox(t)},i.calcLeafBoudingSphere=function(t,e){for(var i=0;i<this._leafNum;i++)this._leafs[i].calcLeafBoudingSphere(t,e)},i._getVertexBuffer=function(t){return void 0===t&&(t=0),0==t?this._vertexBuffer:null},i._getIndexBuffer=function(){return this._indexBuffer},i._prepareRender=function(t){this._indexBuffer.bind();var e=t.renderElement.material;if(e.blend==BaseMaterial.BLEND_DISABLE){var i=t.camera;this.assembleIndex(i,i.transform.position)&&this._indexBuffer.setData(this._indexArrayBuffer)}return!0},i._render=function(){VertexPositionTerrain.vertexDeclaration;LayaGL.instance.drawElements(Terrain.RENDER_LINE_MODEL?1:4,this._currentNumberIndices,5123,0),Stat.trianglesFaces+=this._numberTriangle,Stat.drawCall++},i.destroy=function(){this._owner=null,this._vertexBuffer&&this._vertexBuffer.destroy(),this._indexBuffer&&this._indexBuffer.destroy()},__getset(0,i,"_vertexBufferCount",function(){return this._numberVertices}),__getset(0,i,"triangleCount",function(){return this._numberTriangle}),__static(e,["_TEMP_ARRAY_BUFFER",function(){return this._TEMP_ARRAY_BUFFER=new Uint32Array(TerrainLeaf.CHUNK_GRID_NUM/TerrainLeaf.LEAF_GRID_NUM*TerrainLeaf.CHUNK_GRID_NUM/TerrainLeaf.LEAF_GRID_NUM)}]),e}(GeometryElement),Vector2=function(t){function e(t,i){e.__super.call(this),void 0===t&&(t=0),void 0===i&&(i=0);var n=this.elements=new Float32Array(2);n[0]=t,n[1]=i}__class(e,"laya.d3.math.Vector2",t);var i=e.prototype;return Laya.imps(i,{"laya.d3.core.IClone":!0}),i.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1]},i.cloneTo=function(t){var e=t,i=e.elements,n=this.elements;i[0]=n[0],i[1]=n[1]},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,i,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),__getset(0,i,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),e.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e},__static(e,["ZERO",function(){return this.ZERO=new e(0,0)},"ONE",function(){return this.ONE=new e(1,1)}]),e}(BaseVector),Vector3=function(t){function e(t,i,n){e.__super.call(this),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0);var r=this.elements=new Float32Array(3);r[0]=t,r[1]=i,r[2]=n}__class(e,"laya.d3.math.Vector3",t);var i=e.prototype;return Laya.imps(i,{"laya.d3.core.IClone":!0}),i.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2]},i.cloneTo=function(t){var e=t,i=e.elements,n=this.elements;i[0]=n[0],i[1]=n[1],i[2]=n[2]},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},i.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},__getset(0,i,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),__getset(0,i,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),__getset(0,i,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),e.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2];return r*r+a*a+s*s},e.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2];return Math.sqrt(r*r+a*a+s*s)},e.min=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2])},e.max=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2])},e.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],l=r[2],_=a[0],h=a[1],u=a[2],c=a[3],d=c*s+h*l-u*o,f=c*o+u*s-_*l,m=c*l+_*o-h*s,p=-_*s-h*o-u*l;n[0]=d*c+p*-_+f*-u-m*-h,n[1]=f*c+p*-h+m*-_-d*-u,n[2]=m*c+p*-u+d*-h-f*-_},e.scalarLength=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return Math.sqrt(i*i+n*n+r*r)},e.scalarLengthSquared=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return i*i+n*n+r*r},e.normalize=function(t,e){var i=t.elements,n=e.elements,r=i[0],a=i[1],s=i[2],o=r*r+a*a+s*s;o>0&&(o=1/Math.sqrt(o),n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o)},e.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2]},e.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e},e.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],_=a[2];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=_+i*(s[2]-_)},e.transformV3ToV3=function(t,i,n){var r=e._tempVector4;e.transformV3ToV4(t,i,r);var a=r.elements,s=n.elements;s[0]=a[0],s[1]=a[1],s[2]=a[2]},e.transformV3ToV4=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=i.elements;l[0]=r*o[0]+a*o[4]+s*o[8]+o[12],l[1]=r*o[1]+a*o[5]+s*o[9]+o[13],l[2]=r*o[2]+a*o[6]+s*o[10]+o[14],l[3]=r*o[3]+a*o[7]+s*o[11]+o[15]},e.TransformNormal=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=i.elements;l[0]=r*o[0]+a*o[4]+s*o[8],l[1]=r*o[1]+a*o[5]+s*o[9],l[2]=r*o[2]+a*o[6]+s*o[10]},e.transformCoordinate=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=r*o[3]+a*o[7]+s*o[11]+o[15],_=i.elements;_[0]=r*o[0]+a*o[4]+s*o[8]+o[12]/l,_[1]=r*o[1]+a*o[5]+s*o[9]+o[13]/l,_[2]=r*o[2]+a*o[6]+s*o[10]+o[14]/l},e.Clamp=function(t,e,i,n){var r=t.elements,a=r[0],s=r[1],o=r[2],l=e.elements,_=l[0],h=l[1],u=l[2],c=i.elements,d=c[0],f=c[1],m=c[2],p=n.elements;a=a>d?d:a,a=_>a?_:a,s=s>f?f:s,s=h>s?h:s,o=o>m?m:o,o=u>o?u:o,p[0]=a,p[1]=s,p[2]=o},e.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2]},e.subtract=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2]},e.cross=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=n[0],o=n[1],l=n[2],_=r[0],h=r[1],u=r[2];a[0]=o*u-l*h,a[1]=l*_-s*u,a[2]=s*h-o*_},e.dot=function(t,e){var i=t.elements,n=e.elements,r=i[0]*n[0]+i[1]*n[1]+i[2]*n[2];return r},e.equals=function(t,e){var i=t.elements,n=e.elements;return MathUtils3D.nearEqual(i[0],n[0])&&MathUtils3D.nearEqual(i[1],n[1])&&MathUtils3D.nearEqual(i[2],n[2])},e.ZERO=new e(0,0,0),e.ONE=new e(1,1,1),e.NegativeUnitX=new e(-1,0,0),e.UnitX=new e(1,0,0),e.UnitY=new e(0,1,0),e.UnitZ=new e(0,0,1),e.ForwardRH=new e(0,0,-1),e.ForwardLH=new e(0,0,1),e.Up=new e(0,1,0),e.NAN=new e(0/0,0/0,0/0),__static(e,["_tempVector4",function(){return this._tempVector4=new Vector4}]),e}(BaseVector),Vector4=function(t){function e(t,i,n,r){e.__super.call(this),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var a=this.elements=new Float32Array(4);a[0]=t,a[1]=i,a[2]=n,a[3]=r}__class(e,"laya.d3.math.Vector4",t);var i=e.prototype;return Laya.imps(i,{"laya.d3.core.IClone":!0}),i.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},i.cloneTo=function(t){var e=t,i=e.elements,n=this.elements;i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3]},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},__getset(0,i,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),__getset(0,i,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),__getset(0,i,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),__getset(0,i,"w",function(){return this.elements[3]},function(t){this.elements[3]=t}),e.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],_=a[2],h=a[3];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=_+i*(s[2]-_),r[3]=h+i*(s[3]-h)},e.transformByM4x4=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=e.elements,_=i.elements;_[0]=r*l[0]+a*l[4]+s*l[8]+o*l[12],_[1]=r*l[1]+a*l[5]+s*l[9]+o*l[13],_[2]=r*l[2]+a*l[6]+s*l[10]+o*l[14],_[3]=r*l[3]+a*l[7]+s*l[11]+o*l[15]},e.equals=function(t,e){var i=t.elements,n=e.elements;return MathUtils3D.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&MathUtils3D.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&MathUtils3D.nearEqual(Math.abs(i[2]),Math.abs(n[2]))&&MathUtils3D.nearEqual(Math.abs(i[3]),Math.abs(n[3]))},e.normalize=function(t,e){var i=t.elements,n=e.elements,r=t.length();r>0&&(n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=i[3]*r)},e.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3]},e.subtract=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3]},e.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2],n[3]=r[3]*a[3]},e.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n[3]=r[3]*e},e.Clamp=function(t,e,i,n){var r=t.elements,a=r[0],s=r[1],o=r[2],l=r[3],_=e.elements,h=_[0],u=_[1],c=_[2],d=_[3],f=i.elements,m=f[0],p=f[1],g=f[2],v=f[3],x=n.elements;a=a>m?m:a,a=h>a?h:a,s=s>p?p:s,s=u>s?u:s,o=o>g?g:o,o=c>o?c:o,l=l>v?v:l,l=d>l?d:l,x[0]=a,x[1]=s,x[2]=o,x[3]=l},e.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return r*r+a*a+s*s+o*o},e.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return Math.sqrt(r*r+a*a+s*s+o*o)},e.dot=function(t,e){var i=t.elements,n=e.elements,r=i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3];return r},e.min=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2]),n[3]=Math.min(r[3],a[3])},e.max=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2]),n[3]=Math.max(r[3],a[3])},__static(e,["ZERO",function(){return this.ZERO=new e},"ONE",function(){return this.ONE=new e(1,1,1,1)},"UnitX",function(){return this.UnitX=new e(1,0,0,0)},"UnitY",function(){return this.UnitY=new e(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new e(0,0,1,0)},"UnitW",function(){return this.UnitW=new e(0,0,0,1)}]),e}(BaseVector),GeometryBox=function(t){function e(t,i,n){this._long=0/0,this._width=0/0,this._height=0/0,e.__super.call(this,"Box"),this._long=t.x*n.x,this._height=t.y*n.y,this._width=t.z*n.z,Vector3.multiply(i,n,this._center)}__class(e,"laya.d3.physics.geometry.GeometryBox",t);var i=e.prototype;return i.calculateDefaultMass=function(){return this._long*this._width*this._height},__getset(0,i,"long",function(){return this._long},function(t){this._long=t}),__getset(0,i,"width",function(){return this._width},function(t){this._width=t}),__getset(0,i,"height",function(){return this._height},function(t){this._height=t}),e}(Geometry),GeometryCapsule=function(t){function e(t,i,n,r){this._radius=0/0,this._height=0/0,e.__super.call(this,"Capsule"),this._height=t*r.y,this._radius=i*Math.max(r.x,r.z),Vector3.multiply(n,r,this._center)}__class(e,"laya.d3.physics.geometry.GeometryCapsule",t);var i=e.prototype;return i.calculateDefaultMass=function(){return 0},__getset(0,i,"radius",function(){return this._radius},function(t){this._radius=t}),__getset(0,i,"height",function(){return this._height},function(t){this._height=t}),e}(Geometry),GeometrySphere=function(t){function e(t,i,n){this._radius=0/0,e.__super.call(this,"Sphere");var r=Math.max(Math.max(n.x,n.y),n.z);this._radius=t*r,Vector3.multiply(i,n,this._center)}__class(e,"laya.d3.physics.geometry.GeometrySphere",t);var i=e.prototype;return i.calculateDefaultMass=function(){return 4/3*Math.PI*Math.pow(this._radius,3)},__getset(0,i,"radius",function(){return this._radius},function(t){this._radius=t}),e}(Geometry),Sprite=function(t){function e(){this._x=0,this._y=0,this._width=0,this._height=0,this._visible=!0,this._mouseState=0,this._zOrder=0,this._renderType=0,this._transform=null,this._tfChanged=!1,this._texture=null,this._boundStyle=null,this._graphics=null,this._customRenderCmd=null,this._customCmds=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this._repaintSpecial=0,e.__super.call(this),this._repaint=0,this._style=SpriteStyle.EMPTY,this._cacheStyle=CacheStyle.EMPTY,Render.isConchApp&&(this._customCmds=[])}__class(e,"laya.display.Sprite",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._style&&this._style.recover(),this._cacheStyle&&this._cacheStyle.recover(),this._boundStyle&&this._boundStyle.recover(),this._style=null,this._cacheStyle=null,this._boundStyle=null,this._transform=null,this._graphics=null},i.updateZOrder=function(){Utils.updateOrder(this._children)&&this.repaint()},i._getBoundsStyle=function(){return this._boundStyle||(this._boundStyle=BoundsStyle.create()),this._boundStyle},i._setCustomRender=function(){},i._setCacheAs=function(){},i._checkCanvasEnable=function(){var t=this._cacheStyle.needEnableCanvasRender();this._getCacheStyle().enableCanvasRender=t,t?(this._cacheStyle.cacheAs=this._cacheStyle.needBitmapCache()?"bitmap":this._cacheStyle.userSetCache,this._cacheStyle.reCache=!0,this._renderType|=8):(this._cacheStyle.cacheAs="none",this._cacheStyle.releaseContext(),this._renderType&=-9),this._setRenderType(this._renderType)},i.reCache=function(){this._cacheStyle.reCache=!0,this._repaint|=2},i._setX=function(t){this._x=t},i._setY=function(t){this._y=t},i.setSelfBounds=function(t){this._getBoundsStyle().userBounds=t},i.getBounds=function(){return this._getBoundsStyle().bounds=Rectangle._getWrapRec(this._boundPointsToParent())},i.getSelfBounds=function(){return this._boundStyle&&this._boundStyle.userBounds?this._boundStyle.userBounds:this._graphics||0!==this._children.length?this._getBoundsStyle().bounds=Rectangle._getWrapRec(this._getBoundPointsM(!1)):Rectangle.TEMP.setTo(0,0,0,0)},i._boundPointsToParent=function(t){void 0===t&&(t=!1);var e=0,i=0;this._style&&(e=this.pivotX,i=this.pivotY,t=t||0!==this._style.rotation,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var n=this._getBoundPointsM(t);if(!n||n.length<1)return n;if(8!=n.length&&(n=t?GrahamScan.scanPList(n):Rectangle._getWrapRec(n,Rectangle.TEMP)._getBoundPoints()),!this.transform)return Utils.transPointList(n,this._x-e,this._y-i),n;var r=Point.TEMP,a=0,s=n.length;for(a=0;s>a;a+=2)r.x=n[a],r.y=n[a+1],this.toParentPoint(r),n[a]=r.x,n[a+1]=r.y;return n},i.getGraphicBounds=function(t){return void 0===t&&(t=!1),this._graphics?this._graphics.getBounds(t):Rectangle.TEMP.setTo(0,0,0,0)},i._getBoundPointsM=function(t){if(void 0===t&&(t=!1),this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds._getBoundPoints();if(this._boundStyle||this._getBoundsStyle(),this._boundStyle.temBM||(this._boundStyle.temBM=[]),this._style.scrollRect){var e=Utils.clearArray(this._boundStyle.temBM),i=Rectangle.TEMP;return i.copyFrom(this._style.scrollRect),Utils.concatArray(e,i._getBoundPoints()),e}var n;n=this._graphics?this._graphics.getBoundPoints():Utils.clearArray(this._boundStyle.temBM);var r,a,s;s=this._children;for(var o=0,l=s.length;l>o;o++)r=s[o],r instanceof laya.display.Sprite&&r._visible===!0&&(a=r._boundPointsToParent(t),a&&(n=n?Utils.concatArray(n,a):a));return n},i._getCacheStyle=function(){return this._cacheStyle===CacheStyle.EMPTY&&(this._cacheStyle=CacheStyle.create()),this._cacheStyle},i.getStyle=function(){return this._style===SpriteStyle.EMPTY&&(this._style=SpriteStyle.create()),this._style},i.setStyle=function(t){this._style=t},i._setScaleX=function(t){this._style.scaleX=t},i._setScaleY=function(t){this._style.scaleY=t},i._setRotation=function(t){this._style.rotation=t},i._setSkewX=function(t){this._style.skewX=t},i._setSkewY=function(t){this._style.skewY=t},i._createTransform=function(){return Matrix.create()},i._adjustTransform=function(){"use strict";this._tfChanged=!1;var t,e=this._style,i=e.scaleX,n=e.scaleY;if(e.rotation||1!==i||1!==n||e.skewX||e.skewY){t=this._transform||(this._transform=this._createTransform()),t._bTransform=!0;var r=.0174532922222222*(e.rotation-e.skewX),a=.0174532922222222*(e.rotation+e.skewY),s=Math.cos(a),o=Math.sin(a),l=Math.sin(r),_=Math.cos(r);return t.a=i*s,t.b=i*o,t.c=-n*l,t.d=n*_,t.tx=t.ty=0,t}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-3,this._setRenderType(this._renderType),t},i._setTransform=function(){},i._setPivotX=function(t){var e=this.getStyle();e.pivotX=t},i._getPivotX=function(){return this._style.pivotX},i._setPivotY=function(t){var e=this.getStyle();e.pivotY=t},i._getPivotY=function(){return this._style.pivotY},i._setAlpha=function(t){if(this._style.alpha!==t){var e=this.getStyle();e.alpha=t,1!==t?this._renderType|=1:this._renderType&=-2,this._setRenderType(this._renderType),this.parentRepaint()}},i._getAlpha=function(){return this._style.alpha},i._setGraphics=function(){},i.setLayaGL3D=function(t){t?(Render.isConchApp&&(this.data._int32Data[25]=t._buffer._buffer._ptrID),this._renderType|=1024):this._renderType&=-1025,this._setRenderType(this._renderType),this.repaint()
},i._setScrollRect=function(){},i.pos=function(t,e,i){if(void 0===i&&(i=!1),this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._setX(t),this._setY(e);var n=this._parent;!n||2&n._repaint||(n._repaint|=2,n.parentRepaint()),this._cacheStyle.maskParent&&(n=this._cacheStyle.maskParent,2&n._repaint||(n._repaint|=2,n.parentRepaint()))}else this.x=t,this.y=e}return this},i.pivot=function(t,e){return this.pivotX=t,this.pivotY=e,this},i.size=function(t,e){return this.width=t,this.height=e,this},i.scale=function(t,e,i){void 0===i&&(i=!1);var n=this.getStyle();if(n.scaleX!=t||n.scaleY!=e){if(this.destroyed)return this;i?(this._setScaleX(t),this._setScaleY(e),this._setTranformChange()):(this.scaleX=t,this.scaleY=e)}return this},i.skew=function(t,e){return this.skewX=t,this.skewY=e,this},i.render=function(t,e,i){Stat.spriteCount++,RenderSprite.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},i.repaintSpecial=function(){0==this._repaintSpecial&&(this._repaintSpecial=1,this.parentRepaintSpecial())},i.parentRepaintSpecial=function(){var t=this._parent;t&&0==t._repaintSpecial&&(t._repaintSpecial=1,t.parentRepaintSpecial())},i.renderToNative=function(t,e,i){var n=LayaGL.getFrameCount()-1,r=this.data._int32Data,a=r[3];if(1==this._repaintSpecial||1&a||r[4]!=n){if(this._repaintSpecial=0,2048&this._renderType){this._customRenderCmd.beginEncoding(),this._customRenderCmd.clearEncoding(),t._commandEncoder=this._customRenderCmd,t._customCmds=this._customCmds;for(var s=0,o=this._customCmds.length;o>s;s++)this._customCmds[s].recover();this._customCmds.length=0,this.customRender(t,e,i),this._customRenderCmd.endEncoding(),this.repaintSpecial()}this._children.length>0?(t.blockStart(this.data),this._renderChilds(t),t.blockEnd(this.data)):t.block(this.data)}else this._children.length>0?t.copyCmdBuffer(this.data._int32Data[1],this.data._int32Data[2]):t.block(this.data)},i._renderChilds=function(t){var e,i=this._children,n=0,r=i.length,a=this._style;if(a.viewport)for(var s=a.viewport,o=s.x,l=s.y,_=s.right,h=s.bottom,u=0/0,c=0/0;r>n;++n)(e=i[n])._visible&&(u=e._x)<_&&u+e.width>o&&(c=e._y)<h&&c+e.height>l&&e.renderToNative(t);else for(;r>n;++n)(e=i[n])._visible&&e.renderToNative(t)},i.drawToCanvas=function(t,e,i,n){return RunDriver.drawToCanvas(this,this._renderType,t,e,i,n)},i.customRender=function(){this._repaint=!0},i._applyFilters=function(){if(!Render.isWebGL){var t;if(t=this._cacheStyle.filters,t&&!(t.length<1))for(var e=0,i=t.length;i>e;e++)t[e].action.apply(this._cacheStyle)}},i._setColorFilter=function(){},i._isHaveGlowFilter=function(){var t=0,e=0;if(this.filters)for(t=0;t<this.filters.length;t++)if(8==this.filters[t].type)return!0;for(t=0,e=this._children.length;e>t;t++)if(this._children[t]._isHaveGlowFilter())return!0;return!1},i.localToGlobal=function(t,e){void 0===e&&(e=!1),e===!0&&(t=new Point(t.x,t.y));for(var i=this;i&&i!=Laya.stage;)t=i.toParentPoint(t),i=i.parent;return t},i.globalToLocal=function(t,e){void 0===e&&(e=!1),e&&(t=new Point(t.x,t.y));for(var i=this,n=[];i&&i!=Laya.stage;)n.push(i),i=i.parent;for(var r=n.length-1;r>=0;)i=n[r],t=i.fromParentPoint(t),r--;return t},i.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t},i.fromParentPoint=function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t},i.on=function(e,i,n,r){return 1!==this._mouseState&&this.isMouseEvent(e)?(this.mouseEnabled=!0,this._setBit(4,!0),this._parent&&this._$2__onDisplay(),this._createListener(e,i,n,r,!1)):t.prototype.on.call(this,e,i,n,r)},i.once=function(e,i,n,r){return 1!==this._mouseState&&this.isMouseEvent(e)?(this.mouseEnabled=!0,this._setBit(4,!0),this._parent&&this._$2__onDisplay(),this._createListener(e,i,n,r,!0)):t.prototype.once.call(this,e,i,n,r)},i._$2__onDisplay=function(){if(1!==this._mouseState){var t=this;for(t=t.parent;t&&1!==t._mouseState&&!t._getBit(4);)t.mouseEnabled=!0,t._setBit(4,!0),t=t.parent}},i._setParent=function(e){t.prototype._setParent.call(this,e),e&&this._getBit(4)&&this._$2__onDisplay()},i.loadImage=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var a=Loader.getRes(t);return a||(a=new Texture,a.load(t),Loader.cacheRes(t,a)),a.once("loaded",this,this.repaint),this.texture=a,this},i.repaint=function(t){void 0===t&&(t=2),this._repaint&t||(this._repaint|=t,this.parentRepaint(t)),this._cacheStyle&&this._cacheStyle.maskParent&&this._cacheStyle.maskParent.repaint(t)},i.repaintForNative=function(t){void 0===t&&(t=2),this.data._int32Data[3]&t==t||(this.data._int32Data[3]|=t,this.parentRepaintForNative(t))},i._needRepaint=function(){return 2&this._repaint&&this._cacheStyle.enableCanvasRender&&this._cacheStyle.reCache},i._childChanged=function(t){this._children.length?this._renderType|=8192:this._renderType&=-8193,this._setRenderType(this._renderType),t&&this._getBit(2)&&Laya.timer.callLater(this,this.updateZOrder),this.repaint(3)},i.parentRepaint=function(t){void 0===t&&(t=2);var e=this._parent;!e||e._repaint&t||(e._repaint|=t,e.parentRepaint(t))},i.parentRepaintForNative=function(t){void 0===t&&(t=2);var e=this._parent;!e||e.data._int32Data[3]&t==t||(e.data._int32Data[3]|=t,e.parentRepaintForNative(t))},i.startDrag=function(t,e,i,n,r,a,s){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=300),void 0===a&&(a=!1),void 0===s&&(s=.92),this._style.dragging||(this.getStyle().dragging=new Dragging),this._style.dragging.start(this,t,e,i,n,r,a,s)},i.stopDrag=function(){this._style.dragging&&this._style.dragging.stop()},i._setDisplay=function(e){e||this._cacheStyle&&(this._cacheStyle.releaseContext(),this._cacheStyle.releaseFilterCache(),this._cacheStyle.hasGlowFilter&&(this._cacheStyle.hasGlowFilter=!1)),t.prototype._setDisplay.call(this,e)},i.hitTestPoint=function(t,e){var i=this.globalToLocal(Point.TEMP.setTo(t,e));t=i.x,e=i.y;var n=this._style.hitArea?this._style.hitArea:this._width>0&&this._height>0?Rectangle.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds();return n.contains(t,e)},i.getMousePoint=function(){return this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY))},i._setTexture=function(){},i._setRenderType=function(){},i._setTranformChange=function(){this._tfChanged=!0,this._renderType|=2,this._setRenderType(this._renderType);var t=this._parent;!t||2&t._repaint||(t._repaint|=2,t.parentRepaint())},__getset(0,i,"customRenderEnable",null,function(t){t&&(this._renderType|=2048,this._setRenderType(this._renderType),this._setCustomRender())}),__getset(0,i,"cacheAs",function(){return this._cacheStyle.cacheAs},function(t){t!==this._cacheStyle.userSetCache&&(this._setCacheAs(t),this._getCacheStyle().userSetCache=t,this._checkCanvasEnable(),this.repaint())}),__getset(0,i,"zOrder",function(){return this._zOrder},function(t){this._zOrder!=t&&(this._zOrder=t,this._parent&&(t&&this._parent._setBit(2,!0),Laya.timer.callLater(this._parent,this.updateZOrder)))}),__getset(0,i,"rotation",function(){return this._style.rotation},function(t){var e=this.getStyle();e.rotation!==t&&(this._setRotation(t),this._setTranformChange())}),__getset(0,i,"width",function(){return this.autoSize?this._graphics||0!==this._children.length?this.getSelfBounds().width:0:this._width},function(t){this._width!==t&&(this._width=t,this.repaint())}),__getset(0,i,"x",function(){return this._x},function(t){if(!this.destroyed&&this._x!==t){this._setX(t);var e=this._parent;!e||2&e._repaint||(e._repaint|=2,e.parentRepaint()),e=this._cacheStyle.maskParent,!e||2&e._repaint||(e._repaint|=2,e.parentRepaint())}}),__getset(0,i,"globalScaleY",function(){for(var t=1,e=this;e&&e!==Laya.stage;)t*=e.scaleY,e=e.parent;return t}),__getset(0,i,"hitArea",function(){return this._style.hitArea},function(t){this.getStyle().hitArea=t}),__getset(0,i,"staticCache",function(){return this._cacheStyle.staticCache},function(t){this._getCacheStyle().staticCache=t,t||this.reCache()}),__getset(0,i,"texture",function(){return this._texture},function(t){"string"==typeof t?this.loadImage(t):this._texture!=t&&(this._texture=t,this._setTexture(t),t?this._renderType|=256:this._renderType&=-257,this._setRenderType(this._renderType))}),__getset(0,i,"y",function(){return this._y},function(t){if(!this.destroyed&&this._y!==t){this._setY(t);var e=this._parent;!e||2&e._repaint||(e._repaint|=2,e.parentRepaint()),e=this._cacheStyle.maskParent,!e||2&e._repaint||(e._repaint|=2,e.parentRepaint())}}),__getset(0,i,"height",function(){return this.autoSize?this._graphics||0!==this._children.length?this.getSelfBounds().height:0:this._height},function(t){this._height!==t&&(this._height=t,this.repaint())}),__getset(0,i,"blendMode",function(){return this._style.blendMode},function(t){this.getStyle().blendMode=t,t&&"source-over"!=t?this._renderType|=4:this._renderType&=-5,this._setRenderType(this._renderType),this.parentRepaint()}),__getset(0,i,"scaleX",function(){return this._style.scaleX},function(t){var e=this.getStyle();e.scaleX!==t&&(this._setScaleX(t),this._setTranformChange())}),__getset(0,i,"scaleY",function(){return this._style.scaleY},function(t){var e=this.getStyle();e.scaleY!==t&&(this._setScaleY(t),this._setTranformChange())}),__getset(0,i,"stage",function(){return Laya.stage}),__getset(0,i,"skewX",function(){return this._style.skewX},function(t){var e=this.getStyle();e.skewX!==t&&(this._setSkewX(t),this._setTranformChange())}),__getset(0,i,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t,this._setScrollRect(t),this.repaint(),t?this._renderType|=64:this._renderType&=-65,this._setRenderType(this._renderType)}),__getset(0,i,"skewY",function(){return this._style.skewY},function(t){var e=this.getStyle();e.skewY!==t&&(this._setSkewY(t),this._setTranformChange())}),__getset(0,i,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=!1;var e=this._transform||(this._transform=this._createTransform());t.copyTo(e),this._setTransform(e),t&&(this._x=t.tx,this._y=t.ty,t.tx=t.ty=0),t?this._renderType|=2:this._renderType&=-3,this._setRenderType(this._renderType),this.parentRepaint()}),__getset(0,i,"pivotX",function(){return this._getPivotX()},function(t){this._setPivotX(t),this.repaint()}),__getset(0,i,"pivotY",function(){return this._getPivotY()},function(t){this._setPivotY(t),this.repaint()}),__getset(0,i,"alpha",function(){return this._getAlpha()},function(t){t=0>t?0:t>1?1:t,this._setAlpha(t)}),__getset(0,i,"visible",function(){return this._visible},function(t){this._visible!==t&&(this._visible=t,this.parentRepaint(3))}),__getset(0,i,"graphics",function(){return this._graphics||(this.graphics=RunDriver.createGraphics())},function(t){this._graphics&&(this._graphics._sp=null),this._graphics=t,t?(this._setGraphics(t),this._renderType|=512,t._sp=this):this._renderType&=-513,this._setRenderType(this._renderType),this.repaint()}),__getset(0,i,"filters",function(){return this._cacheStyle.filters},function(t){t&&0===t.length&&(t=null),this._cacheStyle.filters!=t&&(this._getCacheStyle().filters=t?t.slice():null,(Render.isWebGL||Render.isConchApp)&&(t&&t.length?(this._setColorFilter(t[0]),this._renderType|=16):(this._setColorFilter(null),this._renderType&=-17),this._setRenderType(this._renderType)),t&&t.length>0?(this._getBit(1)||this._setBitUp(1),Render.isWebGL&&1==t.length&&t[0]instanceof laya.filters.ColorFilter||(this._getCacheStyle().cacheForFilters=!0,this._checkCanvasEnable())):this._cacheStyle.cacheForFilters&&(this._cacheStyle.cacheForFilters=!1,this._checkCanvasEnable()),this.repaint())}),__getset(0,i,"mask",function(){return this._cacheStyle.mask},function(t){t&&this.mask&&this.mask._cacheStyle.maskParent||(this._getCacheStyle().mask=t,this._checkCanvasEnable(),t?t._getCacheStyle().maskParent=this:this.mask&&(this.mask._getCacheStyle().maskParent=null),this._renderType|=32,this._setRenderType(this._renderType),this.parentRepaint(3))}),__getset(0,i,"mouseEnabled",function(){return this._mouseState>1},function(t){this._mouseState=t?2:1}),__getset(0,i,"globalScaleX",function(){for(var t=1,e=this;e&&e!==Laya.stage;)t*=e.scaleX,e=e.parent;return t}),__getset(0,i,"mouseX",function(){return this.getMousePoint().x}),__getset(0,i,"mouseY",function(){return this.getMousePoint().y}),__getset(0,i,"viewport",function(){return this._style.viewport},function(t){this.getStyle().viewport=t}),e.fromImage=function(t){return(new e).loadImage(t)},e}(Node),ConchSpriteAdpt=function(t){function e(){this._drawSimpleImageData=null,this._dataf32=null,this._datai32=null,this._x=0,this._y=0,this._renderType=0,e.__super.call(this)}__class(e,"laya.runtime.ConchSpriteAdpt",t);var i=e.prototype;return i.createData=function(){var t=212;this.data=new ParamData(t,!1),this._datai32=this.data._int32Data,this._dataf32=this.data._float32Data,this._datai32[4]=-2,this._datai32[21]=4294967295,this._dataf32[7]=0,this._dataf32[8]=0,this._dataf32[9]=1,this._dataf32[10]=1,this._dataf32[15]=1,this._dataf32[16]=0,this._dataf32[17]=0,this._dataf32[18]=1,this._dataf32[19]=0,this._dataf32[20]=0,this._datai32[23]=-1,this._datai32[24]=-1,this._datai32[26]=-1,this._datai32[27]=0,this._datai32[28]=0,this._datai32[29]=1e6,this._datai32[30]=1e6},i._createTransform=function(){return MatrixConch.create(new Float32Array(6))},i._setTransform=function(t){var e=this.data._float32Data;e[14]=0,e[15]=t.a,e[16]=t.b,e[17]=t.c,e[18]=t.d,e[19]=t.tx,e[20]=t.ty},i._setGraphics=function(t){this._datai32[22]=t._commandEncoder.getPtrID()},i._setCacheAs=function(t){this._dataf32[SpriteConst.POSCACHE]="bitmap"==t?2:"normal"==t?1:0},i._setX=function(t){this._x=this._dataf32[5]=t,this._renderType|=2,this._setRenderType(this._renderType),this._dataf32[14]=1},i._setY=function(t){this._y=this._dataf32[6]=t,this._renderType|=2,this._setRenderType(this._renderType),this._dataf32[14]=1},i._setPivotX=function(t){this._renderType|=2,this._dataf32[7]=t,this._dataf32[14]=1},i._getPivotX=function(){return this._dataf32[7]},i._setPivotY=function(t){this._renderType|=2,this._dataf32[8]=t,this._dataf32[14]=1},i._getPivotY=function(){return this._dataf32[8]},i._setAlpha=function(t){var e=this.getStyle();e.alpha=t,t=t>1?1:t,t=0>t?0:t;var i=this._datai32[21],n=i>>24;n=255*t,i=16777215&i|n<<24,this._datai32[21]=i,1!==t?this._renderType|=1:this._renderType&=-2,this._setRenderType(this._renderType),this.parentRepaint()},i._setRenderType=function(t){this._datai32[0]=t,LayaGLTemplate.GLS[t]||LayaGLTemplate.createByRenderType(t)},i.parentRepaint=function(){},i._getAlpha=function(){return(this._datai32[21]>>>24)/255},i._setScaleX=function(t){this._style.scaleX=this._dataf32[9]=t,this._dataf32[14]=1},i._setScaleY=function(t){this._style.scaleY=this._dataf32[10]=t,this._dataf32[14]=1},i._setSkewX=function(t){this._style.skewX=this._dataf32[11]=t,this._dataf32[14]=1},i._setSkewY=function(t){this._style.skewY=this._dataf32[12]=t,this._dataf32[14]=1},i._setRotation=function(t){this._style.rotation=this._dataf32[13]=t,this._dataf32[14]=1},i._setTextureEx=function(t,e){var i=null,n=null;this._drawSimpleImageData||(this._drawSimpleImageData=new ParamData(116,!0),i=this._drawSimpleImageData._float32Data,n=this._drawSimpleImageData._int32Data,n[0]=3,n[1]=33984,n[2]=e?t.bitmap._glTexture:0,n[3]=1,n[4]=96,i[5]=0,i[6]=0,i[7]=0,i[8]=0,n[9]=4294967295,n[10]=4294967295,i[11]=0,i[12]=0,i[13]=1,i[14]=0,n[15]=4294967295,n[16]=4294967295,i[17]=0,i[18]=0,i[19]=1,i[20]=1,n[21]=4294967295,n[22]=4294967295,i[23]=0,i[24]=0,i[25]=0,i[26]=1,n[27]=4294967295,n[28]=4294967295),i=this._drawSimpleImageData._float32Data,n=this._drawSimpleImageData._int32Data,n[2]=e?t.bitmap._glTexture:0;var r=e?t.bitmap.width:0,a=e?t.bitmap.height:0;i[11]=i[17]=r,i[18]=i[24]=a;var s=this._drawSimpleImageData.getPtrID();this._datai32[24]=s,LayaGL.syncBufferToRenderThread(this._drawSimpleImageData),this._datai32[23]=LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.getPtrID()},i._setTexture=function(t){t&&(t.loaded?this._setTextureEx(t,!0):(this._setTextureEx(t,!1),t.on("loaded",this,this._setTextureEx,[t,!0])))},i._setCustomRender=function(){this._customRenderCmd=LayaGL.instance.createCommandEncoder(128,64,!0),this._datai32[26]=this._customRenderCmd.getPtrID()},i._setScrollRect=function(t){this._dataf32[27]=0,this._dataf32[28]=0,this._dataf32[29]=t.width,this._dataf32[30]=t.height,this._dataf32[31]=-t.x,this._dataf32[32]=-t.y},i._setColorFilter=function(t){if(t){var e=t;this._dataf32.set(e._mat,33),this._dataf32.set(e._alpha,49)}else;},i._adjustTransform=function(){var t=this._transform||(this._transform=this._createTransform());t._bTransform=!0,window.conch.calcMatrixFromScaleSkewRotation(this.data._data._ptrID,56,60,20,24,28,32,36,40,44,48,52);var e=this.data._float32Data;return t.a=e[15],t.b=e[16],t.c=e[17],t.d=e[18],t.tx=0,t.ty=0,t},e.createMatrix=function(t,e,i,n,r,a,s){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),new MatrixConch(t,e,i,n,r,a,s)},e.init=function(){ConchCmdReplace.__init__(),ConchGraphicsAdpt.__init__();var t=Sprite.prototype,i=e.prototype,n=["_createTransform","_setTransform","_setGraphics","_setCacheAs","_setX","_setY","_setPivotX","_getPivotX","_setPivotY","_getPivotY","_setAlpha","_getAlpha","_setScaleX","_setScaleY","_setSkewX","_setSkewY","_setRotation","_adjustTransform","_setRenderType","_setTexture","_setTextureEx","_setCustomRender","_setScrollRect","_setColorFilter"],r=0,a=0;a=n.length;var s;for(r=0;a>r;r++)s=n[r],t[s]=i[s];t.createGLBuffer=i.createData,Matrix._createFun=e.createMatrix},e}(Node),AudioSoundChannel=function(t){function e(t){this._audio=null,this._onEnd=null,this._resumePlay=null,e.__super.call(this),this._onEnd=Utils.bind(this.__onEnd,this),this._resumePlay=Utils.bind(this.__resumePlay,this),t.addEventListener("ended",this._onEnd),this._audio=t}__class(e,"laya.media.h5audio.AudioSoundChannel",t);var i=e.prototype;return i.__onEnd=function(){return 1===this.loops?(this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),this.event("complete"),void 0):(this.loops>0&&this.loops--,this.play(),void 0)},i.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,Browser.container.appendChild(this._audio),this._audio.play()}catch(t){this.event("error")}},i.play=function(){this.isStopped=!1;try{this._audio.playbackRate=SoundManager.playbackRate,this._audio.currentTime=this.startTime}catch(t){return this._audio.addEventListener("canplay",this._resumePlay),void 0}SoundManager.addChannel(this),Browser.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()},i.stop=function(){this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(Render.isConchApp&&this._audio.stop(),"pause"in this._audio&&this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),Browser.onIE||Pool.recover("audio:"+this.url,this._audio),Browser.removeElement(this._audio),this._audio=null)},i.pause=function(){this.isStopped=!0,SoundManager.removeChannel(this),"pause"in this._audio&&this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,SoundManager.addChannel(this),"play"in this._audio&&this._audio.play())},__getset(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),__getset(0,i,"duration",function(){return this._audio?this._audio.duration:0}),__getset(0,i,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),e}(SoundChannel),WebAudioSoundChannel=function(t){function e(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,e.__super.call(this),this.context=WebAudioSound.ctx,this._onPlayEnd=Utils.bind(this.__onPlayEnd,this),this.gain=this.context.createGain?this.context.createGain():this.context.createGainNode()}__class(e,"laya.media.webaudio.WebAudioSoundChannel",t);var i=e.prototype;return i.play=function(){if(SoundManager.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var t=this.context,e=this.gain,i=t.createBufferSource();this.bufferSource=i,i.buffer=this.audioBuffer,i.connect(e),e&&e.disconnect(),e.connect(t.destination),i.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=Browser.now(),this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.playbackRate.value=SoundManager.playbackRate,i.start(0,this.startTime),this._currentTime=0}},i.__onPlayEnd=function(){return 1===this.loops?(this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),this.event("complete"),void 0):(this.loops>0&&this.loops--,this.play(),void 0)},i._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null,e._tryCleanFailed||this._tryClearBuffer(t),this.bufferSource=null}},i._tryClearBuffer=function(t){if(!Browser.onIOS)return e._tryCleanFailed=!0,void 0;try{t.buffer=WebAudioSound._miniBuffer}catch(i){e._tryCleanFailed=!0}},i.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null},i.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this)},i.resume=function(){this.startTime=this._pauseTime,this.play()},__getset(0,i,"position",function(){return this.bufferSource?(Browser.now()-this._startTime)/1e3+this.startTime:0}),__getset(0,i,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),__getset(0,i,"volume",function(){return this._volume},function(t){this.isStopped||(this._volume=t,this.gain.gain.value=t)}),e._tryCleanFailed=!1,e}(SoundChannel),Bitmap=function(t){function e(){e.__super.call(this),this._width=-1,this._height=-1}__class(e,"laya.resource.Bitmap",t);var i=e.prototype;return i._getSource=function(){throw"Bitmap: must override it."},__getset(0,i,"width",function(){return this._width}),__getset(0,i,"height",function(){return this._height}),e}(Resource),CharPageTexture=function(t){function e(t){this.texture=null,this._source=null,this._used=null,this._startFindPos=0,this._mgr=null,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!1,e.__super.call(this),this._mgr=t,this.texture=new CharInternalTexture(this),this._used=new Uint8Array(t._gridNum),this.lock=!0}__class(e,"laya.webgl.resource.CharPageTexture",t);var i=e.prototype;return i.findAGrid=function(){for(var t=this._mgr._gridNum,e=this._startFindPos;t>e;e++)if(0==this._used[e])return this._startFindPos=e+1,this._used[e]=1,e;return-1},i.removeGrid=function(t){this._used[t]=0,t<this._startFindPos&&(this._startFindPos=t)},i.removeOld=function(t){for(var e=0,i=null,n=0,r=this.charMaps.length;r>n;n++)if(i=this.charMaps[n])for(var a in i){var s=i[a];s.touchTick<t&&(this.removeGrid(s.pos),console.log("remove char "+a),delete i[a],e++)}return e},i.recreateResource=function(){if(!this._source){var t=Render.isConchApp?LayaGL.instance.getDefaultCommandEncoder():WebGL.mainContext,e=this._source=t.createTexture();this.texture.bitmap._glTexture=this._source,WebGLContext.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._mgr._textureWidth,this._mgr._textureWidth,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)}},i.addChar=function(t,e,i){!this._source&&this.recreateResource();var n=Render.isConchApp?LayaGL.instance.getDefaultCommandEncoder():WebGL.mainContext;WebGLContext.bindTexture(n,3553,this._source),!Render.isConchApp&&n.pixelStorei(37441,!0);var r=t.data;t.data instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer)),n.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,r),!Render.isConchApp&&n.pixelStorei(37441,!1)},i.destroy=function(){console.log("destroy CharPageTexture"),this.__destroyed=!0;var t=Render.isConchApp?LayaGL.instance.getDefaultCommandEncoder():WebGL.mainContext;this._source&&t.deleteTexture(this._source)},e}(Resource),Sprite3D=function(t){function e(t){this._finishPhysicsConfiguration=!1,e.__super.call(this),this._id=++e._uniqueIDCounter,this._transform=new Transform3D(this),this.name=t?t:"Sprite3D-"+e._nameNumberCounter++,this.layer=0,this._loaded=!0}__class(e,"laya.d3.core.Sprite3D",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),i._completeLoad=function(){this._loaded=!0,this.event("hierarchyloaded",[this])},i._setLoaded=function(t){this._loaded=t},i._setUrl=function(t){this._url=t},i._getGroup=function(){return this._group},i._setGroup=function(t){this._group=t},i._changeAnimatorsToLinkSprite3D=function(t,e,i){var n=this.getComponent(Animator);if(n&&(n.avatar||t._changeAnimatorToLinkSprite3DNoAvatar(n,e,i)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){i.unshift(this._parent.name);var r=this._parent;r._hierarchyAnimator&&r._changeAnimatorsToLinkSprite3D(t,e,i)}},i._setHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(t),this._changeAnimatorAvatar(t.avatar);for(var i=0,n=this._children.length;n>i;i++){var r=this._children[i];r._hierarchyAnimator==e&&r._setHierarchyAnimator(t,e)}},i._clearHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(e),this._changeAnimatorAvatar(e?e.avatar:null);for(var i=0,n=this._children.length;n>i;i++){var r=this._children[i];r._hierarchyAnimator==t&&r._clearHierarchyAnimator(t,e)}},i._changeHierarchyAnimatorAvatar=function(t,e){this._changeAnimatorAvatar(e);for(var i=0,n=this._children.length;n>i;i++){var r=this._children[i];r._hierarchyAnimator==t&&r._changeHierarchyAnimatorAvatar(t,e)}},i._changeAnimatorToLinkSprite3DNoAvatar=function(t,e,i){t._handleSpriteOwnersBySprite(e,i,this);for(var n=0,r=this._children.length;r>n;n++){var a=this._children[n],s=i.length;i.push(a.name),a._changeAnimatorToLinkSprite3DNoAvatar(t,e,i),i.splice(s,1)}},i._changeHierarchyAnimator=function(t){this._hierarchyAnimator=t},i._changeAnimatorAvatar=function(){},i._onAdded=function(){this._parent instanceof laya.d3.core.Sprite3D&&(this.transform.parent=this._parent.transform,this._parent._hierarchyAnimator&&(!this._hierarchyAnimator&&this._setHierarchyAnimator(this._parent._hierarchyAnimator,null),this._parent._changeAnimatorsToLinkSprite3D(this,!0,[this.name]))),t.prototype._onAdded.call(this)},i._onRemoved=function(){t.prototype._onRemoved.call(this);var e=this._scene;e&&e._enablePhysics&&this._finishPhysicsConfiguration&&this.compoundShape&&e.physicsSystem.removePhysicsObject(this.physicsId),this._parent instanceof laya.d3.core.Sprite3D&&(this.transform.parent=null,this._parent._hierarchyAnimator&&(this._hierarchyAnimator==this._parent._hierarchyAnimator&&this._clearHierarchyAnimator(this._parent._hierarchyAnimator,null),this._parent._changeAnimatorsToLinkSprite3D(this,!1,[this.name])))},i._onActive=function(){this.scene._enablePhysics&&!this._finishPhysicsConfiguration&&this.compoundShape&&this.setPhysicsConfiguration()},i.setPhysicsConfiguration=function(){if(this.scene._enablePhysics){var t=this.scene,e=t.physicsSystem,i=new PhysicsData,n=this.getComponent(Rigidbody);n?(i.mass=n.isKinematic?0:n.mass,i.friction=n.friction,i.restitution=n.restitution):i.mass=0,e.addPhysicsObject(this.compoundShape,i,this.transform.position,this.transform.rotation),this.physicsId=i._physicsId,e._sprite3Ds[this.physicsId]=this,this._finishPhysicsConfiguration=!0}},i._parse=function(t){var e=this.transform.localPosition;e.fromArray(t.translate),this.transform.localPosition=e;var i=this.transform.localRotation;i.fromArray(t.rotation),this.transform.localRotation=i;var n=this.transform.localScale;n.fromArray(t.scale),this.transform.localScale=n;var r=t.layer;null!=r&&(this.layer=r)},i.loadHierarchy=function(t){this.addChild(laya.d3.core.Sprite3D.load(t))},i._onAsynLoaded=function(t){var e=t[0];if("Sprite3D"!==e.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var i=t[1],n=[];Utils3D._createNodeByJson(this,e,this,i,n),StaticBatchManager.combine(null,n)},i.cloneTo=function(t){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");for(var e=t,i=0,n=this._children.length;n>i;i++)e.addChild(this._children[i].clone());e.name=this.name,e.destroyed=this.destroyed,e.active=this._active;var r=e.transform.localPosition;this.transform.localPosition.cloneTo(r),e.transform.localPosition=r;var a=e.transform.localRotation;this.transform.localRotation.cloneTo(a),e.transform.localRotation=a;var s=e.transform.localScale;this.transform.localScale.cloneTo(s),e.transform.localScale=s,e.isStatic=this.isStatic,e.layer=this.layer,this._cloneTo(e)},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._transform=null,this._colliders=null,Loader.clearRes(this.url),this.loaded||Laya3D._cancelLoadByUrl(this.url))},__getset(0,i,"id",function(){return this._id}),__getset(0,i,"loaded",function(){return this._loaded}),__getset(0,i,"url",function(){return this._url}),__getset(0,i,"layer",function(){return this._layer},function(t){if(this._layer!==t){if(!(t>=0&&30>=t))throw new Error("Layer value must be 0-30.");if(this._activeInHierarchy){var e=0,i=this._colliders.length;if(this._layer)for(e=0;i>e;e++)Layer.getLayerByNumbe(this._layer)._removeCollider(this._colliders[e]);for(e=0;i>e;e++)Layer.getLayerByNumbe(t)._addCollider(this._colliders[e])}this._layer=t}}),__getset(0,i,"transform",function(){return this._transform}),e.instantiate=function(t,e,i,n,r){void 0===i&&(i=!0);var a=t.clone();e&&e.addChild(a);var s=a.transform;if(i){var o=s.worldMatrix;t.transform.worldMatrix.cloneTo(o),s.worldMatrix=o}else n&&(s.position=n),r&&(s.rotation=r);return a},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.WORLDMATRIX=0,e.MVPMATRIX=1,e._uniqueIDCounter=0,e._nameNumberCounter=0,e}(Node),BaseShader=function(t){function e(){e.__super.call(this)}return __class(e,"laya.webgl.shader.BaseShader",t),e.activeShader=null,e.bindShader=null,e}(Resource),Buffer=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),this._glBuffer=LayaGL.instance.createBuffer()}__class(e,"laya.webgl.utils.Buffer",t);var i=e.prototype;return i._bindForVAO=function(){switch(this._bufferType){case 34962:LayaGL.instance.bindBuffer(34962,this._glBuffer);break;case 34963:LayaGL.instance.bindBuffer(34963,this._glBuffer);break;default:console.error("error! unknown buffer type:"+this._bufferType)}},i.bind=function(){switch(this._bufferType){case 34962:if(e._bindedVertexBuffer!==this._glBuffer)return LayaGL.instance.bindBuffer(34962,this._glBuffer),e._bindedVertexBuffer=this._glBuffer,!0;break;case 34963:if(e._bindedIndexBuffer!==this._glBuffer)return LayaGL.instance.bindBuffer(34963,this._glBuffer),e._bindedIndexBuffer=this._glBuffer,!0;break;default:console.error("error! unknown buffer type:"+this._bufferType)}return!1},i._disposeResource=function(){this._glBuffer&&(LayaGL.instance.deleteBuffer(this._glBuffer),this._glBuffer=null),this._setGPUMemory(0)},__getset(0,i,"bufferUsage",function(){return this._bufferUsage}),e._bindedVertexBuffer=null,e._bindedIndexBuffer=null,__static(e,["_bindedAtributeBuffer",function(){return this._bindedAtributeBuffer=new Array(16)
},"_bindedAttributeDeclaration",function(){return this._bindedAttributeDeclaration=new Array(16)}]),e}(Resource),Scene3D=function(t){function e(t){if(this._enableLightCount=3,this._layerList=[],this._visibleLayers=2147483647,this._currentCameraCullingMask=2147483647,this.enableLight=!0,this._visible=!0,this._renderType=0,this._time=0,this._enablePhysics=!1,this._repaintSpecial=1,e.__super.call(this),this._lights=[],this._collsionTestList=[],this._opaqueQueue=new RenderQueue(!1),this._transparentQueue=new RenderQueue(!0),this._cameraPool=[],this._animatorPool=new ListPool,this._skinAnimationsPool=new ListPool,this._scriptPool=new ListPool,this.timer=new Timer,this._key=new SubmitKey,void 0===t&&(t=!1),Render.isConchApp){this._glCommandEncoder=LayaGL.instance.createCommandEncoder(102400,2560,!1);var i=212;this.data=new ParamData(i,!1),this.data._int32Data[25]=this._glCommandEncoder.getPtrID(),this._renderType|=1024,this.data._int32Data[0]=this._renderType}this._enablePhysics=t,t&&(this.physicsSystem=new PhysicsSystem),this._lightmaps=[],this._defineDatas=new DefineDatas,this._shaderValues=new ShaderDatas(null,22),this.parallelSplitShadowMaps=[],this._renders=new ListPool,this._castShadowRenderObjects=[],this._castShadowRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new Vector3(.7,.7,.7),this.ambientColor=new Vector3(.212,.227,.259),this.reflectionIntensity=1,WebGL.shaderHighPrecision&&this._defineDatas.add(Shader3D.SHADERDEFINE_HIGHPRECISION),this._initLayer(),this._loaded=!0,Render.isConchApp&&(this._cullingBufferIndices=new Int32Array(1024),this._cullingBufferResult=new Int32Array(1024))}__class(e,"laya.d3.core.scene.Scene3D",t);var i=e.prototype;return Laya.imps(i,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),i._update=function(){this.timer._update();var t=RenderContext3D._instance;t.scene=this,this._updateScript(),CollisionManager._triggerCollision(this),Animator._update(this),SkinAnimations._update(this),this._lateUpdateScript(),this._time+=this.timer._delta/1e3,this._shaderValues.setNumber(24,this._time),this._enablePhysics&&this.physicsSystem.update()},i._completeLoad=function(){this._loaded=!0,this.event("hierarchyloaded",[this])},i._setLoaded=function(t){this._loaded=t},i._initLayer=function(){this._layerList.length=31;for(var t=0;31>t;t++){var e=new Layer(this);this._layerList[t]=e,0===t?(e.name="Default Layer",e.visible=!0):(e.name="Layer-"+t,e.visible=!1),e._number=t,e._mask=Math.pow(2,t)}this.currentCreationLayer=this._layerList[0]},i._binarySearchIndexInCameraPool=function(t){for(var e=0,i=this._cameraPool.length-1,n=0;i>=e;){n=Math.floor((e+i)/2);var r=this._cameraPool[n]._renderingOrder;if(r==t._renderingOrder)return n;r>t._renderingOrder?i=n-1:e=n+1}return e},i._setUrl=function(t){this._url=t},i._getGroup=function(){return this._group},i._setGroup=function(t){this._group=t},i._setLightMap=function(t){t instanceof laya.d3.core.RenderableSprite3D&&t._render._applyLightMapParams();for(var e=t._children,i=0,n=e.length;n>i;i++)this._setLightMap(e[i])},i._updateScript=function(){for(var t=this._scriptPool,e=t.elements,i=0,n=t.length;n>i;i++){var r=e[i];r&&r.enabled&&r.update()}},i._lateUpdateScript=function(){for(var t=this._scriptPool,e=t.elements,i=0,n=t.length;n>i;i++){var r=e[i];r&&r.enabled&&r.lateUpdate()}},i._preRenderScript=function(){for(var t=this._scriptPool,e=t.elements,i=0,n=t.length;n>i;i++){var r=e[i];r&&r.enabled&&r.onPreRender()}},i._postRenderScript=function(){for(var t=this._scriptPool,e=t.elements,i=0,n=t.length;n>i;i++){var r=e[i];r&&r.enabled&&r.onPostRender()}},i.initOctree=function(t,e,i,n,r){void 0===r&&(r=6),this.treeSize=new Vector3(t,e,i),this.treeLevel=r,this.treeRoot=new OctreeNode(this,0),this.treeRoot.init(n,this.treeSize)},i._prepareSceneToRender=function(t){var e=this._lights.length;if(e>0)for(var i=0,n=0;e>n&&!(this._lights[n]._prepareToScene(t)&&(i++,i>=this._enableLightCount));n++);},i._addCamera=function(t){var e=this._binarySearchIndexInCameraPool(t);this._cameraPool.splice(e,0,t)},i._removeCamera=function(t){var e=this._binarySearchIndexInCameraPool(t);this._cameraPool.splice(e,1)},i._preCulling=function(t,e){e.useOcclusionCulling?this.treeRoot?FrustumCulling.renderObjectCullingOctree(e,this,t):FrustumCulling.renderObjectCulling(e,this,t,this._renders):FrustumCulling.renderObjectCulling(null,this,t,this._renders)},i._clear=function(t,e){var i=e.viewport,n=e.camera,r=n.renderTarget,a=i.width,s=i.height,o=i.x,l=n._canvasHeight-i.y-s;t.viewport(o,l,a,s);var _=256;switch(n.clearFlag){case 0:var h=n.clearColor;if(h){t.enable(3089),t.scissor(o,l,a,s);var u=h.elements;t.clearColor(u[0],u[1],u[2],u[3]),_|=16384}if(r)switch(h||(_=16384),r.depthStencilFormat){case 0:_|=256;break;case 1:_|=1024;break;case 2:_|=256,_|=1024}t.clear(_),h&&t.disable(3089);break;case 1:case 2:if(r)switch(_=16384,r.depthStencilFormat){case 0:_|=256;break;case 1:_|=1024;break;case 2:_|=256,_|=1024}t.clear(_);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},i._renderScene=function(t,e){{var i=e.camera;i.transform.position}if(i.renderTarget?this._opaqueQueue._render(e,!0):this._opaqueQueue._render(e,!1),1===i.clearFlag){var n=i.skyboxMaterial||this._skyboxMaterial;if(n){WebGLContext.setCullFace(t,!1),WebGLContext.setDepthFunc(t,515),WebGLContext.setDepthMask(t,!1);var r=e.shader=n._shader._passes[0].withCompile(0,0,0),a=r.bind()||Stat.loopCount!==r._uploadLoopCount,s=SkyBox._instance,o=s._vertexBuffer;o.bind(),r.uploadAttributes(o.vertexDeclaration._shaderValues),(r._uploadMaterial!==n||a)&&(r.uploadUniforms(r._materialUniformParamsMap,n._shaderValues,!0),r._uploadMaterial=n),(i!==r._uploadCamera||a)&&(r.uploadUniforms(r._cameraUniformParamsMap,i._shaderValues,!0),r._uploadCamera=i),s._render(e),WebGLContext.setDepthFunc(t,513),WebGLContext.setDepthMask(t,!0)}}i.renderTarget?this._transparentQueue._render(e,!0):this._transparentQueue._render(e,!1)},i._set2DRenderConfig=function(t){WebGLContext.setBlend(t,!0),WebGLContext.setBlendFunc(t,1,771),WebGLContext.setDepthTest(t,!1),WebGLContext.setCullFace(t,!1),WebGLContext.setDepthMask(t,!0),WebGLContext.setFrontFace(t,2305),t.viewport(0,0,RenderState2D.width,RenderState2D.height)},i._parse=function(t,e){var i=t.lightmaps,n=i.length,r=this._lightmaps;r.length=n;for(var a=0;n>a;a++)r[a]=Loader.getRes(e[i[a].replace("exr","png")]);this.setlightmaps(r);var s=t.ambientColor;if(s){var o=this.ambientColor;o.fromArray(s),this.ambientColor=o}var l=t.skyboxMaterial;l&&(this.skyboxMaterial=Loader.getRes(e[l.path]));var _=t.reflectionTexture;_&&(this.reflectionTexture=Loader.getRes(e[_]));var h=t.fogColor;if(h){var u=this.fogColor;u.fromArray(h),this.fogColor=u}},i._onActive=function(){t.prototype._onActive.call(this),this.timer._lastTimer=Browser.now()},i._addLight=function(t){this._lights.indexOf(t)<0&&this._lights.push(t)},i._removeLight=function(t){var e=this._lights.indexOf(t);e>=0&&this._lights.splice(e,1)},i.isLayerVisible=function(t){var e=this._layerList[t]._mask;return 0!=(e&this._currentCameraCullingMask&this._visibleLayers)},i._getLatyer=function(t){return this._layerList[t]},i.addTreeNode=function(t){this.treeRoot.addTreeNode(t)},i.removeTreeNode=function(t){this.treeSize&&t._treeNode&&t._treeNode.removeObject(t)},i.setlightmaps=function(t){this._lightmaps=t;for(var e=0,i=this._children.length;i>e;e++)this._setLightMap(this._children[e])},i.getlightmaps=function(){return this._lightmaps},i._addRenderObject=function(t){if(this.treeRoot)this.addTreeNode(t);else if(this._renders.add(t),Render.isConchApp){var e=t._getIndexInList(),i=this._cullingBufferIndices.length;if(e>=i){var n=this._cullingBufferIndices,r=this._cullingBufferResult;this._cullingBufferIndices=new Int32Array(i+1024),this._cullingBufferResult=new Int32Array(i+1024),this._cullingBufferIndices.set(n,0),this._cullingBufferResult.set(r,0)}this._cullingBufferIndices[e]=t._cullingBufferIndex}},i._removeRenderObject=function(t){if(this.treeRoot)this.removeTreeNode(t);else{var e;if(Render.isConchApp)var e=this._renders.elements[this._renders.length-1];this._renders.remove(t),Render.isConchApp&&(this._cullingBufferIndices[e._getIndexInList()]=e._cullingBufferIndex)}},i._addShadowCastRenderObject=function(t){this.treeRoot?this.addTreeNode(t):(this._castShadowRendersLength===this._castShadowRenderObjects.length?this._castShadowRenderObjects.push(t):this._castShadowRenderObjects[this._castShadowRendersLength]=t,t._indexInCastShadowList=this._castShadowRendersLength++)},i._removeShadowCastRenderObject=function(t){if(this.treeRoot)this.removeTreeNode(t);else{this._castShadowRendersLength--;var e=t._indexInCastShadowList;if(e!==this._castShadowRendersLength){var i=this._castShadowRenderObjects[this._castShadowRendersLength];this._castShadowRenderObjects[e]=i,i._indexInCastShadowList=e,t._indexInCastShadowList=-1}}},i._getRenderQueue=function(t){return 3e3>t?this._opaqueQueue:this._transparentQueue},i._onAsynLoaded=function(t){var e=t[0];if("Scene"!==e.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var i=t[1],n=[];Utils3D._createNodeByJson(this,e,this,i,n),StaticBatchManager.combine(null,n)},i.rayCast=function(t,i,n,r){void 0===n&&(n=1.79e308),void 0===r&&(r=0),e._outHitAllInfo.length=0;for(var a=this._getLatyer(r)._colliders,s=0,o=a.length;o>s;s++){var l=a[s];if(l.enabled&&(l.raycast(t,e._outHitInfo,n),-1!==e._outHitInfo.distance&&e._outHitInfo.distance<=n)){var _=new RaycastHit;e._outHitInfo.cloneTo(_),e._outHitAllInfo.push(_)}}if(0==e._outHitAllInfo.length)return i.sprite3D=null,i.distance=-1,void 0;for(var h=Number.MAX_VALUE,u=0,c=0;c<e._outHitAllInfo.length;c++)e._outHitAllInfo[c].distance<h&&(h=e._outHitAllInfo[c].distance,u=c);e._outHitAllInfo[u].cloneTo(i)},i.rayCastAll=function(t,i,n,r){void 0===n&&(n=1.79e308),void 0===r&&(r=0),i.length=0;for(var a=this._getLatyer(r)._colliders,s=0,o=a.length;o>s;s++){var l=a[s];if(l.enabled&&(e._outHitInfo.distance=-1,e._outHitInfo.sprite3D=null,l.raycast(t,e._outHitInfo,n),-1!==e._outHitInfo.distance&&e._outHitInfo.distance<=n)){var _=new RaycastHit;e._outHitInfo.cloneTo(_),i.push(_)}}},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._renders=null,this._castShadowRenderObjects=null,this._cameraPool=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,Loader.clearRes(this.url),this.loaded||Laya3D._cancelLoadByUrl(this.url))},i.render=function(t){this._children.length>0&&t.addRenderObject(this),this._update()},i.renderSubmit=function(){var t=LayaGL.instance;if(Render.isConchApp)this._glCommandEncoder&&this._glCommandEncoder.clearEncoding(),t.beginCommandEncoding(this._glCommandEncoder);else{WebGLContext.bindVertexArray(t,null);var e=Buffer._bindedAtributeBuffer;LayaGL.instance.disableVertexAttribArray(0),e[0]=null,LayaGL.instance.disableVertexAttribArray(1),e[1]=null,LayaGL.instance.disableVertexAttribArray(2),e[2]=null}var i=RenderContext3D._instance;this._prepareSceneToRender(i);var n=0,r=0;if(Laya3D.debugMode||OctreeNode.debugMode)for(n=0,r=this._cameraPool.length;r>n;n++){var a=this._cameraPool[n];Laya3D._debugPhasorSprite.begin(1,a),a._render(t,i,this),Laya3D._debugPhasorSprite.end()}else for(n=0,r=this._cameraPool.length;r>n;n++)this._cameraPool[n]._render(t,i,this);return Render.isConchApp&&(t.endCommandEncoding(),Buffer._bindedVertexBuffer=null,Buffer._bindedIndexBuffer=null),this._set2DRenderConfig(t),1},i.getRenderType=function(){return 0},i.releaseRender=function(){},i.renderToNative=function(t){this._update(),this.renderSubmit(),LayaGLTemplate.GLS[this._renderType]||LayaGLTemplate.createByRenderType(this._renderType),t.block(this.data),this._repaintSpecial=0,this.repaintSpecial()},i.repaintSpecial=function(){0==this._repaintSpecial&&(this._repaintSpecial=1,this.parentRepaintSpecial())},i.parentRepaintSpecial=function(){var t=this._parent;t&&0==t._repaintSpecial&&(t._repaintSpecial=1,t.parentRepaintSpecial())},__getset(0,i,"loaded",function(){return this._loaded}),__getset(0,i,"scene",function(){return this}),__getset(0,i,"fogColor",function(){return this._shaderValues.getVector(0)},function(t){this._shaderValues.setVector(0,t)}),__getset(0,i,"enableFog",function(){return this._enableFog},function(t){this._enableFog!==t&&(this._enableFog=t,t?this._defineDatas.add(laya.d3.core.scene.Scene3D.SHADERDEFINE_FOG):this._defineDatas.remove(laya.d3.core.scene.Scene3D.SHADERDEFINE_FOG))}),__getset(0,i,"url",function(){return this._url}),__getset(0,i,"reflectionIntensity",function(){return this._shaderValues.getNumber(23)},function(t){t=Math.max(Math.min(t,1),0),this._shaderValues.setNumber(23,t)}),__getset(0,i,"fogStart",function(){return this._shaderValues.getNumber(1)},function(t){this._shaderValues.setNumber(1,t)}),__getset(0,i,"fogRange",function(){return this._shaderValues.getNumber(2)},function(t){this._shaderValues.setNumber(2,t)}),__getset(0,i,"skyboxMaterial",function(){return this._skyboxMaterial},function(t){this._skyboxMaterial!==t&&(this._skyboxMaterial&&this._skyboxMaterial._removeReference(),t._addReference(),this._skyboxMaterial=t)}),__getset(0,i,"ambientColor",function(){return this._shaderValues.getVector(21)},function(t){this._shaderValues.setVector(21,t)}),__getset(0,i,"reflectionTexture",function(){return this._shaderValues.getTexture(22)},function(t){this._shaderValues.setTexture(22,t),t?this._defineDatas.add(laya.d3.core.scene.Scene3D.SHADERDEFINE_REFLECTMAP):this._defineDatas.remove(laya.d3.core.scene.Scene3D.SHADERDEFINE_REFLECTMAP)}),__getset(0,i,"visibleLayers",function(){return this._visibleLayers},function(t){this._visibleLayers=t;for(var e=0,i=this._layerList.length;i>e;e++){var n=this._layerList[e];n._visible=0!==(n._mask&this._visibleLayers)}}),e._sortScenes=function(t,i){if(t.parent===Laya.stage&&i.parent===Laya.stage){var n=Laya.stage._children;return n.indexOf(t)-n.indexOf(i)}return t.parent!==Laya.stage&&i.parent!==Laya.stage?e._sortScenes(t.parent,i.parent):t.parent===Laya.stage?-1:1},e.load=function(t,i){return i?Laya.loader.create(t,null,null,e,i):Laya.loader.create(t,null,null,e)},e.SHADERDEFINE_FOG=0,e.SHADERDEFINE_DIRECTIONLIGHT=0,e.SHADERDEFINE_POINTLIGHT=0,e.SHADERDEFINE_SPOTLIGHT=0,e.SHADERDEFINE_CAST_SHADOW=0,e.SHADERDEFINE_SHADOW_PSSM1=0,e.SHADERDEFINE_SHADOW_PSSM2=0,e.SHADERDEFINE_SHADOW_PSSM3=0,e.SHADERDEFINE_SHADOW_PCF_NO=0,e.SHADERDEFINE_SHADOW_PCF1=0,e.SHADERDEFINE_SHADOW_PCF2=0,e.SHADERDEFINE_SHADOW_PCF3=0,e.SHADERDEFINE_REFLECTMAP=0,e.FOGCOLOR=0,e.FOGSTART=1,e.FOGRANGE=2,e.LIGHTDIRECTION=3,e.LIGHTDIRCOLOR=4,e.POINTLIGHTPOS=5,e.POINTLIGHTRANGE=6,e.POINTLIGHTATTENUATION=7,e.POINTLIGHTCOLOR=8,e.SPOTLIGHTPOS=9,e.SPOTLIGHTDIRECTION=10,e.SPOTLIGHTSPOT=11,e.SPOTLIGHTRANGE=12,e.SPOTLIGHTATTENUATION=13,e.SPOTLIGHTCOLOR=14,e.SHADOWDISTANCE=15,e.SHADOWLIGHTVIEWPROJECT=16,e.SHADOWMAPPCFOFFSET=17,e.SHADOWMAPTEXTURE1=18,e.SHADOWMAPTEXTURE2=19,e.SHADOWMAPTEXTURE3=20,e.AMBIENTCOLOR=21,e.REFLECTIONTEXTURE=22,e.REFLETIONINTENSITY=23,e.TIME=24,e._outHitAllInfo=[],__static(e,["_outHitInfo",function(){return this._outHitInfo=new RaycastHit}]),e}(Node),AnimationTemplet=function(t){function e(){this._aniMap={},this.unfixedLastAniIndex=-1,e.__super.call(this),this._anis=new Array}__class(e,"laya.ani.AnimationTemplet",t);var i=e.prototype;return i.parse=function(t){var e=new Byte(t);this._aniVersion=e.readUTFString(),AnimationParser01.parse(this,e)},i._calculateKeyFrame=function(t,e,i){var n=t.keyFrame;n[e]=n[0];for(var r=0;e>r;r++)for(var a=n[r],s=0;i>s;s++)a.dData[s]=0===a.duration?0:(n[r+1].data[s]-a.data[s])/a.duration,a.nextData[s]=n[r+1].data[s];n.length--},i._onAsynLoaded=function(t){var e=new Byte(t);switch(this._aniVersion=e.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":AnimationParser02.parse(this,e);break;default:AnimationParser01.parse(this,e)}},i.getAnimationCount=function(){return this._anis.length},i.getAnimation=function(t){return this._anis[t]},i.getAniDuration=function(t){return this._anis[t].playTime},i.getNodes=function(t){return this._anis[t].nodes},i.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},i.getNodeCount=function(t){return this._anis[t].nodes.length},i.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframeDatasLength},i.getPublicExtData=function(){return this._publicExtData},i.getAnimationDataWithCache=function(t,e,i,n){var r=e[i];if(r){var a=r[t];return a?a[n]:null}return null},i.setAnimationDataWithCache=function(t,e,i,n,r){var a=e[i]||(e[i]={}),s=a[t]||(a[t]=[]);s[n]=r},i.getOriginalData=function(t,i,n,r,a){for(var s=this._anis[t],o=s.nodes,l=0,_=0,h=o.length,u=0;h>_;_++){var c,d=o[_];c=d.keyFrame[n[_][r]],d.dataOffset=u;var f=a-c.startTime,m=d.lerpType;if(m)switch(m){case 0:case 1:for(l=0;l<d.keyframeWidth;)l+=d.interpolationMethod[l](d,l,i,u+l,c.data,f,c.dData,c.duration,c.nextData);break;case 2:var p=c.interpolationData,g=p.length,v=0;for(l=0;g>l;){var x=p[l];switch(x){case 6:l+=e.interpolation[x](d,v,i,u+v,c.data,f,c.dData,c.duration,c.nextData,p,l+1);break;case 7:l+=e.interpolation[x](d,v,i,u+v,c.data,f,c.dData,c.duration,c.nextData,p,l+1);break;default:l+=e.interpolation[x](d,v,i,u+v,c.data,f,c.dData,c.duration,c.nextData)}v++}}else for(l=0;l<d.keyframeWidth;)l+=d.interpolationMethod[l](d,l,i,u+l,c.data,f,c.dData,c.duration,c.nextData);u+=d.keyframeWidth}},i.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t],n=i.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(n.length),this.unfixedCurrentTimes=new Float32Array(n.length),this.unfixedLastAniIndex=t);for(var r=0,a=n.length;a>r;r++){var s=n[r];for(e<this.unfixedCurrentTimes[r]&&(this.unfixedCurrentFrameIndexes[r]=0),this.unfixedCurrentTimes[r]=e;this.unfixedCurrentFrameIndexes[r]<s.keyFrame.length&&!(s.keyFrame[this.unfixedCurrentFrameIndexes[r]].startTime>this.unfixedCurrentTimes[r]);)this.unfixedCurrentFrameIndexes[r]++;this.unfixedCurrentFrameIndexes[r]--}return this.unfixedCurrentFrameIndexes},i.getOriginalDataUnfixedRate=function(t,i,n){var r=this._anis[t],a=r.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(a.length),this.unfixedCurrentTimes=new Float32Array(a.length),this.unfixedKeyframes=__newvec(a.length),this.unfixedLastAniIndex=t);for(var s=0,o=0,l=a.length,_=0;l>o;o++){var h=a[o];for(n<this.unfixedCurrentTimes[o]&&(this.unfixedCurrentFrameIndexes[o]=0),this.unfixedCurrentTimes[o]=n;this.unfixedCurrentFrameIndexes[o]<h.keyFrame.length&&!(h.keyFrame[this.unfixedCurrentFrameIndexes[o]].startTime>this.unfixedCurrentTimes[o]);)this.unfixedKeyframes[o]=h.keyFrame[this.unfixedCurrentFrameIndexes[o]],this.unfixedCurrentFrameIndexes[o]++;var u=this.unfixedKeyframes[o];h.dataOffset=_;var c=n-u.startTime,d=h.lerpType;if(d)switch(h.lerpType){case 0:case 1:for(s=0;s<h.keyframeWidth;)s+=h.interpolationMethod[s](h,s,i,_+s,u.data,c,u.dData,u.duration,u.nextData);break;case 2:var f=u.interpolationData,m=f.length,p=0;for(s=0;m>s;){var g=f[s];switch(g){case 6:s+=e.interpolation[g](h,p,i,_+p,u.data,c,u.dData,u.duration,u.nextData,f,s+1);break;case 7:s+=e.interpolation[g](h,p,i,_+p,u.data,c,u.dData,u.duration,u.nextData,f,s+1);break;default:s+=e.interpolation[g](h,p,i,_+p,u.data,c,u.dData,u.duration,u.nextData)}p++}}else for(s=0;s<h.keyframeWidth;)s+=h.interpolationMethod[s](h,s,i,_+s,u.data,c,u.dData,u.duration,u.nextData);_+=h.keyframeWidth}},e._LinearInterpolation_0=function(t,e,i,n,r,a,s){return i[n]=r[e]+a*s[e],1},e._QuaternionInterpolation_1=function(t,e,i,n,r,a,s,o,l){var _=0===o?0:a/o;return MathUtil.slerpQuaternionArray(r,e,l,e,_,i,n),4},e._AngleInterpolation_2=function(){return 0},e._RadiansInterpolation_3=function(){return 0},e._Matrix4x4Interpolation_4=function(t,e,i,n,r,a,s){for(var o=0;16>o;o++,e++)i[n+o]=r[e]+a*s[e];return 16},e._NoInterpolation_5=function(t,e,i,n,r){return i[n]=r[e],1},e._BezierInterpolation_6=function(t,e,i,n,r,a,s,o,l,_,h){return void 0===h&&(h=0),i[n]=r[e]+(l[e]-r[e])*BezierLerp.getBezierRate(a/o,_[h],_[h+1],_[h+2],_[h+3]),5},e._BezierInterpolation_7=function(t,e,i,n,r,a,s,o,l,_,h){return void 0===h&&(h=0),i[n]=_[h+4]+_[h+5]*BezierLerp.getBezierRate((.001*a+_[h+6])/_[h+7],_[h],_[h+1],_[h+2],_[h+3]),9},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.interpolation=[e._LinearInterpolation_0,e._QuaternionInterpolation_1,e._AngleInterpolation_2,e._RadiansInterpolation_3,e._Matrix4x4Interpolation_4,e._NoInterpolation_5,e._BezierInterpolation_6,e._BezierInterpolation_7],e}(Resource),AnimationClip=function(t){function e(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._duration=0/0,this._frameRate=0,this._nodes=null,this._nodesDic=null,this._nodesMap=null,this._events=null,this._publicClipDatas=null,this.islooping=!1,e.__super.call(this),this._fullKeyframeIndicesCache={},this._animationDatasCache=[],this._skinnedDatasCache=[],this._events=[]}__class(e,"laya.d3.animation.AnimationClip",t);var i=e.prototype;return i.duration=function(){return this._duration},i._hermiteInterpolate=function(t,e,i,n){for(var r=t.data,a=t.outTangent,s=t.next,o=s.data,l=s.inTangent,_=!1,h=0/0,u=0/0,c=0/0,d=0/0,f=0,m=n.length;m>f;f++){var p=a[f],g=l[f];if(Number.isFinite(p)&&Number.isFinite(g)){if(!_){var v=e*e,x=v*e;h=2*x-3*v+1,u=x-2*v+e,c=x-v,d=-2*x+3*v,_=!0}n[f]=h*r[f]+u*p*i+c*g*i+d*o[f]}else n[f]=r[f]}},i._getFullKeyframeIndicesWithCache=function(t){return this._fullKeyframeIndicesCache[t]},i._cacheFullKeyframeIndices=function(t,e){this._fullKeyframeIndicesCache[t]=e},i._getAnimationDataWithCache=function(t,e){var i=this._animationDatasCache[t];return i?i[e]:null},i._cacheAnimationData=function(t,e,i){var n=this._animationDatasCache[t]||(this._animationDatasCache[t]=[]);n[e]=i},i._evaluateAnimationlDatasCacheMode=function(t,e,i,n){for(var r=0,a=0,s=0,o=this._nodes.length;o>s;s++){var l,_=s,h=this._nodes[_],u=t[_],c=u[n._frameIndex];if(-1!==c){var d=h.keyFrames[c],f=d.next;if(f){l=new Float32Array(h.keyFrameWidth),i[s]=l;var m=0/0,p=d.duration;m=0!==p?(n._frameTime-d.startTime)/p:0,this._hermiteInterpolate(d,m,p,l)}else{l=new Float32Array(h.keyFrameWidth),i[s]=l;var g=d.data;for(r=0,a=l.length;a>r;r++)l[r]=g[r]}}else{l=new Float32Array(h.keyFrameWidth),i[s]=l;var v=h.keyFrames[0].data;for(r=0,a=l.length;a>r;r++)l[r]=v[r]}}},i._evaluateAnimationlDatasRealTime=function(t,e){var i=0,n=0,r=this._nodes;if(!this._realTimeCurrentFrameIndexes){for(this._realTimeCurrentFrameIndexes=new Int32Array(r.length),i=0,n=r.length;n>i;i++)this._realTimeCurrentFrameIndexes[i]=-1;this._realTimeCurrentTimes=new Float32Array(r.length)}for(i=0,n=this._nodes.length;n>i;i++){var a=i,s=r[a];t<this._realTimeCurrentTimes[a]&&(this._realTimeCurrentFrameIndexes[a]=-1),this._realTimeCurrentTimes[a]=t;for(var o=this._realTimeCurrentFrameIndexes[a]+1,l=s.keyFrames,_=l.length;_>o;){if(l[o].startTime>t){this._realTimeCurrentFrameIndexes[a]=o-1;break}o++}o===_&&(this._realTimeCurrentFrameIndexes[a]=_-1);var h=0,u=0,c=e[a];c||(c=e[a]=new Float32Array(s.keyFrameWidth));var d=l[this._realTimeCurrentFrameIndexes[a]];if(d){var f=d.next;if(f){var m=d.duration,p=0/0;p=0!==m?(t-d.startTime)/m:0,this._hermiteInterpolate(d,p,m,c)}else{var g=d.data;for(h=0,u=c.length;u>h;h++)c[h]=g[h]}}else{var v=s.keyFrames[0].data;for(h=0,u=c.length;u>h;h++)c[h]=v[h]}}},i._binarySearchEventIndex=function(t){for(var e=0,i=this._events.length-1,n=0;i>=e;){n=Math.floor((e+i)/2);var r=this._events[n].time;if(r==t)return n;r>t?i=n-1:e=n+1}return e},i.addEvent=function(t){var e=this._binarySearchEventIndex(t.time);this._events.splice(e,0,t)},i._onAsynLoaded=function(t){var e=new Byte(t);switch(this._version=e.readUTFString(),this._version){case"LAYAANIMATION:01":AnimationClipParser01.parse(this,e);break;case"LAYAANIMATION:02":AnimationClipParser02.parse(this,e)}},i._disposeResource=function(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._publicClipDatas=null},e.load=function(t){return Laya.loader.create(t,null,null,e)},e}(Resource),Avatar=function(t){function e(){this._rootNode=null,this._nativeNodeCount=0,this._nativeCurCloneCount=0,e.__super.call(this)}__class(e,"laya.d3.core.Avatar",t);var i=e.prototype;return Laya.imps(i,{"laya.d3.core.IClone":!0}),i._initCloneToAnimator=function(t,e){e._avatarNodeMap[t.name]=t;for(var i=0,n=t.getChildCount();n>i;i++)this._initCloneToAnimator(t.getChildByIndex(i),e)},i._parseNode=function(t,e){var i=t.props.name;e.name=i;for(var n=t.customProps,r=n.translate,a=n.rotation,s=n.scale,o=e.transform,l=o.getLocalPosition(),_=o.getLocalRotation(),h=o.getLocalScale(),u=0;3>u;u++)l[u]=r[u];for(u=0;4>u;u++)_[u]=a[u];for(u=0;3>u;u++)h[u]=s[u];o.setLocalPosition(l,!1,1),o.setLocalRotation(_,!1,1),o.setLocalScale(h,!1,1);for(var c=t.child,d=0,f=c.length;f>d;d++){var m=c[d],p=new AnimationNode(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16));e.addChild(p),Render.isConchApp&&this._nativeNodeCount++,this._parseNode(m,p)}},i._onAsynLoaded=function(t){if(this._rootNode=new AnimationNode(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16)),Render.isConchApp&&this._nativeNodeCount++,t.version){var e=t.rootNode;e&&this._parseNode(e,this._rootNode)}else this._parseNode(t,this._rootNode)},i._cloneDatasToAnimator=function(t){var e;e=this._rootNode.clone(),e.transform.setLocalPosition(this._rootNode.transform.getLocalPosition(),!1,1),e.transform.setLocalRotation(this._rootNode.transform.getLocalRotation(),!1,1),e.transform.setLocalScale(this._rootNode.transform.getLocalScale(),!1,1),t._avatarNodeMap={},this._initCloneToAnimator(e,t)},i.cloneTo=function(t){var e=t,i=this._rootNode.clone();e._rootNode=i},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},i._cloneDatasToAnimatorNative=function(t){var e=new Float32Array(3*this._nativeNodeCount),i=new Float32Array(4*this._nativeNodeCount),n=new Float32Array(3*this._nativeNodeCount),r=new Float32Array(16*this._nativeNodeCount),a=new Int16Array(this._nativeNodeCount);t._animationNodeLocalPositions=e,t._animationNodeLocalRotations=i,t._animationNodeLocalScales=n,t._animationNodeWorldMatrixs=r,t._animationNodeParentIndices=a,this._nativeCurCloneCount=0;var s=this._rootNode._cloneNative(e,i,n,r,a,-1,this);s.transform.setLocalPosition(this._rootNode.transform.getLocalPosition(),!1,1),s.transform.setLocalRotation(this._rootNode.transform.getLocalRotation(),!1,1),s.transform.setLocalScale(this._rootNode.transform.getLocalScale(),!1,1),t._avatarNodeMap={},this._initCloneToAnimator(s,t)},e.load=function(t){return Laya.loader.create(t,null,null,e)},e}(Resource),BaseMaterial=function(t){function e(t){e.__super.call(this,t),this._defineDatas=new DefineDatas,this._disablePublicDefineDatas=new DefineDatas,this._shaderValues=new ShaderDatas(this,t),this.renderQueue=2e3,this._alphaTest=!1,this._renderStates=[]}__class(e,"laya.d3.core.material.BaseMaterial",t);var i=e.prototype;return Laya.imps(i,{"laya.d3.core.IClone":!0}),i._removeTetxureReference=function(){for(var t=this._shaderValues._data,e=0,i=t.length;i>e;e++){var n=t[e];n&&n instanceof laya.webgl.resource.BaseTexture&&n._removeReference()}},i._onAsynLoaded=function(t){var e=t[0],i=t[1];switch(e.version){case"LAYAMATERIAL:01":var n=0,r=0,a=e.props;for(var s in a)switch(s){case"vectors":var o=a[s];for(n=0,r=o.length;r>n;n++){var l=o[n],_=l.value;switch(_.length){case 2:this[l.name]=new Vector2(_[0],_[1]);break;case 3:this[l.name]=new Vector3(_[0],_[1],_[2]);break;case 4:this[l.name]=new Vector4(_[0],_[1],_[2],_[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var h=a[s];for(n=0,r=h.length;r>n;n++){var u=h[n],c=u.path;c&&(this[u.name]=Loader.getRes(i[c]))}break;case"defines":var d=a[s];for(n=0,r=d.length;r>n;n++){var f=this._shader.getMaterialDefineByName(d[n]);this._defineDatas.add(f)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":var m=a[s];for(n=0,r=this._renderStates.length;r>n;n++)this._renderStates[n][s]=m;break;case"renderQueue":var p=a[s];switch(p){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[s]=a[s]}break;case"LAYAMATERIAL:02":break;default:throw new Error("BaseMaterial:unkonwn version.")}},i._addReference=function(){t.prototype._addReference.call(this);for(var e=this._shaderValues._data.length,i=0,n=e;n>i;i++){var r=this._shaderValues._data[i];r&&r instanceof laya.webgl.resource.BaseTexture&&r._addReference()}},i._removeReference=function(){t.prototype._removeReference.call(this),this._removeTetxureReference()},i._disposeResource=function(){this._referenceCount>0&&this._removeTetxureReference(),this._shaderValues=null},i.setShaderName=function(t){if(this._shader=Shader3D._preCompileShader[t],!this._shader)throw new Error("BaseMaterial: unknown shader name.");var e=this._shader._passes.length;this._renderStates.length=e;for(var i=0;e>i;i++)this._renderStates[i]||(this._renderStates[i]=new RenderState)},i.getRenderState=function(t){return void 0===t&&(t=0),this._renderStates[t]},i.cloneTo=function(t){var e=t;e.name=this.name,e.renderQueue=this.renderQueue,this._disablePublicDefineDatas.cloneTo(e._disablePublicDefineDatas),this._defineDatas.cloneTo(e._defineDatas),this._shaderValues.cloneTo(e._shaderValues);for(var i=t._renderStates,n=0,r=this._renderStates.length;r>n;n++)this._renderStates[n].cloneTo(i[n])},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},__getset(0,i,"alphaTestValue",function(){return this._shaderValues.getNumber(0)},function(t){this._shaderValues.setNumber(0,t)}),__getset(0,i,"alphaTest",function(){return this._alphaTest},function(t){this._alphaTest=t,t?this._defineDatas.add(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._defineDatas.remove(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),e.__init__=function(){e.SHADERDEFINE_ALPHATEST=e.shaderDefines.registerDefine("ALPHATEST")},e.RENDERQUEUE_OPAQUE=2e3,e.RENDERQUEUE_ALPHATEST=2450,e.RENDERQUEUE_TRANSPARENT=3e3,e.ALPHATESTVALUE=0,e.SHADERDEFINE_ALPHATEST=0,__static(e,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1}]),e}(Resource),SkinAnimations=function(t){function e(){this._tempCurAnimationData=null,this._tempCurBonesData=null,this._curOriginalData=null,this._lastFrameIndex=-1,this._curMeshAnimationData=null,this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh=null,this._boneIndexToMeshList=null,this._oldVersion=!1,e.__super.call(this),this._boneIndexToMeshList=[]}__class(e,"laya.d3.component.animation.SkinAnimations",t);var i=e.prototype;return i._computeBoneIndexToMeshOnTemplet=function(){this._templet.loaded?this._computeBoneIndexToMeshOnMesh():this._templet.once("loaded",this,this._computeBoneIndexToMeshOnMesh)},i._computeBoneIndexToMeshOnMesh=function(){this._oldVersion="LAYAANIMATION:02"===this._templet._aniVersion?!1:!0;var t=this._owner.meshFilter.sharedMesh;t.loaded?this._computeBoneIndexToMesh(t):t.on("loaded",this,this._computeBoneIndexToMesh)},i._computeBoneIndexToMesh=function(t){var e=t._boneNames;if(e)for(var i=e.length,n=this._templet._anis,r=0,a=n.length;a>r;r++){var s=this._boneIndexToMeshList[r];s||(s=this._boneIndexToMeshList[r]=[]),s.length=i;for(var o=n[r],l=0;i>l;l++)s[l]=o.bone3DMap[e[l]]}},i._getAnimationDatasWithCache=function(t,e,i,n,r){var a=i[n];if(a){var s=a[t];if(s){var o=s[e.id];return o?o[r]:null}return null}return null},i._setAnimationDatasWithCache=function(t,e,i,n,r,a){var s=i[n]||(i[n]={}),o=s[t]||(s[t]={}),l=o[e.id]||(o[e.id]=[]);l[r]=a},i._onAnimationPlayMeshLoaded=function(){for(var t=this._ownerMesh.meshRender._renderElements,e=0,i=t.length;i>e;e++)t[e]._canDynamicBatch=!1
},i._onAnimationPlay=function(){this._ownerMesh._render._defineDatas.add(SkinnedMeshSprite3D.SHADERDEFINE_BONE);var t=this._ownerMesh.meshFilter.sharedMesh;t.loaded?this._onAnimationPlayMeshLoaded():t.once("loaded",this,this._onAnimationPlayMeshLoaded)},i._onAnimationStop=function(){this._lastFrameIndex=-1,this._player.returnToZeroStopped&&(this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh._render._defineDatas.remove(SkinnedMeshSprite3D.SHADERDEFINE_BONE));for(var t=this._ownerMesh.meshRender._renderElements,e=0,i=t.length;i>e;e++)t[e]._canDynamicBatch=!0},i._onEnableInScene=function(){this._owner._scene._skinAnimationsPool.add(this)},i._onDisableInScene=function(){this._owner._scene._skinAnimationsPool.remove(this)},i._added=function(){this._ownerMesh=this._owner,this._player.on("played",this,this._onAnimationPlay),this._player.on("stopped",this,this._onAnimationStop),this._owner.meshFilter.on("meshchanged",this,this._computeBoneIndexToMeshOnTemplet)},i._update=function(){this._player._update(Laya.timer.delta);var t=this._ownerMesh.meshFilter.sharedMesh;if(2===this._player.state&&this._templet&&this._templet.loaded&&t.loaded){var i=this._player.playbackRate*Laya.timer.scale,n=this._player.cachePlayRate,r=this._player.isCache&&i>=n,a=r?this.currentFrameIndex:-1;if(-1===a||this._lastFrameIndex!==a){var s=this.currentAnimationClipIndex,o=this._templet._animationDatasCache[0],l=this._templet._animationDatasCache[1];if(r){var _=this._getAnimationDatasWithCache(n,t,l,s,a);if(_)return this._curAnimationDatas=_,this._curBonesDatas=this._templet.getAnimationDataWithCache(n,o,s,a),this._lastFrameIndex=a,void 0}var h=!1;r&&(this._curBonesDatas=this._templet.getAnimationDataWithCache(n,o,s,a),h=this._curBonesDatas?!0:!1);var u=this._templet.getNodes(s),c=16*u.length,d=t.inverseAbsoluteBindPoses;this._oldVersion?this._curMeshAnimationData||(this._curMeshAnimationData=new Float32Array(c)):this._curMeshAnimationData||(this._curMeshAnimationData=new Float32Array(16*d.length));var f,m,p=0,g=0,v=0,x=t.subMeshCount;if(r){for(this._curAnimationDatas=[],this._curAnimationDatas.length=x,p=0;x>p;p++)for(f=this._curAnimationDatas[p]=[],m=t._getSubMesh(p),v=m._boneIndicesList.length,f.length=v,g=0;v>g;g++)f[g]=new Float32Array(16*m._boneIndicesList[g].length);h||(this._curBonesDatas=new Float32Array(c))}else{if(!this._tempCurAnimationData)for(this._tempCurAnimationData=[],this._tempCurAnimationData.length=x,p=0;x>p;p++)for(f=this._tempCurAnimationData[p]=[],m=t._getSubMesh(p),v=m._boneIndicesList.length,f.length=v,g=0;v>g;g++)f[g]=new Float32Array(16*m._boneIndicesList[g].length);this._tempCurBonesData||(this._tempCurBonesData=new Float32Array(c)),this._curAnimationDatas=this._tempCurAnimationData,this._curBonesDatas=this._tempCurBonesData}if(this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(s))),r?this._templet.getOriginalData(s,this._curOriginalData,this._player._fullFrames[s],a,this._player.currentFrameTime):this._templet.getOriginalDataUnfixedRate(s,this._curOriginalData,this._player.currentPlayTime),this._oldVersion)r&&h?Utils3D._computeAnimationDatasByArrayAndMatrixFastOld(d,this._curBonesDatas,this._curMeshAnimationData):Utils3D._computeBoneAndAnimationDatasByBindPoseMatrxixOld(u,this._curOriginalData,d,this._curBonesDatas,this._curMeshAnimationData);else{var y=this._boneIndexToMeshList[s];r&&h?Utils3D._computeAnimationDatasByArrayAndMatrixFast(d,this._curBonesDatas,this._curMeshAnimationData,y):Utils3D._computeBoneAndAnimationDatasByBindPoseMatrxix(u,this._curOriginalData,d,this._curBonesDatas,this._curMeshAnimationData,y)}for(p=0;x>p;p++){var T=t._getSubMesh(p)._boneIndicesList;for(v=T.length,f=this._curAnimationDatas[p],g=0;v>g;g++)e._splitAnimationDatas(T[g],this._curMeshAnimationData,f[g])}r&&(this._setAnimationDatasWithCache(n,t,l,s,a,this._curAnimationDatas),h||this._templet.setAnimationDataWithCache(n,o,s,a,this._curBonesDatas)),this._lastFrameIndex=a}}},i._preRenderUpdate=function(t){var e=t.renderElement._geometry;e._skinAnimationDatas=this._curAnimationDatas?this._curAnimationDatas[e._indexInMesh]:null},i._onDestroy=function(){2==this.player.state&&this._ownerMesh._render._defineDatas.remove(SkinnedMeshSprite3D.SHADERDEFINE_BONE),this._templet&&!this._templet.loaded&&this._templet.off("loaded",this,this._computeBoneIndexToMeshOnMesh);var e=this._ownerMesh.meshFilter.sharedMesh;e.loaded||e.off("loaded",this,this._onAnimationPlayMeshLoaded),t.prototype._onDestroy.call(this),this._tempCurAnimationData=null,this._tempCurBonesData=null,this._curOriginalData=null,this._curMeshAnimationData=null,this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh=null},__getset(0,i,"curBonesDatas",function(){return this._curBonesDatas}),__getset(0,i,"templet",t.prototype._$get_templet,function(t){this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this._computeBoneIndexToMeshOnTemplet(),this._curOriginalData=null,this._curMeshAnimationData=null,this._tempCurBonesData=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[[],[]]))}),e._splitAnimationDatas=function(t,e,i){for(var n=0,r=t.length,a=0;r>n;n++)for(var s=0;16>s;s++,a++)i[a]=e[(t[n]<<4)+s]},e._update=function(t){for(var e=t._skinAnimationsPool,i=e.elements,n=0,r=e.length;r>n;n++){var a=i[n];a&&a.enabled&&a._update()}},e}(KeyframeAnimations),BaseMesh=function(t){function e(){this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._subMeshCount=0,this._positions=null,e.__super.call(this),this._boundingBoxCorners=__newvec(8,null)}__class(e,"laya.d3.resource.models.BaseMesh",t);var i=e.prototype;return i._getPositions=function(){throw new Error("未Override,请重载该属性！")},i._generateBoundingObject=function(){this._boundingSphere=new BoundSphere(new Vector3,0),BoundSphere.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new BoundBox(new Vector3,new Vector3),BoundBox.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},i._getSubMesh=function(){throw new Error("未Override,请重载该属性！")},__getset(0,i,"subMeshCount",function(){return this._subMeshCount}),__getset(0,i,"boundingBox",function(){return this._boundingBox}),__getset(0,i,"boundingBoxCorners",function(){return this._boundingBoxCorners}),__getset(0,i,"boundingSphere",function(){return this._boundingSphere}),e}(Resource),BoxCollider=function(t){function e(){this._size=null,this._transformOrientedBoundBox=null,this.center=null,e.__super.call(this),this._needUpdate=!1}__class(e,"laya.d3.component.physics.BoxCollider",t);var i=e.prototype;return i._updateCollider=function(){if(this._needUpdate){var t=this._transformOrientedBoundBox.transformation,i=this._owner.transform,n=i.rotation,r=i.scale,a=this.center.elements;0===a[0]&&0===a[1]&&0===a[2]?Matrix4x4.createAffineTransformation(i.position,n,Vector3.ONE,t):(Vector3.multiply(this.center,r,e._deviationV3),Vector3.transformQuat(e._deviationV3,n,e._deviationV3),Vector3.add(i.position,e._deviationV3,e._deviationV3),Matrix4x4.createAffineTransformation(e._deviationV3,n,Vector3.ONE,t)),this._transformOrientedBoundBox.transformation=t;var s=this._transformOrientedBoundBox.extents.elements,o=this._size.elements,l=r.elements;s[0]=.5*o[0]*l[0],s[1]=.5*o[1]*l[1],s[2]=.5*o[2]*l[2],this._needUpdate=!1}},i._onWorldMatrixChanged=function(){this._needUpdate=!0;for(var t in this._runtimeCollisonMap)this._runtimeCollisonTestMap[t]=!0,this._runtimeCollisonMap[t]._runtimeCollisonTestMap[this.id]=!0},i._parse=function(t){this.isTrigger=t.isTrigger,this.center.fromArray(t.center);var e=this.size;e.fromArray(t.size),this.size=e},i._added=function(){t.prototype._added.call(this),this._transformOrientedBoundBox=new OrientedBoundBox(new Vector3,new Matrix4x4),this._size=new Vector3,this.center=new Vector3,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},i._getType=function(){return 1},i._collisonTo=function(t){switch(t._getType()){case 0:return 0!==this.boundBox.containsSphere(t.boundSphere);case 1:return 0!==this.boundBox.containsOrientedBoundBox(t.boundBox);case 2:return!1;case 3:var e=t;if(0!==this.boundBox.containsBoundBox(e._boundBox)){for(var i=t.mesh._positions,n=0,r=i.length;r>n;n++)if(1===this.boundBox.containsPoint(i[n]))return!0;return!1}return!1;default:throw new Error("BoxCollider:unknown collider type.")}},i._cloneTo=function(t){var e=t,i=e.size;this.size.cloneTo(i),e.size=i,this.center.cloneTo(e.center)},i.raycast=function(t,e,i){void 0===i&&(i=1.79e308),this._updateCollider();var n=this._transformOrientedBoundBox.intersectsRay(t,e.position);return-1!==n&&i>=n?(e.distance=n,e.sprite3D=this._owner,!0):(e.distance=-1,e.sprite3D=null,!1)},i.setFromBoundBox=function(t){OrientedBoundBox.createByBoundBox(t,this._transformOrientedBoundBox);var e=this._transformOrientedBoundBox.extents;this._size=new Vector3(2*e.x,2*e.y,2*e.z),this.center=new Vector3,Vector3.add(t.min,t.max,this.center),Vector3.scale(this.center,.5,this.center),this._needUpdate=!0;var i=this._owner;i.scene._enablePhysics&&this.setPhysicsGeomertyData()},i.setFromCustomData=function(t,e){this.center=new Vector3(t.x,t.y,t.z),this._size=new Vector3(e.x,e.y,e.z);var i=this._owner;i.scene._enablePhysics&&this.setPhysicsGeomertyData()},i.setPhysicsGeomertyData=function(){var t=this._owner;if(t.scene._enablePhysics){var e=new GeometryBox(this.size,this.center,t.transform.scale);t.scene.physicsSystem.addShape(t.compoundShape,e)}},i._awake=function(){t.prototype._awake.call(this);var e=this._owner;e.scene._enablePhysics&&this.center},__getset(0,i,"boundBox",function(){return this._updateCollider(),this._transformOrientedBoundBox}),__getset(0,i,"size",function(){return this._size},function(t){this._size=t,this._needUpdate=!0}),__static(e,["_deviationV3",function(){return this._deviationV3=new Vector3},"_obbCenterV3",function(){return this._obbCenterV3=new Vector3}]),e}(Collider),CapsuleCollider=function(t){function e(){this._center=null,this._radius=0/0,this._height=0/0,e.__super.call(this)}__class(e,"laya.d3.component.physics.CapsuleCollider",t);var i=e.prototype;return i._parse=function(t){this._center=new Vector3,this.isTrigger=t.isTrigger,this._center.fromArray(t.center),this._radius=t.radius,this._height=t.height},i._getType=function(){return 2},i.setFromBoundBox=function(t){this._center=new Vector3;var e=t.min,i=t.max,n=e.elements,r=i.elements;Vector3.add(e,i,this._center),Vector3.scale(this._center,.5,this._center),this._height=r[1]-n[1],this._radius=Math.max(r[2]-n[2],r[0]-n[0])/2;var a=this._owner;a.scene._enablePhysics&&this.setPhysicsGeomertyData()},i.setFromCustomData=function(t,e,i){this.center=new Vector3(t.x,t.y,t.z),this.radius=e,this.height=i;var n=this._owner;n.scene._enablePhysics&&this.setPhysicsGeomertyData()},i.setPhysicsGeomertyData=function(){var t=this._owner;if(t.scene._enablePhysics){var e=new GeometryCapsule(this.height,this.radius,this.center,t.transform.scale);t.scene.physicsSystem.addShape(t.compoundShape,e)}},i._awake=function(){t.prototype._awake.call(this);var e=this._owner;e.scene._enablePhysics&&this.center},__getset(0,i,"center",function(){return this._center},function(t){this._center=t}),__getset(0,i,"radius",function(){return this._radius},function(t){this._radius=t}),__getset(0,i,"height",function(){return this._height},function(t){this._height=t}),e}(Collider),MeshCollider=function(t){function e(){this._transformBoundingBox=null,this._mesh=null,e.__super.call(this),this._transformBoundingBox=new BoundBox(new Vector3,new Vector3),this._needUpdate=!1}__class(e,"laya.d3.component.physics.MeshCollider",t);var i=e.prototype;return i._updateBoundBoxCollider=function(){if(this._needUpdate){for(var t=this._owner.transform.worldMatrix,i=this._mesh.boundingBoxCorners,n=0;8>n;n++)Vector3.transformCoordinate(i[n],t,e._tempBoundBoxCorners[n]);BoundBox.createfromPoints(e._tempBoundBoxCorners,this._transformBoundingBox),this._needUpdate=!1}},i._raycastMesh=function(t,i,n,r){void 0===r&&(r=1.79e308);var a=i.transform.worldMatrix,s=e._tempMatrix4x40;a.invert(s);var o=t.origin,l=t.direction,_=e._tempRay0;Vector3.transformCoordinate(o,s,_.origin),Vector3.TransformNormal(l,s,_.direction);for(var h=Number.MAX_VALUE,u=0,c=this._mesh.subMeshCount;c>u;u++){var d=this._mesh._getSubMesh(u),f=d._vertexBuffer,m=f.getData(),p=d._indexBuffer.getData(),g=e._tempRaycastHit,v=Picker.rayIntersectsPositionsAndIndices(_,m,f.vertexDeclaration,p,g);if(v){Vector3.transformCoordinate(g.position,a,g.position);var x=e._tempVector30;Vector3.subtract(o,g.position,x);var y=Vector3.scalarLength(x);if(r>y&&h>y){g.distance=y,g.sprite3D=i;var T=g.trianglePositions;Vector3.transformCoordinate(T[0],a,T[0]),Vector3.transformCoordinate(T[1],a,T[1]),Vector3.transformCoordinate(T[2],a,T[2]);var D=g.triangleNormals;return Vector3.transformCoordinate(D[0],a,D[0]),Vector3.transformCoordinate(D[1],a,D[1]),Vector3.transformCoordinate(D[2],a,D[2]),h=y,g.cloneTo(n),!0}return!1}}return!1},i._onWorldMatrixChanged=function(){this._needUpdate=!0},i._added=function(){this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},i._getType=function(){return 3},i._collisonTo=function(t){var e=0,i=0,n=this.mesh._positions;switch(t._getType()){case 0:var r=t;if(0!==Collision.sphereContainsBox(r.boundSphere,this._boundBox)){for(e=0,i=n.length;i>e;e++)if(1===Collision.sphereContainsPoint(r.boundSphere,n[e]))return!0;return!1}return!1;case 1:var a=t;if(0!==a.boundBox.containsBoundBox(this._boundBox)){for(e=0,i=n.length;i>e;e++)if(1===a.boundBox.containsPoint(n[e]))return!0;return!1}return!1;case 2:var s=t;return 1!==Collision.intersectsBoxAndBox(s._boundBox,this._boundBox)?!0:!1;default:throw new Error("MeshCollider:unknown collider type.")}},i._cloneTo=function(t){var e=t;e.mesh=this._mesh},i.raycast=function(t,e,i){if(void 0===i&&(i=1.79e308),null==this._mesh||!this._mesh.loaded)return!1;var n=Collision.intersectsRayAndBoxRD(t,this._boundBox);return-1!==n&&i>=n&&this._raycastMesh(t,this._owner,e,i)?!0:(e.distance=-1,e.sprite3D=null,!1)},__getset(0,i,"_boundBox",function(){return this._updateBoundBoxCollider(),this._transformBoundingBox}),__getset(0,i,"mesh",function(){return this._mesh},function(t){this._mesh=t}),__static(e,["_tempRay0",function(){return this._tempRay0=new Ray(new Vector3,new Vector3)},"_tempVector30",function(){return this._tempVector30=new Vector3},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new Matrix4x4},"_tempRaycastHit",function(){return this._tempRaycastHit=new RaycastHit},"_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3]}]),e}(Collider),SphereCollider=function(t){function e(){this._originalBoundSphere=null,this._transformBoundSphere=null,e.__super.call(this),this._translate=new Vector3,this._position=new Vector3,this._tempM4=new Matrix4x4,this._tempCenter=new Vector3,this._needUpdate=!1}__class(e,"laya.d3.component.physics.SphereCollider",t);var i=e.prototype;return i._updateCollider=function(){if(this._needUpdate){var t=0/0,e=this._owner.transform,i=e.scale;t=i.x>=i.y&&i.x>=i.z?i.x:i.y>=i.z?i.y:i.z,Vector3.transformCoordinate(this._originalBoundSphere.center,e.worldMatrix,this._transformBoundSphere.center),this._transformBoundSphere.radius=this._originalBoundSphere.radius*t,this._needUpdate=!1}},i._onWorldMatrixChanged=function(){this._needUpdate=!0;for(var t in this._runtimeCollisonMap)this._runtimeCollisonTestMap[t]=!0,this._runtimeCollisonMap[t]._runtimeCollisonTestMap[this.id]=!0},i._parse=function(t){this.isTrigger=t.isTrigger;var e=this.center;e.fromArray(t.center),this.center=e,this.radius=t.radius},i._added=function(){t.prototype._added.call(this),this._originalBoundSphere=new BoundSphere(new Vector3(0,0,0),.5),this._transformBoundSphere=new BoundSphere(new Vector3(0,0,0),.5),this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},i._getType=function(){return 0},i._collisonTo=function(t){switch(t._getType()){case 0:return 0!==Collision.sphereContainsSphere(this.boundSphere,t.boundSphere);case 1:return 0!==t.boundBox.containsSphere(this.boundSphere);case 2:return!1;case 3:var e=t;if(0!==Collision.sphereContainsBox(this.boundSphere,e._boundBox)){for(var i=e.mesh._positions,n=0,r=i.length;r>n;n++)if(1===Collision.sphereContainsPoint(this.boundSphere,i[n]))return!0;return!1}return!1;default:throw new Error("SphereCollider:unknown collider type.")}},i._cloneTo=function(t){var e=t;e.radius=this.radius;var i=e.center;this.center.cloneTo(i),e.center=i},i.raycast=function(t,e,i){void 0===i&&(i=1.79e308),this._updateCollider();var n=this._transformBoundSphere.intersectsRayPoint(t,e.position);return-1!==n&&i>=n?(e.distance=n,e.sprite3D=this._owner,!0):(e.distance=-1,e.sprite3D=null,!1)},i.setFromBoundSphere=function(t){this.center=t.center.clone(),this.radius=t.radius,this._needUpdate=!0;var e=this._owner;e.scene._enablePhysics&&this.setPhysicsGeomertyData()},i.setFromCustomData=function(t,e){this.center=new Vector3(t.x,t.y,t.z),this.radius=e;var i=this._owner;i.scene._enablePhysics&&this.setPhysicsGeomertyData()},i.setPhysicsGeomertyData=function(){var t=this._owner;if(t.scene._enablePhysics){var e=new GeometrySphere(this.radius,this.center,t.transform.scale);t.scene.physicsSystem.addShape(t.compoundShape,e)}},i._awake=function(){t.prototype._awake.call(this);var e=this._owner;e.scene._enablePhysics&&this._originalBoundSphere},__getset(0,i,"center",function(){return this._originalBoundSphere.center},function(t){this._originalBoundSphere.center=t}),__getset(0,i,"radius",function(){return this._originalBoundSphere.radius},function(t){this._originalBoundSphere.radius=t}),__getset(0,i,"boundSphere",function(){return this._updateCollider(),this._transformBoundSphere}),e}(Collider),ShaderInstance=function(t){function e(t,i,n,r){if(e.__super.call(this),!t||!i)throw"Shader Error";this._vs=t,this._ps=i,this._attributeMap=n,this._uniformMap=r,this._create()}__class(e,"laya.d3.shader.ShaderInstance",t);var i=e.prototype;return i._create=function(){var t=LayaGL.instance;if(this._program=t.createProgram(),this._vshader=this._createShader(t,this._vs,35633),this._pshader=this._createShader(t,this._ps,35632),t.attachShader(this._program,this._vshader),t.attachShader(this._program,this._pshader),t.linkProgram(this._program),!Render.isConchApp&&Shader3D.debugMode&&!t.getProgramParameter(this._program,35714))throw t.getProgramInfoLog(this._program);var e,i=0,n=0,r=0;for(r=Render.isConchApp?t.getProgramParameterEx(this._vs,this._ps,"",35721):t.getProgramParameter(this._program,35721),this._attributeParamsMap=LayaGL.instance.createCommandEncoder(4*r*4+4,64,!0),i=0;r>i;i++){var a=null;a=Render.isConchApp?t.getActiveAttribEx(this._vs,this._ps,"",i):t.getActiveAttrib(this._program,i);var s=a.name;e=new ShaderVariable,e.location=t.getAttribLocation(this._program,s),e.name=s,e.type=a.type,null!=this._attributeMap[s]?(e.dataOffset=this._attributeMap[s],this._addShaderAttribute(this._attributeParamsMap,e)):console.log("Shader:can't find uinform name:"+s+" in shader file.")}var o=[],l=[],_=[],h=[],u=[];this._customUniformParamsMap=[];var c=0;for(c=Render.isConchApp?t.getProgramParameterEx(this._vs,this._ps,"",35718):t.getProgramParameter(this._program,35718),WebGLContext.useProgram(t,this._program),this._curActTexIndex=0,i=0;c>i;i++){var d=null;d=Render.isConchApp?t.getActiveUniformEx(this._vs,this._ps,"",i):t.getActiveUniform(this._program,i);var f=d.name;e=new ShaderVariable,e.location=t.getUniformLocation(this._program,f),f.indexOf("[0]")>0?(e.name=f=f.substr(0,f.length-3),e.isArray=!0):(e.name=f,e.isArray=!1),e.type=d.type,this._addShaderUnifiormFun(e);var m=this._uniformMap[f];if(null!=m)switch(e.dataOffset=m[0],m[1]){case 0:u.push(e);break;case 1:h.push(e);break;case 2:_.push(e);break;case 3:l.push(e);break;case 4:o.push(e);break;default:throw new Error("Shader3D: period is unkonw.")}else console.log("Shader3D:can't find uinform name:"+this._uniformMap[e.name]+" in shader file.")}for(this._sceneUniformParamsMap=LayaGL.instance.createCommandEncoder(4*o.length*5+4,64,!0),i=0,n=o.length;n>i;i++)this._sceneUniformParamsMap.addShaderUniform(o[i]);for(this._cameraUniformParamsMap=LayaGL.instance.createCommandEncoder(4*l.length*5+4,64,!0),i=0,n=l.length;n>i;i++)this._cameraUniformParamsMap.addShaderUniform(l[i]);for(this._spriteUniformParamsMap=LayaGL.instance.createCommandEncoder(4*_.length*5+4,64,!0),i=0,n=_.length;n>i;i++)this._spriteUniformParamsMap.addShaderUniform(_[i]);for(this._materialUniformParamsMap=LayaGL.instance.createCommandEncoder(4*h.length*5+4,64,!0),i=0,n=h.length;n>i;i++)this._materialUniformParamsMap.addShaderUniform(h[i]);for(this._customUniformParamsMap.length=u.length,i=0,n=u.length;n>i;i++){var p=u[i];this._customUniformParamsMap[p.dataOffset]=p}Render.isConchApp&&(this._shaderParamsIDs=new Int32Array(5),LayaGL.createArrayBufferRef(this._shaderParamsIDs,0,!0),this._shaderParamsIDs[0]=this._attributeParamsMap.getPtrID(),this._shaderParamsIDs[1]=this._sceneUniformParamsMap.getPtrID(),this._shaderParamsIDs[2]=this._cameraUniformParamsMap.getPtrID(),this._shaderParamsIDs[3]=this._spriteUniformParamsMap.getPtrID(),this._shaderParamsIDs[4]=this._materialUniformParamsMap.getPtrID())},i._disposeResource=function(){LayaGL.instance.deleteShader(this._vshader),LayaGL.instance.deleteShader(this._pshader),LayaGL.instance.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._setGPUMemory(0),this._curActTexIndex=0},i._addShaderAttribute=function(t,e){e.caller=this,e.fun=this._attribute,t.addShaderAttribute(e)},i._addShaderUnifiormFun=function(t){var e=LayaGL.instance;t.caller=this;var i=t.isArray;switch(t.type){case 35670:t.fun=this._uniform1i,t.uploadedValue=new Array(1);break;case 5124:t.fun=i?this._uniform1iv:this._uniform1i,t.uploadedValue=new Array(1);break;case 5126:t.fun=i?this._uniform1fv:this._uniform1f,t.uploadedValue=new Array(1);break;case 35664:t.fun=i?this._uniform_vec2v:this._uniform_vec2,t.uploadedValue=new Array(2);break;case 35665:t.fun=i?this._uniform_vec3v:this._uniform_vec3,t.uploadedValue=new Array(3);break;case 35666:t.fun=i?this._uniform_vec4v:this._uniform_vec4,t.uploadedValue=new Array(4);break;case 35674:t.fun=this._uniformMatrix2fv;break;case 35675:t.fun=this._uniformMatrix3fv;break;case 35676:t.fun=i?this._uniformMatrix4fv:this._uniformMatrix4f;break;case 35678:e.uniform1i(t.location,this._curActTexIndex),t.textureID=WebGLContext._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_sampler2D;break;case 35679:e.uniform1i(t.location,this._curActTexIndex),t.textureID=WebGLContext._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_sampler3D;break;case 35680:e.uniform1i(t.location,this._curActTexIndex),t.textureID=WebGLContext._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_samplerCube;break;default:throw new Error("compile shader err!")}},i._createShader=function(t,e,i){var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),Shader3D.debugMode&&!t.getShaderParameter(n,35713))throw t.getShaderInfoLog(n);return n},i._attribute=function(t,e){var i=LayaGL.instance,n=Buffer._bindedAtributeBuffer,r=Buffer._bindedAttributeDeclaration,a=t.location,s=Buffer._bindedVertexBuffer;return n[a]||i.enableVertexAttribArray(a),n[a]!==s||r[a]!==e?(i.vertexAttribPointer(a,e[0],e[1],e[2],e[3],e[4]),n[a]=s,r[a]=e,1):0},i._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(LayaGL.instance.uniform1f(t.location,i[0]=e),1):0},i._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(LayaGL.instance.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return LayaGL.instance.uniform1fv(t.location,e),1},i._uniform_vec2=function(t,e){var i=e.elements,n=t.uploadedValue;return n[0]!==i[0]||n[1]!==i[1]?(LayaGL.instance.uniform2f(t.location,n[0]=i[0],n[1]=i[1]),1):0},i._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(LayaGL.instance.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return LayaGL.instance.uniform2fv(t.location,e),1},i._uniform_vec3=function(t,e){var i=e.elements,n=t.uploadedValue;return n[0]!==i[0]||n[1]!==i[1]||n[2]!==i[2]?(LayaGL.instance.uniform3f(t.location,n[0]=i[0],n[1]=i[1],n[2]=i[2]),1):0},i._uniform_vec3v=function(t,e){return LayaGL.instance.uniform3fv(t.location,e),1},i._uniform_vec4=function(t,e){var i=e.elements,n=t.uploadedValue;return n[0]!==i[0]||n[1]!==i[1]||n[2]!==i[2]||n[3]!==i[3]?(LayaGL.instance.uniform4f(t.location,n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3]),1):0},i._uniform_vec4v=function(t,e){return LayaGL.instance.uniform4fv(t.location,e),1},i._uniformMatrix2fv=function(t,e){return LayaGL.instance.uniformMatrix2fv(t.location,!1,e),1},i._uniformMatrix3fv=function(t,e){return LayaGL.instance.uniformMatrix3fv(t.location,!1,e),1},i._uniformMatrix4f=function(t,e){var i=e.elements;return LayaGL.instance.uniformMatrix4fv(t.location,!1,i),1},i._uniformMatrix4fv=function(t,e){return LayaGL.instance.uniformMatrix4fv(t.location,!1,e),1},i._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(LayaGL.instance.uniform1i(t.location,i[0]=e),1):0},i._uniform1iv=function(t,e){return LayaGL.instance.uniform1iv(t.location,e),1},i._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(LayaGL.instance.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_ivec2v=function(t,e){return LayaGL.instance.uniform2iv(t.location,e),1},i._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(LayaGL.instance.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3vi=function(t,e){return LayaGL.instance.uniform3iv(t.location,e),1},i._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(LayaGL.instance.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4vi=function(t,e){return LayaGL.instance.uniform4iv(t.location,e),1},i._uniform_sampler2D=function(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),n=LayaGL.instance;return WebGLContext.activeTexture(n,t.textureID),WebGLContext.bindTexture(n,3553,i),0},i._uniform_sampler3D=function(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),n=LayaGL.instance;return WebGLContext.activeTexture(n,t.textureID),WebGLContext.bindTexture(n,32879,i),0},i._uniform_samplerCube=function(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),n=LayaGL.instance;return WebGLContext.activeTexture(n,t.textureID),WebGLContext.bindTexture(n,34067,i),0},i.bind=function(){return WebGLContext.useProgram(LayaGL.instance,this._program)},i.uploadAttributes=function(t){Stat.shaderCall+=LayaGLRunner.uploadVertexBufferAttributes(LayaGL.instance,this._attributeParamsMap,t._data)},i.uploadMultiAttributes=function(t){Stat.shaderCall+=LayaGLRunner.uploadMultiVertexBufferAttributes(LayaGL.instance,this._attributeParamsMap,t)},i.uploadUniforms=function(t,e,i){Stat.shaderCall+=LayaGLRunner.uploadShaderUniforms(LayaGL.instance,t,e._data,i)},i.uploadCustomUniform=function(t,e){Stat.shaderCall+=LayaGLRunner.uploadCustomUniform(LayaGL.instance,this._customUniformParamsMap,t,e)},i._uniformMatrix2fvForNative=function(t,e){return LayaGL.instance.uniformMatrix2fvEx(t.location,!1,e),1},i._uniformMatrix3fvForNative=function(t,e){return LayaGL.instance.uniformMatrix3fvEx(t.location,!1,e),1},i._uniformMatrix4fvForNative=function(t,e){return LayaGL.instance.uniformMatrix4fvEx(t.location,!1,e),1},i.uploadShaderParamForNative=function(t,e,i,n,r){Stat.shaderCall+=LayaGL.instance.uploadShaderParamForNative(this._shaderParamsIDs,t,e,i,n,r)},e}(Resource),TerrainHeightData=function(t){function e(){this._terrainHeightData=null,this._width=0,this._height=0,this._bitType=0,this._value=0/0,e.__super.call(this)}__class(e,"laya.d3.terrain.TerrainHeightData",t);var i=e.prototype;return i._onAsynLoaded=function(t,e){this._width=e[0],this._height=e[1],this._bitType=e[2],this._value=e[3];var i,n=0/0;8==this._bitType?(i=new Uint8Array(t),n=1/255):16==this._bitType&&(i=new Int16Array(t),n=1/32766),this._terrainHeightData=new Float32Array(this._height*this._width);for(var r=0,a=this._height*this._width;a>r;r++)this._terrainHeightData[r]=i[r]*n*this._value/2},e.load=function(t,i,n,r,a){return Laya.loader.create(t,null,null,e,[i,n,r,a],1,!1)},e}(Resource),TextSV=function(t){function e(){e.__super.call(this,64),this.defines.add(64)}__class(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;return i.release=function(){e.pool[e._length++]=this,this.clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(TextureSV),TerrainRes=function(t){function e(){this._version=0/0,this._cameraCoordinateInverse=!1,this._gridSize=0/0,this._chunkNumX=0,this._chunkNumZ=0,this._heightDataX=0,this._heightDataZ=0,this._heightDataBitType=0,this._heightDataValue=0/0,this._heightDataUrl=null,this._detailTextureInfos=null,this._chunkInfos=null,this._heightData=null,this._materialInfo=null,this._alphaMaps=null,this._normalMaps=null,e.__super.call(this)}__class(e,"laya.d3.terrain.TerrainRes",t);var i=e.prototype;return i.parseData=function(t){var e=t[0],i=t[1];if(this._version=e.version,1==this._version){this._cameraCoordinateInverse=e.cameraCoordinateInverse,this._gridSize=e.gridSize,this._chunkNumX=e.chunkNumX,this._chunkNumZ=e.chunkNumZ;var n=e.heightData;if(this._heightDataX=n.numX,this._heightDataZ=n.numZ,this._heightDataBitType=n.bitType,this._heightDataValue=n.value,this._heightDataUrl=i[n.url],this._materialInfo=new MaterialInfo,e.material){var r=e.material.ambient,a=e.material.diffuse,s=e.material.specular;this._materialInfo.ambientColor=new Vector3(r[0],r[1],r[2]),this._materialInfo.diffuseColor=new Vector3(a[0],a[1],a[2]),this._materialInfo.specularColor=new Vector4(s[0],s[1],s[2],s[3])}var o=e.detailTexture;this._detailTextureInfos=__newvec(o.length);for(var l=0;l<o.length;l++){var _=o[l],h=new DetailTextureInfo;h.diffuseTexture=i[_.diffuse],h.normalTexture=_.normal?i[_.normal]:null,h.scale=_.scale?new Vector2(_.scale[0],_.scale[1]):new Vector2(1,1),h.offset=_.offset?new Vector2(_.offset[0],_.offset[1]):new Vector2(0,0),this._detailTextureInfos[l]=h}var u=e.alphaMap;for(this._alphaMaps=__newvec(u.length),l=0;l<this._alphaMaps.length;l++)this._alphaMaps[l]=e.alphaMap[l];var c=e.normalMap;for(this._normalMaps=__newvec(c.length),l=0;l<this._normalMaps.length;l++)this._normalMaps[l]=e.normalMap[l];var d=e.chunkInfo;if(this._chunkNumX*this._chunkNumZ!=d.length)return alert("terrain data error"),!1;for(this._chunkInfos=__newvec(d.length),l=0;l<d.length;l++){var f=d[l],m=new ChunkInfo,p=f.alphaMap.length,g=f.detailID.length;if(p!=g)return alert("terrain chunk data error"),!1;m.alphaMap=__newvec(p),m.detailID=__newvec(g),m.normalMap=i[this._normalMaps[f.normalMap]];for(var v=0;p>v;v++){m.alphaMap[v]=i[this._alphaMaps[f.alphaMap[v]]];var x=f.detailID[v],y=x.length;m.detailID[v]=new Uint8Array(y);for(var T=0;y>T;T++)m.detailID[v][T]=x[T]}this._chunkInfos[l]=m}this._heightData=Loader.getRes(this._heightDataUrl),this.onLoadTerrainComplete(this._heightData)}return!0},i.onLoadTerrainComplete=function(){},i._onAsynLoaded=function(t){this.parseData(t)},e.load=function(t){return Laya.loader.create(t,null,null,e,null,1,!1)},e}(Resource),MeshRender=function(t){function e(t,i){e.__super.call(this,t,i),this._projectionViewWorldMatrix=new Matrix4x4,t&&t.meshFilter.on("meshchanged",this,this._onMeshChanged)}__class(e,"laya.d3.core.MeshRender",t);var i=e.prototype;return i._onMeshChanged=function(t,e,i){i.loaded?this._onMeshLoaed():i.once("loaded",this,this._onMeshLoaed)
},i._onMeshLoaed=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},i._calculateBoundingSphereByInitSphere=function(t){var e=0/0,i=this._owner.transform,n=i.scale.elements,r=n[0];r||(r=-r);var a=n[1];a||(a=-a);var s=n[2];if(s||(s=-s),e=r>=a&&r>=s?r:a>=s?a:s,Vector3.transformCoordinate(t.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*e,Render.isConchApp){var o=this._boundingSphere.center.elements,l=FrustumCulling._cullingBuffer;l[this._cullingBufferIndex+1]=o[0],l[this._cullingBufferIndex+2]=o[1],l[this._cullingBufferIndex+3]=o[2],l[this._cullingBufferIndex+4]=this._boundingSphere.radius}},i._calculateBoundBoxByInitCorners=function(t){for(var e=this._owner.transform.worldMatrix,i=0;8>i;i++)BoundBox.createfromPoints(BaseRender._tempBoundBoxCorners,this._boundingBox);Vector3.transformCoordinate(t[i],e,BaseRender._tempBoundBoxCorners[i])},i._calculateBoundingSphere=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(t.boundingSphere)},i._calculateBoundingBox=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(t.boundingBoxCorners)},i._needRender=function(t){return t?0!==t.containsBoundSphere(this.boundingSphere):!0},i._renderUpdate=function(t,e){e?this._shaderValues.setMatrix4x4(0,e.worldMatrix):this._shaderValues.setMatrix4x4(0,Matrix4x4.DEFAULT)},i._renderUpdateWithCamera=function(t,e){var i=t.projectionViewMatrix;e?(Matrix4x4.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(1,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(1,i),Laya3D.debugMode&&this._renderRenderableBoundBox()},i._destroy=function(){this._isPartOfStaticBatch&&MeshRenderStaticBatchManager.instance._destroyRenderSprite(this._owner),t.prototype._destroy.call(this)},e}(BaseRender),ShurikenParticleRender=function(t){function e(t){this._finalGravity=new Vector3,this._tempRotationMatrix=new Matrix4x4,e.__super.call(this,t,52),this._defaultBoundBox=new BoundBox(new Vector3,new Vector3),this._renderMode=-1,this.stretchedBillboardCameraSpeedScale=0,this.stretchedBillboardSpeedScale=0,this.stretchedBillboardLengthScale=1}__class(e,"laya.d3.core.particleShuriKen.ShurikenParticleRender",t);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._owner.particleSystem._boundingSphere,e=0/0,i=this._owner.transform,n=i.scale.elements,r=Math.abs(n[0]),a=Math.abs(n[1]),s=Math.abs(n[2]);e=r>=a&&r>=s?r:a>=s?a:s,Vector3.transformCoordinate(t.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*e},i._needRender=function(t){return t?0!==t.containsBoundSphere(this.boundingSphere)?this._owner.particleSystem.isAlive?!0:!1:!1:!0},i._renderUpdate=function(){var t=this._owner.particleSystem,e=this._shaderValues,i=this._owner.transform;switch(t.simulationSpace){case 0:break;case 1:e.setVector(0,i.position),e.setQuaternion(1,i.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(t.scaleMode){case 0:var n=i.scale;e.setVector(4,n),e.setVector(5,n);break;case 1:var r=i.localScale;e.setVector(4,r),e.setVector(5,r);break;case 2:e.setVector(4,i.scale),e.setVector(5,Vector3.ONE)}Vector3.scale(Physics.gravity,t.gravityModifier,this._finalGravity),e.setVector(7,this._finalGravity),e.setInt(11,t.simulationSpace),e.setBool(8,t.threeDStartRotation),e.setInt(6,t.scaleMode),e.setInt(9,this.stretchedBillboardLengthScale),e.setInt(10,this.stretchedBillboardSpeedScale),e.setNumber(12,t._currentTime),Laya3D.debugMode&&this._renderRenderableBoundBox()},i._destroy=function(){t.prototype._destroy.call(this),this._mesh&&(this._mesh._removeReference(),this._mesh=null)},__getset(0,i,"boundingBox",function(){return this._owner.particleSystem.isAlive?(this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox):this._defaultBoundBox}),__getset(0,i,"renderMode",function(){return this._renderMode},function(t){if(this._renderMode!==t){var e=this._defineDatas;switch(this._renderMode){case 0:e.remove(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:e.remove(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:e.remove(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:e.remove(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:e.remove(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_MESH)}switch(this._renderMode=t,t){case 0:e.add(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:e.add(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:e.add(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:e.add(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:e.add(ShuriKenParticle3D.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}this._owner.particleSystem._initBufferDatas()}}),__getset(0,i,"mesh",function(){return this._mesh},function(t){this._mesh!==t&&(this._mesh&&this._mesh._removeReference(),this._mesh=t,t&&t._addReference(),this._owner.particleSystem._initBufferDatas())}),e}(BaseRender),MiniSoundChannel=function(t){function e(t,i){this._audio=null,this._onEnd=null,this._miniSound=null,e.__super.call(this),this._audio=t,this._miniSound=i,this._onEnd=e.bindToThis(this.__onEnd,this),t.onEnded(this._onEnd)}__class(e,"laya.wx.mini.MiniSoundChannel",t);var i=e.prototype;return i.__onEnd=function(){return 1==this.loops?(this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),this.event("complete"),void 0):(this.loops>0&&this.loops--,this.startTime=0,this.play(),void 0)},i.play=function(){this.isStopped=!1,SoundManager.addChannel(this),this._audio.play()},i.stop=function(){this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.pause(),this._audio.offEnded(null),this._audio=null,this._miniSound=null,this._onEnd=null)},i.pause=function(){this.isStopped=!0,this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,SoundManager.addChannel(this),this._audio.play())},__getset(0,i,"autoplay",function(){return this._audio.autoplay},function(t){this._audio.autoplay=t}),__getset(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),__getset(0,i,"duration",function(){return this._audio?this._audio.duration:0}),__getset(0,i,"loop",function(){return this._audio.loop},function(t){this._audio.loop=t}),__getset(0,i,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),e.bindToThis=function(t,e){var i=t;return i=t.bind(e)},e}(SoundChannel),TrailRenderer=function(t){function e(t){this._projectionViewWorldMatrix=new Matrix4x4,e.__super.call(this,t)}__class(e,"laya.d3.core.trail.TrailRenderer",t);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},i._needRender=function(){return!0},i._renderUpdate=function(e){t.prototype._renderUpdate.call(this,e),this._owner.trailFilter._update(e)},i._renderUpdateWithCamera=function(t,e){var i=t.projectionViewMatrix;e?(Matrix4x4.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(1,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(1,i),Laya3D.debugMode&&this._renderRenderableBoundBox()},e}(BaseRender),TerrainRender=function(t){function e(t){this._terrainSprite3DOwner=null,this._projectionViewWorldMatrix=null,e.__super.call(this,t),this._terrainSprite3DOwner=t,this._projectionViewWorldMatrix=new Matrix4x4}__class(e,"laya.d3.terrain.TerrainRender",t);var i=e.prototype;return i._calculateBoundingSphere=function(){var t=this._terrainSprite3DOwner.terrainFilter;if(null==t)this._boundingSphere.toDefault();else{var e=t._boundingSphere,i=0/0,n=this._terrainSprite3DOwner.transform,r=n.scale;i=r.x>=r.y&&r.x>=r.z?r.x:r.y>=r.z?r.y:r.z,Vector3.transformCoordinate(e.center,n.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=e.radius*i,t.calcLeafBoudingSphere(n.worldMatrix,i)}},i._needRender=function(t){return t?0!==t.containsBoundSphere(this.boundingSphere):!0},i._calculateBoundingBox=function(){var t=this._terrainSprite3DOwner.terrainFilter;if(null==t)this._boundingBox.toDefault();else{for(var e=this._terrainSprite3DOwner.transform.worldMatrix,i=t._boundingBoxCorners,n=0;8>n;n++)Vector3.transformCoordinate(i[n],e,BaseRender._tempBoundBoxCorners[n]);BoundBox.createfromPoints(BaseRender._tempBoundBoxCorners,this._boundingBox),t.calcLeafBoudingBox(e)}},i._renderUpdate=function(t,e){var i=t.projectionViewMatrix,n=this._shaderValues,r=e.worldMatrix;n.setMatrix4x4(0,r),Matrix4x4.multiply(i,r,this._projectionViewWorldMatrix),n.setMatrix4x4(1,this._projectionViewWorldMatrix)},i._destroy=function(){t.prototype._destroy.call(this),this._terrainSprite3DOwner=null},e}(BaseRender),Maggot=function(t){function e(){this.direction=0/0,this.turningSpeed=0/0,this.speed=0/0,this.offset=0/0,e.__super.call(this)}return __class(e,"test.Maggot",t),e}(Sprite),Scene=function(t){function e(){this._viewCreated=!1,this.awaked=!1,e.__super.call(this),this.createChildren()}__class(e,"laya.display.Scene",t);var i=e.prototype;return i.createChildren=function(){},i.createView=function(t){t&&!this._viewCreated&&(this._viewCreated=!0,SceneUtils.createByData(this,t))},i._awake=function(){this.awaked||(this.awaked=!0,this.awake())},i.awake=function(){},i.loadScene=function(t){var e=t+".scene",i=Laya.loader.getRes(e);i?this.createView(i):Laya.loader.load(e,Handler.create(this,this.createView),null,"json")},__getset(1,e,"root",function(){return e._root||(e._root=Laya.stage.addChild(new Sprite)),e._root},laya.display.Sprite._$SET_root),e.add=function(t,i){void 0===i&&(i=!0),i&&e.root.removeChildren(),e.root.addChild(t)},e.load=function(t,i,n){void 0===i&&(i=!0),i&&e.root.removeChildren(),Laya.loader.load(t,Handler.create(null,e._onSceneLoaded,[i,n]),null,"json")},e._onSceneLoaded=function(t,i,n){if(n){Laya.loader.resetProgress();var r=n.props&&n.props.runtime?n.props.runtime:n.type,a=ClassUtils.getInstance(r);a.createView(n),e.add(a,t),i&&i.run(a)}},e.create=function(t,i){if(void 0===i&&(i=!1),t){var n=new t;return e.add(n,i),n}return null},e._root=null,e}(Sprite),AnimationBase=function(t){function e(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._actionName=null,this._controlNode=null,e.__super.call(this),this._interval=Config.animationInterval,this._setBitUp(1)}__class(e,"laya.display.AnimationBase",t);var i=e.prototype;return i.play=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),this._isPlaying=!0,this._actionName=i,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._isReverse=1===this.wrapMode,this.interval>0&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},i._getFrameByLabel=function(t){for(var e=0;e<this._count;e++){var i=this._labels[e];if(i&&i.indexOf(t)>-1)return e}return 0},i._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),this.event("complete"),void 0;2==this.wrapMode?(this._index=this._count>0?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),this.event("complete"),void 0;2==this.wrapMode?(this._index=this._count-2>=0?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},i._setControlNode=function(t){this._controlNode&&(this._controlNode.off("display",this,this._resumePlay),this._controlNode.off("undisplay",this,this._resumePlay)),this._controlNode=t,t&&t!=this&&(t.on("display",this,this._resumePlay),t.on("undisplay",this,this._resumePlay))},i._setDisplay=function(e){t.prototype._setDisplay.call(this,e),this._resumePlay()},i._resumePlay=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},i.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},i.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]||(this._labels[e]=[]),this._labels[e].push(t)},i.removeLabel=function(t){if(t){if(this._labels)for(var e in this._labels)this._removeLabelFromList(this._labels[e],t)}else this._labels=null},i._removeLabelFromList=function(t,e){if(t)for(var i=t.length-1;i>=0;i--)t[i]==e&&t.splice(i,1)},i.gotoAndStop=function(t){this.index="string"==typeof t?this._getFrameByLabel(t):t,this.stop()},i._displayToIndex=function(){},i.clear=function(){return this.stop(),this._labels=null,this},__getset(0,i,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._frameRateChanged=!0,this._interval=t,this._isPlaying&&t>0&&this.timerLoop(t,this,this._frameLoop,null,!0,!0))}),__getset(0,i,"isPlaying",function(){return this._isPlaying}),__getset(0,i,"index",function(){return this._index},function(t){if(this._index=t,this._displayToIndex(t),this._labels&&this._labels[t])for(var e=this._labels[t],i=0,n=e.length;n>i;i++)this.event("label",e[i])}),__getset(0,i,"count",function(){return this._count}),e.WRAP_POSITIVE=0,e.WRAP_REVERSE=1,e.WRAP_PINGPONG=2,e}(Sprite),Text=function(t){function e(){this._clipPoint=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=0/0,this._startY=0/0,this._words=null,this._charSize={},this._valign="top",this._color="#000000",e.__super.call(this),this._fontSize=e.defaultFontSize,this._font=e.defaultFont,this.overflow="visible",this._style=TextStyle.EMPTY}__class(e,"laya.display.Text",t);var i=e.prototype;return i.getStyle=function(){return this._style===TextStyle.EMPTY&&(this._style=TextStyle.create()),this._style},i._getTextStyle=function(){return this._style===TextStyle.EMPTY&&(this._style=TextStyle.create()),this._style},i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._clipPoint=null,this._lines=null,this._lineWidths=null,this._words=null,this._charSize=null},i._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=Rectangle.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()},i.getGraphicBounds=function(t){void 0===t&&(t=!1);var e=Rectangle.TEMP;return e.setTo(0,0,this.width,this.height),e},i._getCSSStyle=function(){return this._style},i.lang=function(t){if(t=e.langPacks&&e.langPacks[t]?e.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var i=0,n=arguments.length;n>i;i++)t=t.replace("{"+i+"}",arguments[i+1]);this._text=t}},i._getContextFont=function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Browser.onIPhone?laya.display.Text.fontFamilyMap[this.font]||this.font:this.font)},i._renderText=function(){var t=this.padding,e=this._lines.length;"visible"!=this.overflow&&(e=Math.min(e,Math.floor((this.height-t[0]-t[2])/(this.leading+this._charSize.height))+1));var i=this.scrollY/(this._charSize.height+this.leading)|0,n=this.graphics;n.clear(!0);var r=this._getContextFont();Browser.context.font=r;var a=t[3],s="left",o=this._lines,l=this.leading+this._charSize.height,_=this._style.currBitmapFont;_&&(l=this.leading+_.getMaxHeight());var h=t[0];if(!_&&this._width>0&&this._textWidth<=this._width&&("right"==this.align?(s="right",a=this._width-t[1]):"center"==this.align&&(s="center",a=.5*this._width+t[3]-t[1])),this._height>0){var u=this._textHeight>this._height?"top":this.valign;"middle"===u?h=.5*(this._height-e*l)+t[0]-t[2]:"bottom"===u&&(h=this._height-e*l-t[2])}var c=this._style;if(_&&_.autoScaleSize)var d=_.fontSize/this.fontSize;if(this._clipPoint){if(n.save(),_&&_.autoScaleSize){var f=0,m=0;f=this._width?this._width-t[3]-t[1]:this._textWidth,m=this._height?this._height-t[0]-t[2]:this._textHeight,f*=d,m*=d,n.clipRect(t[3],t[0],f,m)}else n.clipRect(t[3],t[0],this._width?this._width-t[3]-t[1]:this._textWidth,this._height?this._height-t[0]-t[2]:this._textHeight);this.repaint()}var p=c.asPassword;"prompt"in this&&this.prompt==this._text&&(p=!1);for(var g=0,v=0,x=Math.min(this._lines.length,e+i)||1,y=i;x>y;y++){var T,D=o[y];if(p){var E=D.length;D="";for(var S=E;S>0;S--)D+="●"}if(g=a-(this._clipPoint?this._clipPoint.x:0),v=h+l*y-(this._clipPoint?this._clipPoint.y:0),this.underline&&this._drawUnderline(s,g,v,y),_){var M=this.width;_.autoScaleSize&&(M=this.width*d),_._drawText(D,this,g,v,this.align,M)}else Render.isWebGL?(this._words||(this._words=[]),T=this._words.length>y-i?this._words[y-i]:new WordText,T.setText(D)):T=D,c.stroke?n.fillBorderText(T,g,v,r,this.color,c.strokeColor,c.stroke,s):n.fillText(T,g,v,r,this.color,s)}if(_&&_.autoScaleSize){var R=1/d;this.scale(R,R)}this._clipPoint&&n.restore(),this._startX=a,this._startY=h},i._drawUnderline=function(t,e,i,n){var r=this._lineWidths[n];switch(t){case"center":e-=r/2;break;case"right":e-=r;break;case"left":}i+=this._charSize.height,this._graphics.drawLine(e,i,e+r,i,this.underlineColor||this.color,1)},i.typeset=function(){return this._isChanged=!1,this._text?(Render.isConchApp?window.conchTextCanvas.font=this._getContextFont():Browser.context.font=this._getContextFont(),this._lines.length=0,this._lineWidths.length=0,this._parseLines(this._text),this._evalTextSize(),this._checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new Point(0,0)):this._clipPoint=null,this._renderText(),void 0):(this._clipPoint=null,this._textWidth=this._textHeight=0,this.graphics.clear(!0),void 0)},i._evalTextSize=function(){var t=0/0,e=0/0;t=Math.max.apply(this,this._lineWidths),e=this._style.currBitmapFont?this._lines.length*(this._style.currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],(t!=this._textWidth||e!=this._textHeight)&&(this._textWidth=t,this._textHeight=e)},i._checkEnabledViewportOrNot=function(){return"scroll"==this.overflow&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)},i.changeText=function(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},i._parseLines=function(t){var i=this.wordWrap||"hidden"==this.overflow;if(i)var n=this._getWordWrapWidth();var r=this._style.currBitmapFont;if(r)this._charSize.width=r.getMaxWidth(),this._charSize.height=r.getMaxHeight();else{var a=null;a=Render.isConchApp?window.conchTextCanvas.measureText(this._testWord):Browser.context.measureText(e._testWord),this._charSize.width=a.width,this._charSize.height=a.height||this.fontSize}for(var s=t.replace(/\r\n/g,"\n").split("\n"),o=0,l=s.length;l>o;o++){var _=s[o];i?this._parseLine(_,n):(this._lineWidths.push(this._getTextWidth(_)),this._lines.push(_))}},i._parseLine=function(t,e){var i,n=(Browser.context,this._lines),r=0,a=0/0,s=0/0,o=0;if(a=this._getTextWidth(t),e>=a)return n.push(t),this._lineWidths.push(a),void 0;a=this._charSize.width,r=Math.floor(e/a),0==r&&(r=1),a=this._getTextWidth(t.substring(0,r)),s=a;for(var l=r,_=t.length;_>l;l++)if(a=this._getTextWidth(t.charAt(l)),s+=a,s>e)if(this.wordWrap){var h=t.substring(o,l);if(h.charCodeAt(h.length-1)<255&&(i=/(?:\w|-)+$/.exec(h),i&&(l=i.index+o,0==i.index?l+=h.length:h=t.substring(o,l))),n.push(h),this._lineWidths.push(s-a),o=l,!(_>l+r)){n.push(t.substring(o,_)),this._lineWidths.push(this._getTextWidth(n[n.length-1])),o=-1;break}l+=r,a=this._getTextWidth(t.substring(o,l)),s=a,l--}else if("hidden"==this.overflow)return n.push(t.substring(0,l)),this._lineWidths.push(this._getTextWidth(n[n.length-1])),void 0;this.wordWrap&&-1!=o&&(n.push(t.substring(o,_)),this._lineWidths.push(this._getTextWidth(n[n.length-1])))},i._getTextWidth=function(t){var e=this._style.currBitmapFont;return e?e.getTextWidth(t):Render.isConchApp?window.conchTextCanvas.measureText(t).width:Browser.context.measureText(t).width},i._getWordWrapWidth=function(){var t=this.padding,e=0/0,i=this._style.currBitmapFont;return e=i&&i.autoScaleSize?this._width*(i.fontSize/this.fontSize):this._width,0>=e&&(e=this.wordWrap?100:Browser.width),0>=e&&(e=100),e-t[3]-t[1]},i.getCharPoint=function(t,e){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);for(var i=0,n=this._lines,r=0,a=0,s=n.length;s>a;a++){if(i+=n[a].length,i>t){var o=a;break}r=i}var l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.context.font=l;var _=this._getTextWidth(this._text.substring(r,t)),h=e||new Point;return h.setTo(this._startX+_-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},__getset(0,i,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(t){t!=this._width&&(Laya.superSet(Sprite,this,"width",t),this.isChanged=!0)}),__getset(0,i,"textWidth",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textWidth}),__getset(0,i,"height",function(){return this._height?this._height:this.textHeight+this.padding[0]+this.padding[2]},function(t){t!=this._height&&(Laya.superSet(Sprite,this,"height",t),this.isChanged=!0)}),__getset(0,i,"textHeight",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textHeight}),__getset(0,i,"padding",function(){return this._style.padding},function(t){this._getTextStyle().padding=t,this.isChanged=!0}),__getset(0,i,"bold",function(){return this._style.bold},function(t){this._getTextStyle().bold=t,this.isChanged=!0}),__getset(0,i,"text",function(){return this._text||""},function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event("change"))}),__getset(0,i,"color",function(){return this._color},function(t){this._color!=t&&(this._color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),__getset(0,i,"font",function(){return this._font},function(t){this._style.currBitmapFont&&(this._getTextStyle().currBitmapFont=null,this.scale(1,1)),e._bitmapFonts&&e._bitmapFonts[t]&&(this._getTextStyle().currBitmapFont=e._bitmapFonts[t]),this._font=t,this.isChanged=!0}),__getset(0,i,"fontSize",function(){return this._fontSize},function(t){this._fontSize=t,this.isChanged=!0}),__getset(0,i,"italic",function(){return this._style.italic},function(t){this._getTextStyle().italic=t,this.isChanged=!0}),__getset(0,i,"align",function(){return this._style.align},function(t){this._getTextStyle().align=t,this.isChanged=!0}),__getset(0,i,"valign",function(){return this._valign},function(t){this._valign=t,this.isChanged=!0}),__getset(0,i,"wordWrap",function(){return this._style.wordWrap},function(t){this._getTextStyle().wordWrap=t,this.isChanged=!0}),__getset(0,i,"leading",function(){return this._style.leading},function(t){this._getTextStyle().leading=t,this.isChanged=!0}),__getset(0,i,"bgColor",function(){return this._style.bgColor},function(t){this._getTextStyle().bgColor=t,this._renderType|=128,this.isChanged=!0}),__getset(0,i,"borderColor",function(){return this._style.borderColor},function(t){this._getTextStyle().borderColor=t,this._renderType|=128,this.isChanged=!0}),__getset(0,i,"stroke",function(){return this._style.stroke},function(t){this._getTextStyle().stroke=t,this.isChanged=!0}),__getset(0,i,"strokeColor",function(){return this._style.strokeColor},function(t){this._getTextStyle().strokeColor=t,this.isChanged=!0}),__getset(0,i,"isChanged",null,function(t){this._isChanged!==t&&(this._isChanged=t,t&&Laya.timer.callLater(this,this.typeset))}),__getset(0,i,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(t){if(!("scroll"!=this.overflow||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=t>e?e:t,this._clipPoint.x=t,this._renderText()}}),__getset(0,i,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(t){if(!("scroll"!=this.overflow||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height;t=t>e?e:t,this._clipPoint.y=t,this._renderText()}}),__getset(0,i,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),__getset(0,i,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),__getset(0,i,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),__getset(0,i,"underlineColor",function(){return this._style.underlineColor},function(t){this._getTextStyle().underlineColor=t,this._isChanged||this._renderText()}),__getset(0,i,"underline",function(){return this._style.underline},function(t){this._getTextStyle().underline=t}),e.defaultFontStr=function(){return e.defaultFontSize+"px "+e.defaultFont},e.registerBitmapFont=function(t,i){e._bitmapFonts||(e._bitmapFonts={}),e._bitmapFonts[t]=i},e.unregisterBitmapFont=function(t,i){if(void 0===i&&(i=!0),e._bitmapFonts&&e._bitmapFonts[t]){var n=e._bitmapFonts[t];i&&n.destroy(),delete e._bitmapFonts[t]}},e.VISIBLE="visible",e.SCROLL="scroll",e.HIDDEN="hidden",e.defaultFontSize=12,e.defaultFont="Arial",e.langPacks=null,e.isComplexText=!1,e._testWord="游",e._bitmapFonts=null,e.CharacterCache=!0,__static(e,["fontFamilyMap",function(){return this.fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),e}(Sprite),Stage=function(t){function e(){function t(){"hidden"==Browser.document[a]?(i._isVisibility=!1,r._isInputting()&&(Input.inputElement.target.focus=!1)):i._isVisibility=!0,i.renderingEnabled=i._isVisibility,r.event("visibilitychange")}this.focus=null,this.frameRate="fast",this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._safariOffsetY=0,this._frameStartTime=0/0,this._isFocused=!1,this._isVisibility=!1,this._wgColor=[0,0,0,1],e.__super.call(this),this.offset=new Point,this._canvasTransform=new Matrix,this._previousOrientation=Browser.window.orientation;var i=this;this.transform=Matrix.create(),this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._setBit(8,!0),this._isFocused=!0,this._isVisibility=!0,this._activeInHierarchy=!0;var n=Browser.window,r=this;n.addEventListener("focus",function(){i._isFocused=!0,r.event("focus"),r.event("focuschange")}),n.addEventListener("blur",function(){i._isFocused=!1,r.event("blur"),r.event("focuschange"),r._isInputting()&&(Input.inputElement.target.focus=!1)});var a="visibilityState",s="visibilitychange",o=n.document;"undefined"!=typeof o.hidden?(s="visibilitychange",a="visibilityState"):"undefined"!=typeof o.mozHidden?(s="mozvisibilitychange",a="mozVisibilityState"):"undefined"!=typeof o.msHidden?(s="msvisibilitychange",a="msVisibilityState"):"undefined"!=typeof o.webkitHidden&&(s="webkitvisibilitychange",a="webkitVisibilityState"),n.document.addEventListener(s,t),n.addEventListener("resize",function(){var t=Browser.window.orientation;null!=t&&t!=i._previousOrientation&&r._isInputting()&&(Input.inputElement.target.focus=!1),i._previousOrientation=t,r._isInputting()||(Browser.onSafari&&(r._safariOffsetY=(Browser.window.__innerHeight||Browser.document.body.clientHeight||Browser.document.documentElement.clientHeight)-Browser.window.innerHeight),r._resetCanvas())}),n.addEventListener("orientationchange",function(){r._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),Browser.onMobile&&this.on("mousedown",this,this._onmouseMove)}__class(e,"laya.display.Stage",t);var i=e.prototype;return i._isInputting=function(){return Browser.onMobile&&Input.isInputting},i._changeCanvasSize=function(){this.setScreenSize(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio)},i._resetCanvas=function(){if(this.screenAdaptationEnabled){{var t=Render._mainCanvas;t.source.style}t.size(1,1),Laya.timer.once(100,this,this._changeCanvasSize)}},i.setScreenSize=function(t,e){var i=!1;if("none"!==this._screenMode){var n=1>t/e?"vertical":"horizontal";if(i=n!==this._screenMode){var r=e;e=t,t=r}}this.canvasRotation=i;var a=Render._mainCanvas,s=a.source.style,o=this._canvasTransform.identity(),l=this._scaleMode,_=t/this.designWidth,h=e/this.designHeight,u=this.designWidth,c=this.designHeight,d=t,f=e,m=Browser.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,l){case"noscale":_=h=1,d=this.designWidth,f=this.designHeight;break;case"showall":_=h=Math.min(_,h),u=d=Math.round(this.designWidth*_),c=f=Math.round(this.designHeight*h);break;case"noborder":_=h=Math.max(_,h),d=Math.round(this.designWidth*_),f=Math.round(this.designHeight*h);break;case"full":_=h=1,this._width=u=t,this._height=c=e;break;case"fixedwidth":h=_,this._height=c=Math.round(e/_);break;case"fixedheight":_=h,this._width=u=Math.round(t/h);break;case"fixedauto":t/e<this.designWidth/this.designHeight?(h=_,this._height=c=Math.round(e/_)):(_=h,this._width=u=Math.round(t/h))}_*=this.scaleX,h*=this.scaleY,1===_&&1===h?this.transform.identity():(this.transform.a=this._formatData(_/(d/u)),this.transform.d=this._formatData(h/(f/c))),a.size(u,c),RunDriver.changeWebGLSize(u,c),o.scale(d/u/m,f/c/m),this.offset.x="left"===this._alignH?0:"right"===this._alignH?t-d:.5*(t-d)/m,this.offset.y="top"===this._alignV?0:"bottom"===this._alignV?e-f:.5*(e-f)/m,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),o.translate(this.offset.x,this.offset.y),this._safariOffsetY&&o.translate(0,this._safariOffsetY),this.canvasDegree=0,i&&("horizontal"===this._screenMode?(o.rotate(Math.PI/2),o.translate(e/m,0),this.canvasDegree=90):(o.rotate(-Math.PI/2),o.translate(0,t/m),this.canvasDegree=-90)),o.a=this._formatData(o.a),o.d=this._formatData(o.d),o.tx=this._formatData(o.tx),o.ty=this._formatData(o.ty),s.transformOrigin=s.webkitTransformOrigin=s.msTransformOrigin=s.mozTransformOrigin=s.oTransformOrigin="0px 0px 0px",s.transform=s.webkitTransform=s.msTransform=s.mozTransform=s.oTransform="matrix("+o.toString()+")",this._safariOffsetY&&o.translate(0,-this._safariOffsetY),o.translate(parseInt(s.left)||0,parseInt(s.top)||0),this.visible=!0,this._repaint|=2,this.event("resize")},i._formatData=function(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?t>0?1:-1:t},i.getMousePoint=function(){return Point.TEMP.setTo(this.mouseX,this.mouseY)},i.repaint=function(t){void 0===t&&(t=2),this._repaint|=t},i.repaintForNative=function(t){void 0===t&&(t=2),this.data._int32Data[3]|=t},i.parentRepaint=function(t){void 0===t&&(t=2)},i._loop=function(){return this.render(Render._context,0,0),!0},i._onmouseMove=function(){this._mouseMoveTime=Browser.now()},i.getTimeFromFrameStart=function(){return Browser.now()-this._frameStartTime},i.render=function(e,i,n){if("sleep"===this.frameRate){var r=Browser.now();
if(!(r-this._frameStartTime>=1e3))return;this._frameStartTime=r}if(this._renderCount++,!this._visible)return this._renderCount%5===0&&(Stat.loopCount++,Laya.startTimer._update(),Laya.physicsTimer._update(),MouseManager.instance.runEvent(),Laya.timer._update(),Laya.updateTimer._update(),Laya.lateTimer._update(),Laya.renderTimer._update()),void 0;this._frameStartTime=Browser.now();var a="mouse"===this.frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this.frameRate,s="slow"!==a,o=this._renderCount%2===0;if(Stat.renderSlow=!s,Stat.mesh2DNum=0,(s||o)&&(Stat.loopCount++,Laya.startTimer._update(),Laya.physicsTimer._update(),MouseManager.instance.runEvent(),Laya.timer._update(),Laya.updateTimer._update(),Laya.lateTimer._update(),Laya.renderTimer._update(),!Render.isConchApp)){var l=Date.now();Render.isWebGL&&this.renderingEnabled&&(e.clear(),t.prototype.render.call(this,e,i,n),Stat._show&&Stat._sp&&Stat._sp.render(e,i,n));var _=Date.now()-l;PerfHUD.inst&&PerfHUD.inst.updateValue(1,_)}if(this.renderingEnabled&&(s||!o)){var l=0;if(Render.isConchApp||(l=Date.now()),Render.isWebGL?(RunDriver.clear(this._bgColor),e.flush(),VectorGraphManager.instance&&VectorGraphManager.getInstance().endDispose()):(RunDriver.clear(this._bgColor),t.prototype.render.call(this,e,i,n),Stat._show&&Stat._sp&&Stat._sp.render(e,i,n),Render.isConchApp&&e.commit()),!Render.isConchApp){var h=Date.now()-l;PerfHUD.inst&&PerfHUD.inst.updateValue(2,h)}}},i._requestFullscreen=function(){var t=Browser.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},i._fullScreenChanged=function(){Laya.stage.event("fullscreenchange")},i.exitFullscreen=function(){var t=Browser.document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},__getset(0,i,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),__getset(0,i,"width",t.prototype._$get_width,function(t){this.designWidth=t,Laya.superSet(Sprite,this,"width",t),Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"isFocused",function(){return this._isFocused}),__getset(0,i,"alignH",function(){return this._alignH},function(t){this._alignH=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"height",t.prototype._$get_height,function(t){this.designHeight=t,Laya.superSet(Sprite,this,"height",t),Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||this._createTransform()},t.prototype._$set_transform),__getset(0,i,"isVisibility",function(){return this._isVisibility}),__getset(0,i,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"alignV",function(){return this._alignV},function(t){this._alignV=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,Render.isWebGL&&(this._wgColor=t?Color.create(t).arrColor:null),Render.canvas.style.background=t?t:"none"}),__getset(0,i,"mouseX",function(){return Math.round(MouseManager.instance.mouseX/this.clientScaleX)}),__getset(0,i,"mouseY",function(){return Math.round(MouseManager.instance.mouseY/this.clientScaleY)}),__getset(0,i,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),__getset(0,i,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t}),__getset(0,i,"visible",t.prototype._$get_visible,function(t){if(this.visible!==t){Laya.superSet(Sprite,this,"visible",t);var e=Render._mainCanvas.source.style;e.visibility=t?"visible":"hidden"}}),__getset(0,i,"fullScreenEnabled",null,function(t){var e=Browser.document,i=Render.canvas;t?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),e.addEventListener("fullscreenchange",this._fullScreenChanged),e.addEventListener("mozfullscreenchange",this._fullScreenChanged),e.addEventListener("webkitfullscreenchange",this._fullScreenChanged),e.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),e.removeEventListener("fullscreenchange",this._fullScreenChanged),e.removeEventListener("mozfullscreenchange",this._fullScreenChanged),e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),e.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),e.SCALE_NOSCALE="noscale",e.SCALE_EXACTFIT="exactfit",e.SCALE_SHOWALL="showall",e.SCALE_NOBORDER="noborder",e.SCALE_FULL="full",e.SCALE_FIXED_WIDTH="fixedwidth",e.SCALE_FIXED_HEIGHT="fixedheight",e.SCALE_FIXED_AUTO="fixedauto",e.ALIGN_LEFT="left",e.ALIGN_RIGHT="right",e.ALIGN_CENTER="center",e.ALIGN_TOP="top",e.ALIGN_MIDDLE="middle",e.ALIGN_BOTTOM="bottom",e.SCREEN_NONE="none",e.SCREEN_HORIZONTAL="horizontal",e.SCREEN_VERTICAL="vertical",e.FRAME_FAST="fast",e.FRAME_SLOW="slow",e.FRAME_MOUSE="mouse",e.FRAME_SLEEP="sleep",e}(Sprite),PerfHUD=function(t){function e(){this.datas=[],this.hud_width=800,this.hud_height=200,this.gMinV=0,this.gMaxV=100,this.textSpace=30,e.__super.call(this),this.xdata=new Array(e.DATANUM),this.ydata=new Array(e.DATANUM),e.inst=this,this._renderType|=2048,this._setRenderType(this._renderType),this._setCustomRender(),this.addDataDef(0,"white","frame",1),this.addDataDef(1,"green","update",1),this.addDataDef(2,"red","flush",1)}__class(e,"laya.utils.PerfHUD",t);var i=e.prototype;return i.now=function(){return performance?performance.now():Date.now()},i.config=function(t,e){this.hud_width=t,this.hud_height=e},i.addDataDef=function(t,e,i,n){this.datas[t]=new PerfData(t,e,i,n)},i.start=function(){},i.end=function(){},i.updateValue=function(t,e){this.datas[t].addData(e)},i.draw=function(){e._now=Date.now(),e._lastTm<=0&&(e._lastTm=e._now);e._now-e._lastTm},i.v2y=function(t){this._y+this.hud_height*(1-(t-this.gMinV)/this.gMaxV);return this._y+this.hud_height*(1-(t-this.gMinV)/this.gMaxV)},i.drawHLine=function(t,e,i,n){var r=this._x,a=(this._x+this.hud_width,this.v2y(e));t.fillText(n,r,a-6,null,"green"),r+=this.textSpace,t.fillStyle=i,t.fillRect(r,a,this._x+this.hud_width,1)},i.customRender=function(t){var i=Date.now();e._lastTm<=0&&(e._lastTm=i),this.updateValue(0,i-e._lastTm),e._lastTm=i,t.save(),t.fillRect(this._x,this._y,this.hud_width,this.hud_height+4,"#77777777"),t.globalAlpha=.5,this.drawHLine(t,0,"green","    0"),this.drawHLine(t,10,"green","  10"),this.drawHLine(t,16.667,"red"," "),this.drawHLine(t,20,"green","50|20"),this.drawHLine(t,33.334,"yellow","30|33"),this.drawHLine(t,50,"green","20|50"),this.drawHLine(t,100,"green","10|100");for(var n=0,r=this.datas.length;r>n;n++){var a=this.datas[n];if(a){var s=a.datas.length,o=(this.hud_width-this.textSpace)/s,l=a.datapos,_=this._x+this.textSpace;t.fillStyle=a.color;for(var h=s;h>l;l++){var u=this.v2y(a.datas[l]*a.scale);t.fillRect(_,u,o,this.hud_height+this._y-u),_+=o}for(l=0;l<a.datapos;l++)u=this.v2y(a.datas[l]*a.scale),t.fillRect(_,u,o,this.hud_height+this._y-u),_+=o}}t.restore()},e._lastTm=0,e._now=0,e.DATANUM=300,e.inst=null,e}(Sprite),HTMLCanvas=function(t){function e(t){this._is2D=!1,this.getContext=function(){return i._ctx?i._ctx:i._ctx=e._createContext(this)},e.__super.call(this);var i=this;if(this._source=this,"2D"===t||"AUTO"===t&&!Render.isWebGL){this._is2D=!0,this._source=Browser.createElement("canvas");var n=this;n.getContext=function(t,e){if(i._ctx)return i._ctx;var r=i._ctx=i._source.getContext(t,e);return r&&(r._canvas=n,r.size=function(){}),r}}this.lock=!0}__class(e,"laya.resource.HTMLCanvas",t);var i=e.prototype;return i.clear=function(){this._ctx&&this._ctx.clear()},i.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},i.release=function(){},i._setContext=function(t){this._ctx=t},i.getMemSize=function(){return 0},i.size=function(t,e){(this._width!=t||this._height!=e||this._source&&(this._source.width!=t||this._source.height!=e))&&(this._width=t,this._height=e,this._setGPUMemory(t*e*4),this._ctx&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t))},i.getCanvas=function(){return this._source},__getset(0,i,"source",function(){return this._source}),__getset(0,i,"context",function(){return this._ctx}),__getset(0,i,"asBitmap",null,function(){}),e.create=function(t){return new e(t)},e.TYPE2D="2D",e.TYPE3D="3D",e.TYPEAUTO="AUTO",e._createContext=null,e}(Bitmap),HTMLImage=function(t){function e(){e.__super.call(this)}__class(e,"laya.resource.HTMLImage",t);var i=e.prototype;return i.setImageSource=function(t){var e=t.width,i=t.height;if(0>=e||0>=i)throw new Error("HTMLImage:width or height must large than 0.");this._width=e,this._height=i,this._source=t,this._setGPUMemory(e*i*4),this._activeResource()},i._disposeResource=function(){this._source&&(this._source=null,this._setGPUMemory(0))},i._getSource=function(){return this._source},e.create=function(){return new e},e}(Bitmap),BaseTexture=function(t){function e(t,i){e.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=i,this._anisoLevel=1,this._glTexture=LayaGL.instance.createTexture()}__class(e,"laya.webgl.resource.BaseTexture",t);var i=e.prototype;return i._isPot=function(t){return 0===(t&t-1)},i._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;default:throw"BaseTexture: unkonw texture format."}return t},i._setFilterMode=function(t){var e=LayaGL.instance;switch(WebGLContext.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},i._setWarpMode=function(t,e){var i=LayaGL.instance;if(WebGLContext.bindTexture(i,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:i.texParameteri(this._glTextureType,t,10497);break;case 1:i.texParameteri(this._glTextureType,t,33071)}else i.texParameteri(this._glTextureType,t,33071)},i._setAnisotropy=function(t){var e=LayaGL.instance;WebGLContext.bindTexture(e,this._glTextureType,this._glTexture);var i=WebGLContext.extTextureFilterAnisotropic;i&&(t=Math.min(e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),e.texParameterf(this._glTextureType,i.TEXTURE_MAX_ANISOTROPY_EXT,t))},i._onAsynLoaded=function(t,e){if(e&&"object"==typeof e){var i=e.format;void 0!==i&&(this._format=i);var n=e.mipmap;void 0!==n&&(this.mipmap=n);var r=e.wrapModeU;void 0!==r&&(this.wrapModeU=r);var a=e.wrapModeV;void 0!==a&&(this.wrapModeV=a);var s=e.filterMode;void 0!==s&&(this.filterMode=s);var o=e.anisoLevel;void 0!==o&&(this.anisoLevel=o)}},i._disposeResource=function(){this._glTexture&&(LayaGL.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},i._getSource=function(){return this._readyed?this._glTexture:null},i._getGLFormatForNative=function(){return 6408},__getset(0,i,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),__getset(0,i,"mipmap",function(){return this._mipmap}),__getset(0,i,"format",function(){return this._format}),__getset(0,i,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),__getset(0,i,"defaulteTexture",function(){throw"BaseTexture:must override it."}),__getset(0,i,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),__getset(0,i,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),e.WARPMODE_REPEAT=0,e.WARPMODE_CLAMP=1,e.FILTERMODE_POINT=0,e.FILTERMODE_BILINEAR=1,e.FILTERMODE_TRILINEAR=2,e.FORMAT_RGB_8_8_8=0,e.FORMAT_RGBA_8_8_8_8=1,e.FORMAT_DEPTH_16=0,e.FORMAT_STENCIL_8=1,e.FORMAT_DEPTHSTENCIL_16_8=2,e.FORMAT_DEPTHSTENCIL_NONE=3,e}(Bitmap),Shader=function(t){function e(t,i,n,r,a){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},e.__super.call(this),!t||!i)throw"Shader Error";this._attribInfo=a,(Render.isConchApp||Render.isFlash)&&(this.customCompile=!0),this._id=++e._count,this._vs=t,this._ps=i,this._nameMap=r?r:{},null!=n&&(e.sharders[n]=this),this.recreateResource(),this.lock=!0}__class(e,"laya.webgl.shader.Shader",t);var i=e.prototype;return i.recreateResource=function(){this._compile(),this._setGPUMemory(0)},i._disposeResource=function(){WebGL.mainContext.deleteShader(this._vshader),WebGL.mainContext.deleteShader(this._pshader),WebGL.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},i._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t;this.customCompile&&(t=ShaderCompile.preGetParams(this._vs,this._ps));var i=WebGL.mainContext;this._program=i.createProgram(),this._vshader=e._createShader(i,this._vs,35633),this._pshader=e._createShader(i,this._ps,35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader);var n,r,a=0,s=0,o=this._attribInfo?this._attribInfo.length:0;for(a=0;o>a;a+=2)i.bindAttribLocation(this._program,this._attribInfo[a+1],this._attribInfo[a]);if(i.linkProgram(this._program),!this.customCompile&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var l=this.customCompile?t.uniforms.length:i.getProgramParameter(this._program,35718);for(a=0;l>a;a++){var _=this.customCompile?t.uniforms[a]:i.getActiveUniform(this._program,a);r=i.getUniformLocation(this._program,_.name),n={vartype:"uniform",glfun:null,ivartype:1,location:r,name:_.name,type:_.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},n.name.indexOf("[0]")>0&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=i.getUniformLocation(this._program,n.name)),this._params.push(n)}for(a=0,s=this._params.length;s>a;a++)switch(n=this._params[a],n.indexOfParams=a,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=this._nameMap[n.codename]?this._nameMap[n.codename]:n.codename,this._paramsMap[n.name]=n,n._this=this,n.uploadedValue=[],n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.glfun=i.uniformMatrix4fv,n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;case 35674:case 35675:throw new Error("compile shader err!");default:throw new Error("compile shader err!")}}},i.getUniform=function(t){return this._paramsMap[t]},i._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(WebGL.mainContext.uniform1f(t.location,i[0]=e),1):0},i._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(WebGL.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return WebGL.mainContext.uniform1fv(t.location,e),1},i._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(WebGL.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(WebGL.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return WebGL.mainContext.uniform2fv(t.location,e),1},i._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(WebGL.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3v=function(t,e){return WebGL.mainContext.uniform3fv(t.location,e),1},i._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(WebGL.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4v=function(t,e){return WebGL.mainContext.uniform4fv(t.location,e),1},i._uniformMatrix2fv=function(t,e){return WebGL.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uniformMatrix3fv=function(t,e){return WebGL.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniformMatrix4fv=function(t,e){return WebGL.mainContext.uniformMatrix4fv(t.location,!1,e),1},i._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(WebGL.mainContext.uniform1i(t.location,i[0]=e),1):0},i._uniform1iv=function(t,e){return WebGL.mainContext.uniform1iv(t.location,e),1},i._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(WebGL.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_ivec2v=function(t,e){return WebGL.mainContext.uniform2iv(t.location,e),1},i._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(WebGL.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3vi=function(t,e){return WebGL.mainContext.uniform3iv(t.location,e),1},i._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(WebGL.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4vi=function(t,e){return WebGL.mainContext.uniform4iv(t.location,e),1},i._uniform_sampler2D=function(t,e){var i=WebGL.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),WebGLContext.activeTexture(i,33984+this._curActTexIndex),WebGLContext.bindTexture(i,3553,e),this._curActTexIndex++,1):(WebGLContext.activeTexture(i,33984+n[0]),WebGLContext.bindTexture(i,3553,e),0)},i._uniform_samplerCube=function(t,e){var i=WebGL.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),WebGLContext.activeTexture(i,33984+this._curActTexIndex),WebGLContext.bindTexture(i,34067,e),this._curActTexIndex++,1):(WebGLContext.activeTexture(i,33984+n[0]),WebGLContext.bindTexture(i,34067,e),0)},i._noSetValue=function(t){console.log("no....:"+t.name)},i.uploadOne=function(t,e){WebGLContext.useProgram(WebGL.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},i.uploadTexture2D=function(t){Stat.shaderCall++;var e=WebGL.mainContext;WebGLContext.activeTexture(e,33984),WebGLContext.bindTexture(e,3553,t)},i.upload=function(t,e){BaseShader.activeShader=BaseShader.bindShader=this;var i=WebGL.mainContext;WebGLContext.useProgram(i,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var n,r,a=e.length,s=0,o=0;a>o;o++)n=e[o],null!==(r=t[n.name])&&(s+=n.fun.call(this,n,r));Stat.shaderCall+=s},i.uploadArray=function(t,e,i){BaseShader.activeShader=this,BaseShader.bindShader=this,WebGLContext.useProgram(WebGL.mainContext,this._program);for(var n,r,a=(this._params,0),s=e-2;s>=0;s-=2)r=this._paramsMap[t[s]],r&&(n=t[s+1],null!=n&&(i&&i[r.name]&&i[r.name].bind(),a+=r.fun.call(this,r,n)));Stat.shaderCall+=a},i.getParams=function(){return this._params},i.setAttributesLocation=function(t){this._attribInfo=t},e.getShader=function(t){return e.sharders[t]},e.create=function(t,i,n,r,a){return new e(t,i,n,r,a)},e.withCompile=function(t,i,n,r){if(n&&e.sharders[n])return e.sharders[n];var a=e._preCompileShader[2e-4*t];if(!a)throw new Error("withCompile shader err!"+t);return a.createShader(i,n,r)},e.withCompile2D=function(t,i,n,r,a,s){if(r&&e.sharders[r])return e.sharders[r];var o=e._preCompileShader[2e-4*t+i];if(!o)throw new Error("withCompile shader err!"+t+" "+i);return o.createShader(n,r,a,s)},e.addInclude=function(t,e){ShaderCompile.addInclude(t,e)},e.preCompile=function(t,i,n,r){var a=2e-4*t;e._preCompileShader[a]=new ShaderCompile(i,n,r)},e.preCompile2D=function(t,i,n,r,a){var s=2e-4*t+i;e._preCompileShader[s]=new ShaderCompile(n,r,a)},e._createShader=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.log(t.getShaderInfoLog(n)),null)},e._count=0,e._preCompileShader={},e.SHADERNAME2ID=2e-4,e.sharders=new Array(32),__static(e,["nameKey",function(){return this.nameKey=new StringKey}]),e}(BaseShader),UIComponent=function(t){function e(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,e.__super.call(this),this._layout=LayoutStyle.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}__class(e,"laya.ui.UIComponent",t);var i=e.prototype;return Laya.imps(i,{"laya.ui.IComponent":!0}),i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},i.preinitialize=function(){},i.createChildren=function(){},i.initialize=function(){},i.callLater=function(t,e){Laya.timer.callLater(this,t,e)},i.runCallLater=function(t){Laya.timer.runCallLater(this,t)},i.commitMeasure=function(){},i.changeSize=function(){this.event("resize")},i.getLayout=function(){return this._layout===LayoutStyle.EMPTY&&(this._layout=new LayoutStyle),this._layout},i._setLayoutEnabled=function(t){this._layout&&this._layout.enable!=t&&(this._layout.enable=t,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},i.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},i.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},i.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY()),this.event("resize")},i.resetLayoutX=function(){var t=this._layout;if(isNaN(t.anchorX)||(this.pivotX=t.anchorX*this.width),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerX)?isNaN(t.left)?isNaN(t.right)||(this.x=Math.round(e.width-this.displayWidth-t.right+this.pivotX*this.scaleX)):(this.x=Math.round(t.left+this.pivotX*this.scaleX),isNaN(t.right)||(this.width=(e._width-t.left-t.right)/(this.scaleX||.01))):this.x=Math.round(.5*(e.width-this.displayWidth)+t.centerX+this.pivotX*this.scaleX))}},i.resetLayoutY=function(){var t=this._layout;if(isNaN(t.anchorY)||(this.pivotY=t.anchorY*this.height),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerY)?isNaN(t.top)?isNaN(t.bottom)||(this.y=Math.round(e.height-this.displayHeight-t.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(t.top+this.pivotY*this.scaleY),isNaN(t.bottom)||(this.height=(e._height-t.top-t.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(e.height-this.displayHeight)+t.centerY+this.pivotY*this.scaleY))}},i.onMouseOver=function(){Laya.stage.event("showtip",this._toolTip)},i.onMouseOut=function(){Laya.stage.event("hidetip",this._toolTip)},__getset(0,i,"displayWidth",function(){return this.width*this.scaleX}),__getset(0,i,"width",function(){return this._width?this._width:this.measureWidth},function(t){this._width!=t&&(this._width=t,this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),__getset(0,i,"measureWidth",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;e>-1;e--){var i=this.getChildAt(e);i._visible&&(t=Math.max(i._x+i.width*i.scaleX,t))}return t}),__getset(0,i,"displayHeight",function(){return this.height*this.scaleY}),__getset(0,i,"height",function(){return this._height?this._height:this.measureHeight},function(t){this._height!=t&&(this._height=t,this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),__getset(0,i,"dataSource",function(){return this._dataSource},function(t){this._dataSource=t;for(var e in this._dataSource)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=this._dataSource[e])}),__getset(0,i,"scaleY",t.prototype._$get_scaleY,function(t){Laya.superGet(Sprite,this,"scaleY")!=t&&(Laya.superSet(Sprite,this,"scaleY",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),__getset(0,i,"measureHeight",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;e>-1;e--){var i=this.getChildAt(e);i._visible&&(t=Math.max(i._y+i.height*i.scaleY,t))}return t}),__getset(0,i,"scaleX",t.prototype._$get_scaleX,function(t){Laya.superGet(Sprite,this,"scaleX")!=t&&(Laya.superSet(Sprite,this,"scaleX",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),__getset(0,i,"top",function(){return this._layout.top},function(t){t!=this._layout.top&&(this.getLayout().top=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),__getset(0,i,"bottom",function(){return this._layout.bottom},function(t){t!=this._layout.bottom&&(this.getLayout().bottom=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),__getset(0,i,"left",function(){return this._layout.left},function(t){t!=this._layout.left&&(this.getLayout().left=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),__getset(0,i,"right",function(){return this._layout.right},function(t){t!=this._layout.right&&(this.getLayout().right=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),__getset(0,i,"centerX",function(){return this._layout.centerX},function(t){t!=this._layout.centerX&&(this.getLayout().centerX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),__getset(0,i,"centerY",function(){return this._layout.centerY},function(t){t!=this._layout.centerY&&(this.getLayout().centerY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),__getset(0,i,"anchorX",function(){return this._layout.anchorX},function(t){t!=this._layout.anchorX&&(this.getLayout().anchorX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),__getset(0,i,"anchorY",function(){return this._layout.anchorY},function(t){t!=this._layout.anchorY&&(this.getLayout().anchorY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),__getset(0,i,"tag",function(){return this._tag},function(t){this._tag=t}),__getset(0,i,"toolTip",function(){return this._toolTip},function(t){this._toolTip!=t&&(this._toolTip=t,null!=t?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),__getset(0,i,"comXml",function(){return this._comXml},function(t){this._comXml=t}),__getset(0,i,"gray",function(){return this._gray},function(t){t!==this._gray&&(this._gray=t,UIUtils.gray(this,t))}),__getset(0,i,"disabled",function(){return this._disabled},function(t){t!==this._disabled&&(this.gray=this._disabled=t,this.mouseEnabled=!t)}),e}(Sprite),Buffer2D=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,e.__super.call(this),this.lock=!0}__class(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),Stat.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._setGPUMemory(this._buffer.byteLength),this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,LayaGL.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this._setGPUMemory(this._uploadSize)),LayaGL.instance.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),Stat.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._setGPUMemory(this._buffer.byteLength),this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,LayaGL.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this._setGPUMemory(this._uploadSize)),e||i){var n=this._buffer.slice(e,i);LayaGL.instance.bufferSubData(this._bufferType,t,n)}else LayaGL.instance.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_uploadForVAO=function(){return this._upload?(this._upload=!1,this._bindForVAO(),this._bufferData(),!0):!1},i._bind_upload=function(){return this._upload?(this._upload=!1,this.bind(),this._bufferData(),!0):!1},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._upload?(this._upload=!1,this.bind(),this._bufferSubData(t,e,i),!0):!1},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this._setGPUMemory(t),e&&this._buffer&&this._buffer.byteLength>0){var i=new ArrayBuffer(t),n=this._u8Array&&this._u8Array.buffer==this._buffer?this._u8Array:new Uint8Array(this._buffer);this._u8Array=new Uint8Array(i),this._u8Array.set(n,0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this._bufferSize=this._buffer.byteLength,this},i.append=function(t){this._upload=!0;var e,i=0;i=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+i,!0),e=new Float32Array(this._buffer,this._byteLength)),e.set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),n=0;e>n;n++)i[n]=t[n];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i,n=0;n=t.byteLength,this._resizeBuffer(this._byteLength+n,!0),i=new e(this._buffer,this._byteLength),i.set(t,0),this._byteLength+=n,this._checkArrayUse()},i.appendEx2=function(t,e,i,n){void 0===n&&(n=1),this._upload=!0;var r,a=0;a=i*n,this._resizeBuffer(this._byteLength+a,!0),r=new e(this._buffer,this._byteLength);var s=0;for(s=0;i>s;s++)r[s]=t[s];this._byteLength+=a,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();
return LayaGL.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(Buffer._bindedVertexBuffer=null),34963==this._bufferType&&(Buffer._bindedIndexBuffer=null),BaseShader.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this._bind_subUpload();return LayaGL.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(Buffer._bindedVertexBuffer=null),34963==this._bufferType&&(Buffer._bindedIndexBuffer=null),BaseShader.activeShader=null,n},i._disposeResource=function(){t.prototype._disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},__getset(0,i,"bufferLength",function(){return this._buffer.byteLength}),__getset(0,i,"byteLength",null,function(t){this.setByteLength(t)}),e.__int__=function(){IndexBuffer2D.QuadrangleIB=IndexBuffer2D.create(35044),GlUtils.fillIBQuadrangle(IndexBuffer2D.QuadrangleIB,16)},e.FLOAT32=4,e.SHORT=2,e}(Buffer),BaseCamera=function(t){function e(t,i){e.__super.call(this),void 0===t&&(t=.3),void 0===i&&(i=1e3),this._shaderValues=new ShaderDatas(null,14),this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=t,this._farPlane=i,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),Laya.stage.on("resize",this,this._onScreenSizeChanged)}__class(e,"laya.d3.core.BaseCamera",t);var i=e.prototype;return i._sortCamerasByRenderingOrder=function(){if(this.displayedInStage)for(var t=this.scene._cameraPool,e=t.length-1,i=0;e>i;i++)if(t[i].renderingOrder>t[e].renderingOrder){var n=t[i];t[i]=t[e],t[e]=n}},i._calculateProjectionMatrix=function(){},i._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},i._prepareCameraToRender=function(){Layer._currentCameraCullingMask=this.cullingMask;var t=this._shaderValues;t.setVector(0,this.transform.position),t.setVector(5,this.transform.forward),t.setVector(6,this.transform.up)},i._prepareCameraViewProject=function(t,i,n){var r=this._shaderValues;r.setMatrix4x4(1,t),r.setMatrix4x4(2,i),this.transform.worldMatrix.cloneTo(e._tempMatrix4x40),e._tempMatrix4x40.transpose(),Matrix4x4.multiply(i,e._tempMatrix4x40,n),r.setMatrix4x4(4,n)},i._render=function(){},i.addLayer=function(t){this.cullingMask=this.cullingMask|t.mask},i.removeLayer=function(t){this.cullingMask=this.cullingMask&~t.mask},i.addAllLayers=function(){this.cullingMask=2147483647},i.removeAllLayers=function(){this.cullingMask=0},i.resetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},i._onActive=function(){this._scene._addCamera(this)},i._onInActive=function(){this._scene._removeCamera(this)},i._parse=function(e,i){t.prototype._parse.call(this,e,i);var n=e.clearColor;this.clearColor=new Vector4(n[0],n[1],n[2],n[3]);var r=e.skyboxMaterial;r&&(this._skyboxMaterial=Loader.getRes(i[r.path]))},i.destroy=function(e){void 0===e&&(e=!0),this._skyboxMaterial._removeReference(),this._skyboxMaterial=null,this.renderTarget=null,Laya.stage.off("resize",this,this._onScreenSizeChanged),t.prototype.destroy.call(this,e)},__getset(0,i,"skyboxMaterial",function(){return this._skyboxMaterial},function(t){this._skyboxMaterial!==t&&(this._skyboxMaterial&&this._skyboxMaterial._removeReference(),t._addReference(),this._skyboxMaterial=t)}),__getset(0,i,"farPlane",function(){return this._farPlane},function(t){this._farPlane=t,this._calculateProjectionMatrix()}),__getset(0,i,"renderTarget",function(){return this._renderTarget},function(t){this._renderTarget=t}),__getset(0,i,"orthographic",function(){return this._orthographic},function(t){this._orthographic=t,this._calculateProjectionMatrix()}),__getset(0,i,"fieldOfView",function(){return this._fieldOfView},function(t){this._fieldOfView=t,this._calculateProjectionMatrix()}),__getset(0,i,"nearPlane",function(){return this._nearPlane},function(t){this._nearPlane=t,this._calculateProjectionMatrix()}),__getset(0,i,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(t){this._orthographicVerticalSize=t,this._calculateProjectionMatrix()}),__getset(0,i,"renderingOrder",function(){return this._renderingOrder},function(t){this._renderingOrder=t,this._sortCamerasByRenderingOrder()}),e.CAMERAPOS=0,e.VIEWMATRIX=1,e.PROJECTMATRIX=2,e.VPMATRIX=3,e.VPMATRIX_NO_TRANSLATE=4,e.CAMERADIRECTION=5,e.CAMERAUP=6,e.ENVIRONMENTDIFFUSE=7,e.ENVIRONMENTSPECULAR=8,e.SIMLODINFO=9,e.DIFFUSEIRRADMATR=10,e.DIFFUSEIRRADMATG=11,e.DIFFUSEIRRADMATB=12,e.HDREXPOSURE=13,e.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",e.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",e.CLEARFLAG_SOLIDCOLOR=0,e.CLEARFLAG_SKY=1,e.CLEARFLAG_DEPTHONLY=2,e.CLEARFLAG_NONE=3,__static(e,["_tempMatrix4x40",function(){return this._tempMatrix4x40=new Matrix4x4},"_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new Matrix4x4(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new Matrix4x4},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new Matrix4x4}]),e}(Sprite3D),LightSprite=function(t){function e(){this._intensityColor=null,this._intensity=0/0,this._shadow=!1,this._shadowFarPlane=0,this._shadowMapSize=0,this._shadowMapCount=0,this._shadowMapPCFType=0,this._parallelSplitShadowMap=null,this._lightmapBakedType=0,this.color=null,e.__super.call(this),this._intensity=1,this._intensityColor=new Vector3,this.color=new Vector3(1,1,1),this._shadow=!1,this._shadowFarPlane=8,this._shadowMapSize=512,this._shadowMapCount=1,this._shadowMapPCFType=0,this._lightmapBakedType=e.LIGHTMAPBAKEDTYPE_REALTIME}__class(e,"laya.d3.core.light.LightSprite",t);var i=e.prototype;return i._parse=function(e,i){t.prototype._parse.call(this,e,i);var n=e.color;this.color.fromArray(n)},i._onActive=function(){this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._addLight(this)},i._onInActive=function(){this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._removeLight(this)},i._prepareToScene=function(){return!1},__getset(0,i,"lightmapBakedType",function(){return this._lightmapBakedType},function(t){this._lightmapBakedType!==t&&(this._lightmapBakedType=t,this._activeInHierarchy&&(t!==e.LIGHTMAPBAKEDTYPE_BAKED?this._scene._addLight(this):this._scene._removeLight(this)))}),__getset(0,i,"shadowPCFType",function(){return this._shadowMapPCFType},function(t){this._shadowMapPCFType=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setPCFType(t)}),__getset(0,i,"intensity",function(){return this._intensity},function(t){this._intensity=t}),__getset(0,i,"shadow",function(){return this._shadow},function(){throw new Error("LightSprite: must override it.")}),__getset(0,i,"shadowDistance",function(){return this._shadowFarPlane},function(t){this._shadowFarPlane=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setFarDistance(t)}),__getset(0,i,"shadowPSSMCount",function(){return this._shadowMapCount},function(t){this._shadowMapCount=t,this._parallelSplitShadowMap&&(this._parallelSplitShadowMap.shadowMapCount=t)}),__getset(0,i,"shadowResolution",function(){return this._shadowMapSize},function(t){this._shadowMapSize=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setShadowMapTextureSize(t)}),__getset(0,i,"diffuseColor",function(){return console.log("LightSprite: discard property,please use color property instead."),this.color},function(t){console.log("LightSprite: discard property,please use color property instead."),this.color=t}),e.LIGHTMAPBAKEDTYPE_REALTIME=0,e.LIGHTMAPBAKEDTYPE_MIXED=1,e.LIGHTMAPBAKEDTYPE_BAKED=2,e}(Sprite3D),RenderableSprite3D=function(t){function e(t){this._render=null,e.__super.call(this,t)}__class(e,"laya.d3.core.RenderableSprite3D",t);var i=e.prototype;return i._onInActive=function(){this._scene._removeRenderObject(this._render),this._render.castShadow&&this._scene._removeShadowCastRenderObject(this._render)},i._onActive=function(){t.prototype._onActive.call(this),this._scene._addRenderObject(this._render),this._render.castShadow&&this._scene._addShadowCastRenderObject(this._render)},i._addToInitStaticBatchManager=function(){},i._setBelongScene=function(t){laya.display.Node.prototype._setBelongScene.call(this,t),this._render._setBelongScene(t)},i._setUnBelongScene=function(){this._render._defineDatas.remove(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),laya.display.Node.prototype._setUnBelongScene.call(this)},i._changeHierarchyAnimator=function(e){if(this._hierarchyAnimator){var i=this._hierarchyAnimator._renderableSprites;i.splice(i.indexOf(this),1)}e&&e._renderableSprites.push(this),t.prototype._changeHierarchyAnimator.call(this,e)},i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._render._destroy(),this._render=null},e.__init__=function(){e.SHADERDEFINE_RECEIVE_SHADOW=e.shaderDefines.registerDefine("RECEIVESHADOW"),e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=e.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),e.SAHDERDEFINE_LIGHTMAP=e.shaderDefines.registerDefine("LIGHTMAP")},e.SHADERDEFINE_RECEIVE_SHADOW=0,e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=0,e.SAHDERDEFINE_LIGHTMAP=0,e.LIGHTMAPSCALEOFFSET=2,e.LIGHTMAP=3,__static(e,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1}]),e}(Sprite3D),IndexBuffer3D=function(t){function e(t,i,n,r){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===n&&(n=35044),void 0===r&&(r=!1),e.__super.call(this),this._indexType=t,this._indexCount=i,this._bufferUsage=n,this._bufferType=34963,this._canRead=r;var a=0;if("ushort"==t)this._indexTypeByteCount=2;else{if("ubyte"!=t)throw new Error("unidentification index type.");this._indexTypeByteCount=1}a=this._indexTypeByteCount*i,this._byteLength=a,this.bind(),LayaGL.instance.bufferData(this._bufferType,a,this._bufferUsage),r?("ushort"==t?this._buffer=new Uint16Array(i):"ubyte"==t&&(this._buffer=new Uint8Array(i)),this._setGPUMemory(2*a)):this._setGPUMemory(a),this._activeResource()}__class(e,"laya.d3.graphics.IndexBuffer3D",t);var i=e.prototype;return i.bind=function(){return Buffer._bindedIndexBuffer!==this._glBuffer?(LayaGL.instance.bindBuffer(34963,this._glBuffer),Buffer._bindedIndexBuffer=this._glBuffer,!0):!1},i.setData=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295);var r=0;if("ushort"==this._indexType?(r=2,(0!==i||4294967295!==n)&&(t=new Uint16Array(t.buffer,i*r,n))):"ubyte"==this._indexType&&(r=1,(0!==i||4294967295!==n)&&(t=new Uint8Array(t.buffer,i*r,n))),this.bind(),LayaGL.instance.bufferSubData(this._bufferType,e*r,t),this._canRead)if(0!==e||0!==i||4294967295!==n){var a=this._buffer.length-e;n>a&&(n=a);for(var s=0;n>s;s++)this._buffer[e+s]=t[s]}else this._buffer=t},i.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},i._disposeResource=function(){t.prototype._disposeResource.call(this),this._buffer=null,this._setGPUMemory(0)},__getset(0,i,"indexType",function(){return this._indexType}),__getset(0,i,"indexTypeByteCount",function(){return this._indexTypeByteCount}),__getset(0,i,"indexCount",function(){return this._indexCount}),__getset(0,i,"canRead",function(){return this._canRead}),e.INDEXTYPE_UBYTE="ubyte",e.INDEXTYPE_USHORT="ushort",e.create=function(t,i,n,r){return void 0===n&&(n=35044),void 0===r&&(r=!1),new e(t,i,n,r)},e}(Buffer),BlinnPhongMaterial=function(t){function e(){e.__super.call(this,12),this.setShaderName("BLINNPHONG"),this._albedoIntensity=1,this._albedoColor=new Vector4(1,1,1,1);var t=this._shaderValues;t.setVector(5,new Vector4(1,1,1,1)),t.setVector(6,new Vector3(1,1,1)),t.setNumber(7,.078125),t.setNumber(0,.5),t.setVector(8,new Vector4(1,1,0,0)),t.setVector(9,new Vector3(.5,.5,.5)),this._enableLighting=!0,this._enableReflection=!1,this.renderMode=0}__class(e,"laya.d3.core.material.BlinnPhongMaterial",t);var i=e.prototype;return i.disableFog=function(){this._disablePublicDefineDatas.add(Shader3D.SHADERDEFINE_FOG)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i._enableLighting=this._enableLighting,i._enableReflection=this._enableReflection,i._albedoIntensity=this._albedoIntensity,this._albedoColor.cloneTo(i._albedoColor)},__getset(0,i,"renderMode",null,function(t){var i=this.getRenderState();switch(t){case 0:this.alphaTest=!1,this.renderQueue=2e3,i.depthWrite=!0,i.cull=2,i.blend=0,i.depthTest=513,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 1:this.renderQueue=2450,this.alphaTest=!0,i.depthWrite=!0,i.cull=2,i.blend=0,i.depthTest=513,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=3e3,this.alphaTest=!1,i.depthWrite=!1,i.cull=2,i.blend=1,i.srcBlend=770,i.dstBlend=771,i.depthTest=513,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.renderQueue=3e3,this.alphaTest=!1,i.depthWrite=!1,i.cull=2,i.blend=1,i.srcBlend=770,i.dstBlend=1,i.depthTest=513,this._defineDatas.add(e.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}}),__getset(0,i,"normalTexture",function(){return this._shaderValues.getTexture(2)},function(t){t?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP),this._shaderValues.setTexture(2,t)}),__getset(0,i,"tilingOffset",function(){return this._shaderValues.getVector(8)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET)}else this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET);this._shaderValues.setVector(8,t)}),__getset(0,i,"specularColor",function(){return this._shaderValues.getVector(6)},function(t){this._shaderValues.setVector(6,t)}),__getset(0,i,"albedoColor",function(){return this._albedoColor},function(t){var e=this._shaderValues.getVector(5);Vector4.scale(t,this._albedoIntensity,e),this._albedoColor=t,this._shaderValues.setVector(5,e)}),__getset(0,i,"albedoIntensity",function(){return this._albedoIntensity},function(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(5);Vector4.scale(this._albedoColor,t,e),this._albedoIntensity=t,this._shaderValues.setVector(5,e)}}),__getset(0,i,"specularTexture",function(){return this._shaderValues.getTexture(3)},function(t){t?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP),this._shaderValues.setTexture(3,t)}),__getset(0,i,"albedoTexture",function(){return this._shaderValues.getTexture(1)},function(t){t?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(1,t)}),__getset(0,i,"shininess",function(){return this._shaderValues.getNumber(7)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(7,t)}),__getset(0,i,"enableLighting",function(){return this._enableLighting},function(t){this._enableLighting!==t&&(t?this._disablePublicDefineDatas.remove(Scene3D.SHADERDEFINE_POINTLIGHT|Scene3D.SHADERDEFINE_SPOTLIGHT|Scene3D.SHADERDEFINE_DIRECTIONLIGHT):this._disablePublicDefineDatas.add(Scene3D.SHADERDEFINE_POINTLIGHT|Scene3D.SHADERDEFINE_SPOTLIGHT|Scene3D.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=t)}),__getset(0,i,"enableReflection",function(){return this._enableReflection},function(t){this._enableReflection!==t&&(t?this._disablePublicDefineDatas.remove(Scene3D.SHADERDEFINE_REFLECTMAP):this._disablePublicDefineDatas.add(Scene3D.SHADERDEFINE_REFLECTMAP),this._enableReflection=t)}),__getset(0,i,"reflectionColor",function(){return this._shaderValues.getVector(9)},function(t){this._shaderValues.setVector(9,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSEMAP=e.shaderDefines.registerDefine("DIFFUSEMAP"),e.SHADERDEFINE_NORMALMAP=e.shaderDefines.registerDefine("NORMALMAP"),e.SHADERDEFINE_SPECULARMAP=e.shaderDefines.registerDefine("SPECULARMAP"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET"),e.SHADERDEFINE_ADDTIVEFOG=e.shaderDefines.registerDefine("ADDTIVEFOG")},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.SPECULARSOURCE_DIFFUSEMAPALPHA=0,e.SPECULARSOURCE_SPECULARMAP=0,e.RENDERMODE_OPAQUE=0,e.RENDERMODE_CUTOUT=1,e.RENDERMODE_TRANSPARENT=2,e.RENDERMODE_ADDTIVE=3,e.SHADERDEFINE_DIFFUSEMAP=0,e.SHADERDEFINE_NORMALMAP=0,e.SHADERDEFINE_SPECULARMAP=0,e.SHADERDEFINE_TILINGOFFSET=0,e.SHADERDEFINE_ADDTIVEFOG=0,e.ALBEDOTEXTURE=1,e.NORMALTEXTURE=2,e.SPECULARTEXTURE=3,e.EMISSIVETEXTURE=4,e.ALBEDOCOLOR=5,e.MATERIALSPECULAR=6,e.SHININESS=7,e.TILINGOFFSET=8,e.REFLECTIONCOLOR=9,__static(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),ExtendTerrainMaterial=function(t){function e(){this._enableLighting=!0,e.__super.call(this,15),this.setShaderName("ExtendTerrain",15),this.renderMode=1}__class(e,"laya.d3.core.material.ExtendTerrainMaterial",t);var i=e.prototype;return i._setDetailNum=function(t){switch(t){case 1:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4)}},__getset(0,i,"diffuseScaleOffset2",null,function(t){this._shaderValues.setVector(7,t)}),__getset(0,i,"splatAlphaTexture",function(){return this._shaderValues.getTexture(0)},function(t){this._shaderValues.setTexture(0,t)}),__getset(0,i,"diffuseScaleOffset3",null,function(t){this._shaderValues.setVector(8,t)}),__getset(0,i,"diffuseTexture1",null,function(t){this._shaderValues.setTexture(1,t),this._setDetailNum(1)}),__getset(0,i,"renderMode",null,function(t){var e=this.getRenderState();switch(t){case 1:this.renderQueue=2e3,e.depthWrite=!0,e.cull=2,e.blend=0,e.depthTest=513;break;case 2:this.renderQueue=2e3,e.depthWrite=!1,e.cull=2,e.blend=1,e.srcBlend=770,e.dstBlend=771,e.depthTest=515;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}}),__getset(0,i,"diffuseTexture2",function(){return this._shaderValues.getTexture(2)},function(t){this._shaderValues.setTexture(2,t),this._setDetailNum(2)}),__getset(0,i,"diffuseScaleOffset1",null,function(t){this._shaderValues.setVector(6,t)}),__getset(0,i,"diffuseTexture3",function(){return this._shaderValues.getTexture(3)},function(t){this._shaderValues.setTexture(3,t),this._setDetailNum(3)}),__getset(0,i,"diffuseTexture4",function(){return this._shaderValues.getTexture(4)},function(t){this._shaderValues.setTexture(4,t),this._setDetailNum(4)}),__getset(0,i,"diffuseTexture5",function(){return this._shaderValues.getTexture(5)},function(t){this._shaderValues.setTexture(5,t),this._setDetailNum(5)}),__getset(0,i,"diffuseScaleOffset4",null,function(t){this._shaderValues.setVector(9,t)}),__getset(0,i,"diffuseScaleOffset5",null,function(t){this._shaderValues.setVector(10,t)}),__getset(0,i,"albedo",function(){return this._shaderValues.getVector(14)},function(t){this._shaderValues.setVector(14,t)}),__getset(0,i,"ambientColor",function(){return this._shaderValues.getVector(11)},function(t){this._shaderValues.setVector(11,t)}),__getset(0,i,"diffuseColor",function(){return this._shaderValues.getVector(12)},function(t){this._shaderValues.setVector(12,t)}),__getset(0,i,"specularColor",function(){return this._shaderValues.getVector(13)},function(t){this._shaderValues.setVector(13,t)}),__getset(0,i,"enableLighting",function(){return this._enableLighting},function(t){this._enableLighting!==t&&(t?this._disablePublicDefineDatas.remove(Scene3D.SHADERDEFINE_POINTLIGHT|Scene3D.SHADERDEFINE_SPOTLIGHT|Scene3D.SHADERDEFINE_DIRECTIONLIGHT):this._disablePublicDefineDatas.add(Scene3D.SHADERDEFINE_POINTLIGHT|Scene3D.SHADERDEFINE_SPOTLIGHT|Scene3D.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=t)}),e.__init__=function(){e.SHADERDEFINE_DETAIL_NUM1=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM1"),e.SHADERDEFINE_DETAIL_NUM2=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM2"),e.SHADERDEFINE_DETAIL_NUM3=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM3"),e.SHADERDEFINE_DETAIL_NUM4=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM4"),e.SHADERDEFINE_DETAIL_NUM5=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM5")},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_TRANSPARENT=2,e.SPLATALPHATEXTURE=0,e.DIFFUSETEXTURE1=1,e.DIFFUSETEXTURE2=2,e.DIFFUSETEXTURE3=3,e.DIFFUSETEXTURE4=4,e.DIFFUSETEXTURE5=5,e.DIFFUSESCALEOFFSET1=6,e.DIFFUSESCALEOFFSET2=7,e.DIFFUSESCALEOFFSET3=8,e.DIFFUSESCALEOFFSET4=9,e.DIFFUSESCALEOFFSET5=10,e.MATERIALAMBIENT=11,e.MATERIALDIFFUSE=12,e.MATERIALSPECULAR=13,e.MATERIALALBEDO=14,e.SHADERDEFINE_DETAIL_NUM1=0,e.SHADERDEFINE_DETAIL_NUM2=0,e.SHADERDEFINE_DETAIL_NUM3=0,e.SHADERDEFINE_DETAIL_NUM4=0,e.SHADERDEFINE_DETAIL_NUM5=0,__static(e,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),PBRMaterial=function(t){function e(){if(this._transformUV=null,e.__super.call(this,15),!laya.d3.core.material.PBRMaterial.pbrlutTex){var t=Browser.window.__pbrlutdata;if(!t)throw alert("no pbr lutdata, need pbrlut.js"),"no pbr lutdata, need pbrlut.js";var i=DataTexture2D.create(new Uint32Array(t).buffer,256,256,9728,9728,!1);laya.d3.core.material.PBRMaterial.pbrlutTex=i}this._shaderValues.setTexture(4,laya.d3.core.material.PBRMaterial.pbrlutTex),this.setShaderName("PBR"),this._shaderValues.setNumber(0,.5),this.use_groundtruth=!1}__class(e,"laya.d3.core.material.PBRMaterial",t);var i=e.prototype;return i.disableLight=function(){this._defineDatas.add(Scene3D.SHADERDEFINE_POINTLIGHT|Scene3D.SHADERDEFINE_SPOTLIGHT|Scene3D.SHADERDEFINE_DIRECTIONLIGHT)},i.disableFog=function(){this._defineDatas.add(Shader3D.SHADERDEFINE_FOG)},i.radicalInverse_VdC=function(t){var e=new Uint32Array(1);return function(t){return t=t<<16|t>>>16,t=(1431655765&t)<<1|(2863311530&t)>>>1,t=(858993459&t)<<2|(3435973836&t)>>>2,t=(252645135&t)<<4|(4042322160&t)>>>4,t=(16711935&t)<<8|(4278255360&t)>>>8,e[0]=t,2.3283064365386963e-10*e[0]}(t)},i.createHammersleyTex=function(t,e){var i=new Uint8Array(t*e*4),n=0,r=0;for(r=0;t*e>r;r++){var a=this.radicalInverse_VdC(r);i[n++]=255*a,i[n++]=0,i[n++]=0,i[n++]=255}return i},__getset(0,i,"normalTexture",function(){return this._shaderValues.getTexture(2)},function(t){this._shaderValues.setTexture(2,t)}),__getset(0,i,"has_tangent",null,function(){this._defineDatas.add(e.SHADERDEFINE_HAS_TANGENT)}),__getset(0,i,"roughness",function(){return this._shaderValues.getNumber(6)},function(t){this._shaderValues.setNumber(6,t),this._defineDatas.add(e.SHADERDEFINE_FIX_ROUGHNESS)}),__getset(0,i,"metaless",function(){return this._shaderValues.getNumber(7)},function(t){this._shaderValues.setNumber(7,t),this._defineDatas.add(e.SHADERDEFINE_FIX_METALESS)}),__getset(0,i,"pbrlutTexture",function(){return this._shaderValues.getTexture(4)},function(t){this._shaderValues.setTexture(4,t)}),__getset(0,i,"use_groundtruth",null,function(t){if(t){if(this._defineDatas.add(e.SHADERDEFINE_USE_GROUNDTRUTH),!laya.d3.core.material.PBRMaterial.HammersleyNoiseTex){var i=this.createHammersleyTex(32,32);laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=DataTexture2D.create(i.buffer,32,32,9728,9728,!1)}this._shaderValues.setTexture(15,e.HammersleyNoiseTex)}else laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=null,this._defineDatas.remove(e.SHADERDEFINE_USE_GROUNDTRUTH)}),__getset(0,i,"transformUV",function(){return this._transformUV},function(t){this._transformUV=t,this._shaderValues.setMatrix4x4(8,t.matrix)}),__getset(0,i,"diffuseTexture",function(){return this._shaderValues.getTexture(1)},function(t){this._shaderValues.setTexture(1,t)}),__getset(0,i,"renderMode",null,function(t){var e=this.getRenderState();switch(t){case 1:e.renderQueue=2e3,e.depthWrite=!0,e.cull=2,e.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=2e3,e.depthWrite=!0,e.cull=0,e.blend=0,this.alphaTest=!1;break;case 3:e.depthWrite=!0,e.cull=2,e.blend=0,this.renderQueue=2450;break;case 13:this.renderQueue=3e3,e.depthWrite=!0,e.cull=2,e.blend=1,e.srcBlend=770,e.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),__getset(0,i,"pbrInfoTexture",function(){return this._shaderValues.getTexture(3)},function(t){this._shaderValues.setTexture(3,t),this._defineDatas.add(e.SHADERDEFINE_HAS_PBRINFO)}),__getset(0,i,"testClipZ",null,function(){this._defineDatas.add(e.SHADERDEFINE_TEST_CLIPZ)}),e.__init__=function(){e.SHADERDEFINE_FIX_METALESS=e.shaderDefines.registerDefine("FIX_METALESS"),e.SHADERDEFINE_FIX_ROUGHNESS=e.shaderDefines.registerDefine("FIX_ROUGHNESS"),e.SHADERDEFINE_HAS_TANGENT=e.shaderDefines.registerDefine("HAS_TANGENT"),e.SHADERDEFINE_HAS_PBRINFO=e.shaderDefines.registerDefine("HAS_PBRINFO"),e.SHADERDEFINE_USE_GROUNDTRUTH=e.shaderDefines.registerDefine("USE_GROUNDTRUTH"),e.SHADERDEFINE_TEST_CLIPZ=e.shaderDefines.registerDefine("CLIPZ")},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.DIFFUSETEXTURE=1,e.NORMALTEXTURE=2,e.PBRINFOTEXTURE=3,e.PBRLUTTEXTURE=4,e.UVANIAGE=5,e.MATERIALROUGHNESS=6,e.MATERIALMETALESS=7,e.UVMATRIX=8,e.UVAGE=9,e.AOOBJPOS=14,e.HSNOISETEXTURE=15,e.SHADERDEFINE_FIX_ROUGHNESS=0,e.SHADERDEFINE_FIX_METALESS=0,e.SHADERDEFINE_HAS_TANGENT=0,e.SHADERDEFINE_TEST_CLIPZ=0,e.SHADERDEFINE_HAS_PBRINFO=0,e.SHADERDEFINE_USE_GROUNDTRUTH=0,e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,e.pbrlutTex=null,e.HammersleyNoiseTex=null,__static(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),PBRSpecularMaterial=function(t){function e(){e.__super.call(this,19),this.setShaderName("PBRSpecular"),this._shaderValues.setVector(7,new Vector4(1,1,1,1)),this._shaderValues.setVector(9,new Vector4(0,0,0,0)),this._shaderValues.setVector(8,new Vector4(.2,.2,.2,.2)),this._shaderValues.setNumber(10,.5),this._shaderValues.setNumber(11,1),this._shaderValues.setNumber(12,0),this._shaderValues.setNumber(13,1),this._shaderValues.setNumber(14,1),this._shaderValues.setNumber(15,.001),this._shaderValues.setBool(16,!1),this._shaderValues.setNumber(0,.5)}__class(e,"laya.d3.core.material.PBRSpecularMaterial",t);var i=e.prototype;return __getset(0,i,"albedoColor",function(){return this._shaderValues.getVector(7)},function(t){this._shaderValues.setVector(7,t)}),__getset(0,i,"specularTexture",function(){return this._shaderValues.getTexture(2)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE),this._shaderValues.setTexture(2,t)}),__getset(0,i,"albedoTexture",function(){return this._shaderValues.getTexture(1)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._shaderValues.setTexture(1,t)}),__getset(0,i,"occlusionTexture",function(){return this._shaderValues.getTexture(5)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._shaderValues.setTexture(5,t)}),__getset(0,i,"normalTexture",function(){return this._shaderValues.getTexture(3)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(3,t)}),__getset(0,i,"parallaxTexture",function(){return this._shaderValues.getTexture(4)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._shaderValues.setTexture(4,t)}),__getset(0,i,"emissionColor",function(){return this._shaderValues.getVector(9)},function(t){this._shaderValues.setVector(9,t)}),__getset(0,i,"normalTextureScale",function(){return this._shaderValues.getNumber(14)},function(t){this._shaderValues.setNumber(14,t)}),__getset(0,i,"parallaxTextureScale",function(){return this._shaderValues.getNumber(15)},function(t){t=Math.max(.005,Math.min(.08,t)),this._shaderValues.setNumber(15,t)}),__getset(0,i,"occlusionTextureStrength",function(){return this._shaderValues.getNumber(13)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(13,t)}),__getset(0,i,"specularColor",function(){return this._shaderValues.getVector(8)},function(t){this._shaderValues.setVector(8,t)}),__getset(0,i,"smoothness",function(){return this._shaderValues.getNumber(10)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(10,t)}),__getset(0,i,"smoothnessTextureScale",function(){return this._shaderValues.getNumber(11)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(11,t)}),__getset(0,i,"smoothnessSource",function(){return this._shaderValues.getNumber(12)},function(t){1==t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),t=0),this._shaderValues.setNumber(12,t)
}),__getset(0,i,"enableEmission",function(){return this._shaderValues.getBool(16)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION),this._shaderValues.setBool(16,t)}),__getset(0,i,"emissionTexture",function(){return this._shaderValues.getTexture(6)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._shaderValues.setTexture(6,t)}),__getset(0,i,"enableReflection",function(){return this._shaderValues.getBool(17)},function(t){this._shaderValues.setBool(17,!0),t?this._disablePublicDefineDatas.remove(Scene3D.SHADERDEFINE_REFLECTMAP):this._disablePublicDefineDatas.add(Scene3D.SHADERDEFINE_REFLECTMAP)}),__getset(0,i,"tilingOffset",null,function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET)}else this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET);this._shaderValues.setVector(18,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_SPECULARTEXTURE=e.shaderDefines.registerDefine("SPECULARTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_SPECULARTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.SPECULARTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.SPECULARCOLOR=8,e.EMISSIONCOLOR=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.ENABLEREFLECT=17,e.TILINGOFFSET=18,__static(e,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),PBRStandardMaterial=function(t){function e(){e.__super.call(this,19),this.setShaderName("PBRStandard"),this._shaderValues.setVector(7,new Vector4(1,1,1,1)),this._shaderValues.setVector(8,new Vector4(0,0,0,0)),this._shaderValues.setNumber(9,0),this._shaderValues.setNumber(10,.5),this._shaderValues.setNumber(11,1),this._shaderValues.setNumber(12,0),this._shaderValues.setNumber(13,1),this._shaderValues.setNumber(14,1),this._shaderValues.setNumber(15,.001),this._shaderValues.setBool(16,!1),this._shaderValues.setBool(17,!0),this._shaderValues.setNumber(0,.5),this._disablePublicDefineDatas.remove(Scene3D.SHADERDEFINE_REFLECTMAP)}__class(e,"laya.d3.core.material.PBRStandardMaterial",t);var i=e.prototype;return __getset(0,i,"albedoColor",function(){return this._shaderValues.getVector(7)},function(t){this._shaderValues.setVector(7,t)}),__getset(0,i,"albedoTexture",function(){return this._shaderValues.getTexture(1)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._shaderValues.setTexture(1,t)}),__getset(0,i,"enableEmission",function(){return this._shaderValues.getBool(16)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION),this._shaderValues.setBool(16,t)}),__getset(0,i,"metallicGlossTexture",function(){return this._shaderValues.getTexture(2)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE),this._shaderValues.setTexture(2,t)}),__getset(0,i,"occlusionTexture",function(){return this._shaderValues.getTexture(5)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._shaderValues.setTexture(5,t)}),__getset(0,i,"normalTexture",function(){return this._shaderValues.getTexture(3)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(3,t)}),__getset(0,i,"parallaxTexture",function(){return this._shaderValues.getTexture(4)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._shaderValues.setTexture(4,t)}),__getset(0,i,"emissionColor",function(){return this._shaderValues.getVector(8)},function(t){this._shaderValues.setVector(8,t)}),__getset(0,i,"normalTextureScale",function(){return this._shaderValues.getNumber(14)},function(t){this._shaderValues.setNumber(14,t)}),__getset(0,i,"parallaxTextureScale",function(){return this._shaderValues.getNumber(15)},function(t){t=Math.max(.005,Math.min(.08,t)),this._shaderValues.setNumber(15,t)}),__getset(0,i,"occlusionTextureStrength",function(){return this._shaderValues.getNumber(13)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(13,t)}),__getset(0,i,"metallic",function(){return this._shaderValues.getNumber(9)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(9,t)}),__getset(0,i,"smoothness",function(){return this._shaderValues.getNumber(10)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(10,t)}),__getset(0,i,"smoothnessTextureScale",function(){return this._shaderValues.getNumber(11)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(11,t)}),__getset(0,i,"smoothnessSource",function(){return this._shaderValues.getNumber(12)},function(t){1==t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),t=0),this._shaderValues.setNumber(12,t)}),__getset(0,i,"emissionTexture",function(){return this._shaderValues.getTexture(6)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._shaderValues.setTexture(6,t)}),__getset(0,i,"enableReflection",function(){return this._shaderValues.getBool(17)},function(t){this._shaderValues.setBool(17,!0),t?this._disablePublicDefineDatas.remove(Scene3D.SHADERDEFINE_REFLECTMAP):this._disablePublicDefineDatas.add(Scene3D.SHADERDEFINE_REFLECTMAP)}),__getset(0,i,"tilingOffset",null,function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET);this._shaderValues.setVector(18,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_METALLICGLOSSTEXTURE=e.shaderDefines.registerDefine("METALLICGLOSSTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_REFLECTMAP=e.shaderDefines.registerDefine("REFLECTMAP"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_METALLICGLOSSTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_REFLECTMAP=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.METALLICGLOSSTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.EMISSIONCOLOR=8,e.METALLIC=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.ENABLEREFLECT=17,e.TILINGOFFSET=18,__static(e,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),SkyBoxMaterial=function(t){function e(){e.__super.call(this,5),this.setShaderName("SkyBox")}__class(e,"laya.d3.core.material.SkyBoxMaterial",t);var i=e.prototype;return __getset(0,i,"tintColor",function(){return this._shaderValues.getVector(1)},function(t){this._shaderValues.setVector(1,t)}),__getset(0,i,"exposure",function(){return this._shaderValues.getNumber(2)},function(t){this._shaderValues.setNumber(2,t)}),__getset(0,i,"rotation",function(){return this._shaderValues.getNumber(3)},function(t){this._shaderValues.setNumber(3,t)}),__getset(0,i,"textureCube",function(){return this._shaderValues.getTexture(4)},function(t){return this._shaderValues.setTexture(4,t)}),e.load=function(t){return Laya.loader.create(t,null,null,e)},e.TINTCOLOR=1,e.EXPOSURE=2,e.ROTATION=3,e.TEXTURECUBE=4,__static(e,["defaultMaterial",function(){return this.defaultMaterial=new e}]),e}(BaseMaterial),TerrainMaterial=function(t){function e(){this._diffuseScale1=null,this._diffuseScale2=null,this._diffuseScale3=null,this._diffuseScale4=null,e.__super.call(this,13),this.setShaderName("Terrain"),this.renderMode=1,this._diffuseScale1=new Vector2,this._diffuseScale2=new Vector2,this._diffuseScale3=new Vector2,this._diffuseScale4=new Vector2,this.ambientColor=new Vector3(.6,.6,.6),this.diffuseColor=new Vector3(1,1,1),this.specularColor=new Vector4(.2,.2,.2,32)}__class(e,"laya.d3.core.material.TerrainMaterial",t);var i=e.prototype;return i.setDiffuseScale1=function(t,e){this._diffuseScale1.x=t,this._diffuseScale1.y=e,this._shaderValues.setVector(6,this._diffuseScale1)},i.setDiffuseScale2=function(t,e){this._diffuseScale2.x=t,this._diffuseScale2.y=e,this._shaderValues.setVector(7,this._diffuseScale2)},i.setDiffuseScale3=function(t,e){this._diffuseScale3.x=t,this._diffuseScale3.y=e,this._shaderValues.setVector(8,this._diffuseScale3)},i.setDiffuseScale4=function(t,e){this._diffuseScale4.x=t,this._diffuseScale4.y=e,this._shaderValues.setVector(9,this._diffuseScale4)},i.setDetailNum=function(t){switch(t){case 1:this._defineDatas.add(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 2:this._defineDatas.add(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 3:this._defineDatas.add(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 4:this._defineDatas.add(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3)}},i.disableLight=function(){this._disablePublicDefineDatas.add(Scene3D.SHADERDEFINE_POINTLIGHT|Scene3D.SHADERDEFINE_SPOTLIGHT|Scene3D.SHADERDEFINE_DIRECTIONLIGHT)},i.setShaderName=function(e){t.prototype.setShaderName.call(this,e)},__getset(0,i,"renderMode",null,function(t){var e=this.getRenderState();switch(t){case 1:this.renderQueue=2e3,e.depthWrite=!0,e.cull=2,e.blend=0,e.depthTest=513;break;case 2:this.renderQueue=2e3,e.depthWrite=!1,e.cull=2,e.blend=1,e.srcBlend=770,e.dstBlend=771,e.depthTest=515;break;default:throw new Error("TerrainMaterial:renderMode value error.")}}),__getset(0,i,"diffuseTexture2",function(){return this._shaderValues.getTexture(3)},function(t){this._shaderValues.setTexture(3,t)}),__getset(0,i,"ambientColor",function(){return this._shaderValues.getVector(10)},function(t){this._shaderValues.setVector(10,t)}),__getset(0,i,"diffuseTexture4",function(){return this._shaderValues.getTexture(5)},function(t){this._shaderValues.setTexture(5,t)}),__getset(0,i,"diffuseColor",function(){return this._shaderValues.getVector(11)},function(t){this._shaderValues.setVector(11,t)}),__getset(0,i,"diffuseTexture1",function(){return this._shaderValues.getTexture(2)},function(t){this._shaderValues.setTexture(2,t)}),__getset(0,i,"specularColor",function(){return this._shaderValues.getVector(12)},function(t){this._shaderValues.setVector(12,t)}),__getset(0,i,"diffuseTexture3",function(){return this._shaderValues.getTexture(4)},function(t){this._shaderValues.setTexture(4,t)}),__getset(0,i,"splatAlphaTexture",function(){return this._shaderValues.getTexture(0)},function(t){this._shaderValues.setTexture(0,t)}),__getset(0,i,"normalTexture",function(){return this._shaderValues.getTexture(1)},function(t){this._shaderValues.setTexture(1,t)}),e.__init__=function(){e.SHADERDEFINE_DETAIL_NUM1=e.shaderDefines.registerDefine("DETAIL_NUM1"),e.SHADERDEFINE_DETAIL_NUM2=e.shaderDefines.registerDefine("DETAIL_NUM2"),e.SHADERDEFINE_DETAIL_NUM4=e.shaderDefines.registerDefine("DETAIL_NUM4"),e.SHADERDEFINE_DETAIL_NUM3=e.shaderDefines.registerDefine("DETAIL_NUM3")},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_TRANSPARENT=2,e.SPLATALPHATEXTURE=0,e.NORMALTEXTURE=1,e.DIFFUSETEXTURE1=2,e.DIFFUSETEXTURE2=3,e.DIFFUSETEXTURE3=4,e.DIFFUSETEXTURE4=5,e.DIFFUSESCALE1=6,e.DIFFUSESCALE2=7,e.DIFFUSESCALE3=8,e.DIFFUSESCALE4=9,e.MATERIALAMBIENT=10,e.MATERIALDIFFUSE=11,e.MATERIALSPECULAR=12,e.SHADERDEFINE_DETAIL_NUM1=0,e.SHADERDEFINE_DETAIL_NUM2=0,e.SHADERDEFINE_DETAIL_NUM3=0,e.SHADERDEFINE_DETAIL_NUM4=0,__static(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),UnlitMaterial=function(t){function e(){e.__super.call(this,3),this.setShaderName("Unlit"),this._shaderValues.setVector(new Vector4(1,1,1,1))}__class(e,"laya.d3.core.material.UnlitMaterial",t);var i=e.prototype;return __getset(0,i,"albedoColor",function(){return this._shaderValues.getVector(2)},function(t){this._shaderValues.setVector(2,t)}),__getset(0,i,"albedoTexture",function(){return this._shaderValues.getTexture(1)},function(t){t?this._defineDatas.add(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE):this._defineDatas.remove(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(1,t)}),__getset(0,i,"tilingOffset",function(){return this._shaderValues.getVector(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._defineDatas.add(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_TILINGOFFSET)}else this._defineDatas.remove(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_TILINGOFFSET);this._shaderValues.setVector(3,t)}),e.__init__=function(){e.SHADERDEFINE_ALBEDOTEXTURE=e.shaderDefines.registerDefine("ALBEDOTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SHADERDEFINE_ALBEDOTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.ALBEDOTEXTURE=1,e.ALBEDOCOLOR=2,e.TILINGOFFSET=3,__static(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),WaterPrimaryMaterial=function(t){function e(){e.__super.call(this,5),this.setShaderName("WaterPrimary"),this._shaderValues.setVector(0,new Vector4(.172,.463,.435,0)),this._shaderValues.setNumber(3,.15),this._shaderValues.setVector(4,new Vector4(19,9,-16,-7))}__class(e,"laya.d3.core.material.WaterPrimaryMaterial",t);var i=e.prototype;return __getset(0,i,"waveSpeed",function(){return this._shaderValues.getVector(4)},function(t){this._shaderValues.setVector(4,t)}),__getset(0,i,"horizonColor",function(){return this._shaderValues.getVector(0)},function(t){this._shaderValues.setVector(0,t)}),__getset(0,i,"mainTexture",function(){return this._shaderValues.getTexture(1)},function(t){t?this._defineDatas.add(laya.d3.core.material.WaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE):this._defineDatas.remove(laya.d3.core.material.WaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(1,t)}),__getset(0,i,"normalTexture",function(){return this._shaderValues.getTexture(2)},function(t){t?this._defineDatas.add(laya.d3.core.material.WaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE):this._defineDatas.remove(laya.d3.core.material.WaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(2,t)}),__getset(0,i,"waveScale",function(){return this._shaderValues.getNumber(3)},function(t){this._shaderValues.setNumber(3,t)}),e.__init__=function(){e.SHADERDEFINE_MAINTEXTURE=e.shaderDefines.registerDefine("MAINTEXTURE"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE")},e.HORIZONCOLOR=0,e.MAINTEXTURE=1,e.NORMALTEXTURE=2,e.WAVESCALE=3,e.WAVESPEED=4,e.SHADERDEFINE_MAINTEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,__static(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),VertexBuffer3D=function(t){function e(t,i,n){this._vertexCount=0,this._canRead=!1,this._vertexDeclaration=null,void 0===n&&(n=!1),e.__super.call(this),this._vertexCount=-1,this._bufferUsage=i,this._bufferType=34962,this._canRead=n,this._byteLength=t,this._setGPUMemory(t),this.bind(),LayaGL.instance.bufferData(this._bufferType,this._byteLength,this._bufferUsage),n&&(this._buffer=new Float32Array(this._byteLength/4)),this._activeResource()}__class(e,"laya.d3.graphics.VertexBuffer3D",t);var i=e.prototype;return i.bind=function(){return Buffer._bindedVertexBuffer!==this._glBuffer?(LayaGL.instance.bindBuffer(34962,this._glBuffer),Buffer._bindedVertexBuffer=this._glBuffer,!0):!1},i.setData=function(t,e,i,n){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295),(0!==i||4294967295!==n)&&(t=new Float32Array(t.buffer,4*i,n)),this.bind(),LayaGL.instance.bufferSubData(this._bufferType,4*e,t),this._canRead)if(0!==e||0!==i||4294967295!==n){var r=this._buffer.length-e;n>r&&(n=r);for(var a=0;n>a;a++)this._buffer[e+a]=t[a]}else this._buffer=t},i.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},i._disposeResource=function(){t.prototype._disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this._setGPUMemory(0)},__getset(0,i,"vertexDeclaration",function(){return this._vertexDeclaration},function(t){this._vertexDeclaration!==t&&(this._vertexDeclaration=t,this._vertexCount=t?this._byteLength/t.vertexStride:-1)}),__getset(0,i,"vertexCount",function(){return this._vertexCount}),__getset(0,i,"canRead",function(){return this._canRead}),e}(Buffer),ShurikenParticleMaterial=function(t){function e(){e.__super.call(this,4),this.setShaderName("PARTICLESHURIKEN"),this.renderMode=6}__class(e,"laya.d3.core.particleShuriKen.ShurikenParticleMaterial",t);var i=e.prototype;return __getset(0,i,"renderMode",null,function(t){var i=this.getRenderState();switch(t){case 1:this.renderQueue=2e3,i.depthWrite=!0,i.cull=2,i.blend=0,this.alphaTest=!1,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,i.depthWrite=!0,i.cull=0,i.blend=0,this.alphaTest=!1,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.renderQueue=BaseMaterial.SHADERDEFINE_ALPHATEST,i.depthWrite=!0,i.cull=2,i.blend=0,this.alphaTest=!0,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2450,i.depthWrite=!0,i.cull=0,i.blend=0,this.alphaTest=!0,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,i.depthWrite=!0,i.cull=2,i.blend=1,i.srcBlend=770,i.dstBlend=771,this.alphaTest=!1,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,i.depthWrite=!0,i.cull=0,i.blend=1,i.srcBlend=770,i.dstBlend=771,this.alphaTest=!1,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,i.depthWrite=!0,i.cull=2,i.blend=1,i.srcBlend=770,i.dstBlend=1,this.alphaTest=!1,this._defineDatas.add(e.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,i.depthWrite=!0,i.cull=0,i.blend=1,i.srcBlend=770,i.dstBlend=1,this.alphaTest=!1,this._defineDatas.add(e.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,i.depthWrite=!1,i.cull=2,i.blend=1,i.srcBlend=770,i.dstBlend=771,this.alphaTest=!1,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,i.depthWrite=!1,i.cull=0,i.blend=1,i.srcBlend=770,i.dstBlend=771,this.alphaTest=!1,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,i.depthWrite=!1,i.cull=2,i.blend=1,i.srcBlend=770,i.dstBlend=1,this.alphaTest=!1,this._defineDatas.add(e.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,i.depthWrite=!1,i.cull=0,i.blend=1,i.srcBlend=770,i.dstBlend=1,this.alphaTest=!1,this._defineDatas.add(e.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,i.depthTest=RenderQueue.DEPTHTEST_LESS,i.cull=2,i.blend=1,i.srcBlend=770,i.dstBlend=771,this.alphaTest=!1,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,i.depthTest=513,i.cull=0,i.blend=1,i.srcBlend=770,i.dstBlend=771,this.alphaTest=!1,this._defineDatas.remove(e.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,i.depthTest=513,i.cull=2,i.blend=1,i.srcBlend=770,i.dstBlend=1,this.alphaTest=!1,this._defineDatas.add(e.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,i.depthTest=RenderQueue.DEPTHTEST_LESS,i.cull=0,i.blend=1,i.srcBlend=770,i.dstBlend=1,this.alphaTest=!1,this._defineDatas.add(e.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}}),__getset(0,i,"tintColor",function(){return this._shaderValues.getVector(2)},function(t){t?this._defineDatas.add(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR):this._defineDatas.remove(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR),this._shaderValues.setVector(2,t)}),__getset(0,i,"tilingOffset",function(){return this._shaderValues.getVector(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._defineDatas.add(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET)}else this._defineDatas.remove(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET);this._shaderValues.setVector(3,t)}),__getset(0,i,"diffuseTexture",function(){return this._shaderValues.getTexture(1)},function(t){t?this._defineDatas.add(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP):this._defineDatas.remove(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(1,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSEMAP=e.shaderDefines.registerDefine("DIFFUSEMAP"),e.SHADERDEFINE_TINTCOLOR=e.shaderDefines.registerDefine("TINTCOLOR"),e.SHADERDEFINE_ADDTIVEFOG=e.shaderDefines.registerDefine("ADDTIVEFOG"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,e.RENDERMODE_TRANSPARENTDOUBLEFACE=14,e.RENDERMODE_ADDTIVE=15,e.RENDERMODE_ADDTIVEDOUBLEFACE=16,e.RENDERMODE_DEPTHREAD_TRANSPARENT=5,e.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,e.RENDERMODE_DEPTHREAD_ADDTIVE=7,e.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,e.RENDERMODE_NONDEPTH_TRANSPARENT=9,e.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,e.RENDERMODE_NONDEPTH_ADDTIVE=11,e.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,e.SHADERDEFINE_DIFFUSEMAP=0,e.SHADERDEFINE_TINTCOLOR=0,e.SHADERDEFINE_TILINGOFFSET=0,e.SHADERDEFINE_ADDTIVEFOG=0,e.DIFFUSETEXTURE=1,e.TINTCOLOR=2,e.TILINGOFFSET=3,__static(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),Terrain=function(t){function e(t){this._terrainRes=null,this._lightmapScaleOffset=null,e.__super.call(this),this._lightmapScaleOffset=new Vector4(1,1,0,0),t&&(this._terrainRes=t,t.loaded?this.buildTerrain(t):t.once("loaded",this,this.buildTerrain))}__class(e,"laya.d3.terrain.Terrain",t);var i=e.prototype;return i._parse=function(e,i){t.prototype._parse.call(this,e,i),this.terrainRes=Loader.getRes(i[e.dataPath]);var n=e.lightmapIndex;null!=n&&this.setLightmapIndex(n);var r=e.lightmapScaleOffset;r&&this.setLightmapScaleOffset(new Vector4(r[0],r[1],r[2],r[3]))},i.setLightmapIndex=function(t){for(var e=0;e<this._children.length;e++){var i=this._children[e];i.terrainRender.lightmapIndex=t}},i.setLightmapScaleOffset=function(t){if(t){t.cloneTo(this._lightmapScaleOffset);for(var e=0;e<this._children.length;e++){var i=this._children[e];i.terrainRender.lightmapScaleOffset=this._lightmapScaleOffset}}},i.disableLight=function(){for(var t=0,e=this._children.length;e>t;t++)for(var i=this._children[t],n=0,r=i._render.sharedMaterials.length;r>n;n++){var a=i._render.sharedMaterials[n];a.disableLight()}},i.buildTerrain=function(t){for(var e=t._chunkNumX,i=t._chunkNumZ,n=t._heightData,r=0,a=0;i>a;a++)for(var s=0;e>s;s++){for(var o=new TerrainChunk(s,a,t._gridSize,n._terrainHeightData,n._width,n._height,t._cameraCoordinateInverse),l=t._chunkInfos[r++],_=0;_<l.alphaMap.length;_++){var h=l.detailID[_].length,u=h>0?t._detailTextureInfos[l.detailID[_][0]].diffuseTexture:null,c=h>1?t._detailTextureInfos[l.detailID[_][1]].diffuseTexture:null,d=h>2?t._detailTextureInfos[l.detailID[_][2]].diffuseTexture:null,f=h>3?t._detailTextureInfos[l.detailID[_][3]].diffuseTexture:null,m=h>0?t._detailTextureInfos[l.detailID[_][0]].scale:null,p=h>1?t._detailTextureInfos[l.detailID[_][1]].scale:null,g=h>2?t._detailTextureInfos[l.detailID[_][2]].scale:null,v=h>3?t._detailTextureInfos[l.detailID[_][3]].scale:null;o.buildRenderElementAndMaterial(h,l.normalMap,l.alphaMap[_],u,c,d,f,t._materialInfo.ambientColor,t._materialInfo.diffuseColor,t._materialInfo.specularColor,m?m.x:1,m?m.y:1,p?p.x:1,p?p.y:1,g?g.x:1,g?g.y:1,v?v.x:1,v?v.y:1)}o.terrainRender.receiveShadow=!0,o.terrainRender.lightmapScaleOffset=this._lightmapScaleOffset,this.addChild(o)}},i.width=function(){return this._terrainRes._chunkNumX*TerrainLeaf.CHUNK_GRID_NUM*this._terrainRes._gridSize},i.depth=function(){return this._terrainRes._chunkNumZ*TerrainLeaf.CHUNK_GRID_NUM*this._terrainRes._gridSize},i.getHeightXZ=function(t,i){if(!this._terrainRes||!this._terrainRes.loaded)return 0/0;if(t-=this.transform.position.x,i-=this.transform.position.z,e.__VECTOR3__||(e.__VECTOR3__=new Vector3),e.__VECTOR3__.elements[0]=t,e.__VECTOR3__.elements[1]=0,e.__VECTOR3__.elements[2]=i,Vector3.transformV3ToV3(e.__VECTOR3__,TerrainLeaf.__ADAPT_MATRIX_INV__,e.__VECTOR3__),t=e.__VECTOR3__.elements[0],i=e.__VECTOR3__.elements[2],0>t||t>this.width()||0>i||i>this.depth())return 0/0;var n=this._terrainRes._gridSize,r=parseInt(""+t/n),a=parseInt(""+i/n),s=t-r*n,o=i-a*n,l=0/0,_=0/0,h=0/0,u=0/0,c=0/0,d=this._terrainRes._heightData;return s+o>n?(l=d._terrainHeightData[(a+1-1)*d._width+r+1],_=d._terrainHeightData[(a+1-1)*d._width+r],h=d._terrainHeightData[(a-1)*d._width+r+1],u=(n-s)/n,c=(n-o)/n,l+(_-l)*u+(h-l)*c):(l=d._terrainHeightData[Math.max(0,a-1)*d._width+r],_=d._terrainHeightData[Math.min(d._width*d._height-1,(a+1-1)*d._width+r)],h=d._terrainHeightData[Math.min(d._width*d._height-1,Math.max(0,a-1)*d._width+r+1)],u=s/n,c=o/n,l+(_-l)*c+(h-l)*u)},__getset(0,i,"terrainRes",null,function(t){t&&(this._terrainRes=t,t.loaded?this.buildTerrain(t):t.once("loaded",this,this.buildTerrain))}),e.load=function(t){return Laya.loader.create(t,null,null,e,null,1,!1)},e.RENDER_LINE_MODEL=!1,e.LOD_TOLERANCE_VALUE=4,e.LOD_DISTANCE_FACTOR=2,e.__VECTOR3__=null,e}(Sprite3D),TrailMaterial=function(t){function e(){e.__super.call(this),this.setShaderName("Trail"),this._shaderValues.setVector(2,new Vector4(1,1,1,1))}__class(e,"laya.d3.core.trail.TrailMaterial",t);var i=e.prototype;return __getset(0,i,"tintColor",function(){return this._shaderValues.getVector(2)},function(t){this._shaderValues.setVector(2,t)}),__getset(0,i,"diffuseTexture",function(){return this._shaderValues._getTexture(1)},function(t){t?this._defineDatas.add(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._defineDatas.remove(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._shaderValues.setTexture(1,t)}),__getset(0,i,"tilingOffset",function(){return this._shaderValues.getVector(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._defineDatas.add(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET)}else this._defineDatas.remove(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET);this._shaderValues.setVector(3,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.TINTCOLOR=2,e.TILINGOFFSET=3,__static(e,["defaultMaterial",function(){return this.defaultMaterial=new e
},"shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),e}(BaseMaterial),SkinnedMeshRender=function(t){function e(t,i){e.__super.call(this,t,i),this._owner.transform.off("worldmatrixneedchanged",this,this._onWorldMatNeedChange),this._skinnedDataLoopMarks=[],this._cacheAnimationNode=[],this._localBoundingBoxCorners=__newvec(8,null),this._owner.meshFilter.on("meshchanged",this,this._$3__onMeshChanged)}__class(e,"laya.d3.core.SkinnedMeshRender",t);var i=e.prototype;return i._getCacheAnimationNodes=function(){var t=this._cacheMesh._boneNames,e=this._cacheMesh._bindPoseIndices,i=e.length;if(Render.isConchApp){this._cacheAnimationNodeIndices=new Uint16Array(i);for(var n=this._cacheAnimator._avatarNodeMap,r=0;i>r;r++){var a=n[t[e[r]]];this._cacheAnimationNodeIndices[r]=a._worldMatrixIndex}}else{this._cacheAnimationNode.length=i;for(var s=this._cacheAnimator._avatarNodeMap,r=0;i>r;r++){var o=s[t[e[r]]];this._cacheAnimationNode[r]=o}}},i._offComputeBoneIndexToMeshEvent=function(t,e){t.loaded?e.loaded||e.off("loaded",this,this._getCacheAnimationNodes):t.off("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},i._computeBoneIndexToMeshWithAsyncAvatar=function(){this._cacheAvatar.loaded?this._computeBoneIndexToMeshWithAsyncMesh():this._cacheAvatar.once("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},i._computeBoneIndexToMeshWithAsyncMesh=function(){this._cacheMesh.loaded?this._getCacheAnimationNodes():this._cacheMesh.on("loaded",this,this._getCacheAnimationNodes)},i._$3__onMeshChanged=function(t,e,i){this._cacheMesh=i,e&&!e.loaded&&i.off("loaded",this,this._onMeshLoaded),i.loaded?this._onMeshLoaded(i):i.on("loaded",this,this._onMeshLoaded),this._cacheAvatar&&(e&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,e),i&&this._computeBoneIndexToMeshWithAsyncAvatar())},i._onMeshLoaded=function(t){var e=t.subMeshCount;this._skinnedData=__newvec(e),this._skinnedDataLoopMarks.length=t._bindPoseIndices.length;for(var i=0;e>i;i++)for(var n=t._getSubMesh(i)._boneIndicesList,r=n.length,a=this._skinnedData[i]=__newvec(r),s=0;r>s;s++)a[s]=new Float32Array(16*n[s].length)},i._computeSkinnedData=function(){if(this._cacheMesh&&this._cacheMesh.loaded&&this._cacheAvatar&&this._cacheAvatar.loaded)for(var t=this._cacheMesh._inverseBindPoses,e=this._cacheMesh._bindPoseIndices,i=this._cacheMesh._skinDataPathMarks,n=0,r=this._cacheMesh.subMeshCount;r>n;n++){for(var a=this._cacheMesh._getSubMesh(n)._boneIndicesList,s=this._skinnedData[n],o=0,l=a.length;l>o;o++){var _=a[o];Render.isConchApp?this._computeSubSkinnedDataNative(this._cacheAnimator._animationNodeWorldMatrixs,this._cacheAnimationNodeIndices,this._cacheMesh._inverseBindPosesBuffer,_,e,s[o]):this._computeSubSkinnedData(t,_,e,s[o],i)}this._renderElements[n].skinnedDatas=s}},i._computeSubSkinnedData=function(t,e,i,n,r){for(var a=0,s=e.length;s>a;a++){var o=e[a];if(this._skinnedDataLoopMarks[o]===Stat.loopCount)for(var l=r[o],_=this._skinnedData[l[0]][l[1]],h=16*l[2],u=16*a,c=0;16>c;c++)n[u+c]=_[h+c];else Utils3D._mulMatrixArray(this._cacheAnimationNode[o].transform.getWorldMatrix(),t[i[o]],n,16*a),this._skinnedDataLoopMarks[o]=Stat.loopCount}},i._setCacheAnimator=function(t){this._cacheAnimator=t},i._setRootBone=function(t){this._rootBone=t},i._setCacheAvatar=function(t){this._cacheAvatar!==t&&(this._cacheMesh?(this._cacheAvatar&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,this._cacheMesh),this._cacheAvatar=t,t&&(this._defineDatas.add(SkinnedMeshSprite3D.SHADERDEFINE_BONE),this._computeBoneIndexToMeshWithAsyncAvatar())):this._cacheAvatar=t)},i._calculateBoundingBox=function(){if(this._cacheAnimator){var e=this._cacheAnimator._avatarNodeMap[this._rootBone];null==e||null==this._localBoundBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(this._localBoundingBoxCorners)}else t.prototype._calculateBoundingBox.call(this)},i._calculateBoundingSphere=function(){if(this._cacheAnimator){var e=this._cacheAnimator._avatarNodeMap[this._rootBone];null==e||null==this.localBoundSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(this.localBoundSphere)}else t.prototype._calculateBoundingSphere.call(this)},i._updateOctreeNode=function(){var t=this._treeNode;t&&t.updateObject(this)},i._renderUpdate=function(t,e){if(this._cacheAnimator){this._computeSkinnedData();var i=this._cacheAnimator.owner._transform.parent,n=i?i.worldMatrix:Matrix4x4.DEFAULT;this._shaderValues.setMatrix4x4(0,n)}else this._shaderValues.setMatrix4x4(0,e.worldMatrix)},i._renderUpdateWithCamera=function(t,e){var i=t.projectionViewMatrix;if(this._cacheAnimator){var n=this._cacheAnimator.owner._transform.parent,r=n?n.worldMatrix:Matrix4x4.DEFAULT;Matrix4x4.multiply(i,r,this._projectionViewWorldMatrix)}else Matrix4x4.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix);this._shaderValues.setMatrix4x4(1,this._projectionViewWorldMatrix),Laya3D.debugMode&&this._renderRenderableBoundBox()},i._computeSubSkinnedDataNative=function(t,e,i,n,r,a){LayaGL.instance.computeSubSkinnedDataNative(t,e,i,n,r,a)},__getset(0,i,"localBoundBox",function(){return this._localBoundBox},function(t){this._localBoundBox=t,t.getCorners(this._localBoundingBoxCorners)}),__getset(0,i,"boundingSphere",function(){return this._calculateBoundingSphere(),this._boundingSphere}),__getset(0,i,"boundingBox",function(){return this._calculateBoundingBox(),this._boundingBox}),__getset(0,i,"boundingBoxCenter",function(){var t=this.boundingBox;return Vector3.add(t.min,t.max,this._boundingBoxCenter),Vector3.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenter}),e}(MeshRender),PrimitiveMesh=function(t){function e(){e.__super.call(this),this._subMeshCount=1,this._primitveGeometry=new primitiveGeometry}__class(e,"laya.d3.resource.models.PrimitiveMesh",t);var i=e.prototype;return i._getPositions=function(){var t,e=this._primitveGeometry._vertexBuffer,i=[],n=e.vertexDeclaration.vertexElements,r=0;for(r=0;r<n.length;r++){var a=n[r];if("vector3"===a.elementFormat&&0===a.elementUsage){t=a;break}}var s=e.getData();for(r=0;r<s.length;r+=e.vertexDeclaration.vertexStride/4){var o=r+t.offset/4,l=new Vector3(s[o+0],s[o+1],s[o+2]);i.push(l)}return i},i._getSubMesh=function(t){return 0===t?this._primitveGeometry:null},i.setData=function(t,e,i){this.released||this.releaseResource();var n=new VertexBuffer3D(4*e.length,35044,!0);n.vertexDeclaration=t,n.setData(e),this._primitveGeometry._setVertexBuffer(n);var r=new IndexBuffer3D("ushort",i.length,35044,!0);r.setData(i),this._primitveGeometry._indexBuffer=r,this._setGPUMemory(2*(n._byteLength+r._byteLength)),this._activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()},i._disposeResource=function(){this._primitveGeometry.dispose(),this._setGPUMemory(0)},e}(BaseMesh),Mesh=function(t){function e(){this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._inverseBindPosesBuffer=null,this._bindPoseIndices=null,this._skinDataPathMarks=null,this._vertexCount=0,e.__super.call(this),this._subMeshes=[],this._vertexBuffers=[],this._skinDataPathMarks=[]}__class(e,"laya.d3.resource.models.Mesh",t);var i=e.prototype;return i._getPositions=function(){var t,e,i,n,r,a=[],s=0,o=0,l=0,_=this._vertexBuffers.length;for(s=0;_>s;s++){for(t=this._vertexBuffers[s],i=t.vertexDeclaration.vertexElements,o=0;o<i.length;o++)if(n=i[o],"vector3"===n.elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)l=o+e.offset/4,a.push(new Vector3(r[l+0],r[l+1],r[l+2]))}return a},i._setSubMeshes=function(t){this._subMeshes=t,this._subMeshCount=t.length;for(var e=0;e<this._subMeshCount;e++)t[e]._indexInMesh=e;this._positions=this._getPositions(),this._generateBoundingObject()},i._onAsynLoaded=function(t){var e=t[0],i=t[1];MeshReader.read(e,this,this._subMeshes,i)},i._getSubMesh=function(t){return this._subMeshes[t]},i._disposeResource=function(){for(var t=0;t<this._subMeshes.length;t++)this._subMeshes[t].dispose();this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer.destroy(),this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},__getset(0,i,"inverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),__getset(0,i,"vertexCount",function(){return this._vertexCount}),e.load=function(t){return Laya.loader.create(t,null,null,e)},e}(BaseMesh),FrameAnimation=function(t){function e(){this._targetDic=null,this._animationData=null,this._usedFrames=null,e.__super.call(this),null===e._sortIndexFun&&(e._sortIndexFun=MathUtil.sortByKey("index",!1,!0))}__class(e,"laya.display.FrameAnimation",t);var i=e.prototype;return i._setUp=function(t,e){this._targetDic=t,this._animationData=e,this.interval=1e3/e.frameRate,e.parsed?(this._count=e.count,this._labels=e.labels,this._usedFrames=e.animationNewFrames):(this._usedFrames=[],this._calculateDatas(),e.parsed=!0,e.labels=this._labels,e.count=this._count,e.animationNewFrames=this._usedFrames)},i.clear=function(){return t.prototype.clear.call(this),this._targetDic=null,this._animationData=null,this},i._displayToIndex=function(t){if(this._animationData){0>t&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(i=0;n>i;i++)this._displayNodeToFrame(e[i],t)}},i._displayNodeToFrame=function(t,e,i){i||(i=this._targetDic);var n=i[t.target];if(n){var r,a,s,o=t.frames,l=t.keys,_=0,h=l.length;for(_=0;h>_;_++)r=l[_],a=o[r],s=a.length>e?a[e]:a[a.length-1],n[r]=s}},i._calculateDatas=function(){if(this._animationData){var t,e=this._animationData.nodes,i=0,n=e.length;for(this._count=0,i=0;n>i;i++)t=e[i],this._calculateKeyFrames(t);this._count+=1}},i._calculateKeyFrames=function(t){var i,n,r=t.keyframes,a=t.target;t.frames||(t.frames={}),t.keys?t.keys.length=0:t.keys=[],t.initValues||(t.initValues={});for(i in r)n=r[i],t.frames[i]||(t.frames[i]=[]),this._targetDic&&this._targetDic[a]&&(t.initValues[i]=this._targetDic[a][i]),n.sort(e._sortIndexFun),t.keys.push(i),this._calculateNodePropFrames(n,t.frames[i],i,a)},i.resetNodes=function(){if(this._targetDic&&this._animationData){var t,e,i=this._animationData.nodes,n=0,r=i.length;for(n=0;r>n;n++)if(t=i[n],e=t.initValues){var a=this._targetDic[t.target];if(a){var s;for(s in e)a[s]=e[s]}}}},i._calculateNodePropFrames=function(t,e){var i=0,n=t.length-1;for(e.length=t[n].index+1,i=0;n>i;i++)this._dealKeyFrame(t[i]),this._calculateFrameValues(t[i],t[i+1],e);0==n&&(e[0]=t[0].value,this._usedFrames&&(this._usedFrames[t[0].index]=!0)),this._dealKeyFrame(t[i])},i._dealKeyFrame=function(t){t.label&&""!=t.label&&this.addLabel(t.label,t.index)},i._calculateFrameValues=function(t,e,i){var n,r=0,a=t.index,s=e.index,o=t.value,l=e.value-t.value,_=s-a,h=this._usedFrames;if(s>this._count&&(this._count=s),t.tween)for(n=Ease[t.tweenMethod],null==n&&(n=Ease.linearNone),r=a;s>r;r++)i[r]=n(r-a,o,l,_),h&&(h[r]=!0);else for(r=a;s>r;r++)i[r]=o;h&&(h[t.index]=!0,h[e.index]=!0),i[e.index]=e.value},e._sortIndexFun=null,e}(AnimationBase),Input=function(t){function e(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",e.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow="scroll",this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}__class(e,"laya.display.Input",t);var i=e.prototype;return i.setSelection=function(t,e){laya.display.Input.inputElement.selectionStart=t,laya.display.Input.inputElement.selectionEnd=e},i._onUnDisplay=function(){this.focus=!1},i._onMouseDown=function(){this.focus=!0},i._syncInputTransform=function(){var t=this.nativeInput,i=Utils.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),n=this._width-this.padding[1]-this.padding[3],r=this._height-this.padding[0]-this.padding[2];Render.isConchApp?(t.setScale(i.scaleX,i.scaleY),t.setSize(n,r),t.setPos(i.x,i.y)):(e.inputContainer.style.transform=e.inputContainer.style.webkitTransform="scale("+i.scaleX+","+i.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",t.style.width=n+"px",t.style.height=r+"px",e.inputContainer.style.left=i.x+"px",e.inputContainer.style.top=i.y+"px")},i.select=function(){this.nativeInput.select()},i._setInputMethod=function(){e.input.parentElement&&e.inputContainer.removeChild(e.input),e.area.parentElement&&e.inputContainer.removeChild(e.area),e.inputElement=this._multiline?e.area:e.input,e.inputContainer.appendChild(e.inputElement)},i._focusIn=function(){laya.display.Input.isInputting=!0;var t=this.nativeInput;this._focus=!0;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),t.readOnly=!this._editable,Render.isConchApp&&t.setForbidEdit(!this._editable),t.maxLength=this._maxChars;this.padding;t.type=this._type,t.value=this._content,t.placeholder=this._prompt,Laya.stage.off("keydown",this,this._onKeyDown),Laya.stage.on("keydown",this,this._onKeyDown),Laya.stage.focus=this,this.event("focus"),Browser.onPC&&t.focus();this._text;this._text=null,this.typeset(),t.setColor(this._originColor),t.setFontSize(this.fontSize),t.setFontFace(Browser.onIPhone?Text.fontFamilyMap[this.font]||this.font:this.font),Render.isConchApp&&t.setMultiAble&&t.setMultiAble(this._multiline),e.lineHeight=this.leading+this.fontSize+"px",e.fontStyle=this.italic?"italic":"normal",e.fontWeight=this.bold?"bold":"normal",e.textAlign=this.align,e.padding="0 0",this._syncInputTransform(),!Render.isConchApp&&Browser.onPC&&Laya.timer.frameLoop(1,this,this._syncInputTransform)},i._setPromptColor=function(){e.promptStyleDOM=Browser.getElementById("promptStyle"),e.promptStyleDOM||(e.promptStyleDOM=Browser.createElement("style"),e.promptStyleDOM.setAttribute("id","promptStyle"),Browser.document.head.appendChild(e.promptStyleDOM)),e.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},i._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(Laya.superSet(Text,this,"text",this._content),Laya.superSet(Text,this,"color",this._originColor)):(Laya.superSet(Text,this,"text",this._prompt),Laya.superSet(Text,this,"color",this._promptColor)),Laya.stage.off("keydown",this,this._onKeyDown),Laya.stage.focus=null,this.event("blur"),Render.isConchApp&&this.nativeInput.blur(),Browser.onPC&&Laya.timer.clear(this,this._syncInputTransform)},i._onKeyDown=function(t){13===t.keyCode&&(Browser.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},i.changeText=function(e){this._content=e,this._focus?(this.nativeInput.value=e||"",this.event("change")):t.prototype.changeText.call(this,e)},__getset(0,i,"color",t.prototype._$get_color,function(t){this._focus&&this.nativeInput.setColor(t),Laya.superSet(Text,this,"color",this._content?t:this._promptColor),this._originColor=t}),__getset(0,i,"multiline",function(){return this._multiline},function(t){this._multiline=t,this.valign=t?"top":"middle"}),__getset(0,i,"maxChars",function(){return this._maxChars},function(t){0>=t&&(t=1e5),this._maxChars=t}),__getset(0,i,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(t){Laya.superSet(Text,this,"color",this._originColor),t+="",this._focus?(this.nativeInput.value=t||"",this.event("change")):(this._multiline||(t=t.replace(/\r?\n/g,"")),this._content=t,t?Laya.superSet(Text,this,"text",t):(Laya.superSet(Text,this,"text",this._prompt),Laya.superSet(Text,this,"color",this.promptColor)))}),__getset(0,i,"nativeInput",function(){return this._multiline?e.area:e.input}),__getset(0,i,"prompt",function(){return this._prompt},function(t){!this._text&&t&&Laya.superSet(Text,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?Laya.superSet(Text,this,"text",this._text==this._prompt?t:this._text):Laya.superSet(Text,this,"text",t),this._prompt=Text.langPacks&&Text.langPacks[t]?Text.langPacks[t]:t}),__getset(0,i,"focus",function(){return this._focus},function(t){var i=this.nativeInput;this._focus!==t&&(t?(i.target?i.target._focusOut():this._setInputMethod(),i.target=this,this._focusIn()):(i.target=null,this._focusOut(),i.blur(),Render.isConchApp?i.setPos(-1e4,-1e4):e.inputContainer.contains(i)&&e.inputContainer.removeChild(i)))}),__getset(0,i,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(t){t?(t="[^"+t+"]",t.indexOf("^^")>-1&&(t=t.replace("^^","")),this._restrictPattern=new RegExp(t,"g")):this._restrictPattern=null}),__getset(0,i,"editable",function(){return this._editable},function(t){this._editable=t,Render.isConchApp&&e.input.setForbidEdit(!t)}),__getset(0,i,"promptColor",function(){return this._promptColor},function(t){this._promptColor=t,this._content||Laya.superSet(Text,this,"color",t)}),__getset(0,i,"type",function(){return this._type},function(t){this._getTextStyle().asPassword="password"===t?!0:!1,this._type=t}),e.__init__=function(){e._createInputElement(),Browser.onMobile&&Render.canvas.addEventListener(e.IOS_IFRAME?"click":"touchend",e._popupInputMethod)},e._popupInputMethod=function(){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},e._createInputElement=function(){e._initInput(e.area=Browser.createElement("textarea")),e._initInput(e.input=Browser.createElement("input")),e.inputContainer=Browser.createElement("div"),e.inputContainer.style.position="absolute",e.inputContainer.style.zIndex=1e5,Browser.container.appendChild(e.inputContainer),e.inputContainer.setPos=function(t,i){e.inputContainer.style.left=t+"px",e.inputContainer.style.top=i+"px"}},e._initInput=function(t){var i=t.style;i.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",i.resize="none",i.backgroundColor="transparent",i.border="none",i.outline="none",i.zIndex=1,t.addEventListener("input",e._processInputting),t.addEventListener("mousemove",e._stopEvent),t.addEventListener("mousedown",e._stopEvent),t.addEventListener("touchmove",e._stopEvent),t.setFontFace=function(e){t.style.fontFamily=e},Render.isConchApp||(t.setColor=function(e){t.style.color=e},t.setFontSize=function(e){t.style.fontSize=e+"px"})},e._processInputting=function(){var t=laya.display.Input.inputElement.target;if(t){var e=laya.display.Input.inputElement.value;t._restrictPattern&&(e=e.replace(/\u2006|\x27/g,""),t._restrictPattern.test(e)&&(e=e.replace(t._restrictPattern,""),laya.display.Input.inputElement.value=e)),t._text=e,t.event("input")}},e._stopEvent=function(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},e.TYPE_TEXT="text",e.TYPE_PASSWORD="password",e.TYPE_EMAIL="email",e.TYPE_URL="url",e.TYPE_NUMBER="number",e.TYPE_DATE="date",e.TYPE_MONTH="month",e.TYPE_WEEK="week",e.TYPE_TIME="time",e.TYPE_DATE_TIME="datetime",e.TYPE_DATE_TIME_LOCAL="datetime-local",e.TYPE_SEARCH="search",e.input=null,e.area=null,e.inputElement=null,e.inputContainer=null,e.promptStyleDOM=null,e.isInputting=!1,__static(e,["IOS_IFRAME",function(){return this.IOS_IFRAME=Browser.onIOS&&Browser.window.top!=Browser.window.self}]),e}(Text),RenderTexture2D=function(t){function e(t,i,n,r){this._mgrKey=0,void 0===n&&(n=0),void 0===r&&(r=0),e.__super.call(this,n,!1),this._glTextureType=3553,this._width=t,this._height=i,this._depthStencilFormat=r,this._create(t,i)}__class(e,"laya.webgl.resource.RenderTexture2D",t);var i=e.prototype;return i._create=function(t,e){var i=LayaGL.instance;this._frameBuffer=i.createFramebuffer(),WebGLContext.bindTexture(i,this._glTextureType,this._glTexture);var n=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,n,t,e,0,n,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},i.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,LayaGL.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},i.start=function(){var t=LayaGL.instance;LayaGL.instance.bindFramebuffer(36160,this._frameBuffer),e._currentActive=this,this._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=RenderState2D.width,this._lastHeight=RenderState2D.height,RenderState2D.width=this._width,RenderState2D.height=this._height,BaseShader.activeShader=null},i.end=function(){LayaGL.instance.bindFramebuffer(36160,null),e._currentActive=null,this._readyed=!0},i.restore=function(){var t=LayaGL.instance;this._lastRT!=e._currentActive&&(LayaGL.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),e._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),RenderState2D.width=this._lastWidth,RenderState2D.height=this._lastHeight,BaseShader.activeShader=null},i.clear=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1);var r=LayaGL.instance;r.clearColor(t,e,i,n);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}r.clear(a)},i.getData=function(t,e,i,n){var r=LayaGL.instance;r.bindFramebuffer(36160,this._frameBuffer);var a=36053===r.checkFramebufferStatus(36160);if(!a)return r.bindFramebuffer(36160,null),null;var s=new Uint8Array(this._width*this._height*4),o=this._getGLFormat();return r.readPixels(t,e,i,n,o,5121,s),r.bindFramebuffer(36160,null),s},i._disposeResource=function(){if(this._frameBuffer){var t=LayaGL.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},__getset(0,i,"depthStencilFormat",function(){return this._depthStencilFormat}),__getset(0,i,"defaulteTexture",function(){return Texture2D.grayTexture}),__getset(1,e,"currentActive",function(){return e._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),e.pushRT=function(){e.rtStack.push({rt:e._currentActive,w:RenderState2D.width,h:RenderState2D.height})},e.popRT=function(){var t=LayaGL.instance,i=e.rtStack.pop();i&&(e._currentActive!=i.rt&&(LayaGL.instance.bindFramebuffer(36160,i.rt?i.rt._frameBuffer:null),e._currentActive=i.rt),t.viewport(0,0,i.w,i.h),RenderState2D.width=i.w,RenderState2D.height=i.h)},e._currentActive=null,e.rtStack=[],__static(e,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),e}(BaseTexture),Texture2D=function(t){function e(t,i,n){void 0===t&&(t=1),void 0===i&&(i=!0),void 0===n&&(n=!1),e.__super.call(this,t,i),this._glTextureType=3553,this._canRead=n}__class(e,"laya.webgl.resource.Texture2D",t);var i=e.prototype;return i.setImageSource=function(t,e){void 0===e&&(e=!1);var i=t.width,n=t.height;if(0>=i||0>=n)throw new Error("Texture2D:width or height must large than 0.");this._width=i,this._height=n;var r=LayaGL.instance;WebGLContext.bindTexture(r,this._glTextureType,this._glTexture);var a=this._getGLFormat();Render.isConchApp?(t.setPremultiplyAlpha(e),r.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&r.pixelStorei(37441,!0),r.texImage2D(this._glTextureType,0,a,a,5121,t),e&&r.pixelStorei(37441,!1)),this._mipmap&&this._isPot(i)&&this._isPot(n)?(r.generateMipmap(this._glTextureType),this._setGPUMemory(i*n*4*(1+1/3))):this._setGPUMemory(i*n*4),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._canRead&&(Browser.canvas.size(i,n),Browser.canvas.clear(),Browser.context.drawImage(t,0,0,i,n),this._pixels=new Uint8Array(Browser.context.getImageData(0,0,i,n).data.buffer)),this._readyed=!0,this._activeResource()},i.setPixels=function(t,e,i){if(0>=t||0>=e)throw new Error("Texture2D:width or height must large than 0.");if(!i)throw new Error("Texture2D:pixels can't be null.");this._width=t,this._height=e;var n=LayaGL.instance;WebGLContext.bindTexture(n,this._glTextureType,this._glTexture);var r=this._getGLFormat();n.texImage2D(this._glTextureType,0,r,t,e,0,r,5121,i),this._mipmap&&this._isPot(t)&&this._isPot(e)?(n.generateMipmap(this._glTextureType),this._setGPUMemory(t*e*4*(1+1/3))):this._setGPUMemory(t*e*4),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._canRead&&(this._pixels=i),this._readyed=!0,this._activeResource()},i._onAsynLoaded=function(e,i){if(i&&"object"==typeof i){var n=i.canRead;void 0!==n&&(this._canRead=n)}t.prototype._onAsynLoaded.call(this,e,i),this.setImageSource(e)},i._recoverResource=function(){},i.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},__getset(0,i,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture}),e.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,e.grayTexture=new e(0,!1,!1),e.grayTexture.setPixels(1,1,t),e.grayTexture.lock=!0},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.grayTexture=null,e}(BaseTexture),Shader2X=function(t){function e(t,i,n,r,a){this._params2dQuick2=null,e.__super.call(this,t,i,n,r,a)}__class(e,"laya.webgl.shader.d2.Shader2X",t);var i=e.prototype;return i._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},i.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},i._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,i=0,n=e.length;n>i;i++)t=e[i],"size"!==t.name&&this._params2dQuick2.push(t)}return this._params2dQuick2},e.create=function(t,i,n,r,a){return new e(t,i,n,r,a)},e}(Shader),IndexBuffer2D=function(t){function e(t){this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}__class(e,"laya.webgl.utils.IndexBuffer2D",t);var i=e.prototype;return i._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i.destory=function(){this._uint16Array=null,this._buffer=null},e.QuadrangleIB=null,e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(Buffer2D),VertexBuffer2D=function(t){function e(t,i){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,e.__super.call(this),this._vertexStride=t,this._bufferUsage=i,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}__class(e,"laya.webgl.utils.VertexBuffer2D",t);var i=e.prototype;return i.getFloat32Array=function(){return this._floatArray32},i.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length);var i=this.getFloat32Array();i.set(t,e),this._upload=!0},i._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},i._disposeResource=function(){if(t.prototype._disposeResource.call(this),!Render.isConchApp)for(var e=Buffer._bindedAtributeBuffer,i=0;10>i;i++)WebGL.mainContext.disableVertexAttribArray(i),e[i]=null},i.deleteBuffer=function(){t.prototype._disposeResource.call(this)},i.destroy=function(){laya.resource.Resource.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},__getset(0,i,"vertexStride",function(){return this._vertexStride}),e.create=function(t,i){return void 0===i&&(i=35048),new e(t,i)},e}(Buffer2D),DataTexture2D=function(t){function e(){this.simLodInfo=null,this._buffer=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,e.__super.call(this),this._glTextureType=3553}__class(e,"laya.d3.resource.DataTexture2D",t);var i=e.prototype;return i.genDebugMipmaps=function(){var t=[];return t.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),t.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),t.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),t.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),t.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),t.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),t.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),t.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),t.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),t.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),t},i._onTextureLoaded=function(){},i._createWebGlTexture=function(){if(!this._buffer&&!this._mipmaps)throw"create GLTextur err:no data";var t=LayaGL.instance;t.getExtension("EXT_shader_texture_lod");var i=this._width,n=this._height;if(WebGLContext.bindTexture(t,this._glTextureType,this._glTexture),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var r=0;t.texImage2D(this._glTextureType,0,6408,this._width,this._height,0,6408,5121,null);for(var a=0;a<this._mipmaps.length;a++){if(this._mipmaps[a].byteLength!=s*o*4)throw"mipmap size error  level:"+a;t.texSubImage2D(this._glTextureType,0,e.simLodRect[r++],e.simLodRect[r++],e.simLodRect[r++],e.simLodRect[r++],6408,5121,new Uint8Array(this._mipmaps[a]))}this.minFifter=9729,this.magFifter=9729}else{var s=this._width,o=this._height;for(r=0,t.texImage2D(this._glTextureType,0,6408,this._width,this._height,0,6408,5121,null),a=0;a<this._mipmaps.length;a++){if(this._mipmaps[a].byteLength!=s*o*4)throw"mipmap size error  level:"+a;t.texImage2D(this._glTextureType,a,6408,s,o,0,6408,5121,new Uint8Array(this._mipmaps[a])),s/=2,o/=2,1>s&&(s=1),1>o&&(o=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else t.texImage2D(this._glTextureType,0,6408,i,n,0,6408,5121,new Uint8Array(this._buffer));var l=this._minFifter,_=this._magFifter,h=this._repeat?10497:33071,u=Arith.isPOT(i,n);if(!u)throw"data texture must be POT";this._mipmap||this._mipmaps?-1!==l||(l=9987):-1!==l||(l=9729),-1!==_||(_=9729),t.texParameteri(this._glTextureType,10241,l),t.texParameteri(this._glTextureType,10240,_),t.texParameteri(this._glTextureType,10242,h),this._mipmaps?t.texParameteri(this._glTextureType,10243,33071):t.texParameteri(this._glTextureType,10243,h),this._mipmap&&t.generateMipmap(this._glTextureType),this.src&&this.src.length>0&&(this._buffer=null),u?this._setGPUMemory(i*n*4*(1+1/3)):this._setGPUMemory(i*n*4),this._recreateLock=!1
},i._onAsynLoaded=function(t,e){var i;e&&(i=e[0].call(this,t)),i&&(this._width=i.width,this._height=i.height,this._buffer=i.data)},i.getPixels=function(){return new Uint8Array(this._buffer)},i._disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._glTexture&&(LayaGL.instance.deleteTexture(this._glTexture),this._glTexture=null,this._buffer=null,this._setGPUMemory(0))},e.create=function(t,i,n,r,a,s){if(void 0===r&&(r=9729),void 0===a&&(a=9729),void 0===s&&(s=!0),!t||t.byteLength<i*n*4)throw"DataTexture2D create error";var o=new e;return o._buffer=t,o._width=i,o._height=n,o._mipmap=s,o._magFifter=r,o._minFifter=a,o._conchTexture?alert("怎么给runtime传递datatexture数据"):o.activeResource(),o},e.load=function(t,i,n,r,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=9729),void 0===a&&(a=9729);var s=Utils.getFileExtension(t);if("mipmaps"===s){var o=Laya.loader.create(t,null,null,e,[function(t){this._mipmaps=[];var e=new Uint32Array(t);this._width=e[0];var i=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,i=1024),this._width!=i)throw console.error("现在只支持512x256的环境贴图。当前的是"+e[0]),"现在只支持512x256的环境贴图。当前的是"+e[0];this._height=e[1];for(var n=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,r=this._height,a=8;;){var s=n*r*4;if(a+s>t.byteLength)throw"load mipmaps data size error ";var o=new Uint8Array(t,a,s);if(this._mipmaps.push(o),a+=s,1==n&&1==r)break;n/=2,r/=2,1>n&&(n=1),1>r&&(r=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){o.simLodInfo=new Float32Array(40);for(var l=0;l<o.simLodInfo.length;)o.simLodInfo[l]=(e.simLodRect[l]+.5)/1024,l++,o.simLodInfo[l]=(e.simLodRect[l]+.5)/256,l++,o.simLodInfo[l]=Math.max(e.simLodRect[l]-1,.1)/1024,l++,o.simLodInfo[l]=Math.max(e.simLodRect[l]-1.5,.1)/256,l++}return o}if("number"==typeof i)return Laya.loader.create(t,null,null,e,[function(t){return this._width=i,this._height=n,this._buffer=t,null}]);if("function"==typeof i)return Laya.loader.create(t,null,null,e,[i]);throw new Error("unknown params.")},e.lodasatlas=!1,__static(e,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),e}(BaseTexture),RenderTexture=function(t){function e(t,i,n,r){void 0===n&&(n=0),void 0===r&&(r=0),e.__super.call(this,n,!1),this._glTextureType=3553,this._width=t,this._height=i,this._depthStencilFormat=r,this._create(t,i)}__class(e,"laya.d3.resource.RenderTexture",t);var i=e.prototype;return i._create=function(t,e){var i=LayaGL.instance;this._frameBuffer=i.createFramebuffer(),WebGLContext.bindTexture(i,this._glTextureType,this._glTexture);var n=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,n,t,e,0,n,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:throw"RenderTexture: unkonw depth format."}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},i.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,LayaGL.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4*(1+1/3)))},i.start=function(){LayaGL.instance.bindFramebuffer(36160,this._frameBuffer),e._currentActive=this,this._readyed=!1},i.end=function(){LayaGL.instance.bindFramebuffer(36160,null),e._currentActive=null,this._readyed=!0},i.getData=function(t,e,i,n){var r=LayaGL.instance;r.bindFramebuffer(36160,this._frameBuffer);var a=36053===r.checkFramebufferStatus(36160);if(!a)return r.bindFramebuffer(36160,null),null;var s=new Uint8Array(this._width*this._height*4),o=this._getGLFormat();return r.readPixels(t,e,i,n,o,5121,s),r.bindFramebuffer(36160,null),s},i.disposeResource=function(){if(this._frameBuffer){var t=LayaGL.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},__getset(0,i,"depthStencilFormat",function(){return this._depthStencilFormat}),__getset(0,i,"defaulteTexture",function(){return Texture2D.grayTexture}),__getset(1,e,"currentActive",function(){return e._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),e._currentActive=null,e}(BaseTexture),TextureCube=function(t){function e(t,i){void 0===t&&(t=0),void 0===i&&(i=!1),e.__super.call(this,t,i),this._glTextureType=34067}__class(e,"laya.d3.resource.TextureCube",t);var i=e.prototype;return i.setSixSideImageSources=function(t,e){void 0===e&&(e=!1);for(var i=0,n=0,r=0;6>r;r++){var a=t[r].width,s=t[r].height;if(r>0&&i!==a)throw"TextureCube: each side image's width and height must same.";if(i=a,n=s,i!==n)throw"TextureCube: each side image's width and height must same."}this._width=i,this._height=n;var o=LayaGL.instance;WebGLContext.bindTexture(o,this._glTextureType,this._glTexture);var l=this._getGLFormat();if(Render.isConchApp){if(1==e)for(var r=0;6>r;r++)t[r].setPremultiplyAlpha(e);o.texImage2D(34073,0,6408,6408,5121,t[0]),o.texImage2D(34074,0,6408,6408,5121,t[1]),o.texImage2D(34069,0,6408,6408,5121,t[2]),o.texImage2D(34070,0,6408,6408,5121,t[3]),o.texImage2D(34071,0,6408,6408,5121,t[4]),o.texImage2D(34072,0,6408,6408,5121,t[5])}else e&&o.pixelStorei(37441,!0),o.texImage2D(34073,0,l,l,5121,t[0]),o.texImage2D(34074,0,l,l,5121,t[1]),o.texImage2D(34069,0,l,l,5121,t[2]),o.texImage2D(34070,0,l,l,5121,t[3]),o.texImage2D(34071,0,l,l,5121,t[4]),o.texImage2D(34072,0,l,l,5121,t[5]),e&&o.pixelStorei(37441,!1);this._mipmap&&this._isPot(i)&&this._isPot(n)?(o.generateMipmap(this._glTextureType),this._setGPUMemory(i*n*4*(1+1/3)*6)):this._setGPUMemory(i*n*4*6),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._readyed=!0,this._activeResource()},i.setSixSidePixels=function(t,e,i){if(0>=t||0>=e)throw new Error("TextureCube:width or height must large than 0.");if(!i)throw new Error("TextureCube:pixels can't be null.");this._width=t,this._height=e;var n=LayaGL.instance;WebGLContext.bindTexture(n,this._glTextureType,this._glTexture);var r=this._getGLFormat();n.texImage2D(34073,0,r,t,e,0,r,5121,i[0]),n.texImage2D(34074,0,r,t,e,0,r,5121,i[1]),n.texImage2D(34069,0,r,t,e,0,r,5121,i[2]),n.texImage2D(34070,0,r,t,e,0,r,5121,i[3]),n.texImage2D(34071,0,r,t,e,0,r,5121,i[4]),n.texImage2D(34072,0,r,t,e,0,r,5121,i[5]),this._mipmap&&this._isPot(t)&&this._isPot(e)?(n.generateMipmap(this._glTextureType),this._setGPUMemory(t*e*4*(1+1/3)*6)):this._setGPUMemory(t*e*4*6),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._readyed=!0,this._activeResource()},i._onAsynLoaded=function(e,i){t.prototype._onAsynLoaded.call(this,e,i),this.setSixSideImageSources(e)},i._recoverResource=function(){},__getset(0,i,"defaulteTexture",function(){return e.grayTexture}),e.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,e.grayTexture=new e(0,!1),e.grayTexture.setSixSidePixels(1,1,[t,t,t,t,t,t]),e.grayTexture.lock=!0},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.grayTexture=null,e}(BaseTexture),Camera=function(t){function e(t,i,n){void 0===t&&(t=0),void 0===i&&(i=.3),void 0===n&&(n=1e3),this._viewMatrix=new Matrix4x4,this._projectionMatrix=new Matrix4x4,this._projectionViewMatrix=new Matrix4x4,this._projectionViewMatrixNoTranslateScale=new Matrix4x4,this._viewport=new Viewport(0,0,0,0),this._normalizedViewport=new Viewport(0,0,1,1),this._aspectRatio=t,this._boundFrustumUpdate=!0,this._boundFrustum=new BoundFrustum(Matrix4x4.DEFAULT),Render.isConchApp&&(this._boundFrustumBuffer=new Float32Array(24)),e.__super.call(this,i,n),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}__class(e,"laya.d3.core.Camera",t);var i=e.prototype;return i._calculationViewport=function(t,e,i){this._viewport.x=Math.min(Math.max(t.x*e,0),e),this._viewport.y=Math.min(Math.max(t.y*i,0),i),this._viewport.width=Math.min(Math.max(t.width*e,0),e),this._viewport.height=Math.min(Math.max(t.height*i,0),i)},i._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},i._parse=function(e,i){t.prototype._parse.call(this,e,i);var n=e.viewport;this.normalizedViewport=new Viewport(n[0],n[1],n[2],n[3])},i._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.aspectRatio*.5,e=.5*this.orthographicVerticalSize;Matrix4x4.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._projectionMatrix)}else Matrix4x4.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},i._render=function(t,e,i){if(i.parallelSplitShadowMaps[0]){var n=i.parallelSplitShadowMaps[0];n._calcAllLightCameraInfo(this),i._defineDatas.add(Scene3D.SHADERDEFINE_CAST_SHADOW);for(var r=0,a=n.shadowMapCount;a>r;r++){var s=n.cameras[r];e.camera=s,e.projectionViewMatrix=s.projectionViewMatrix;var i=e.scene;FrustumCulling.renderObjectCulling(s.boundFrustum,i,e,i._castShadowRenderObjects,i._castShadowRendersLength);var o=n.cameras[r+1].renderTarget;o.start(),e.camera=s,e.viewport=s.viewport,s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix,s._projectionViewMatrixNoTranslateScale),i._clear(t,e);var l=i._opaqueQueue;l._render(e,!1),o.end()}i._defineDatas.remove(Scene3D.SHADERDEFINE_CAST_SHADOW)}e.camera=this,i._preRenderScript();var _,h;_=e.viewMatrix=this.viewMatrix;var u=this._renderTarget;u?(u.start(),Matrix4x4.multiply(BaseCamera._invertYScaleMatrix,this._projectionMatrix,BaseCamera._invertYProjectionMatrix),Matrix4x4.multiply(BaseCamera._invertYScaleMatrix,this.projectionViewMatrix,BaseCamera._invertYProjectionViewMatrix),h=e.projectionMatrix=BaseCamera._invertYProjectionMatrix,e.projectionViewMatrix=BaseCamera._invertYProjectionViewMatrix):(h=e.projectionMatrix=this._projectionMatrix,e.projectionViewMatrix=this.projectionViewMatrix),e.viewport=this.viewport,this._prepareCameraToRender(),this._prepareCameraViewProject(_,h,this._projectionViewMatrixNoTranslateScale),i._preCulling(e,this),i._clear(t,e),i._renderScene(t,e),i._postRenderScript(),u&&u.end()},i.viewportPointToRay=function(t,e){Picker.calculateCursorRay(t,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},i.normalizedViewportPointToRay=function(t,i){var n=e._tempVector20,r=this.viewport,a=t.elements,s=n.elements;s[0]=a[0]*r.width,s[1]=a[1]*r.height,Picker.calculateCursorRay(n,this.viewport,this._projectionMatrix,this.viewMatrix,null,i)},i.worldToViewportPoint=function(t,e){Matrix4x4.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(t,this._projectionViewMatrix,e);var i=e.elements;i[0]=i[0]/Laya.stage.clientScaleX,i[1]=i[1]/Laya.stage.clientScaleY},i.worldToNormalizedViewportPoint=function(t,e){Matrix4x4.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(t,this._projectionViewMatrix,e);var i=e.elements;i[0]=i[0]/Laya.stage.clientScaleX,i[1]=i[1]/Laya.stage.clientScaleY},i.convertScreenCoordToOrthographicCoord=function(t,e){if(this._orthographic){var i=RenderContext3D.clientWidth,n=RenderContext3D.clientHeight,r=this.orthographicVerticalSize*this.aspectRatio/i,a=this.orthographicVerticalSize/n,s=t.elements,o=e.elements;return o[0]=(-i/2+s[0])*r,o[1]=(n/2-s[1])*a,o[2]=(this.nearPlane-this.farPlane)*(s[2]+1)/2-this.nearPlane,Vector3.transformCoordinate(e,this.transform.worldMatrix,e),!0}return!1},__getset(0,i,"projectionViewMatrix",function(){return Matrix4x4.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),__getset(0,i,"aspectRatio",function(){if(0===this._aspectRatio){var t=this.viewport;return t.width/t.height}return this._aspectRatio},function(t){if(0>t)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=t,this._calculateProjectionMatrix()}),__getset(0,i,"boundFrustum",function(){if(this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix,Render.isConchApp)){var t=this._boundFrustum.near,e=this._boundFrustum.far,i=this._boundFrustum.left,n=this._boundFrustum.right,r=this._boundFrustum.top,a=this._boundFrustum.bottom,s=t.normal.elements,o=e.normal.elements,l=i.normal.elements,_=n.normal.elements,h=r.normal.elements,u=a.normal.elements,c=this._boundFrustumBuffer;c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=t.distance,c[4]=o[0],c[5]=o[1],c[6]=o[2],c[7]=e.distance,c[8]=l[0],c[9]=l[1],c[10]=l[2],c[11]=i.distance,c[12]=_[0],c[13]=_[1],c[14]=_[2],c[15]=n.distance,c[16]=h[0],c[17]=h[1],c[18]=h[2],c[19]=r.distance,c[20]=u[0],c[21]=u[1],c[22]=u[2],c[23]=a.distance}return this._boundFrustum}),__getset(0,i,"viewport",function(){var t=0,e=0;return this._renderTarget?(t=this._renderTarget.width,e=this._renderTarget.height):(t=RenderContext3D.clientWidth,e=RenderContext3D.clientHeight),(t!==this._canvasWidth||e!==this._canvasHeight)&&(this._calculationViewport(this._normalizedViewport,t,e),this._canvasWidth=t,this._canvasHeight=e),this._viewport},function(t){var e=0,i=0;this._renderTarget?(e=this._canvasWidth=this._renderTarget.width,i=this._canvasHeight=this._renderTarget.height):(e=this._canvasWidth=RenderContext3D.clientWidth,i=this._canvasHeight=RenderContext3D.clientHeight),this._normalizedViewport.x=t.x/e,this._normalizedViewport.y=t.y/i,this._normalizedViewport.width=t.width/e,this._normalizedViewport.height=t.height/i,this._calculationViewport(this._normalizedViewport,e,i),this._calculateProjectionMatrix()}),__getset(0,i,"normalizedViewport",function(){return this._normalizedViewport},function(t){var e=0,i=0;this._renderTarget?(e=this._canvasWidth=this._renderTarget.width,i=this._canvasHeight=this._renderTarget.height):(e=this._canvasWidth=RenderContext3D.clientWidth,i=this._canvasHeight=RenderContext3D.clientHeight),this._normalizedViewport=t,this._calculationViewport(t,e,i),this._calculateProjectionMatrix()}),__getset(0,i,"projectionMatrix",function(){return this._projectionMatrix},function(t){this._projectionMatrix=t,this._useUserProjectionMatrix=!0}),__getset(0,i,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),__static(e,["_tempVector20",function(){return this._tempVector20=new Vector2}]),e}(BaseCamera),DirectionLight=function(t){function e(){this._direction=null,e.__super.call(this),this._direction=new Vector3}__class(e,"laya.d3.core.light.DirectionLight",t);var i=e.prototype;return i._initShadow=function(){if(this._shadow)this._parallelSplitShadowMap=new ParallelSplitShadowMap,this.scene.parallelSplitShadowMaps.push(this._parallelSplitShadowMap),this.transform.worldMatrix.getForward(this._direction),Vector3.normalize(this._direction,this._direction),this._parallelSplitShadowMap.setInfo(this.scene,this._shadowFarPlane,this._direction,this._shadowMapSize,this._shadowMapCount,this._shadowMapPCFType);else{var t=this._scene._defineDatas,e=this.scene.parallelSplitShadowMaps;e.splice(e.indexOf(this._parallelSplitShadowMap),1),this._parallelSplitShadowMap.disposeAllRenderTarget(),this._parallelSplitShadowMap=null,t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM1),t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM2),t.remove(Scene3D.SHADERDEFINE_SHADOW_PSSM3)}},i._onActive=function(){t.prototype._onActive.call(this),this._shadow&&this._initShadow()},i._onInActive=function(){this._scene._shaderValues;this._scene._defineDatas.remove(Scene3D.SHADERDEFINE_DIRECTIONLIGHT)},i._prepareToScene=function(t){var e=t.scene;if(e.enableLight&&this._activeInHierarchy){var i=e._defineDatas,n=e._shaderValues;return i.add(Scene3D.SHADERDEFINE_DIRECTIONLIGHT),Vector3.scale(this.color,this._intensity,this._intensityColor),n.setVector(4,this._intensityColor),this.transform.worldMatrix.getForward(this._direction),Vector3.normalize(this._direction,this._direction),n.setVector(3,this._direction),!0}return i.remove(Scene3D.SHADERDEFINE_DIRECTIONLIGHT),!1},__getset(0,i,"shadow",t.prototype._$get_shadow,function(t){this._shadow!==t&&(this._shadow=t,this.scene&&this._initShadow())}),e}(LightSprite),MeshSprite3D=function(t){function e(t,i){e.__super.call(this,i),this._meshFilter=new MeshFilter(this),this._render=new MeshRender(this,4),t&&(this._meshFilter.sharedMesh=t)}__class(e,"laya.d3.core.MeshSprite3D",t);var i=e.prototype;return i._parse=function(t,e){laya.d3.core.Sprite3D.prototype._parse.call(this,t,e);var i=this.meshRender,n=t.lightmapIndex;null!=n&&(i.lightmapIndex=n);var r=t.lightmapScaleOffset;r&&(i.lightmapScaleOffset=new Vector4(r[0],r[1],r[2],r[3]));var a,s;a=t.meshPath,a&&(s=Loader.getRes(e[a]),this.meshFilter.sharedMesh=s);var o=t.materials;if(o){var l=i.sharedMaterials,_=o.length;l.length=_;for(var h=0;_>h;h++)l[h]=Loader.getRes(e[o[h].path]);i.sharedMaterials=l}},i._addToInitStaticBatchManager=function(){MeshRenderStaticBatchManager.instance._addBatchSprite(this)},i.cloneTo=function(t){var e=t;e._meshFilter.sharedMesh=this._meshFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n._castShadow=i._castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.lightmapIndex=i.lightmapIndex,n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._meshFilter.destroy())},__getset(0,i,"meshFilter",function(){return this._meshFilter}),__getset(0,i,"meshRender",function(){return this._render}),e.__init__=function(){StaticBatchManager._registerManager(MeshRenderStaticBatchManager.instance),DynamicBatchManager._registerManager(MeshRenderDynamicBatchManager.instance)},e.load=function(t){return Laya.loader.create(t,null,null,e)},e}(RenderableSprite3D),ShuriKenParticle3D=function(t){function e(){e.__super.call(this,null),this._render=new ShurikenParticleRender(this,52),this._particleSystem=new ShurikenParticleSystem(this);var t=this._render._renderElements,i=t[0]=new RenderElement;i.setTransform(this._transform),i.render=this._render,i.setGeometry(this._particleSystem),i.material=ShurikenParticleMaterial.defaultMaterial}__class(e,"laya.d3.core.particleShuriKen.ShuriKenParticle3D",t);var i=e.prototype;return i._initParticleVelocity=function(t){for(var e=new GradientDataNumber,i=t.velocitys,n=0,r=i.length;r>n;n++){var a=i[n];e.add(a.key,a.value)}return e},i._initParticleColor=function(t){var e=new GradientDataColor,i=t.alphas,n=0,r=0;for(n=0,r=i.length;r>n;n++){var a=i[n];e.addAlpha(a.key,a.value)}var s=t.rgbs;for(n=0,r=s.length;r>n;n++){var o=s[n],l=o.value;e.addRGB(o.key,new Vector3(l[0],l[1],l[2]))}return e},i._initParticleSize=function(t){for(var e=new GradientDataNumber,i=t.sizes,n=0,r=i.length;r>n;n++){var a=i[n];e.add(a.key,a.value)}return e},i._initParticleRotation=function(t){for(var e=new GradientDataNumber,i=t.angularVelocitys,n=0,r=i.length;r>n;n++){var a=i[n];e.add(a.key,a.value/180*Math.PI)}return e},i._initParticleFrame=function(t){for(var e=new GradientDataInt,i=t.frames,n=0,r=i.length;r>n;n++){var a=i[n];e.add(a.key,a.value)}return e},i._parse=function(t,i){laya.d3.core.Sprite3D.prototype._parse.call(this,t,i);var n,r=Math.PI/180,a=0,s=0,o=this.particleRender,l=t.material;n=Loader.getRes(i[l.path]),o.sharedMaterial=n;var _=t.meshPath;_&&(o.mesh=Loader.getRes(i[_])),o.renderMode=t.renderMode,o.stretchedBillboardCameraSpeedScale=t.stretchedBillboardCameraSpeedScale,o.stretchedBillboardSpeedScale=t.stretchedBillboardSpeedScale,o.stretchedBillboardLengthScale=t.stretchedBillboardLengthScale,o.sortingFudge=t.sortingFudge?t.sortingFudge:0;var h=this.particleSystem;h.isPerformanceMode=t.isPerformanceMode,h.duration=t.duration,h.looping=t.looping,h.prewarm=t.prewarm,h.startDelayType=t.startDelayType,h.startDelay=t.startDelay,h.startDelayMin=t.startDelayMin,h.startDelayMax=t.startDelayMax,h.startLifetimeType=t.startLifetimeType,h.startLifetimeConstant=t.startLifetimeConstant,h.startLifeTimeGradient=e._initStartLife(t.startLifetimeGradient),h.startLifetimeConstantMin=t.startLifetimeConstantMin,h.startLifetimeConstantMax=t.startLifetimeConstantMax,h.startLifeTimeGradientMin=e._initStartLife(t.startLifetimeGradientMin),h.startLifeTimeGradientMax=e._initStartLife(t.startLifetimeGradientMax),h.startSpeedType=t.startSpeedType,h.startSpeedConstant=t.startSpeedConstant,h.startSpeedConstantMin=t.startSpeedConstantMin,h.startSpeedConstantMax=t.startSpeedConstantMax,h.threeDStartSize=t.threeDStartSize,h.startSizeType=t.startSizeType,h.startSizeConstant=t.startSizeConstant;var u=t.startSizeConstantSeparate,c=h.startSizeConstantSeparate.elements;c[0]=u[0],c[1]=u[1],c[2]=u[2],h.startSizeConstantMin=t.startSizeConstantMin,h.startSizeConstantMax=t.startSizeConstantMax;var d=t.startSizeConstantMinSeparate,f=h.startSizeConstantMinSeparate.elements;f[0]=d[0],f[1]=d[1],f[2]=d[2];var m=t.startSizeConstantMaxSeparate,p=h.startSizeConstantMaxSeparate.elements;p[0]=m[0],p[1]=m[1],p[2]=m[2],h.threeDStartRotation=t.threeDStartRotation,h.startRotationType=t.startRotationType,h.startRotationConstant=t.startRotationConstant*r;var g=t.startRotationConstantSeparate,v=h.startRotationConstantSeparate.elements;v[0]=g[0]*r,v[1]=g[1]*r,v[2]=g[2]*r,h.startRotationConstantMin=t.startRotationConstantMin*r,h.startRotationConstantMax=t.startRotationConstantMax*r;var x=t.startRotationConstantMinSeparate,y=h.startRotationConstantMinSeparate.elements;y[0]=x[0]*r,y[1]=x[1]*r,y[2]=x[2]*r;var T=t.startRotationConstantMaxSeparate,D=h.startRotationConstantMaxSeparate.elements;D[0]=T[0]*r,D[1]=T[1]*r,D[2]=T[2]*r,h.randomizeRotationDirection=t.randomizeRotationDirection,h.startColorType=t.startColorType;var E=t.startColorConstant,S=h.startColorConstant.elements;S[0]=E[0],S[1]=E[1],S[2]=E[2],S[3]=E[3];var M=t.startColorConstantMin,R=h.startColorConstantMin.elements;R[0]=M[0],R[1]=M[1],R[2]=M[2],R[3]=M[3];var A=t.startColorConstantMax,C=h.startColorConstantMax.elements;C[0]=A[0],C[1]=A[1],C[2]=A[2],C[3]=A[3],h.gravityModifier=t.gravityModifier,h.simulationSpace=t.simulationSpace,h.scaleMode=t.scaleMode,h.playOnAwake=t.playOnAwake,h.maxParticles=t.maxParticles;var L=t.autoRandomSeed;null!=L&&(h.autoRandomSeed=L);var I=t.randomSeed;null!=I&&(h.randomSeed[0]=I);var w=t.emission,b=h.emission;if(w){b.emissionRate=w.emissionRate;var P=w.bursts;if(P)for(a=0,s=P.length;s>a;a++){var V=P[a];b.addBurst(new Burst(V.time,V.min,V.max))}b.enbale=w.enable}else b.enbale=!1;var O=t.shape;if(O){var N;switch(O.shapeType){case 0:var B;N=B=new SphereShape,B.radius=O.sphereRadius,B.emitFromShell=O.sphereEmitFromShell,B.randomDirection=O.sphereRandomDirection;break;case 1:var F;N=F=new HemisphereShape,F.radius=O.hemiSphereRadius,F.emitFromShell=O.hemiSphereEmitFromShell,F.randomDirection=O.hemiSphereRandomDirection;break;case 2:var U;N=U=new ConeShape,U.angle=O.coneAngle*r,U.radius=O.coneRadius,U.length=O.coneLength,U.emitType=O.coneEmitType,U.randomDirection=O.coneRandomDirection;break;case 3:var G;N=G=new BoxShape,G.x=O.boxX,G.y=O.boxY,G.z=O.boxZ,G.randomDirection=O.boxRandomDirection;break;case 7:var H;N=H=new CircleShape,H.radius=O.circleRadius,H.arc=O.circleArc*r,H.emitFromEdge=O.circleEmitFromEdge,H.randomDirection=O.circleRandomDirection;break;default:var W;N=W=new CircleShape,W.radius=O.circleRadius,W.arc=O.circleArc*r,W.emitFromEdge=O.circleEmitFromEdge,W.randomDirection=O.circleRandomDirection}N.enable=O.enable,h.shape=N}var k=t.velocityOverLifetime;if(k){var z,X=k.velocity;switch(X.type){case 0:var Y=X.constant;z=GradientVelocity.createByConstant(new Vector3(Y[0],Y[1],Y[2]));break;case 1:z=GradientVelocity.createByGradient(this._initParticleVelocity(X.gradientX),this._initParticleVelocity(X.gradientY),this._initParticleVelocity(X.gradientZ));break;case 2:var K=X.constantMin,Z=X.constantMax;z=GradientVelocity.createByRandomTwoConstant(new Vector3(K[0],K[1],K[2]),new Vector3(Z[0],Z[1],Z[2]));break;case 3:z=GradientVelocity.createByRandomTwoGradient(this._initParticleVelocity(X.gradientXMin),this._initParticleVelocity(X.gradientXMax),this._initParticleVelocity(X.gradientYMin),this._initParticleVelocity(X.gradientYMax),this._initParticleVelocity(X.gradientZMin),this._initParticleVelocity(X.gradientZMax))}var j=new VelocityOverLifetime(z);j.space=k.space,j.enbale=k.enable,h.velocityOverLifetime=j}var q=t.colorOverLifetime;if(q){var Q,$=q.color;switch($.type){case 0:var J=$.constant;Q=GradientColor.createByConstant(new Vector4(J[0],J[1],J[2],J[3]));break;case 1:Q=GradientColor.createByGradient(this._initParticleColor($.gradient));break;case 2:var te=$.constantMin,ee=$.constantMax;Q=GradientColor.createByRandomTwoConstant(new Vector4(te[0],te[1],te[2],te[3]),new Vector4(ee[0],ee[1],ee[2],ee[3]));break;case 3:Q=GradientColor.createByRandomTwoGradient(this._initParticleColor($.gradientMin),this._initParticleColor($.gradientMax))}var ie=new ColorOverLifetime(Q);ie.enbale=q.enable,h.colorOverLifetime=ie}var ne=t.sizeOverLifetime;if(ne){var re,ae=ne.size;switch(ae.type){case 0:re=ae.separateAxes?GradientSize.createByGradientSeparate(this._initParticleSize(ae.gradientX),this._initParticleSize(ae.gradientY),this._initParticleSize(ae.gradientZ)):GradientSize.createByGradient(this._initParticleSize(ae.gradient));break;case 1:if(ae.separateAxes){var se=ae.constantMinSeparate,oe=ae.constantMaxSeparate;re=GradientSize.createByRandomTwoConstantSeparate(new Vector3(se[0],se[1],se[2]),new Vector3(oe[0],oe[1],oe[2]))}else re=GradientSize.createByRandomTwoConstant(ae.constantMin,ae.constantMax);break;case 2:re=ae.separateAxes?GradientSize.createByRandomTwoGradientSeparate(this._initParticleSize(ae.gradientXMin),this._initParticleSize(ae.gradientYMin),this._initParticleSize(ae.gradientZMin),this._initParticleSize(ae.gradientXMax),this._initParticleSize(ae.gradientYMax),this._initParticleSize(ae.gradientZMax)):GradientSize.createByRandomTwoGradient(this._initParticleSize(ae.gradientMin),this._initParticleSize(ae.gradientMax))}var le=new SizeOverLifetime(re);le.enbale=ne.enable,h.sizeOverLifetime=le}var _e=t.rotationOverLifetime;if(_e){var he,ue=_e.angularVelocity;switch(ue.type){case 0:ue.separateAxes||(he=GradientAngularVelocity.createByConstant(ue.constant*r));break;case 1:ue.separateAxes||(he=GradientAngularVelocity.createByGradient(this._initParticleRotation(ue.gradient)));break;case 2:if(ue.separateAxes){var ce=ue.constantMinSeparate,de=ue.constantMaxSeparate;he=GradientAngularVelocity.createByRandomTwoConstantSeparate(new Vector3(ce[0]*r,ce[1]*r,ce[2]*r),new Vector3(de[0]*r,de[1]*r,de[2]*r))}else he=GradientAngularVelocity.createByRandomTwoConstant(ue.constantMin*r,ue.constantMax*r);break;case 3:ue.separateAxes||(he=GradientAngularVelocity.createByRandomTwoGradient(this._initParticleRotation(ue.gradientMin),this._initParticleRotation(ue.gradientMax)))}var fe=new RotationOverLifetime(he);fe.enbale=_e.enable,h.rotationOverLifetime=fe}var me=t.textureSheetAnimation;if(me){var pe,ge=me.frame;switch(ge.type){case 0:pe=FrameOverTime.createByConstant(ge.constant);break;case 1:pe=FrameOverTime.createByOverTime(this._initParticleFrame(ge.overTime));break;case 2:pe=FrameOverTime.createByRandomTwoConstant(ge.constantMin,ge.constantMax);break;case 3:pe=FrameOverTime.createByRandomTwoOverTime(this._initParticleFrame(ge.overTimeMin),this._initParticleFrame(ge.overTimeMax))}var ve,xe=me.startFrame;switch(xe.type){case 0:ve=StartFrame.createByConstant(xe.constant);break;case 1:ve=StartFrame.createByRandomTwoConstant(xe.constantMin,xe.constantMax)}var ye=new TextureSheetAnimation(pe,ve);ye.enable=me.enable;var Te=me.tiles;ye.tiles=new Vector2(Te[0],Te[1]),ye.type=me.type,ye.randomRow=me.randomRow;var De=me.rowIndex;void 0!==De&&(ye.rowIndex=De),ye.cycles=me.cycles,h.textureSheetAnimation=ye}},i._activeHierarchy=function(){laya.display.Node.prototype._activeHierarchy.call(this),this.particleSystem.playOnAwake&&this.particleSystem.play()},i._inActiveHierarchy=function(){laya.display.Node.prototype._inActiveHierarchy.call(this),this.particleSystem.isAlive&&this.particleSystem.simulate(0,!0)},i.cloneTo=function(t){var e=t,i=e._particleSystem;this._particleSystem.cloneTo(i);var n=e._render,r=this._render;n.sharedMaterials=r.sharedMaterials,n.enable=r.enable,n.renderMode=r.renderMode,n.mesh=r.mesh,n.stretchedBillboardCameraSpeedScale=r.stretchedBillboardCameraSpeedScale,n.stretchedBillboardSpeedScale=r.stretchedBillboardSpeedScale,n.stretchedBillboardLengthScale=r.stretchedBillboardLengthScale,n.sortingFudge=r.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._particleSystem.destroy(),this._particleSystem=null)},__getset(0,i,"particleSystem",function(){return this._particleSystem}),__getset(0,i,"particleRender",function(){return this._render}),e.__init__=function(){e.SHADERDEFINE_RENDERMODE_BILLBOARD=e.shaderDefines.registerDefine("SPHERHBILLBOARD"),e.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=e.shaderDefines.registerDefine("STRETCHEDBILLBOARD"),e.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=e.shaderDefines.registerDefine("HORIZONTALBILLBOARD"),e.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=e.shaderDefines.registerDefine("VERTICALBILLBOARD"),e.SHADERDEFINE_COLOROVERLIFETIME=e.shaderDefines.registerDefine("COLOROVERLIFETIME"),e.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=e.shaderDefines.registerDefine("RANDOMCOLOROVERLIFETIME"),e.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=e.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECONSTANT"),e.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=e.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECURVE"),e.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=e.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),e.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=e.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),e.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=e.shaderDefines.registerDefine("TEXTURESHEETANIMATIONCURVE"),e.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=e.shaderDefines.registerDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),e.SHADERDEFINE_ROTATIONOVERLIFETIME=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIME"),e.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMESEPERATE"),e.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECONSTANT"),e.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECURVE"),e.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),e.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=e.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),e.SHADERDEFINE_SIZEOVERLIFETIMECURVE=e.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVE"),e.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=e.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVESEPERATE"),e.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=e.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVES"),e.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=e.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),e.SHADERDEFINE_RENDERMODE_MESH=e.shaderDefines.registerDefine("RENDERMODE_MESH"),e.SHADERDEFINE_SHAPE=e.shaderDefines.registerDefine("SHAPE")
},e.load=function(t){return Laya.loader.create(t,null,null,e)},e._initStartLife=function(t){for(var e=new GradientDataNumber,i=t.startLifetimes,n=0,r=i.length;r>n;n++){var a=i[n];e.add(a.key,a.value)}return e},e.SHADERDEFINE_RENDERMODE_BILLBOARD=0,e.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=0,e.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=0,e.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=0,e.SHADERDEFINE_COLOROVERLIFETIME=0,e.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=0,e.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=0,e.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=0,e.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=0,e.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=0,e.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=0,e.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=0,e.SHADERDEFINE_ROTATIONOVERLIFETIME=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=0,e.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=0,e.SHADERDEFINE_SIZEOVERLIFETIMECURVE=0,e.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=0,e.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=0,e.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=0,e.SHADERDEFINE_RENDERMODE_MESH=0,e.SHADERDEFINE_SHAPE=0,e.WORLDPOSITION=0,e.WORLDROTATION=1,e.POSITIONSCALE=4,e.SIZESCALE=5,e.SCALINGMODE=6,e.GRAVITY=7,e.THREEDSTARTROTATION=8,e.STRETCHEDBILLBOARDLENGTHSCALE=9,e.STRETCHEDBILLBOARDSPEEDSCALE=10,e.SIMULATIONSPACE=11,e.CURRENTTIME=12,e.VOLVELOCITYCONST=13,e.VOLVELOCITYGRADIENTX=14,e.VOLVELOCITYGRADIENTY=15,e.VOLVELOCITYGRADIENTZ=16,e.VOLVELOCITYCONSTMAX=17,e.VOLVELOCITYGRADIENTXMAX=18,e.VOLVELOCITYGRADIENTYMAX=19,e.VOLVELOCITYGRADIENTZMAX=20,e.VOLSPACETYPE=21,e.COLOROVERLIFEGRADIENTALPHAS=22,e.COLOROVERLIFEGRADIENTCOLORS=23,e.MAXCOLOROVERLIFEGRADIENTALPHAS=24,e.MAXCOLOROVERLIFEGRADIENTCOLORS=25,e.SOLSIZEGRADIENT=26,e.SOLSIZEGRADIENTX=27,e.SOLSIZEGRADIENTY=28,e.SOLSizeGradientZ=29,e.SOLSizeGradientMax=30,e.SOLSIZEGRADIENTXMAX=31,e.SOLSIZEGRADIENTYMAX=32,e.SOLSizeGradientZMAX=33,e.ROLANGULARVELOCITYCONST=34,e.ROLANGULARVELOCITYCONSTSEPRARATE=35,e.ROLANGULARVELOCITYGRADIENT=36,e.ROLANGULARVELOCITYGRADIENTX=37,e.ROLANGULARVELOCITYGRADIENTY=38,e.ROLANGULARVELOCITYGRADIENTZ=39,e.ROLANGULARVELOCITYGRADIENTW=40,e.ROLANGULARVELOCITYCONSTMAX=41,e.ROLANGULARVELOCITYCONSTMAXSEPRARATE=42,e.ROLANGULARVELOCITYGRADIENTMAX=43,e.ROLANGULARVELOCITYGRADIENTXMAX=44,e.ROLANGULARVELOCITYGRADIENTYMAX=45,e.ROLANGULARVELOCITYGRADIENTZMAX=46,e.ROLANGULARVELOCITYGRADIENTWMAX=47,e.TEXTURESHEETANIMATIONCYCLES=48,e.TEXTURESHEETANIMATIONSUBUVLENGTH=49,e.TEXTURESHEETANIMATIONGRADIENTUVS=50,e.TEXTURESHEETANIMATIONGRADIENTMAXUVS=51,__static(e,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(RenderableSprite3D.shaderDefines)}]),e}(RenderableSprite3D),SkinnedMeshSprite3D=function(t){function e(t,i){this._subMeshOffset=null,this._meshFilter=null,e.__super.call(this,i),this._subMeshOffset=[],this._meshFilter=new MeshFilter(this),this._render=new SkinnedMeshRender(this,4),t&&(this._meshFilter.sharedMesh=t)}__class(e,"laya.d3.core.SkinnedMeshSprite3D",t);var i=e.prototype;return i._parse=function(t,e){laya.d3.core.Sprite3D.prototype._parse.call(this,t,e);var i=this.skinnedMeshRender,n=t.lightmapIndex;null!=n&&(i.lightmapIndex=n);var r=t.lightmapScaleOffset;r&&(i.lightmapScaleOffset=new Vector4(r[0],r[1],r[2],r[3]));var a,s;a=t.meshPath,a&&(s=Loader.getRes(e[a]),this.meshFilter.sharedMesh=s);var o=t.materials;if(o){var l=i.sharedMaterials,_=o.length;l.length=_;for(var h=0;_>h;h++)l[h]=Loader.getRes(e[o[h].path]);i.sharedMaterials=l}var u=t.rootBone;u&&i._setRootBone(u);var c=t.boundBox,d=c.min,f=c.max,m=new BoundBox(new Vector3(d[0],d[1],d[2]),new Vector3(f[0],f[1],f[2]));i.localBoundBox=m;var p=t.boundSphere;if(p){var g=p.center,v=new BoundSphere(new Vector3(g[0],g[1],g[2]),p.radius);i.localBoundSphere=v}},i._changeHierarchyAnimator=function(e){var i=this._hierarchyAnimator;t.prototype._changeHierarchyAnimator.call(this,e),i&&i.unLinkSprite3DToAvatarNode(this),e&&e.linkSprite3DToAvatarNode(this.skinnedMeshRender._rootBone,this),this.skinnedMeshRender._setCacheAnimator(e)},i._changeAnimatorAvatar=function(t){this.skinnedMeshRender._setCacheAvatar(t)},i.cloneTo=function(t){var e=t;e._meshFilter.sharedMesh=this._meshFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n._castShadow=i._castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,n._rootBone=i._rootBone;var a=i.localBoundSphere;a&&(n.localBoundSphere=a.clone());var s=i.localBoundBox;s&&(n.localBoundBox=s.clone()),laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._meshFilter._destroy())},__getset(0,i,"meshFilter",function(){return this._meshFilter}),__getset(0,i,"skinnedMeshRender",function(){return this._render}),e.__init__=function(){e.SHADERDEFINE_BONE=e.shaderDefines.registerDefine("BONE")},e.load=function(t){return Laya.loader.create(t,null,null,e)},e.SHADERDEFINE_BONE=0,e.BONES=0,__static(e,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(RenderableSprite3D.shaderDefines)}]),e}(RenderableSprite3D),TrailSprite3D=function(t){function e(){this._geometryFilter=null,e.__super.call(this),this._render=new TrailRenderer(this),this._geometryFilter=new TrailFilter(this)}__class(e,"laya.d3.core.trail.TrailSprite3D",t);var i=e.prototype;return i._parse=function(t,e){laya.d3.core.Sprite3D.prototype._parse.call(this,t,e);var i=this._render,n=this._geometryFilter,r=0,a=0,s=t.materials;if(s){var o=i.sharedMaterials,l=s.length;for(o.length=l,r=0;l>r;r++)o[r]=Loader.getRes(e[s[r].path]);i.sharedMaterials=o}n.time=t.time,n.minVertexDistance=t.minVertexDistance,n.widthMultiplier=t.widthMultiplier,n.textureMode=t.textureMode;var _=[],h=t.widthCurve;for(r=0,a=h.length;a>r;r++){var u=new TrailKeyFrame;u.time=h[r].time,u.inTangent=h[r].inTangent,u.outTangent=h[r].outTangent,u.value=h[r].value,_.push(u)}n.widthCurve=_;var c=t.colorGradient,d=new Gradient;d.mode=c.mode;var f,m,p=[],g=c.colorKeys;for(r=0,a=g.length;a>r;r++)m=g[r],f=new GradientColorKey(new Color$1(m.value[0],m.value[1],m.value[2],1),m.time),p.push(f);var v,x,y=[],T=c.alphaKeys;for(r=0,a=T.length;a>r;r++)x=T[r],v=new GradientAlphaKey(x.value,x.time),y.push(v);d.setKeys(p,y),n.colorGradient=d},i.reset=function(){this.trailFilter.reset()},i.cloneTo=function(t){laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t);var e=0,i=0,n=t,r=n.trailFilter;r.time=this.trailFilter.time,r.minVertexDistance=this.trailFilter.minVertexDistance,r.widthMultiplier=this.trailFilter.widthMultiplier;var a=this.trailFilter.widthCurve,s=[];for(e=0,i=a.length;i>e;e++){var o=new TrailKeyFrame;a[e].cloneTo(o),s.push(o)}r.widthCurve=s;var l=new Gradient;this.trailFilter.colorGradient.cloneTo(l),r.colorGradient=l,r.textureMode=this.trailFilter.textureMode;var _=n.trailRender;_.sharedMaterial=this.trailRender.sharedMaterial},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter.destroy(),this._geometryFilter=null)},__getset(0,i,"trailFilter",function(){return this._geometryFilter}),__getset(0,i,"trailRender",function(){return this._render}),e.__init__=function(){e.SHADERDEFINE_GRADIENTMODE_BLEND=e.shaderDefines.registerDefine("GRADIENTMODE_BLEND")},e.CURTIME=3,e.LIFETIME=4,e.WIDTHCURVE=5,e.WIDTHCURVEKEYLENGTH=6,e.GRADIENTCOLORKEY=7,e.GRADIENTALPHAKEY=8,e.SHADERDEFINE_GRADIENTMODE_BLEND=0,__static(e,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(RenderableSprite3D.shaderDefines)}]),e}(RenderableSprite3D),Box=function(t){function e(){e.__super.call(this)}__class(e,"laya.ui.Box",t);var i=e.prototype;return Laya.imps(i,{"laya.ui.IBox":!0}),__getset(0,i,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t;for(var e in t){var i=this.getChildByName(e);i?i.dataSource=t[e]:this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=t[e])}}),e}(UIComponent),TerrainChunk=function(t){function e(t,i,n,r,a,s,o,l){this._terrainFilter=null,e.__super.call(this,l),this._terrainFilter=new TerrainFilter(this,t,i,n,r,a,s,o),this._render=new TerrainRender(this)}__class(e,"laya.d3.terrain.TerrainChunk",t);var i=e.prototype;return i.buildRenderElementAndMaterial=function(t,e,i,n,r,a,s,o,l,_,h,u,c,d,f,m,p,g){void 0===h&&(h=1),void 0===u&&(u=1),void 0===c&&(c=1),void 0===d&&(d=1),void 0===f&&(f=1),void 0===m&&(m=1),void 0===p&&(p=1),void 0===g&&(g=1);var v=new TerrainMaterial;l&&(v.diffuseColor=l),o&&(v.ambientColor=o),_&&(v.specularColor=_),v.splatAlphaTexture=Loader.getRes(i),v.normalTexture=e?Loader.getRes(e):null,v.diffuseTexture1=n?Loader.getRes(n):null,v.diffuseTexture2=r?Loader.getRes(r):null,v.diffuseTexture3=a?Loader.getRes(a):null,v.diffuseTexture4=s?Loader.getRes(s):null,v.setDiffuseScale1(h,u),v.setDiffuseScale2(c,d),v.setDiffuseScale3(f,m),v.setDiffuseScale4(p,g),v.setDetailNum(t),0!=this._render._renderElements.length&&(v.renderMode=2);var x=new RenderElement;x.setTransform(this._transform),x.render=this._render,x.setGeometry(this._terrainFilter),this._render._renderElements.push(x),this._render.sharedMaterial=v},i.cloneTo=function(){console.log("Terrain Chunk can't clone")},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._terrainFilter.destroy(),this._terrainFilter=null)},__getset(0,i,"terrainFilter",function(){return this._terrainFilter}),__getset(0,i,"terrainRender",function(){return this._render}),e.load=function(t){return Laya.loader.create(t,null,null,e,null,1,!1)},e}(RenderableSprite3D),SphereMesh=function(t){function e(t,i,n){this._radius=0/0,this._slices=0,this._stacks=0,void 0===t&&(t=.5),void 0===i&&(i=32),void 0===n&&(n=32),e.__super.call(this),this._radius=t,this._stacks=i,this._slices=n,this._create()}__class(e,"laya.d3.resource.models.SphereMesh",t);var i=e.prototype;return i._create=function(){for(var t=(this._stacks+1)*(this._slices+1),e=3*this._stacks*(this._slices+1)*2,i=new Uint16Array(e),n=VertexPositionNormalTexture.vertexDeclaration,r=n.vertexStride/4,a=new Float32Array(t*r),s=Math.PI/this._stacks,o=2*Math.PI/this._slices,l=0,t=0,e=0,_=0;_<this._stacks+1;_++)for(var h=Math.sin(_*s),u=Math.cos(_*s),c=0;c<this._slices+1;c++){var d=h*Math.sin(c*o+1*Math.PI/2),f=h*Math.cos(c*o+1*Math.PI/2);a[t+0]=d*this._radius,a[t+1]=u*this._radius,a[t+2]=f*this._radius,a[t+3]=d,a[t+4]=u,a[t+5]=f,a[t+6]=c/this._slices,a[t+7]=_/this._stacks,t+=r,_!=this._stacks-1&&(i[e++]=l+(this._slices+1),i[e++]=l,i[e++]=l+1,i[e++]=l+this._slices,i[e++]=l,i[e++]=l+(this._slices+1),l++)}this.setData(n,a,i)},__getset(0,i,"radius",function(){return this._radius},function(t){this._radius!==t&&(this._radius=t,this.releaseResource(),this._create())}),__getset(0,i,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this._create())}),__getset(0,i,"stacks",function(){return this._stacks},function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this._create())}),e}(PrimitiveMesh);Laya.__init([LoaderManager,EventDispatcher,Render,WebGLContext2D,SceneUtils,Path,Earcut,Timer,ShaderCompile]),new PerformanceTest_Maggots}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});for(var i in Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}});