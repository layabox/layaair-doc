# 百度小游戏的5M本地包与动态资源加载

>author：charley

私たちは通常プロジェクトを開発する時、直接にローカルパスを使用します。例で参照するのはローカルパスです。


```json

Laya.Texture2D.load("res/layabox.png");
```


プロジェクトのカタログの大きさを全部合わせて5 Mを超えないなら、現地の資源を見つけられたら、どうやって書いても大丈夫です。

しかし、

Baiduの小ゲームのローカルパッケージは5 Mの制限があります。この制限を超えると、アップロードできません。

だから、私たちの**プロジェクトが5 Mより大きい場合、どう処理しますか？**

一つの案はパッケージを分けて、ゲームの基礎ライブラリの2.0バージョンから10 Mまでの配置でパッケージ化できる。下請けについては、別途文書で詳しく説明します。ここで別の案について話します。

もう一つの案はネットワークの動的ローディングであり、

私たちは地元のカバンの中に、JSコードを入れなければなりません。JSはネットのローディングができないので、動的に作成されました。したがって、ローカルパケット内のJSが5 Mを超える場合、まずJSの体積をどのように最適化するかを考えます。例えば、混淆圧縮とUIコード分離です。やはりだめなら、ミニゲームのパッケージで解決するしかないです。JSが5 Mを超えていないなら、状況に応じて、あらかじめロードするための基礎資源を置くこともできます。

つまり、ほとんどのミニゲームにとっては、ネットを動的にロードするのは必須の方法です。

それは**ネットワークのダイナミックロードの経路はどうなりますか？**。ローカルにロードされた`load()`方法の後に使う`URL.basePath`方法。

たとえば:


```java

material.diffuseTexture = Laya.Texture2D.load("res/layabox.png");
box.meshRender.material = material;
Laya.URL.basePath = "https://XXXX.com";//请把XXXX换成自己的真实网址；
//在此之下，再使用load加载资源，都会自动加入URL网址。从网络上动态加载。
```


使用`URL.basePath`方法の後、ロードを使ってローカルパスをロードすると、自動的にURL.basePathのアドレスが追加されます。これにより、ローカルとネットワークのロードとの結合が実現される。

**これで終わりですか？ありません**

先ほどの書き方で、`res/layabox.png`Baiduのゲームのローカルディレクトリにアップロードしましたが、使っています。`URL.basePath`その後、再読み込み`res/layabox.png`ローカルからのロードではなく、ネットワークからの動的なロードで使用します。これは私たちが望む結果ではない。

だから、エンジンは使用に対して`URL.basePath`その後、どうやって再びローカルローディングを使うか、行いました。**特殊ディレクトリとファイルの処理**つまり、ローカルパッケージホワイトリストの仕組みです。次の例に示します


```json

BMiniAdpter.nativefiles =  [
    "wxlocal",
    "res/atlas/houzi.atlas",
    "res/atlas/houzi.png",
    "common/tishi.png",
    "common/bg.png",
    "ui.json",
    "newLb/bg031.png"
];
```


**BMiniAdpter.native filesに存在するディレクトリ名またはファイルであれば、エンジンは自動的にこのディレクトリをローカルディレクトリとして認識します。**URL.basePathを使用しても、native filesホワイトリストに含まれるディレクトリ名やファイルは、ネットワークから動的にロードされず、ローカルからのみロードされます。



この文書に疑問があれば、公式サイトに質問してください。コミュニティの中のリンクを公式QQ群の中@管理人charleyに送ってもいいです。

コミュニティURL：https://ask.layabox.com/



##この文章は賞賛します

本論文があなたのために役立つと思ったら、スキャンコードの作者への賞賛を歓迎します。激励は私たちがより多くの優れた文書を書くための動力です。

![wechatPay](../../../wechatPay.jpg)